{"file_contents":{"client/src/pages/Ideas.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Loader2, Heart, MessageCircle, Send, Lightbulb, Image, Video, ChevronDown, ChevronUp, FileText, Download, Trophy, Clock, Pencil, Trash2, MoreVertical, Reply, X, EyeOff, Search, Filter, ArrowUpDown } from \"lucide-react\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { getIdeas, createIdea, toggleLike, addComment, editComment, deleteComment } from \"@/lib/api/ideas\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\nimport FileUpload from \"@/components/FileUpload\";\nimport { motion } from \"framer-motion\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\nimport utc from \"dayjs/plugin/utc\";\nimport timezone from \"dayjs/plugin/timezone\";\n\ndayjs.extend(relativeTime);\ndayjs.extend(utc);\ndayjs.extend(timezone);\ndayjs.locale(\"tr\");\n\nexport default function Ideas() {\n  const [open, setOpen] = useState(false);\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [videoUrl, setVideoUrl] = useState(\"\");\n  const [attachmentUrl, setAttachmentUrl] = useState(\"\");\n  const [attachmentType, setAttachmentType] = useState<'image' | 'video' | 'pdf' | 'document' | undefined>();\n  const [isAnonymous, setIsAnonymous] = useState(false);\n  const [isCommentAnonymous, setIsCommentAnonymous] = useState<Record<string, boolean>>({});\n  const [expandedIdea, setExpandedIdea] = useState<string | null>(null);\n  const [commentText, setCommentText] = useState<Record<string, string>>({});\n  const [editingComment, setEditingComment] = useState<{ id: string; content: string } | null>(null);\n  const [deleteCommentId, setDeleteCommentId] = useState<string | null>(null);\n  const [replyingTo, setReplyingTo] = useState<{ commentId: string; authorName: string; ideaId: string } | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\" | \"most_liked\" | \"most_commented\">(\"newest\");\n  const { toast } = useToast();\n  const { user, profile } = useAuth();\n  const [, setLocation] = useLocation();\n\n  const { data: ideas, isLoading } = useQuery({\n    queryKey: ['/api/ideas'],\n    queryFn: getIdeas,\n  });\n\n  // Filter and sort ideas\n  const filteredAndSortedIdeas = ideas ? [...ideas]\n    .filter((idea: any) => {\n      if (!searchQuery) return true;\n      const query = searchQuery.toLowerCase();\n      const authorName = idea.author \n        ? `${idea.author.first_name || \"\"} ${idea.author.last_name || \"\"}`.toLowerCase()\n        : \"\";\n      return (\n        idea.title.toLowerCase().includes(query) ||\n        idea.content.toLowerCase().includes(query) ||\n        authorName.includes(query)\n      );\n    })\n    .sort((a: any, b: any) => {\n      switch (sortBy) {\n        case \"newest\":\n          return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\n        case \"oldest\":\n          return new Date(a.created_at).getTime() - new Date(b.created_at).getTime();\n        case \"most_liked\":\n          return (b.likes_count || 0) - (a.likes_count || 0);\n        case \"most_commented\":\n          return (b.comments?.length || 0) - (a.comments?.length || 0);\n        default:\n          return 0;\n      }\n    })\n  : [];\n\n  const createMutation = useMutation({\n    mutationFn: (data: { title: string; content: string; imageUrl?: string; videoUrl?: string; attachmentUrl?: string; attachmentType?: string; is_anonymous?: boolean }) => {\n      if (!user) {\n        toast({\n          title: \"Giriş Gerekli\",\n          description: \"Fikir paylaşmak için giriş yapmanız gerekiyor\",\n        });\n        setTimeout(() => setLocation(\"/giris\"), 1500);\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return createIdea(data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ideas'] });\n      setTitle(\"\");\n      setContent(\"\");\n      setImageUrl(\"\");\n      setVideoUrl(\"\");\n      setAttachmentUrl(\"\");\n      setAttachmentType(undefined);\n      setIsAnonymous(false);\n      setOpen(false);\n      toast({\n        title: \"Fikir gönderildi!\",\n        description: \"Fikriniz yönetici onayından sonra yayınlanacak.\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          title: \"Hata\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const likeMutation = useMutation({\n    mutationFn: (ideaId: string) => {\n      if (!user) {\n        toast({\n          title: \"Giriş Gerekli\",\n          description: \"Beğenmek için giriş yapmanız gerekiyor\",\n        });\n        setTimeout(() => setLocation(\"/giris\"), 1500);\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return toggleLike(ideaId);\n    },\n    onMutate: async (ideaId) => {\n      if (!user) return { previousIdeas: null };\n\n      // Cancel outgoing refetches\n      await queryClient.cancelQueries({ queryKey: ['/api/ideas'] });\n\n      // Snapshot previous value\n      const previousIdeas = queryClient.getQueryData(['/api/ideas']);\n\n      // Optimistically update\n      queryClient.setQueryData(['/api/ideas'], (old: any) => {\n        if (!old) return old;\n        return old.map((idea: any) => {\n          if (idea.id === ideaId) {\n            return {\n              ...idea,\n              user_has_liked: !idea.user_has_liked,\n              likes_count: idea.user_has_liked \n                ? (idea.likes_count || 1) - 1 \n                : (idea.likes_count || 0) + 1,\n            };\n          }\n          return idea;\n        });\n      });\n\n      return { previousIdeas };\n    },\n    onError: (err: any, ideaId, context: any) => {\n      // Rollback on error\n      if (context?.previousIdeas) {\n        queryClient.setQueryData(['/api/ideas'], context.previousIdeas);\n      }\n      if (err.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          title: \"Hata\",\n          description: \"Beğeni kaydedilemedi\",\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const commentMutation = useMutation({\n    mutationFn: ({ ideaId, content, parentId, isAnonymous }: { ideaId: string; content: string; parentId?: string; isAnonymous?: boolean }) => {\n      if (!user) {\n        toast({\n          title: \"Giriş Gerekli\",\n          description: \"Yorum yapmak için giriş yapmanız gerekiyor\",\n        });\n        setTimeout(() => setLocation(\"/giris\"), 1500);\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return addComment(ideaId, content, parentId, isAnonymous);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ideas'] });\n      setCommentText({ ...commentText, [variables.ideaId]: '' });\n      setIsCommentAnonymous({ ...isCommentAnonymous, [variables.ideaId]: false });\n      setReplyingTo(null);\n      toast({\n        title: variables.parentId ? \"Yanıt gönderildi!\" : \"Yorum gönderildi!\",\n        description: \"Yorumunuz yönetici onayından sonra yayınlanacak.\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          title: \"Hata\",\n          description: error.message,\n          variant: \"destructive\",\n        });\n      }\n    },\n  });\n\n  const editCommentMutation = useMutation({\n    mutationFn: ({ commentId, content }: { commentId: string; content: string }) => {\n      return editComment(commentId, content);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ideas'] });\n      setEditingComment(null);\n      toast({\n        title: \"Yorum düzenlendi!\",\n        description: \"Yorumunuz tekrar yönetici onayına gönderildi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteCommentMutation = useMutation({\n    mutationFn: (commentId: string) => {\n      return deleteComment(commentId);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ideas'] });\n      setDeleteCommentId(null);\n      toast({\n        title: \"Yorum silindi\",\n        description: \"Yorumunuz başarıyla silindi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = () => {\n    if (!title.trim() || !content.trim()) {\n      toast({\n        title: \"Eksik bilgi\",\n        description: \"Başlık ve içerik zorunludur.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createMutation.mutate({ \n      title, \n      content, \n      imageUrl: imageUrl || undefined, \n      videoUrl: videoUrl || undefined,\n      attachmentUrl: attachmentUrl || undefined,\n      attachmentType: attachmentType || undefined,\n      is_anonymous: isAnonymous,\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 lg:px-6 py-8 flex justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8 max-w-3xl\">\n      <div className=\"mb-8 flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold mb-2\">Fikirler</h1>\n          <p className=\"text-muted-foreground\">Öğrenci fikirlerini keşfedin ve paylaşın</p>\n        </div>\n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-new-idea\">\n              <Lightbulb className=\"h-4 w-4 mr-2\" />\n              Yeni Fikir\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Yeni Fikir Paylaş</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <Input\n                placeholder=\"Başlık...\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                data-testid=\"input-idea-title\"\n              />\n              <Textarea\n                placeholder=\"Fikrinizi detaylı açıklayın...\"\n                value={content}\n                onChange={(e) => setContent(e.target.value)}\n                rows={6}\n                data-testid=\"textarea-idea-content\"\n              />\n              \n              <Tabs defaultValue=\"image\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-3\">\n                  <TabsTrigger value=\"image\" className=\"flex items-center gap-2\">\n                    <Image className=\"h-4 w-4\" />\n                    Görsel\n                  </TabsTrigger>\n                  <TabsTrigger value=\"video\" className=\"flex items-center gap-2\">\n                    <Video className=\"h-4 w-4\" />\n                    Video\n                  </TabsTrigger>\n                  <TabsTrigger value=\"document\" className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4\" />\n                    PDF/Doküman\n                  </TabsTrigger>\n                </TabsList>\n                <TabsContent value=\"image\" className=\"mt-4\">\n                  <FileUpload\n                    type=\"image\"\n                    currentUrl={imageUrl}\n                    onUploadComplete={(url) => setImageUrl(url)}\n                    onRemove={() => setImageUrl(\"\")}\n                  />\n                </TabsContent>\n                <TabsContent value=\"video\" className=\"mt-4\">\n                  <FileUpload\n                    type=\"video\"\n                    currentUrl={videoUrl}\n                    onUploadComplete={(url) => setVideoUrl(url)}\n                    onRemove={() => setVideoUrl(\"\")}\n                  />\n                </TabsContent>\n                <TabsContent value=\"document\" className=\"mt-4\">\n                  <FileUpload\n                    type=\"all\"\n                    currentUrl={attachmentUrl}\n                    onUploadComplete={(url, type) => {\n                      setAttachmentUrl(url);\n                      setAttachmentType(type);\n                    }}\n                    onRemove={() => {\n                      setAttachmentUrl(\"\");\n                      setAttachmentType(undefined);\n                    }}\n                    accept=\".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt\"\n                  />\n                </TabsContent>\n              </Tabs>\n              \n              <div className=\"flex items-center space-x-2 py-2 px-3 bg-muted/50 rounded-lg\">\n                <Checkbox \n                  id=\"anonymous\" \n                  checked={isAnonymous} \n                  onCheckedChange={(checked) => setIsAnonymous(checked === true)}\n                  data-testid=\"checkbox-anonymous\"\n                />\n                <Label htmlFor=\"anonymous\" className=\"flex items-center gap-2 cursor-pointer text-sm\">\n                  <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                  Anonim olarak paylaş\n                </Label>\n                <span className=\"text-xs text-muted-foreground ml-auto\">\n                  (Yöneticiler kimliğinizi görebilir)\n                </span>\n              </div>\n              \n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel-idea\">\n                  İptal\n                </Button>\n                <Button onClick={handleSubmit} disabled={createMutation.isPending} data-testid=\"button-submit-idea\">\n                  {createMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      Gönderiliyor...\n                    </>\n                  ) : (\n                    <>\n                      <Send className=\"h-4 w-4 mr-2\" />\n                      Paylaş\n                    </>\n                  )}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Search and Filter */}\n      <div className=\"mb-6 flex flex-col sm:flex-row gap-3\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Fikir ara (başlık, içerik veya yazar)...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-ideas\"\n          />\n        </div>\n        <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>\n          <SelectTrigger className=\"w-full sm:w-48\" data-testid=\"select-sort-ideas\">\n            <ArrowUpDown className=\"h-4 w-4 mr-2\" />\n            <SelectValue placeholder=\"Sırala\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"newest\">En Yeni</SelectItem>\n            <SelectItem value=\"oldest\">En Eski</SelectItem>\n            <SelectItem value=\"most_liked\">En Çok Beğenilen</SelectItem>\n            <SelectItem value=\"most_commented\">En Çok Yorumlanan</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Top 3 Most Liked Ideas */}\n      {ideas && ideas.length > 0 && !searchQuery && (\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <Trophy className=\"h-5 w-5 text-yellow-500\" />\n            <h2 className=\"text-xl font-bold\">En Popüler Fikirler</h2>\n          </div>\n          <div className=\"grid gap-4 md:grid-cols-3\">\n            {[...ideas]\n              .sort((a: any, b: any) => (b.likes_count || 0) - (a.likes_count || 0))\n              .slice(0, 3)\n              .map((idea: any, index: number) => {\n                const isIdeaAnon = idea.is_anonymous && !idea.author;\n                const authorName = idea.author\n                  ? `${idea.author.first_name || \"\"} ${idea.author.last_name || \"\"}`.trim()\n                  : \"Anonim\";\n                const showIdeaAnonBadge = idea.is_anonymous && idea.author && profile?.role === 'admin';\n                const authorPicture = idea.author?.profile_picture_status === 'approved' ? idea.author?.profile_picture_url : null;\n                const initials = isIdeaAnon ? \"\" : authorName\n                  .split(\" \")\n                  .map((n) => n[0])\n                  .join(\"\")\n                  .toUpperCase()\n                  .slice(0, 2);\n                const medalColors = ['text-yellow-500', 'text-gray-400', 'text-amber-600'];\n                \n                return (\n                  <Card key={idea.id} className=\"p-4 relative\" data-testid={`card-top-idea-${idea.id}`}>\n                    <div className=\"absolute -top-2 -left-2 w-8 h-8 rounded-full bg-background border flex items-center justify-center\">\n                      <span className={`font-bold ${medalColors[index]}`}>{index + 1}</span>\n                    </div>\n                    <div className=\"flex items-center gap-3 mb-3\">\n                      <Avatar className=\"h-8 w-8\">\n                        {authorPicture && <AvatarImage src={authorPicture} alt={authorName} />}\n                        <AvatarFallback className=\"text-xs\">{isIdeaAnon ? <EyeOff className=\"h-4 w-4\" /> : initials}</AvatarFallback>\n                      </Avatar>\n                      <span className=\"text-sm font-medium truncate\">\n                        {authorName}\n                        {showIdeaAnonBadge && (\n                          <span className=\"ml-1 text-xs text-muted-foreground font-normal inline-flex items-center gap-1\">\n                            <EyeOff className=\"h-3 w-3\" />\n                          </span>\n                        )}\n                      </span>\n                    </div>\n                    <h3 className=\"font-bold mb-2 line-clamp-2\">{idea.title}</h3>\n                    <p className=\"text-sm text-muted-foreground line-clamp-2 mb-3\">{idea.content}</p>\n                    <div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <Heart className={`h-4 w-4 ${idea.user_has_liked ? 'fill-red-500 text-red-500' : ''}`} />\n                        {idea.likes_count || 0}\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <MessageCircle className=\"h-4 w-4\" />\n                        {idea.comments?.length || 0}\n                      </span>\n                    </div>\n                  </Card>\n                );\n              })}\n          </div>\n        </div>\n      )}\n\n      {/* Ideas List */}\n      <div className=\"flex items-center justify-between gap-2 mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <Clock className=\"h-5 w-5 text-primary\" />\n          <h2 className=\"text-xl font-bold\">\n            {searchQuery ? `Arama Sonuçları (${filteredAndSortedIdeas.length})` : \"Tüm Fikirler\"}\n          </h2>\n        </div>\n        {searchQuery && (\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setSearchQuery(\"\")}\n            data-testid=\"button-clear-search\"\n          >\n            <X className=\"h-4 w-4 mr-1\" />\n            Temizle\n          </Button>\n        )}\n      </div>\n\n      <div className=\"space-y-4\">\n        {filteredAndSortedIdeas.length > 0 ? (\n          filteredAndSortedIdeas.map((idea: any) => {\n            const isIdeaAnon = idea.is_anonymous && !idea.author;\n            const authorName = idea.author\n              ? `${idea.author.first_name || \"\"} ${idea.author.last_name || \"\"}`.trim()\n              : \"Anonim\";\n            const showIdeaAnonBadge = idea.is_anonymous && idea.author && profile?.role === 'admin';\n            const authorClass = isIdeaAnon ? \"\" : (idea.author?.class_name || \"\");\n            const authorPicture = idea.author?.profile_picture_status === 'approved' ? idea.author?.profile_picture_url : null;\n            const initials = isIdeaAnon ? \"\" : authorName\n              .split(\" \")\n              .map((n) => n[0])\n              .join(\"\")\n              .toUpperCase()\n              .slice(0, 2);\n\n            return (\n              <Card key={idea.id} className=\"p-6\" data-testid={`card-idea-${idea.id}`}>\n                <div className=\"flex gap-4\">\n                  <Avatar>\n                    {authorPicture && <AvatarImage src={authorPicture} alt={authorName} />}\n                    <AvatarFallback>{isIdeaAnon ? <EyeOff className=\"h-5 w-5\" /> : initials}</AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-baseline gap-2 mb-2\">\n                      <span className=\"font-semibold\">\n                        {authorName}\n                        {showIdeaAnonBadge && (\n                          <span className=\"ml-2 text-xs text-muted-foreground font-normal inline-flex items-center gap-1\">\n                            <EyeOff className=\"h-3 w-3\" />\n                            Anonim\n                          </span>\n                        )}\n                      </span>\n                      {authorClass && (\n                        <span className=\"text-sm text-muted-foreground\">{authorClass}</span>\n                      )}\n                      <span className=\"text-sm text-muted-foreground\">·</span>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {dayjs.utc(idea.created_at).local().fromNow()}\n                      </span>\n                    </div>\n                    <h3 className=\"font-bold text-lg mb-2\">{idea.title}</h3>\n                    <p className=\"text-foreground whitespace-pre-wrap mb-4\">{idea.content}</p>\n                    \n                    {idea.image_url && (\n                      <img \n                        src={idea.image_url} \n                        alt={idea.title}\n                        className=\"rounded-lg mb-4 max-h-96 object-cover w-full\"\n                      />\n                    )}\n                    \n                    {idea.video_url && (\n                      <video \n                        src={idea.video_url}\n                        controls\n                        className=\"rounded-lg mb-4 max-h-96 w-full\"\n                      />\n                    )}\n                    \n                    {idea.attachment_url && (idea.attachment_type === 'pdf' || idea.attachment_type === 'document') && (\n                      <a \n                        href={idea.attachment_url} \n                        download \n                        target=\"_blank\" \n                        rel=\"noopener noreferrer\"\n                        className=\"inline-flex items-center gap-2 mb-4 px-4 py-2 bg-primary/10 text-primary rounded-md hover:bg-primary/20 transition-colors text-sm\"\n                        data-testid={`link-download-attachment-${idea.id}`}\n                      >\n                        <FileText className=\"h-4 w-4\" />\n                        {idea.attachment_type === 'pdf' ? 'PDF Dosyası' : 'Doküman'} İndir\n                        <Download className=\"h-4 w-4\" />\n                      </a>\n                    )}\n\n                    <div className=\"flex items-center gap-6 text-muted-foreground\">\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger asChild>\n                            <button\n                              onClick={() => likeMutation.mutate(idea.id)}\n                              className={`flex items-center gap-2 hover-elevate active-elevate-2 rounded-md px-3 py-1.5 transition-colors ${\n                                idea.user_has_liked ? 'text-primary' : ''\n                              }`}\n                              data-testid={`button-like-${idea.id}`}\n                            >\n                              <motion.div\n                                key={idea.user_has_liked ? 'liked' : 'unliked'}\n                                initial={{ scale: 1 }}\n                                animate={{ scale: [1, 1.3, 1] }}\n                                transition={{ \n                                  duration: 0.3,\n                                  ease: \"easeInOut\"\n                                }}\n                              >\n                                <Heart className={`h-5 w-5 ${idea.user_has_liked ? 'fill-current' : ''}`} />\n                              </motion.div>\n                              <span className=\"text-sm font-medium\">{idea.likes_count || 0}</span>\n                            </button>\n                          </TooltipTrigger>\n                          {!user && (\n                            <TooltipContent>\n                              <p>Beğenmek için giriş yapın</p>\n                            </TooltipContent>\n                          )}\n                        </Tooltip>\n                      </TooltipProvider>\n                      <button\n                        onClick={() => setExpandedIdea(expandedIdea === idea.id ? null : idea.id)}\n                        className=\"flex items-center gap-2 hover-elevate active-elevate-2 rounded-md px-3 py-1.5\"\n                        data-testid={`button-comments-${idea.id}`}\n                      >\n                        <MessageCircle className=\"h-5 w-5\" />\n                        <span className=\"text-sm font-medium\">{idea.comments?.length || 0}</span>\n                        {expandedIdea === idea.id ? (\n                          <ChevronUp className=\"h-4 w-4\" />\n                        ) : (\n                          <ChevronDown className=\"h-4 w-4\" />\n                        )}\n                      </button>\n                    </div>\n\n                    {/* Comments Section */}\n                    {expandedIdea === idea.id && (\n                      <div className=\"mt-4 pt-4 border-t space-y-4\">\n                        {/* Comment List */}\n                        {idea.comments && idea.comments.length > 0 ? (\n                          <div className=\"space-y-3\">\n                            {idea.comments.map((comment: any) => {\n                              const isCommentAnon = comment.is_anonymous && !comment.author;\n                              const commentAuthor = comment.author\n                                ? `${comment.author.first_name || \"\"} ${comment.author.last_name || \"\"}`.trim()\n                                : \"Anonim\";\n                              const showAnonBadge = comment.is_anonymous && comment.author && profile?.role === 'admin';\n                              const commentPicture = comment.author?.profile_picture_status === 'approved' ? comment.author?.profile_picture_url : null;\n                              const isOwnComment = profile?.id === comment.author_id;\n                              const isAdmin = profile?.role === 'admin';\n                              const canModify = isOwnComment || isAdmin;\n                              return (\n                                <div key={comment.id} className=\"flex gap-3\">\n                                  <Avatar className=\"h-8 w-8\">\n                                    {commentPicture && <AvatarImage src={commentPicture} alt={commentAuthor} />}\n                                    <AvatarFallback className=\"text-xs\">\n                                      {isCommentAnon ? <EyeOff className=\"h-4 w-4\" /> : commentAuthor.split(\" \").map(n => n[0]).join(\"\").toUpperCase().slice(0, 2)}\n                                    </AvatarFallback>\n                                  </Avatar>\n                                  <div className=\"flex-1\">\n                                    <div className=\"bg-muted rounded-lg p-3 relative\">\n                                      <div className=\"flex items-start justify-between gap-2\">\n                                        <div className=\"flex-1\">\n                                          <p className=\"font-semibold text-sm\">\n                                            {isCommentAnon ? (\n                                              <span className=\"inline-flex items-center gap-1\">\n                                                <EyeOff className=\"h-4 w-4\" />\n                                                Anonim\n                                              </span>\n                                            ) : (\n                                              <>\n                                                {commentAuthor}\n                                                {showAnonBadge && (\n                                                  <span className=\"ml-2 text-xs text-muted-foreground font-normal inline-flex items-center gap-1\">\n                                                    <EyeOff className=\"h-3 w-3\" />\n                                                    Anonim\n                                                  </span>\n                                                )}\n                                              </>\n                                            )}\n                                          </p>\n                                          <p className=\"text-sm\">\n                                            {comment.parent_id && (() => {\n                                              const parentComment = idea.comments?.find((c: any) => c.id === comment.parent_id);\n                                              const parentIsAnon = parentComment?.is_anonymous && !parentComment?.author;\n                                              const parentAuthorName = parentComment?.author \n                                                ? `${parentComment.author.first_name || \"\"} ${parentComment.author.last_name || \"\"}`.trim() \n                                                : null;\n                                              return (\n                                                <span className=\"text-primary font-medium\">\n                                                  @{parentIsAnon ? \"anoimkişi\" : (parentAuthorName || \"anoimkişi\")}{\" \"}\n                                                </span>\n                                              );\n                                            })()}\n                                            {comment.content}\n                                          </p>\n                                        </div>\n                                        {canModify && (\n                                          <DropdownMenu>\n                                            <DropdownMenuTrigger asChild>\n                                              <Button \n                                                variant=\"ghost\" \n                                                size=\"icon\" \n                                                className=\"h-6 w-6 shrink-0\"\n                                                data-testid={`button-comment-menu-${comment.id}`}\n                                              >\n                                                <MoreVertical className=\"h-4 w-4\" />\n                                              </Button>\n                                            </DropdownMenuTrigger>\n                                            <DropdownMenuContent align=\"end\">\n                                              {isOwnComment && (\n                                                <DropdownMenuItem \n                                                  onClick={() => setEditingComment({ id: comment.id, content: comment.content })}\n                                                  data-testid={`button-edit-comment-${comment.id}`}\n                                                >\n                                                  <Pencil className=\"h-4 w-4 mr-2\" />\n                                                  Düzenle\n                                                </DropdownMenuItem>\n                                              )}\n                                              <DropdownMenuItem \n                                                onClick={() => setDeleteCommentId(comment.id)}\n                                                className=\"text-destructive\"\n                                                data-testid={`button-delete-comment-${comment.id}`}\n                                              >\n                                                <Trash2 className=\"h-4 w-4 mr-2\" />\n                                                Sil\n                                              </DropdownMenuItem>\n                                            </DropdownMenuContent>\n                                          </DropdownMenu>\n                                        )}\n                                      </div>\n                                    </div>\n                                    <div className=\"flex items-center gap-3 mt-1 ml-3\">\n                                      <p className=\"text-xs text-muted-foreground\">\n                                        {dayjs.utc(comment.created_at).local().fromNow()}\n                                      </p>\n                                      {user && (\n                                        <button\n                                          onClick={() => setReplyingTo({ \n                                            commentId: comment.id, \n                                            authorName: commentAuthor, \n                                            ideaId: idea.id \n                                          })}\n                                          className=\"text-xs text-primary hover:underline flex items-center gap-1\"\n                                          data-testid={`button-reply-${comment.id}`}\n                                        >\n                                          <Reply className=\"h-3 w-3\" />\n                                          Yanıtla\n                                        </button>\n                                      )}\n                                    </div>\n                                  </div>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-muted-foreground text-center py-4\">Henüz yorum yok</p>\n                        )}\n\n                        {/* Comment Form */}\n                        {user ? (\n                          <div className=\"space-y-2\">\n                            {replyingTo && replyingTo.ideaId === idea.id && (\n                              <div className=\"flex items-center gap-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded-md\">\n                                <Reply className=\"h-4 w-4\" />\n                                <span><strong>{replyingTo.authorName}</strong> adlı kişiye yanıt veriyorsunuz</span>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"h-5 w-5 ml-auto\"\n                                  onClick={() => setReplyingTo(null)}\n                                  data-testid=\"button-cancel-reply\"\n                                >\n                                  <X className=\"h-3 w-3\" />\n                                </Button>\n                              </div>\n                            )}\n                            <div className=\"flex gap-2\">\n                              <Textarea\n                                placeholder={replyingTo && replyingTo.ideaId === idea.id ? `${replyingTo.authorName} adlı kişiye yanıt yaz...` : \"Yorum yaz...\"}\n                                value={commentText[idea.id] || ''}\n                                onChange={(e) => setCommentText({ ...commentText, [idea.id]: e.target.value })}\n                                className=\"min-h-[60px]\"\n                                data-testid={`input-comment-${idea.id}`}\n                              />\n                              <Button\n                                onClick={() => {\n                                  if (!commentText[idea.id]?.trim()) {\n                                    toast({\n                                      title: \"Eksik bilgi\",\n                                      description: \"Yorum boş olamaz.\",\n                                      variant: \"destructive\",\n                                    });\n                                    return;\n                                  }\n                                  commentMutation.mutate({ \n                                    ideaId: idea.id, \n                                    content: commentText[idea.id],\n                                    parentId: (replyingTo && replyingTo.ideaId === idea.id) ? replyingTo.commentId : undefined,\n                                    isAnonymous: isCommentAnonymous[idea.id] || false\n                                  });\n                                }}\n                                disabled={commentMutation.isPending}\n                                data-testid={`button-submit-comment-${idea.id}`}\n                              >\n                                {commentMutation.isPending ? (\n                                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                                ) : (\n                                  <Send className=\"h-4 w-4\" />\n                                )}\n                              </Button>\n                            </div>\n                            <div className=\"flex items-center space-x-2\">\n                              <Checkbox \n                                id={`comment-anonymous-${idea.id}`}\n                                checked={isCommentAnonymous[idea.id] || false}\n                                onCheckedChange={(checked) => setIsCommentAnonymous({ ...isCommentAnonymous, [idea.id]: checked === true })}\n                                data-testid={`checkbox-comment-anonymous-${idea.id}`}\n                              />\n                              <Label htmlFor={`comment-anonymous-${idea.id}`} className=\"flex items-center gap-1 cursor-pointer text-xs text-muted-foreground\">\n                                <EyeOff className=\"h-3 w-3\" />\n                                Anonim yorum\n                              </Label>\n                            </div>\n                          </div>\n                        ) : (\n                          <div className=\"text-center py-4\">\n                            <p className=\"text-sm text-muted-foreground mb-2\">Yorum yapmak için giriş yapın</p>\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => setLocation(\"/giris\")} data-testid=\"button-login-to-comment\">\n                              Giriş Yap\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </Card>\n            );\n          })\n        ) : (\n          <Card className=\"p-12 text-center\">\n            <Lightbulb className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <h3 className=\"text-lg font-semibold mb-2\">\n              {searchQuery ? \"Sonuç bulunamadı\" : \"Henüz fikir yok\"}\n            </h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {searchQuery \n                ? \"Arama kriterlerinize uygun fikir bulunamadı.\" \n                : \"İlk fikri paylaşan sen ol!\"}\n            </p>\n            {searchQuery ? (\n              <Button variant=\"outline\" onClick={() => setSearchQuery(\"\")} data-testid=\"button-clear-search-empty\">\n                <X className=\"h-4 w-4 mr-2\" />\n                Aramayı Temizle\n              </Button>\n            ) : (\n              <Button onClick={() => setOpen(true)} data-testid=\"button-first-idea\">\n                <Lightbulb className=\"h-4 w-4 mr-2\" />\n                Yeni Fikir\n              </Button>\n            )}\n          </Card>\n        )}\n      </div>\n\n      {/* Edit Comment Dialog */}\n      <Dialog open={!!editingComment} onOpenChange={(open) => !open && setEditingComment(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Yorumu Düzenle</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Textarea\n              value={editingComment?.content || ''}\n              onChange={(e) => setEditingComment(editingComment ? { ...editingComment, content: e.target.value } : null)}\n              placeholder=\"Yorumunuz...\"\n              className=\"min-h-[100px]\"\n              data-testid=\"input-edit-comment\"\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              Düzenlenen yorumlar tekrar yönetici onayına gönderilir.\n            </p>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setEditingComment(null)}>\n                İptal\n              </Button>\n              <Button\n                onClick={() => {\n                  if (editingComment && editingComment.content.trim()) {\n                    editCommentMutation.mutate({ \n                      commentId: editingComment.id, \n                      content: editingComment.content \n                    });\n                  }\n                }}\n                disabled={editCommentMutation.isPending}\n                data-testid=\"button-save-edit-comment\"\n              >\n                {editCommentMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : null}\n                Kaydet\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Comment Confirmation */}\n      <AlertDialog open={!!deleteCommentId} onOpenChange={(open) => !open && setDeleteCommentId(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Yorumu Sil</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu yorumu silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>İptal</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (deleteCommentId) {\n                  deleteCommentMutation.mutate(deleteCommentId);\n                }\n              }}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete-comment\"\n            >\n              {deleteCommentMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n              ) : null}\n              Sil\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":44472,"size_tokens":null},"shared/schema.ts":{"content":"import { z } from \"zod\";\nimport { pgTable, varchar, text, timestamp, boolean, integer, jsonb } from \"drizzle-orm/pg-core\";\nimport { sql } from \"drizzle-orm\";\n\n// ============================================\n// DRIZZLE ORM TABLE DEFINITIONS\n// ============================================\n\nexport const profiles = pgTable(\"profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  user_id: varchar(\"user_id\").notNull().unique(),\n  first_name: text(\"first_name\"),\n  last_name: text(\"last_name\"),\n  role: text(\"role\").notNull().default(\"student\"),\n  class_name: text(\"class_name\"),\n  student_no: text(\"student_no\"),\n  gender: text(\"gender\"),\n  is_class_president: boolean(\"is_class_president\").notNull().default(false),\n  profile_picture_url: text(\"profile_picture_url\"),\n  profile_picture_status: text(\"profile_picture_status\").default(\"approved\"),\n  accepted_terms_at: timestamp(\"accepted_terms_at\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const classes = pgTable(\"classes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull().unique(),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const announcements = pgTable(\"announcements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  author_id: varchar(\"author_id\"),\n  target_audience: text(\"target_audience\").notNull().default(\"all\"),\n  attachment_url: text(\"attachment_url\"),\n  attachment_type: text(\"attachment_type\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const polls = pgTable(\"polls\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  question: text(\"question\").notNull(),\n  is_open: boolean(\"is_open\").notNull().default(true),\n  results_published: boolean(\"results_published\").notNull().default(false),\n  created_by: varchar(\"created_by\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const pollOptions = pgTable(\"poll_options\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  poll_id: varchar(\"poll_id\").notNull(),\n  option_text: text(\"option_text\").notNull(),\n  vote_count: integer(\"vote_count\").notNull().default(0),\n});\n\nexport const pollVotes = pgTable(\"poll_votes\", {\n  user_id: varchar(\"user_id\").notNull(),\n  poll_id: varchar(\"poll_id\").notNull(),\n  option_id: varchar(\"option_id\").notNull(),\n  voted_at: timestamp(\"voted_at\").notNull().default(sql`now()`),\n});\n\nexport const ideas = pgTable(\"ideas\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  author_id: varchar(\"author_id\").notNull(),\n  is_anonymous: boolean(\"is_anonymous\").notNull().default(false),\n  image_url: text(\"image_url\"),\n  video_url: text(\"video_url\"),\n  attachment_url: text(\"attachment_url\"),\n  attachment_type: text(\"attachment_type\"),\n  likes_count: integer(\"likes_count\").notNull().default(0),\n  reviewed_by: varchar(\"reviewed_by\"),\n  reviewed_at: timestamp(\"reviewed_at\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const comments = pgTable(\"comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  idea_id: varchar(\"idea_id\").notNull(),\n  author_id: varchar(\"author_id\").notNull(),\n  parent_id: varchar(\"parent_id\"),\n  content: text(\"content\").notNull(),\n  is_anonymous: boolean(\"is_anonymous\").notNull().default(false),\n  status: text(\"status\").notNull().default(\"pending\"),\n  reviewed_by: varchar(\"reviewed_by\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const announcementComments = pgTable(\"announcement_comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  announcement_id: varchar(\"announcement_id\").notNull(),\n  author_id: varchar(\"author_id\").notNull(),\n  parent_id: varchar(\"parent_id\"),\n  content: text(\"content\").notNull(),\n  is_anonymous: boolean(\"is_anonymous\").notNull().default(false),\n  status: text(\"status\").notNull().default(\"pending\"),\n  reviewed_by: varchar(\"reviewed_by\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const blutenPosts = pgTable(\"bluten_posts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  instagram_post_id: text(\"instagram_post_id\"),\n  instagram_url: text(\"instagram_url\").notNull(),\n  media_url: text(\"media_url\"),\n  media_type: text(\"media_type\"),\n  caption: text(\"caption\"),\n  username: text(\"username\"),\n  is_visible: boolean(\"is_visible\").notNull().default(true),\n  created_by: varchar(\"created_by\"),\n  posted_at: timestamp(\"posted_at\"),\n  fetched_at: timestamp(\"fetched_at\").notNull().default(sql`now()`),\n});\n\nexport const ideaLikes = pgTable(\"idea_likes\", {\n  idea_id: varchar(\"idea_id\").notNull(),\n  user_id: varchar(\"user_id\").notNull(),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const profilePhotoLogs = pgTable(\"profile_photo_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  user_id: varchar(\"user_id\").notNull(),\n  image_url: text(\"image_url\").notNull(),\n  action: text(\"action\").notNull().default(\"upload\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const actionLogs = pgTable(\"action_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  user_id: varchar(\"user_id\").notNull(),\n  action_type: text(\"action_type\").notNull(),\n  target_id: varchar(\"target_id\"),\n  target_type: text(\"target_type\"),\n  details: text(\"details\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  user_id: varchar(\"user_id\").notNull(),\n  type: text(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  link: text(\"link\"),\n  is_read: boolean(\"is_read\").notNull().default(false),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const events = pgTable(\"events\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  is_active: boolean(\"is_active\").notNull().default(true),\n  event_date: timestamp(\"event_date\"),\n  end_date: timestamp(\"end_date\"),\n  form_fields: jsonb(\"form_fields\").notNull().default([]),\n  created_by: varchar(\"created_by\"),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const eventApplications = pgTable(\"event_applications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  event_id: varchar(\"event_id\").notNull(),\n  profile_id: varchar(\"profile_id\").notNull(),\n  responses: jsonb(\"responses\").notNull().default({}),\n  created_at: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\n// ============================================\n// ZOD SCHEMAS & TYPES\n// ============================================\n\n// ============================================\n// PROFILES\n// ============================================\nexport const insertProfileSchema = z.object({\n  user_id: z.string().uuid(),\n  first_name: z.string().min(1, \"Ad gerekli\").optional(),\n  last_name: z.string().min(1, \"Soyad gerekli\").optional(),\n  role: z.enum(['admin', 'teacher', 'student']).default('student'),\n  class_name: z.string().optional(),\n  student_no: z.string().optional(),\n  gender: z.string().optional(),\n  is_class_president: z.boolean().default(false),\n});\n\nexport type InsertProfile = z.infer<typeof insertProfileSchema>;\n\nexport const updateProfileSchema = z.object({\n  first_name: z.string().min(1, \"Ad gerekli\").optional(),\n  last_name: z.string().min(1, \"Soyad gerekli\").optional(),\n  role: z.enum(['admin', 'teacher', 'student']).optional(),\n  class_name: z.string().optional(),\n  student_no: z.string().optional(),\n  gender: z.string().optional(),\n  is_class_president: z.boolean().optional(),\n});\n\nexport type UpdateProfile = z.infer<typeof updateProfileSchema>;\n\nexport interface Profile {\n  id: string;\n  user_id: string;\n  first_name?: string;\n  last_name?: string;\n  role: 'admin' | 'teacher' | 'student';\n  class_name?: string;\n  student_no?: string;\n  gender?: string;\n  is_class_president: boolean;\n  profile_picture_url?: string;\n  profile_picture_status?: 'pending' | 'approved' | 'rejected';\n  created_at: string;\n}\n\n// ============================================\n// CLASSES\n// ============================================\nexport const insertClassSchema = z.object({\n  name: z.string().min(1, \"Sınıf adı gerekli\"),\n});\n\nexport type InsertClass = z.infer<typeof insertClassSchema>;\n\nexport interface SchoolClass {\n  id: string;\n  name: string;\n  created_at: string;\n}\n\n// ============================================\n// ANNOUNCEMENTS\n// ============================================\nexport const insertAnnouncementSchema = z.object({\n  title: z.string().min(3, \"Başlık en az 3 karakter olmalı\"),\n  content: z.string().min(10, \"İçerik en az 10 karakter olmalı\"),\n  author_id: z.string().uuid().optional(),\n  target_audience: z.enum(['all', 'class_presidents']).default('all'),\n  attachment_url: z.string().optional(),\n  attachment_type: z.enum(['image', 'video', 'pdf', 'document']).optional(),\n});\n\nexport type InsertAnnouncement = z.infer<typeof insertAnnouncementSchema>;\n\nexport interface Announcement {\n  id: string;\n  title: string;\n  content: string;\n  author_id?: string;\n  target_audience: 'all' | 'class_presidents';\n  attachment_url?: string;\n  attachment_type?: 'image' | 'video' | 'pdf' | 'document';\n  created_at: string;\n}\n\n// ============================================\n// POLLS\n// ============================================\nexport const insertPollSchema = z.object({\n  question: z.string().min(5, \"Soru en az 5 karakter olmalı\"),\n  options: z.array(z.string().min(1, \"Seçenek boş olamaz\")).min(2, \"En az 2 seçenek gerekli\"),\n  created_by: z.string().uuid().optional(),\n});\n\nexport type InsertPoll = z.infer<typeof insertPollSchema>;\n\nexport interface Poll {\n  id: string;\n  question: string;\n  is_open: boolean;\n  results_published: boolean;\n  created_by?: string;\n  created_at: string;\n}\n\nexport interface PollOption {\n  id: string;\n  poll_id: string;\n  option_text: string;\n  vote_count: number;\n}\n\n// ============================================\n// IDEAS\n// ============================================\nexport const insertIdeaSchema = z.object({\n  title: z.string().min(3, \"Başlık en az 3 karakter olmalı\"),\n  content: z.string().min(10, \"İçerik en az 10 karakter olmalı\"),\n  author_id: z.string().uuid(),\n  is_anonymous: z.boolean().default(false),\n  image_url: z.string().url().optional().or(z.literal('')),\n  video_url: z.string().url().optional().or(z.literal('')),\n  attachment_url: z.string().optional(),\n  attachment_type: z.enum(['image', 'video', 'pdf', 'document']).optional(),\n});\n\nexport type InsertIdea = z.infer<typeof insertIdeaSchema>;\n\nexport interface Idea {\n  id: string;\n  title: string;\n  content: string;\n  status: 'pending' | 'approved' | 'rejected';\n  author_id: string;\n  is_anonymous: boolean;\n  image_url?: string;\n  video_url?: string;\n  attachment_url?: string;\n  attachment_type?: 'image' | 'video' | 'pdf' | 'document';\n  likes_count: number;\n  reviewed_by?: string;\n  reviewed_at?: string;\n  created_at: string;\n}\n\n// ============================================\n// COMMENTS\n// ============================================\nexport const insertCommentSchema = z.object({\n  idea_id: z.string().uuid(),\n  author_id: z.string().uuid(),\n  content: z.string().min(1, \"Yorum boş olamaz\"),\n  is_anonymous: z.boolean().default(false),\n});\n\nexport type InsertComment = z.infer<typeof insertCommentSchema>;\n\nexport interface Comment {\n  id: string;\n  idea_id: string;\n  author_id: string;\n  content: string;\n  is_anonymous: boolean;\n  status: 'pending' | 'approved' | 'rejected';\n  reviewed_by?: string;\n  created_at: string;\n}\n\n// ============================================\n// ANNOUNCEMENT COMMENTS\n// ============================================\nexport const insertAnnouncementCommentSchema = z.object({\n  announcement_id: z.string().uuid(),\n  author_id: z.string().uuid(),\n  content: z.string().min(1, \"Yorum boş olamaz\"),\n  is_anonymous: z.boolean().default(false),\n});\n\nexport type InsertAnnouncementComment = z.infer<typeof insertAnnouncementCommentSchema>;\n\nexport interface AnnouncementComment {\n  id: string;\n  announcement_id: string;\n  author_id: string;\n  content: string;\n  is_anonymous: boolean;\n  status: 'pending' | 'approved' | 'rejected';\n  reviewed_by?: string;\n  created_at: string;\n}\n\n// ============================================\n// BLÜTEN POSTS\n// ============================================\nexport const insertBlutenPostSchema = z.object({\n  instagram_url: z.string().url(\"Geçerli bir URL giriniz\"),\n  media_url: z.string().url().optional(),\n  media_type: z.string().optional(),\n  caption: z.string().optional(),\n  username: z.string().optional(),\n  is_visible: z.boolean().default(true),\n  created_by: z.string().uuid().optional(),\n  posted_at: z.string().optional(),\n});\n\nexport type InsertBlutenPost = z.infer<typeof insertBlutenPostSchema>;\n\nexport interface BlutenPost {\n  id: string;\n  instagram_post_id?: string;\n  instagram_url: string;\n  media_url?: string;\n  media_type?: string;\n  caption?: string;\n  username?: string;\n  is_visible: boolean;\n  created_by?: string;\n  posted_at?: string;\n  fetched_at: string;\n}\n\n// ============================================\n// USER CREATION (For admin manual user add)\n// ============================================\nexport const createUserSchema = z.object({\n  email: z.string().email(\"Geçerli bir email giriniz\"),\n  password: z.string().min(6, \"Şifre en az 6 karakter olmalı\"),\n  first_name: z.string().min(1, \"Ad gerekli\"),\n  last_name: z.string().min(1, \"Soyad gerekli\"),\n  role: z.enum(['admin', 'teacher', 'student']).default('student'),\n  class_name: z.string().optional(),\n  student_no: z.string().optional(),\n  is_class_president: z.boolean().default(false),\n});\n\nexport type CreateUser = z.infer<typeof createUserSchema>;\n\n// ============================================\n// STUDENT REGISTRATION (Public one-time registration)\n// ============================================\nexport const studentRegistrationSchema = z.object({\n  email: z.string().email(\"Geçerli bir e-posta adresi giriniz\"),\n  password: z.string().min(6, \"Şifre en az 6 karakter olmalı\"),\n  first_name: z.string().min(1, \"Ad gerekli\"),\n  last_name: z.string().min(1, \"Soyad gerekli\"),\n  class_name: z.string().min(1, \"Sınıf gerekli\"),\n  student_no: z.string().min(1, \"Öğrenci numarası gerekli\"),\n});\n\nexport type StudentRegistration = z.infer<typeof studentRegistrationSchema>;\n\n// ============================================\n// IDEA LIKES\n// ============================================\nexport const insertIdeaLikeSchema = z.object({\n  idea_id: z.string().uuid(),\n  user_id: z.string().uuid(),\n});\n\nexport type InsertIdeaLike = z.infer<typeof insertIdeaLikeSchema>;\n\nexport interface IdeaLike {\n  idea_id: string;\n  user_id: string;\n  created_at: string;\n}\n\n// ============================================\n// PROFILE PHOTO LOGS\n// ============================================\nexport const insertProfilePhotoLogSchema = z.object({\n  user_id: z.string().uuid(),\n  image_url: z.string().url(),\n  action: z.enum(['upload', 'delete', 'reset']).default('upload'),\n});\n\nexport type InsertProfilePhotoLog = z.infer<typeof insertProfilePhotoLogSchema>;\n\nexport interface ProfilePhotoLog {\n  id: string;\n  user_id: string;\n  image_url: string;\n  action: 'upload' | 'delete' | 'reset';\n  created_at: string;\n}\n\n// ============================================\n// ACTION LOGS\n// ============================================\nexport const ACTION_TYPES = [\n  'LOGIN',\n  'LOGOUT', \n  'VOTE_CAST',\n  'VOTE_CHANGED',\n  'COMMENT_CREATED',\n  'COMMENT_EDITED',\n  'COMMENT_DELETED',\n  'ANNOUNCEMENT_COMMENT_CREATED',\n  'ANNOUNCEMENT_COMMENT_EDITED',\n  'ANNOUNCEMENT_COMMENT_DELETED',\n  'LIKE_ADDED',\n  'LIKE_REMOVED',\n  'IDEA_CREATED',\n  'IDEA_DELETED',\n  'PROFILE_UPDATED',\n  'PROFILE_PHOTO_UPLOADED',\n  'PROFILE_PHOTO_RESET',\n  'PASSWORD_CHANGED',\n  'EMAIL_CHANGED',\n  'EVENT_APPLICATION_SUBMITTED',\n  'USER_SUSPENDED',\n  'USER_ACTIVATED',\n  'TERMS_ACCEPTED',\n] as const;\n\nexport type ActionType = typeof ACTION_TYPES[number];\n\nexport const insertActionLogSchema = z.object({\n  user_id: z.string().uuid(),\n  action_type: z.enum(ACTION_TYPES),\n  target_id: z.string().optional(),\n  target_type: z.string().optional(),\n  details: z.string().optional(),\n});\n\nexport type InsertActionLog = z.infer<typeof insertActionLogSchema>;\n\nexport interface ActionLog {\n  id: string;\n  user_id: string;\n  action_type: ActionType;\n  target_id?: string;\n  target_type?: string;\n  details?: string;\n  created_at: string;\n}\n\nexport interface ActionLogWithProfile extends ActionLog {\n  profile?: {\n    first_name?: string;\n    last_name?: string;\n    class_name?: string;\n  };\n}\n\n// ============================================\n// NOTIFICATIONS\n// ============================================\nexport const insertNotificationSchema = z.object({\n  user_id: z.string().uuid(),\n  type: z.enum([\n    'idea_approved',\n    'idea_rejected',\n    'comment_approved',\n    'comment_rejected',\n    'reply_received',\n    'announcement_comment_approved',\n    'announcement_comment_rejected',\n  ]),\n  title: z.string(),\n  message: z.string(),\n  link: z.string().optional(),\n});\n\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\n\nexport interface Notification {\n  id: string;\n  user_id: string;\n  type: string;\n  title: string;\n  message: string;\n  link?: string;\n  is_read: boolean;\n  created_at: string;\n}\n\n// ============================================\n// EVENTS (Etkinlikler)\n// ============================================\nexport const formFieldSchema = z.object({\n  id: z.string(),\n  label: z.string().min(1, \"Alan adı gerekli\"),\n  type: z.enum(['text', 'textarea', 'select']),\n  required: z.boolean().default(false),\n  options: z.array(z.string()).optional(),\n});\n\nexport type FormField = z.infer<typeof formFieldSchema>;\n\nexport const insertEventSchema = z.object({\n  name: z.string().min(3, \"Etkinlik adı en az 3 karakter olmalı\"),\n  description: z.string().optional(),\n  is_active: z.boolean().default(true),\n  event_date: z.string().optional(),\n  end_date: z.string().optional(),\n  form_fields: z.array(formFieldSchema).default([]),\n  created_by: z.string().uuid().optional(),\n});\n\nexport type InsertEvent = z.infer<typeof insertEventSchema>;\n\nexport const updateEventSchema = z.object({\n  name: z.string().min(3, \"Etkinlik adı en az 3 karakter olmalı\").optional(),\n  description: z.string().optional(),\n  is_active: z.boolean().optional(),\n  event_date: z.string().nullable().optional(),\n  end_date: z.string().nullable().optional(),\n  form_fields: z.array(formFieldSchema).optional(),\n});\n\nexport type UpdateEvent = z.infer<typeof updateEventSchema>;\n\nexport interface Event {\n  id: string;\n  name: string;\n  description?: string;\n  is_active: boolean;\n  event_date?: string;\n  end_date?: string;\n  form_fields: FormField[];\n  created_by?: string;\n  created_at: string;\n}\n\n// ============================================\n// EVENT APPLICATIONS (Başvurular)\n// ============================================\nexport const insertEventApplicationSchema = z.object({\n  event_id: z.string().uuid(),\n  profile_id: z.string().uuid(),\n  responses: z.record(z.string(), z.any()),\n});\n\nexport type InsertEventApplication = z.infer<typeof insertEventApplicationSchema>;\n\nexport interface EventApplication {\n  id: string;\n  event_id: string;\n  profile_id: string;\n  responses: Record<string, any>;\n  created_at: string;\n}\n","path":null,"size_bytes":19999,"size_tokens":null},"client/src/contexts/AuthContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, useRef } from 'react';\nimport { User, Session } from '@supabase/supabase-js';\nimport { supabase } from '@/lib/supabase';\nimport { translateSupabaseError } from '@/lib/errors/supabase';\nimport { queryClient } from '@/lib/queryClient';\n\ninterface Profile {\n  id: string;\n  user_id: string;\n  first_name: string | null;\n  last_name: string | null;\n  role: 'admin' | 'teacher' | 'student';\n  class_name: string | null;\n  student_no: string | null;\n  gender: string | null;\n  profile_picture_url?: string | null;\n  profile_picture_status?: 'pending' | 'approved' | 'rejected';\n}\n\ninterface SignInWithNameResult {\n  requiresEmail: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  profile: Profile | null;\n  session: Session | null;\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<void>;\n  signInWithName: (firstName: string, lastName: string, password: string) => Promise<SignInWithNameResult>;\n  signUp: (email: string, password: string) => Promise<void>;\n  signOut: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [session, setSession] = useState<Session | null>(null);\n  const [loading, setLoading] = useState(true);\n  \n  // Request token to prevent stale updates across session changes\n  const requestTokenRef = useRef<number>(0);\n  const activeSessionUserIdRef = useRef<string | null>(null);\n  // Map of promises per userId to prevent concurrent calls for same user\n  const loadProfilePromisesRef = useRef<Map<string, Promise<Profile | null>>>(new Map());\n\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      setSession(session);\n      setUser(session?.user ?? null);\n      if (session?.user) {\n        loadProfile(session.user.id).catch(err => {\n          console.error('Failed to load profile on session:', err);\n          setLoading(false);\n        });\n      } else {\n        setLoading(false);\n      }\n    });\n\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setSession(session);\n      setUser(session?.user ?? null);\n      if (session?.user) {\n        loadProfile(session.user.id).catch(err => {\n          console.error('Failed to load profile on auth state change:', err);\n          setProfile(null);\n          setLoading(false);\n        });\n      } else {\n        // Session is null - invalidate all in-flight requests\n        requestTokenRef.current += 1;\n        activeSessionUserIdRef.current = null;\n        loadProfilePromisesRef.current.clear();\n        setProfile(null);\n        setLoading(false);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  async function loadProfile(userId: string, retries = 0, maxRetries = 10): Promise<Profile | null> {\n    // If there's already a pending request for the same user, return it\n    const existingPromise = loadProfilePromisesRef.current.get(userId);\n    if (existingPromise) {\n      return existingPromise;\n    }\n\n    // Only create a new promise chain if this is the first attempt (retries === 0)\n    if (retries === 0) {\n      setLoading(true);\n      // Increment request token and capture it for this request\n      requestTokenRef.current += 1;\n      const thisRequestToken = requestTokenRef.current;\n      activeSessionUserIdRef.current = userId;\n\n      const promise = (async (): Promise<Profile | null> => {\n        try {\n          // Recursive retry logic\n          for (let attempt = 0; attempt <= maxRetries; attempt++) {\n            // Get current session for API call\n            const { data: { session } } = await supabase.auth.getSession();\n            if (!session) {\n              throw new Error('Oturum bulunamadı');\n            }\n\n            // Fetch profile from backend API\n            const res = await fetch('/api/profiles/me', {\n              headers: {\n                'Authorization': `Bearer ${session.access_token}`,\n              },\n              credentials: 'include',\n            });\n\n            if (res.ok) {\n              const data = await res.json();\n              // Verify this request is still valid before updating state\n              if (thisRequestToken === requestTokenRef.current && activeSessionUserIdRef.current === userId) {\n                setProfile(data);\n                setLoading(false);\n                return data as Profile;\n              } else {\n                // Session changed, bail out without mutating state\n                console.log('Stale loadProfile request, ignoring');\n                return null;\n              }\n            }\n\n            // Profile doesn't exist yet (404) - retry if we haven't exceeded max attempts\n            if (res.status === 404 || res.status === 400) {\n              if (attempt < maxRetries) {\n                await new Promise(resolve => setTimeout(resolve, 300));\n                continue;\n              }\n            } else {\n              const error = await res.json();\n              throw new Error(error.error || 'Profil yükleme hatası');\n            }\n          }\n\n          // Max retries exceeded\n          throw new Error('Profil bulunamadı. Lütfen destek ekibiyle iletişime geçin.');\n        } catch (error: any) {\n          console.error('Error loading profile:', error);\n          // Only update state if this request is still valid\n          if (thisRequestToken === requestTokenRef.current && activeSessionUserIdRef.current === userId) {\n            setProfile(null);\n            setLoading(false);\n          }\n          throw error;\n        }\n      })();\n\n      loadProfilePromisesRef.current.set(userId, promise);\n      \n      // Clean up promise from map after it completes (success or failure)\n      promise.finally(() => {\n        if (loadProfilePromisesRef.current.get(userId) === promise) {\n          loadProfilePromisesRef.current.delete(userId);\n        }\n      });\n      \n      return promise;\n    }\n\n    // This should not be reached, but return null as fallback\n    return null;\n  }\n\n  async function signIn(email: string, password: string) {\n    // Clear ALL cache before signing in (prevents user data mixing)\n    queryClient.clear();\n    \n    const { error } = await supabase.auth.signInWithPassword({\n      email,\n      password,\n    });\n    if (error) throw translateSupabaseError(error, 'login');\n  }\n\n  async function signInWithName(firstName: string, lastName: string, password: string): Promise<SignInWithNameResult> {\n    // Clear ALL cache before signing in (prevents user data mixing)\n    queryClient.clear();\n    \n    // Call backend API to authenticate with name\n    const response = await fetch('/api/auth/login-with-name', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ firstName, lastName, password }),\n    });\n    \n    const data = await response.json();\n    \n    if (!response.ok) {\n      throw new Error(data.error || 'Giriş yapılırken bir hata oluştu');\n    }\n    \n    // If user needs to add email, return early\n    if (data.requiresEmail) {\n      // Sign in with the returned session token\n      const { error } = await supabase.auth.setSession({\n        access_token: data.accessToken,\n        refresh_token: data.refreshToken,\n      });\n      if (error) throw translateSupabaseError(error, 'login');\n      return { requiresEmail: true };\n    }\n    \n    // Normal login - set session\n    const { error } = await supabase.auth.setSession({\n      access_token: data.accessToken,\n      refresh_token: data.refreshToken,\n    });\n    if (error) throw translateSupabaseError(error, 'login');\n    \n    return { requiresEmail: false };\n  }\n\n  async function signUp(email: string, password: string) {\n    const { data, error } = await supabase.auth.signUp({\n      email,\n      password,\n    });\n    if (error) throw translateSupabaseError(error, 'register');\n    \n    // Profile will be created automatically by the database trigger\n    // loadProfile will retry until it exists or max retries exceeded\n    if (data.user) {\n      try {\n        const loadedProfile = await loadProfile(data.user.id);\n        if (!loadedProfile) {\n          throw translateSupabaseError(\n            new Error('Profile not found after retries'),\n            'profile'\n          );\n        }\n        \n        // Record terms acceptance timestamp for legal compliance via backend API\n        const { data: { session } } = await supabase.auth.getSession();\n        if (session) {\n          const res = await fetch('/api/profiles/accept-terms', {\n            method: 'POST',\n            headers: {\n              'Authorization': `Bearer ${session.access_token}`,\n            },\n            credentials: 'include',\n          });\n          \n          if (!res.ok) {\n            console.error('Failed to record terms acceptance');\n            // Don't throw - registration is complete, this is non-blocking\n          }\n        }\n      } catch (err) {\n        throw translateSupabaseError(err, 'profile');\n      }\n    }\n  }\n\n  async function signOut() {\n    // Clear request tokens and promises to prevent stale updates\n    requestTokenRef.current += 1;\n    activeSessionUserIdRef.current = null;\n    loadProfilePromisesRef.current.clear();\n    \n    // Clear ALL cache on sign out (prevents data leakage between users)\n    queryClient.clear();\n    \n    try {\n      const { error } = await supabase.auth.signOut();\n      // Ignore auth session missing and 403 errors - we're signing out anyway\n      if (error && !error.message?.includes('Auth session missing') && error.status !== 403) {\n        throw error;\n      }\n    } catch (err: any) {\n      // Ignore session missing and 403 errors during sign out\n      if (!err.message?.includes('Auth session missing') && err.status !== 403) {\n        throw err;\n      }\n    }\n    \n    // Force clear session from localStorage to ensure clean logout\n    try {\n      await supabase.auth.getSession().then(() => {\n        // Session cleared by Supabase\n      });\n    } catch {\n      // Ignore any errors\n    }\n  }\n\n  const value = {\n    user,\n    profile,\n    session,\n    loading,\n    signIn,\n    signInWithName,\n    signUp,\n    signOut,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":10688,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/examples/IdeaCard.tsx":{"content":"import IdeaCard from \"../IdeaCard\";\n\nexport default function IdeaCardExample() {\n  return (\n    <div className=\"p-4 max-w-2xl space-y-4\">\n      <IdeaCard\n        title=\"Okul Bahçesine Daha Fazla Oturma Alanı\"\n        excerpt=\"Teneffüslerde oturacak yer bulamıyoruz. Bahçeye daha fazla bank ve oturma alanı eklenebilir mi?\"\n        authorName=\"Zeynep Kaya\"\n        authorInitials=\"ZK\"\n        createdAt=\"8 Mayıs 2025\"\n        status=\"approved\"\n        commentCount={12}\n        onReadMore={() => console.log(\"Fikir detayı\")}\n      />\n      <IdeaCard\n        title=\"Dijital Kütüphane Sistemi\"\n        excerpt=\"E-kitap okumak için dijital bir kütüphane sistemi kurulmasını öneriyorum.\"\n        authorName=\"Ali Demir\"\n        authorInitials=\"AD\"\n        createdAt=\"7 Mayıs 2025\"\n        status=\"pending\"\n        commentCount={5}\n        onReadMore={() => console.log(\"Fikir detayı\")}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":925,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/lib/api/comments.ts":{"content":"import { supabase } from '../supabase';\n\nexport interface Comment {\n  id: string;\n  idea_id: string;\n  author_id: string;\n  content: string;\n  status: 'pending' | 'approved' | 'rejected';\n  reviewed_by?: string;\n  created_at: string;\n  author?: {\n    first_name: string | null;\n    last_name: string | null;\n  };\n}\n\nexport async function getCommentsByIdea(ideaId: string): Promise<Comment[]> {\n  const res = await fetch(`/api/ideas/${ideaId}/comments`, {\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorumlar yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Comment[]>;\n}\n\nexport async function createComment(ideaId: string, content: string, isAnonymous: boolean = false) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/ideas/${ideaId}/comments`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ content, is_anonymous: isAnonymous }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum oluşturulamadı');\n  }\n\n  return res.json();\n}\n\nexport async function approveComment(commentId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/comments/${commentId}/status`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ status: 'approved' }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum onaylanamadı');\n  }\n\n  return res.json();\n}\n\nexport async function rejectComment(commentId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/comments/${commentId}/status`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ status: 'rejected' }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum reddedilemedi');\n  }\n\n  return res.json();\n}\n\nexport async function deleteComment(commentId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/comments/${commentId}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum silinemedi');\n  }\n}\n\nexport async function getPendingComments(): Promise<Comment[]> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/comments', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Bekleyen yorumlar yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Comment[]>;\n}\n","path":null,"size_bytes":3642,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/pages/Admin.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport StatusBadge from \"@/components/StatusBadge\";\nimport { CheckCircle2, XCircle, Eye, Users, Bell, BarChart3, FileText, Loader2, Image, MessageSquare, Trash2, Download, Camera, Check, X, Ban, UserCheck, ImageOff, Heart, GraduationCap, Plus, Calendar, Edit2, ClipboardList, TrendingUp, PieChart } from \"lucide-react\";\nimport { getAdminProfiles, updateProfile, getClasses, createClass, deleteClass, type SchoolClass } from \"@/lib/api/profiles\";\nimport { getAdminIdeas, getAdminComments, updateIdeaStatus, updateCommentStatus, deleteIdea } from \"@/lib/api/ideas\";\nimport { getAdminBlutenPosts, toggleBlutenVisibility } from \"@/lib/api/bluten\";\nimport { getAdminAnnouncements, deleteAnnouncement, getAdminAnnouncementComments, updateAnnouncementCommentStatus } from \"@/lib/api/announcements\";\nimport { getAdminPolls, deletePoll, togglePollStatus, publishPollResults } from \"@/lib/api/polls\";\nimport { getPendingProfilePictures, approveProfilePicture, rejectProfilePicture, suspendUser, activateUser, resetUserProfilePicture, deleteComment, clearIdeaLikes } from \"@/lib/api/admin\";\nimport { getAdminEvents, createEvent, updateEvent, deleteEvent, getEventApplications, type EventApplicationWithProfile } from \"@/lib/api/events\";\nimport { getAnalytics, type AnalyticsData } from \"@/lib/api/analytics\";\nimport { Progress } from \"@/components/ui/progress\";\nimport type { Event, FormField } from \"@shared/schema\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { supabase } from \"@/lib/supabase\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\nimport utc from \"dayjs/plugin/utc\";\nimport timezone from \"dayjs/plugin/timezone\";\nimport AnnouncementForm from \"@/components/admin/AnnouncementForm\";\nimport PollForm from \"@/components/admin/PollForm\";\nimport BlutenForm from \"@/components/admin/BlutenForm\";\nimport UserForm from \"@/components/admin/UserForm\";\nimport PollStatsDialog from \"@/components/admin/PollStatsDialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useState } from \"react\";\n\ndayjs.extend(relativeTime);\ndayjs.extend(utc);\ndayjs.extend(timezone);\ndayjs.locale(\"tr\");\n\nexport default function Admin() {\n  const { toast } = useToast();\n  const [selectedIdea, setSelectedIdea] = useState<any>(null);\n  const [newClassName, setNewClassName] = useState(\"\");\n\n  // Events state\n  const [editingEvent, setEditingEvent] = useState<Event | null>(null);\n  const [viewingApplicationsEvent, setViewingApplicationsEvent] = useState<Event | null>(null);\n  const [eventApplications, setEventApplications] = useState<EventApplicationWithProfile[]>([]);\n  const [loadingApplications, setLoadingApplications] = useState(false);\n  \n  // Event form state\n  const [newEventName, setNewEventName] = useState(\"\");\n  const [newEventDescription, setNewEventDescription] = useState(\"\");\n  const [newEventActive, setNewEventActive] = useState(true);\n  const [newEventDate, setNewEventDate] = useState(\"\");\n  const [newEventEndDate, setNewEventEndDate] = useState(\"\");\n  const [newEventFormFields, setNewEventFormFields] = useState<FormField[]>([]);\n  \n  // Edit event form state  \n  const [editEventName, setEditEventName] = useState(\"\");\n  const [editEventDescription, setEditEventDescription] = useState(\"\");\n  const [editEventActive, setEditEventActive] = useState(true);\n  const [editEventDate, setEditEventDate] = useState(\"\");\n  const [editEventEndDate, setEditEventEndDate] = useState(\"\");\n  const [editEventFormFields, setEditEventFormFields] = useState<FormField[]>([]);\n  \n  // Form field builder state (for new event)\n  const [newFieldLabel, setNewFieldLabel] = useState(\"\");\n  const [newFieldType, setNewFieldType] = useState<'text' | 'textarea' | 'select'>('text');\n  const [newFieldRequired, setNewFieldRequired] = useState(false);\n  const [newFieldOptions, setNewFieldOptions] = useState(\"\");\n  \n  // Form field builder state (for edit event)\n  const [editFieldLabel, setEditFieldLabel] = useState(\"\");\n  const [editFieldType, setEditFieldType] = useState<'text' | 'textarea' | 'select'>('text');\n  const [editFieldRequired, setEditFieldRequired] = useState(false);\n  const [editFieldOptions, setEditFieldOptions] = useState(\"\");\n\n  // Analytics\n  const { data: analytics, isLoading: loadingAnalytics } = useQuery({\n    queryKey: [\"/api/admin/analytics\"],\n    queryFn: getAnalytics,\n  });\n\n  // Classes\n  const { data: classes, isLoading: loadingClasses } = useQuery({\n    queryKey: [\"/api/classes\"],\n    queryFn: getClasses,\n  });\n\n  const createClassMutation = useMutation({\n    mutationFn: (name: string) => createClass(name),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/classes\"] });\n      setNewClassName(\"\");\n      toast({ description: \"Sınıf oluşturuldu\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Sınıf oluşturulurken hata oluştu\" });\n    },\n  });\n\n  const deleteClassMutation = useMutation({\n    mutationFn: (id: string) => deleteClass(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/classes\"] });\n      toast({ description: \"Sınıf silindi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Sınıf silinirken hata oluştu\" });\n    },\n  });\n\n  const { data: profiles, isLoading: loadingProfiles } = useQuery({\n    queryKey: [\"/api/admin/profiles\"],\n    queryFn: () => getAdminProfiles(),\n  });\n\n  const { data: pendingPictures, isLoading: loadingPictures } = useQuery({\n    queryKey: [\"/api/admin/profile-pictures\"],\n    queryFn: getPendingProfilePictures,\n  });\n\n  const approvePictureMutation = useMutation({\n    mutationFn: (profileId: string) => approveProfilePicture(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/profile-pictures\"] });\n      toast({ description: \"Profil fotoğrafı onaylandı\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Onay yapılırken hata oluştu\" });\n    },\n  });\n\n  const rejectPictureMutation = useMutation({\n    mutationFn: (profileId: string) => rejectProfilePicture(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/profile-pictures\"] });\n      toast({ description: \"Profil fotoğrafı reddedildi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Red işlemi yapılırken hata oluştu\" });\n    },\n  });\n\n  const suspendUserMutation = useMutation({\n    mutationFn: (profileId: string) => suspendUser(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/profiles\"] });\n      toast({ description: \"Kullanıcı askıya alındı\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Kullanıcı askıya alınırken hata oluştu\" });\n    },\n  });\n\n  const activateUserMutation = useMutation({\n    mutationFn: (profileId: string) => activateUser(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/profiles\"] });\n      toast({ description: \"Kullanıcı aktifleştirildi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Kullanıcı aktifleştirilirken hata oluştu\" });\n    },\n  });\n\n  const resetPictureMutation = useMutation({\n    mutationFn: (profileId: string) => resetUserProfilePicture(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/profiles\"] });\n      toast({ description: \"Profil fotoğrafı sıfırlandı\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Profil fotoğrafı sıfırlanırken hata oluştu\" });\n    },\n  });\n\n  const deleteCommentMutation = useMutation({\n    mutationFn: (commentId: string) => deleteComment(commentId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/comments\"] });\n      toast({ description: \"Yorum silindi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Yorum silinirken hata oluştu\" });\n    },\n  });\n\n  const clearLikesMutation = useMutation({\n    mutationFn: (ideaId: string) => clearIdeaLikes(ideaId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/ideas\"] });\n      toast({ description: \"Beğeniler temizlendi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Beğeniler temizlenirken hata oluştu\" });\n    },\n  });\n\n  const { data: adminIdeas, isLoading: loadingIdeas } = useQuery({\n    queryKey: [\"/api/admin/ideas\"],\n    queryFn: getAdminIdeas,\n  });\n\n  const { data: allBlutenPosts, isLoading: loadingBluten } = useQuery({\n    queryKey: [\"/api/admin/bluten\"],\n    queryFn: getAdminBlutenPosts,\n  });\n\n  const { data: adminComments, isLoading: loadingComments } = useQuery({\n    queryKey: [\"/api/admin/comments\"],\n    queryFn: getAdminComments,\n  });\n\n  const { data: announcementComments, isLoading: loadingAnnouncementComments } = useQuery({\n    queryKey: [\"/api/admin/announcement-comments\"],\n    queryFn: getAdminAnnouncementComments,\n  });\n\n  const { data: announcements, isLoading: loadingAnnouncements } = useQuery({\n    queryKey: [\"/api/admin/announcements\"],\n    queryFn: getAdminAnnouncements,\n  });\n\n  const { data: polls, isLoading: loadingPolls } = useQuery({\n    queryKey: [\"/api/admin/polls\"],\n    queryFn: getAdminPolls,\n  });\n\n  const { data: events, isLoading: loadingEvents } = useQuery({\n    queryKey: [\"/api/admin/events\"],\n    queryFn: getAdminEvents,\n  });\n\n  const createEventMutation = useMutation({\n    mutationFn: createEvent,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/events\"] });\n      setNewEventName(\"\");\n      setNewEventDescription(\"\");\n      setNewEventActive(true);\n      setNewEventDate(\"\");\n      setNewEventEndDate(\"\");\n      setNewEventFormFields([]);\n      toast({ description: \"Etkinlik oluşturuldu\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Etkinlik oluşturulurken hata oluştu\" });\n    },\n  });\n\n  const updateEventMutation = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: any }) => updateEvent(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/events\"] });\n      setEditingEvent(null);\n      toast({ description: \"Etkinlik güncellendi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Etkinlik güncellenirken hata oluştu\" });\n    },\n  });\n\n  const deleteEventMutation = useMutation({\n    mutationFn: deleteEvent,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/events\"] });\n      toast({ description: \"Etkinlik silindi\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", description: error.message || \"Etkinlik silinirken hata oluştu\" });\n    },\n  });\n\n  const handleViewApplications = async (event: Event) => {\n    setViewingApplicationsEvent(event);\n    setLoadingApplications(true);\n    try {\n      const applications = await getEventApplications(event.id);\n      setEventApplications(applications);\n    } catch (error: any) {\n      toast({ variant: \"destructive\", description: error.message || \"Başvurular yüklenirken hata oluştu\" });\n    } finally {\n      setLoadingApplications(false);\n    }\n  };\n\n  const handleEditEvent = (event: Event) => {\n    setEditingEvent(event);\n    setEditEventName(event.name);\n    setEditEventDescription(event.description || \"\");\n    setEditEventActive(event.is_active);\n    setEditEventDate(event.event_date ? dayjs(event.event_date).format(\"YYYY-MM-DDTHH:mm\") : \"\");\n    setEditEventEndDate(event.end_date ? dayjs(event.end_date).format(\"YYYY-MM-DDTHH:mm\") : \"\");\n    setEditEventFormFields(event.form_fields || []);\n  };\n\n  const addFormField = (isEdit: boolean) => {\n    const label = isEdit ? editFieldLabel : newFieldLabel;\n    const type = isEdit ? editFieldType : newFieldType;\n    const required = isEdit ? editFieldRequired : newFieldRequired;\n    const options = isEdit ? editFieldOptions : newFieldOptions;\n    \n    if (!label.trim()) {\n      toast({ variant: \"destructive\", description: \"Alan adı gerekli\" });\n      return;\n    }\n    \n    const newField: FormField = {\n      id: Date.now().toString(),\n      label: label.trim(),\n      type,\n      required,\n      options: type === 'select' ? options.split(',').map(o => o.trim()).filter(o => o) : undefined,\n    };\n    \n    if (isEdit) {\n      setEditEventFormFields([...editEventFormFields, newField]);\n      setEditFieldLabel(\"\");\n      setEditFieldType('text');\n      setEditFieldRequired(false);\n      setEditFieldOptions(\"\");\n    } else {\n      setNewEventFormFields([...newEventFormFields, newField]);\n      setNewFieldLabel(\"\");\n      setNewFieldType('text');\n      setNewFieldRequired(false);\n      setNewFieldOptions(\"\");\n    }\n  };\n\n  const removeFormField = (fieldId: string, isEdit: boolean) => {\n    if (isEdit) {\n      setEditEventFormFields(editEventFormFields.filter(f => f.id !== fieldId));\n    } else {\n      setNewEventFormFields(newEventFormFields.filter(f => f.id !== fieldId));\n    }\n  };\n\n  const deleteAnnouncementMutation = useMutation({\n    mutationFn: (announcementId: string) => deleteAnnouncement(announcementId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/announcements\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Duyuru silindi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Duyuru silinirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const deletePollMutation = useMutation({\n    mutationFn: (pollId: string) => deletePoll(pollId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/polls\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oylama silindi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Oylama silinirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const togglePollMutation = useMutation({\n    mutationFn: ({ pollId, isOpen }: { pollId: string; isOpen: boolean }) =>\n      togglePollStatus(pollId, isOpen),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/polls\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oylama durumu güncellendi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Oylama durumu güncellenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const publishResultsMutation = useMutation({\n    mutationFn: (pollId: string) => publishPollResults(pollId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/polls\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oylama sonuçları yayınlandı ve oylama kapatıldı\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Sonuçlar yayınlanırken bir hata oluştu\",\n      });\n    },\n  });\n\n  const roleUpdateMutation = useMutation({\n    mutationFn: ({ userId, role }: { userId: string; role: string }) =>\n      updateProfile(userId, { role: role as any }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/profiles\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı rolü güncellendi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Rol güncellenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const ideaStatusMutation = useMutation({\n    mutationFn: ({ ideaId, status }: { ideaId: string; status: 'approved' | 'rejected' }) =>\n      updateIdeaStatus(ideaId, status),\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/ideas\"] });\n      toast({\n        title: \"Başarılı\",\n        description: variables.status === 'approved' ? \"Fikir onaylandı\" : \"Fikir reddedildi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Fikir durumu güncellenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const commentStatusMutation = useMutation({\n    mutationFn: ({ commentId, status }: { commentId: string; status: 'approved' | 'rejected' }) =>\n      updateCommentStatus(commentId, status),\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/comments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/ideas\"] });\n      toast({\n        title: \"Başarılı\",\n        description: variables.status === 'approved' ? \"Yorum onaylandı\" : \"Yorum reddedildi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Yorum durumu güncellenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const deleteIdeaMutation = useMutation({\n    mutationFn: (ideaId: string) => deleteIdea(ideaId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/ideas\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/ideas\"] });\n      setSelectedIdea(null);\n      toast({\n        title: \"Başarılı\",\n        description: \"Fikir silindi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Fikir silinirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const announcementCommentStatusMutation = useMutation({\n    mutationFn: ({ commentId, status }: { commentId: string; status: 'approved' | 'rejected' }) =>\n      updateAnnouncementCommentStatus(commentId, status),\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/announcement-comments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/announcements\"] });\n      toast({\n        title: \"Başarılı\",\n        description: variables.status === 'approved' ? \"Yorum onaylandı\" : \"Yorum reddedildi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Yorum durumu güncellenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const blutenVisibilityMutation = useMutation({\n    mutationFn: ({ id, visible }: { id: string; visible: boolean }) =>\n      toggleBlutenVisibility(id, visible),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/bluten\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Blüten görünürlüğü güncellendi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Görünürlük değiştirilirken bir hata oluştu\",\n      });\n    },\n  });\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Yönetici Paneli</h1>\n        <p className=\"text-muted-foreground\">Sistem yönetimi ve moderasyon işlemleri</p>\n      </div>\n\n      <Tabs defaultValue=\"users\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-3 md:grid-cols-8 lg:w-auto lg:inline-grid gap-1\">\n          <TabsTrigger value=\"users\" data-testid=\"tab-users\">\n            <Users className=\"h-4 w-4 mr-2\" />\n            Kullanıcılar\n          </TabsTrigger>\n          <TabsTrigger value=\"announcements\" data-testid=\"tab-announcements\">\n            <Bell className=\"h-4 w-4 mr-2\" />\n            Duyurular\n          </TabsTrigger>\n          <TabsTrigger value=\"bluten\" data-testid=\"tab-bluten\">\n            <Image className=\"h-4 w-4 mr-2\" />\n            Blüten\n          </TabsTrigger>\n          <TabsTrigger value=\"polls\" data-testid=\"tab-polls\">\n            <BarChart3 className=\"h-4 w-4 mr-2\" />\n            Oylamalar\n          </TabsTrigger>\n          <TabsTrigger value=\"ideas\" data-testid=\"tab-ideas\">\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Fikirler\n          </TabsTrigger>\n          <TabsTrigger value=\"comments\" data-testid=\"tab-comments\">\n            <MessageSquare className=\"h-4 w-4 mr-2\" />\n            Fikir Yorumları\n          </TabsTrigger>\n          <TabsTrigger value=\"announcement-comments\" data-testid=\"tab-announcement-comments\">\n            <MessageSquare className=\"h-4 w-4 mr-2\" />\n            Duyuru Yorumları\n          </TabsTrigger>\n          <TabsTrigger value=\"profile-pictures\" data-testid=\"tab-profile-pictures\" className=\"relative\">\n            <Camera className=\"h-4 w-4 mr-2\" />\n            Profil Fotoğrafları\n            {pendingPictures && pendingPictures.length > 0 && (\n              <Badge variant=\"destructive\" className=\"ml-2 h-5 w-5 p-0 flex items-center justify-center text-xs\">\n                {pendingPictures.length}\n              </Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value=\"classes\" data-testid=\"tab-classes\">\n            <GraduationCap className=\"h-4 w-4 mr-2\" />\n            Sınıflar\n          </TabsTrigger>\n          <TabsTrigger value=\"events\" data-testid=\"tab-events\">\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Etkinlikler\n          </TabsTrigger>\n          <TabsTrigger value=\"analytics\" data-testid=\"tab-analytics\">\n            <TrendingUp className=\"h-4 w-4 mr-2\" />\n            Analitik\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"users\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle>Kullanıcı Yönetimi</CardTitle>\n              <UserForm />\n            </CardHeader>\n            <CardContent>\n              {loadingProfiles ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>İsim</TableHead>\n                      <TableHead>Sınıf</TableHead>\n                      <TableHead>Rol</TableHead>\n                      <TableHead className=\"text-right\">İşlemler</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {profiles?.map((profile) => (\n                      <TableRow key={profile.id} data-testid={`row-user-${profile.id}`}>\n                        <TableCell className=\"font-medium\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-8 w-8\">\n                              {profile.profile_picture_url && profile.profile_picture_status === 'approved' && (\n                                <AvatarImage src={profile.profile_picture_url} alt={profile.first_name || ''} />\n                              )}\n                              <AvatarFallback>{profile.first_name?.[0]}{profile.last_name?.[0]}</AvatarFallback>\n                            </Avatar>\n                            {profile.first_name} {profile.last_name}\n                          </div>\n                        </TableCell>\n                        <TableCell>{profile.class_name || \"-\"}</TableCell>\n                        <TableCell>\n                          <Select\n                            value={profile.role}\n                            onValueChange={(value) => roleUpdateMutation.mutate({ userId: profile.user_id, role: value })}\n                          >\n                            <SelectTrigger className=\"w-32\" data-testid={`select-role-${profile.id}`}>\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"student\">Student</SelectItem>\n                              <SelectItem value=\"teacher\">Teacher</SelectItem>\n                              <SelectItem value=\"admin\">Admin</SelectItem>\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex justify-end gap-1\">\n                            {profile.profile_picture_url && (\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm('Bu kullanıcının profil fotoğrafını sıfırlamak istediğinize emin misiniz?')) {\n                                    resetPictureMutation.mutate(profile.id);\n                                  }\n                                }}\n                                title=\"Profil fotoğrafını sıfırla\"\n                                data-testid={`button-reset-picture-${profile.id}`}\n                              >\n                                <ImageOff className=\"h-4 w-4 text-orange-500\" />\n                              </Button>\n                            )}\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => {\n                                if (confirm('Bu kullanıcıyı askıya almak istediğinize emin misiniz?')) {\n                                  suspendUserMutation.mutate(profile.id);\n                                }\n                              }}\n                              title=\"Kullanıcıyı askıya al\"\n                              data-testid={`button-suspend-${profile.id}`}\n                            >\n                              <Ban className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => {\n                                activateUserMutation.mutate(profile.id);\n                              }}\n                              title=\"Kullanıcıyı aktifleştir\"\n                              data-testid={`button-activate-${profile.id}`}\n                            >\n                              <UserCheck className=\"h-4 w-4 text-green-500\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"announcements\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle>Duyuru Yönetimi ({announcements?.length || 0})</CardTitle>\n              <AnnouncementForm />\n            </CardHeader>\n            <CardContent>\n              {loadingAnnouncements ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : announcements && announcements.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Başlık</TableHead>\n                      <TableHead>İçerik</TableHead>\n                      <TableHead>Yazar</TableHead>\n                      <TableHead>Tarih</TableHead>\n                      <TableHead className=\"text-right\">İşlemler</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {announcements.map((announcement) => {\n                      const authorName = announcement.author\n                        ? `${announcement.author.first_name || \"\"} ${announcement.author.last_name || \"\"}`.trim() || \"Anonim\"\n                        : \"Yönetici\";\n                      \n                      return (\n                        <TableRow key={announcement.id} data-testid={`row-announcement-${announcement.id}`}>\n                          <TableCell className=\"font-medium max-w-xs\">\n                            <p className=\"truncate\">{announcement.title}</p>\n                          </TableCell>\n                          <TableCell className=\"max-w-md\">\n                            <p className=\"truncate text-muted-foreground\">{announcement.content}</p>\n                          </TableCell>\n                          <TableCell className=\"text-sm\">{authorName}</TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {dayjs(announcement.created_at).format('DD MMMM YYYY, HH:mm')}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <AnnouncementForm existingAnnouncement={announcement} />\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm('Bu duyuruyu silmek istediğinize emin misiniz?')) {\n                                    deleteAnnouncementMutation.mutate(announcement.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-announcement-${announcement.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              ) : (\n                <div className=\"text-center py-12\">\n                  <Bell className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <p className=\"text-muted-foreground\">Henüz duyuru yok</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"polls\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle>Oylama Yönetimi ({polls?.length || 0})</CardTitle>\n              <PollForm />\n            </CardHeader>\n            <CardContent>\n              {loadingPolls ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : polls && polls.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {polls.map((poll: any) => {\n                    const totalVotes = poll.options?.reduce((sum: number, opt: any) => sum + (opt.vote_count || 0), 0) || 0;\n                    \n                    return (\n                      <Card key={poll.id} data-testid={`card-poll-${poll.id}`}>\n                        <CardHeader>\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <CardTitle className=\"text-lg mb-2\">{poll.question}</CardTitle>\n                              <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                                <span>{poll.is_open ? '🟢 Açık' : '🔴 Kapalı'}</span>\n                                <span>👥 {totalVotes} oy</span>\n                                <span>{dayjs(poll.created_at).format('DD MMMM YYYY')}</span>\n                              </div>\n                            </div>\n                            <div className=\"flex gap-2\">\n                              <PollStatsDialog pollId={poll.id} pollQuestion={poll.question} />\n                              {!poll.results_published && (\n                                <Button\n                                  variant=\"default\"\n                                  size=\"sm\"\n                                  onClick={() => {\n                                    if (confirm('Sonuçları yayınlamak istediğinize emin misiniz? Bu işlemden sonra kimse oy veremeyecek ve sonuçlar herkese görünür olacak.')) {\n                                      publishResultsMutation.mutate(poll.id);\n                                    }\n                                  }}\n                                  data-testid={`button-publish-results-${poll.id}`}\n                                >\n                                  Sonuçları Yayınla\n                                </Button>\n                              )}\n                              {poll.results_published && (\n                                <span className=\"text-xs text-muted-foreground px-2 py-1 bg-muted rounded\">\n                                  Sonuçlar Yayınlandı\n                                </span>\n                              )}\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => togglePollMutation.mutate({ \n                                  pollId: poll.id, \n                                  isOpen: !poll.is_open \n                                })}\n                                data-testid={`button-toggle-poll-${poll.id}`}\n                                disabled={poll.results_published}\n                              >\n                                {poll.is_open ? 'Kapat' : 'Aç'}\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm('Bu oylamayı silmek istediğinize emin misiniz?')) {\n                                    deletePollMutation.mutate(poll.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-poll-${poll.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"space-y-3\">\n                            {poll.options?.map((option: any) => {\n                              const percentage = totalVotes > 0 \n                                ? Math.round((option.vote_count / totalVotes) * 100) \n                                : 0;\n                              \n                              return (\n                                <div key={option.id} className=\"space-y-1\">\n                                  <div className=\"flex items-center justify-between text-sm\">\n                                    <span>{option.option_text}</span>\n                                    <span className=\"text-muted-foreground\">\n                                      {option.vote_count} oy ({percentage}%)\n                                    </span>\n                                  </div>\n                                  <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\n                                    <div \n                                      className=\"h-full bg-primary transition-all\" \n                                      style={{ width: `${percentage}%` }}\n                                    />\n                                  </div>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"text-center py-12\">\n                  <BarChart3 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <p className=\"text-muted-foreground\">Henüz oylama yok</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"bluten\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <CardTitle>Bülten Yönetimi ({allBlutenPosts?.length || 0})</CardTitle>\n              <BlutenForm />\n            </CardHeader>\n            <CardContent>\n              {loadingBluten ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : allBlutenPosts && allBlutenPosts.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Görsel</TableHead>\n                      <TableHead>Açıklama</TableHead>\n                      <TableHead>Kaynak</TableHead>\n                      <TableHead>Tarih</TableHead>\n                      <TableHead>Görünür</TableHead>\n                      <TableHead className=\"text-right\">İşlemler</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {allBlutenPosts.map((post) => (\n                      <TableRow key={post.id} data-testid={`row-bluten-${post.id}`}>\n                        <TableCell>\n                          <div className=\"w-12 h-12 rounded overflow-hidden bg-muted\">\n                            {post.media_url && (\n                              <img src={post.media_url} alt=\"\" className=\"object-cover w-full h-full\" />\n                            )}\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"max-w-xs\">\n                          <p className=\"truncate\">{post.caption || \"Açıklama yok\"}</p>\n                        </TableCell>\n                        <TableCell className=\"text-xs\">\n                          {post.instagram_post_id ? \"Instagram (Otomatik)\" : \"Manuel\"}\n                        </TableCell>\n                        <TableCell className=\"text-sm\">\n                          {post.posted_at ? dayjs(post.posted_at).format('DD.MM.YYYY') : dayjs(post.fetched_at).format('DD.MM.YYYY')}\n                        </TableCell>\n                        <TableCell>\n                          <StatusBadge status={post.is_visible ? \"approved\" : \"rejected\"} />\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => blutenVisibilityMutation.mutate({ id: post.id, visible: !post.is_visible })}\n                            data-testid={`button-toggle-bluten-${post.id}`}\n                          >\n                            {post.is_visible ? <Eye className=\"h-4 w-4\" /> : <XCircle className=\"h-4 w-4\" />}\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Henüz Bülten içeriği yok</p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"ideas\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Fikirler Moderasyonu ({adminIdeas?.filter((i: any) => i.status === 'pending').length || 0} bekliyor)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingIdeas ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : adminIdeas && adminIdeas.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Başlık</TableHead>\n                      <TableHead>Yazar</TableHead>\n                      <TableHead>Tarih</TableHead>\n                      <TableHead>Durum</TableHead>\n                      <TableHead className=\"text-right\">İşlemler</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {adminIdeas.map((idea: any) => {\n                      const authorName = idea.author\n                        ? `${idea.author.first_name || \"\"} ${idea.author.last_name || \"\"}`.trim()\n                        : \"Anonim\";\n                      // Fix timezone issue - convert UTC to local time\n                      const createdDate = dayjs.utc(idea.created_at).local();\n                      return (\n                        <TableRow key={idea.id} data-testid={`row-idea-${idea.id}`}>\n                          <TableCell className=\"font-medium\">{idea.title}</TableCell>\n                          <TableCell>{authorName}</TableCell>\n                          <TableCell>{createdDate.fromNow()}</TableCell>\n                          <TableCell>\n                            <StatusBadge status={idea.status} />\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => setSelectedIdea(idea)}\n                                data-testid={`button-view-idea-${idea.id}`}\n                                title=\"Detayları Görüntüle\"\n                              >\n                                <Eye className=\"h-4 w-4\" />\n                              </Button>\n                              {idea.status === 'pending' && (\n                                <>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => ideaStatusMutation.mutate({ ideaId: idea.id, status: 'approved' })}\n                                    data-testid={`button-approve-idea-${idea.id}`}\n                                  >\n                                    <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                                  </Button>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"sm\"\n                                    onClick={() => ideaStatusMutation.mutate({ ideaId: idea.id, status: 'rejected' })}\n                                    data-testid={`button-reject-idea-${idea.id}`}\n                                  >\n                                    <XCircle className=\"h-4 w-4 text-red-500\" />\n                                  </Button>\n                                </>\n                              )}\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm('Bu fikri silmek istediğinize emin misiniz? Tüm yorumları da silinecek.')) {\n                                    deleteIdeaMutation.mutate(idea.id);\n                                  }\n                                }}\n                                data-testid={`button-delete-idea-${idea.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Henüz fikir yok</p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"comments\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Yorumlar Moderasyonu ({adminComments?.length || 0} bekliyor)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingComments ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : adminComments && adminComments.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Yorum</TableHead>\n                      <TableHead>Yazar</TableHead>\n                      <TableHead>Fikir</TableHead>\n                      <TableHead>Durum</TableHead>\n                      <TableHead className=\"text-right\">İşlemler</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {adminComments.map((comment: any) => {\n                      const authorName = comment.author\n                        ? `${comment.author.first_name || \"\"} ${comment.author.last_name || \"\"}`.trim()\n                        : \"Anonim\";\n                      const ideaTitle = comment.idea?.title || \"Bilinmiyor\";\n                      return (\n                        <TableRow key={comment.id} data-testid={`row-comment-${comment.id}`}>\n                          <TableCell className=\"max-w-xs truncate\">{comment.content}</TableCell>\n                          <TableCell>{authorName}</TableCell>\n                          <TableCell>\n                            <span className=\"text-xs text-muted-foreground\" title={ideaTitle}>\n                              {ideaTitle.substring(0, 30)}{ideaTitle.length > 30 ? '...' : ''}\n                            </span>\n                          </TableCell>\n                          <TableCell>\n                            <StatusBadge status={comment.status} />\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => commentStatusMutation.mutate({ commentId: comment.id, status: 'approved' })}\n                                data-testid={`button-approve-comment-${comment.id}`}\n                              >\n                                <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => commentStatusMutation.mutate({ commentId: comment.id, status: 'rejected' })}\n                                data-testid={`button-reject-comment-${comment.id}`}\n                              >\n                                <XCircle className=\"h-4 w-4 text-red-500\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Bekleyen yorum yok</p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"announcement-comments\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Duyuru Yorumları Moderasyonu ({announcementComments?.filter((c: any) => c.status === 'pending').length || 0} bekliyor)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingAnnouncementComments ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : announcementComments && announcementComments.length > 0 ? (\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Yorum</TableHead>\n                      <TableHead>Yazar</TableHead>\n                      <TableHead>Duyuru</TableHead>\n                      <TableHead>Durum</TableHead>\n                      <TableHead className=\"text-right\">İşlemler</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {announcementComments.map((comment: any) => {\n                      const authorName = comment.author\n                        ? `${comment.author.first_name || \"\"} ${comment.author.last_name || \"\"}`.trim()\n                        : \"Anonim\";\n                      const announcementTitle = comment.announcement?.title || \"Bilinmiyor\";\n                      return (\n                        <TableRow key={comment.id} data-testid={`row-announcement-comment-${comment.id}`}>\n                          <TableCell className=\"max-w-xs truncate\">{comment.content}</TableCell>\n                          <TableCell>{authorName}</TableCell>\n                          <TableCell>\n                            <span className=\"text-xs text-muted-foreground\" title={announcementTitle}>\n                              {announcementTitle.substring(0, 30)}{announcementTitle.length > 30 ? '...' : ''}\n                            </span>\n                          </TableCell>\n                          <TableCell>\n                            <StatusBadge status={comment.status} />\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => announcementCommentStatusMutation.mutate({ commentId: comment.id, status: 'approved' })}\n                                data-testid={`button-approve-announcement-comment-${comment.id}`}\n                              >\n                                <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => announcementCommentStatusMutation.mutate({ commentId: comment.id, status: 'rejected' })}\n                                data-testid={`button-reject-announcement-comment-${comment.id}`}\n                              >\n                                <XCircle className=\"h-4 w-4 text-red-500\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Bekleyen duyuru yorumu yok</p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Profile Pictures Tab */}\n        <TabsContent value=\"profile-pictures\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Camera className=\"h-5 w-5\" />\n                Profil Fotoğrafları Onayı\n                {pendingPictures && pendingPictures.length > 0 && (\n                  <Badge variant=\"destructive\">{pendingPictures.length} bekliyor</Badge>\n                )}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {loadingPictures ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : pendingPictures && pendingPictures.length > 0 ? (\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                  {pendingPictures.map((profile: any) => (\n                    <Card key={profile.id} className=\"overflow-hidden\" data-testid={`card-profile-picture-${profile.id}`}>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex flex-col items-center gap-4\">\n                          <Avatar className=\"h-32 w-32\">\n                            <AvatarImage src={profile.profile_picture_url || undefined} alt={profile.first_name || undefined} />\n                            <AvatarFallback className=\"text-2xl\">\n                              {profile.first_name?.charAt(0)}{profile.last_name?.charAt(0)}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"text-center\">\n                            <p className=\"font-medium\">{profile.first_name} {profile.last_name}</p>\n                            <p className=\"text-sm text-muted-foreground\">{profile.class_name || 'Sınıf belirtilmemiş'}</p>\n                          </div>\n                          <div className=\"flex gap-2 w-full\">\n                            <Button\n                              variant=\"default\"\n                              size=\"sm\"\n                              className=\"flex-1\"\n                              onClick={() => approvePictureMutation.mutate(profile.id)}\n                              disabled={approvePictureMutation.isPending || rejectPictureMutation.isPending}\n                              data-testid={`button-approve-picture-${profile.id}`}\n                            >\n                              {approvePictureMutation.isPending ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <>\n                                  <Check className=\"h-4 w-4 mr-1\" />\n                                  Onayla\n                                </>\n                              )}\n                            </Button>\n                            <Button\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              className=\"flex-1\"\n                              onClick={() => rejectPictureMutation.mutate(profile.id)}\n                              disabled={approvePictureMutation.isPending || rejectPictureMutation.isPending}\n                              data-testid={`button-reject-picture-${profile.id}`}\n                            >\n                              {rejectPictureMutation.isPending ? (\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\n                              ) : (\n                                <>\n                                  <X className=\"h-4 w-4 mr-1\" />\n                                  Reddet\n                                </>\n                              )}\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">Onay bekleyen profil fotoğrafı yok</p>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"classes\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <GraduationCap className=\"h-5 w-5\" />\n                Sınıf Yönetimi\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\">\n                <div className=\"flex gap-2\">\n                  <Input\n                    placeholder=\"Yeni sınıf adı (örn: 9-A)\"\n                    value={newClassName}\n                    onChange={(e) => setNewClassName(e.target.value)}\n                    className=\"max-w-xs\"\n                    data-testid=\"input-new-class\"\n                  />\n                  <Button\n                    onClick={() => {\n                      if (newClassName.trim()) {\n                        createClassMutation.mutate(newClassName.trim());\n                      }\n                    }}\n                    disabled={!newClassName.trim() || createClassMutation.isPending}\n                    data-testid=\"button-create-class\"\n                  >\n                    {createClassMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <>\n                        <Plus className=\"h-4 w-4 mr-2\" />\n                        Sınıf Ekle\n                      </>\n                    )}\n                  </Button>\n                </div>\n\n                {loadingClasses ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                  </div>\n                ) : classes && classes.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Sınıf Adı</TableHead>\n                        <TableHead>Oluşturulma Tarihi</TableHead>\n                        <TableHead className=\"w-[100px]\">İşlemler</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {classes.map((cls) => (\n                        <TableRow key={cls.id} data-testid={`row-class-${cls.id}`}>\n                          <TableCell className=\"font-medium\">{cls.name}</TableCell>\n                          <TableCell className=\"text-muted-foreground\">\n                            {dayjs(cls.created_at).format(\"DD MMM YYYY\")}\n                          </TableCell>\n                          <TableCell>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => {\n                                if (confirm(`\"${cls.name}\" sınıfını silmek istediğinize emin misiniz?`)) {\n                                  deleteClassMutation.mutate(cls.id);\n                                }\n                              }}\n                              disabled={deleteClassMutation.isPending}\n                              data-testid={`button-delete-class-${cls.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground text-center py-8\">\n                    Henüz sınıf eklenmemiş. Kayıt formunda görünmesi için sınıf ekleyin.\n                  </p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"events\">\n          <div className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-5 w-5\" />\n                  Yeni Etkinlik Oluştur\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"event-name\">Etkinlik Adı *</Label>\n                      <Input\n                        id=\"event-name\"\n                        placeholder=\"Etkinlik adını girin\"\n                        value={newEventName}\n                        onChange={(e) => setNewEventName(e.target.value)}\n                        data-testid=\"input-event-name\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"event-description\">Açıklama</Label>\n                      <Input\n                        id=\"event-description\"\n                        placeholder=\"Etkinlik açıklaması (isteğe bağlı)\"\n                        value={newEventDescription}\n                        onChange={(e) => setNewEventDescription(e.target.value)}\n                        data-testid=\"input-event-description\"\n                      />\n                    </div>\n                  </div>\n                  \n                  <div className=\"grid gap-4 md:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"event-date\">Etkinlik Tarihi</Label>\n                      <Input\n                        id=\"event-date\"\n                        type=\"datetime-local\"\n                        value={newEventDate}\n                        onChange={(e) => setNewEventDate(e.target.value)}\n                        data-testid=\"input-event-date\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"event-end-date\">Bitiş Tarihi (İsteğe Bağlı)</Label>\n                      <Input\n                        id=\"event-end-date\"\n                        type=\"datetime-local\"\n                        value={newEventEndDate}\n                        onChange={(e) => setNewEventEndDate(e.target.value)}\n                        data-testid=\"input-event-end-date\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      id=\"event-active\"\n                      checked={newEventActive}\n                      onCheckedChange={setNewEventActive}\n                      data-testid=\"switch-event-active\"\n                    />\n                    <Label htmlFor=\"event-active\">Etkinlik Aktif</Label>\n                  </div>\n\n                  <div className=\"border rounded-lg p-4 space-y-4\">\n                    <h4 className=\"font-medium\">Form Alanları Oluşturucu</h4>\n                    \n                    <div className=\"grid gap-4 md:grid-cols-4\">\n                      <div className=\"space-y-2\">\n                        <Label>Alan Adı</Label>\n                        <Input\n                          placeholder=\"Örn: Telefon Numarası\"\n                          value={newFieldLabel}\n                          onChange={(e) => setNewFieldLabel(e.target.value)}\n                          data-testid=\"input-field-label\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>Alan Tipi</Label>\n                        <Select value={newFieldType} onValueChange={(v: 'text' | 'textarea' | 'select') => setNewFieldType(v)}>\n                          <SelectTrigger data-testid=\"select-field-type\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"text\">Metin</SelectItem>\n                            <SelectItem value=\"textarea\">Uzun Metin</SelectItem>\n                            <SelectItem value=\"select\">Seçim Listesi</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div className=\"flex items-end gap-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <Switch\n                            id=\"field-required\"\n                            checked={newFieldRequired}\n                            onCheckedChange={setNewFieldRequired}\n                            data-testid=\"switch-field-required\"\n                          />\n                          <Label htmlFor=\"field-required\">Zorunlu</Label>\n                        </div>\n                      </div>\n                      <div className=\"flex items-end\">\n                        <Button\n                          type=\"button\"\n                          size=\"sm\"\n                          onClick={() => addFormField(false)}\n                          data-testid=\"button-add-field\"\n                        >\n                          <Plus className=\"h-4 w-4 mr-1\" />\n                          Ekle\n                        </Button>\n                      </div>\n                    </div>\n\n                    {newFieldType === 'select' && (\n                      <div className=\"space-y-2\">\n                        <Label>Seçenekler (virgülle ayırın)</Label>\n                        <Input\n                          placeholder=\"Örn: Seçenek 1, Seçenek 2, Seçenek 3\"\n                          value={newFieldOptions}\n                          onChange={(e) => setNewFieldOptions(e.target.value)}\n                          data-testid=\"input-field-options\"\n                        />\n                      </div>\n                    )}\n\n                    {newEventFormFields.length > 0 && (\n                      <div className=\"space-y-2\">\n                        <Label>Eklenen Alanlar:</Label>\n                        <div className=\"space-y-2\">\n                          {newEventFormFields.map((field) => (\n                            <div key={field.id} className=\"flex items-center justify-between bg-muted p-2 rounded\" data-testid={`field-preview-${field.id}`}>\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"font-medium\">{field.label}</span>\n                                <Badge variant=\"secondary\">{field.type === 'text' ? 'Metin' : field.type === 'textarea' ? 'Uzun Metin' : 'Seçim'}</Badge>\n                                {field.required && <Badge variant=\"destructive\">Zorunlu</Badge>}\n                                {field.options && field.options.length > 0 && (\n                                  <span className=\"text-xs text-muted-foreground\">({field.options.join(', ')})</span>\n                                )}\n                              </div>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => removeFormField(field.id, false)}\n                                data-testid={`button-remove-field-${field.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n\n                  <Button\n                    onClick={() => {\n                      if (!newEventName.trim()) {\n                        toast({ variant: \"destructive\", description: \"Etkinlik adı gerekli\" });\n                        return;\n                      }\n                      createEventMutation.mutate({\n                        name: newEventName.trim(),\n                        description: newEventDescription.trim() || undefined,\n                        is_active: newEventActive,\n                        event_date: newEventDate ? new Date(newEventDate).toISOString() : undefined,\n                        end_date: newEventEndDate ? new Date(newEventEndDate).toISOString() : undefined,\n                        form_fields: newEventFormFields,\n                      });\n                    }}\n                    disabled={!newEventName.trim() || createEventMutation.isPending}\n                    data-testid=\"button-create-event\"\n                  >\n                    {createEventMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    ) : (\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                    )}\n                    Etkinlik Oluştur\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Mevcut Etkinlikler ({events?.length || 0})</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {loadingEvents ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                  </div>\n                ) : events && events.length > 0 ? (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Ad</TableHead>\n                        <TableHead>Açıklama</TableHead>\n                        <TableHead>Durum</TableHead>\n                        <TableHead>Form Alanları</TableHead>\n                        <TableHead>Oluşturulma</TableHead>\n                        <TableHead className=\"text-right\">İşlemler</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {events.map((event) => (\n                        <TableRow key={event.id} data-testid={`row-event-${event.id}`}>\n                          <TableCell className=\"font-medium\">{event.name}</TableCell>\n                          <TableCell className=\"max-w-xs truncate text-muted-foreground\">\n                            {event.description || '-'}\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant={event.is_active ? 'default' : 'secondary'}>\n                              {event.is_active ? 'Aktif' : 'Pasif'}\n                            </Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">{event.form_fields?.length || 0} alan</Badge>\n                          </TableCell>\n                          <TableCell className=\"text-muted-foreground\">\n                            {dayjs(event.created_at).format(\"DD MMM YYYY\")}\n                          </TableCell>\n                          <TableCell className=\"text-right\">\n                            <div className=\"flex justify-end gap-1\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => handleViewApplications(event)}\n                                title=\"Başvuruları Görüntüle\"\n                                data-testid={`button-view-applications-${event.id}`}\n                              >\n                                <ClipboardList className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => handleEditEvent(event)}\n                                title=\"Düzenle\"\n                                data-testid={`button-edit-event-${event.id}`}\n                              >\n                                <Edit2 className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => {\n                                  if (confirm(`\"${event.name}\" etkinliğini silmek istediğinize emin misiniz?`)) {\n                                    deleteEventMutation.mutate(event.id);\n                                  }\n                                }}\n                                title=\"Sil\"\n                                data-testid={`button-delete-event-${event.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground text-center py-8\">\n                    Henüz etkinlik oluşturulmamış.\n                  </p>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Analytics Tab */}\n        <TabsContent value=\"analytics\">\n          <div className=\"space-y-6\">\n            {loadingAnalytics ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : analytics ? (\n              <>\n                {/* Overview Cards */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Toplam Kullanıcı</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\" data-testid=\"text-total-users\">{analytics.overview.totalUsers}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {analytics.overview.studentCount} Öğrenci, {analytics.overview.teacherCount} Öğretmen, {analytics.overview.adminCount} Admin\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Toplam Oylama</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\" data-testid=\"text-total-polls\">{analytics.overview.totalPolls}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {analytics.overview.activePolls} Aktif, {analytics.overview.closedPolls} Kapalı\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Toplam Oy</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\" data-testid=\"text-total-votes\">{analytics.overview.totalVotes}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {analytics.overview.uniqueVoters} Benzersiz Oy Veren\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Katılım Oranı</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold text-primary\" data-testid=\"text-participation-rate\">\n                        %{analytics.overview.participationRate}\n                      </div>\n                      <Progress value={analytics.overview.participationRate} className=\"mt-2 h-2\" />\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Engagement Metrics */}\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Fikirler</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{analytics.overview.totalIdeas}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        <span className=\"text-green-600\">{analytics.overview.approvedIdeas} onaylı</span>,{' '}\n                        <span className=\"text-yellow-600\">{analytics.overview.pendingIdeas} bekleyen</span>,{' '}\n                        <span className=\"text-red-600\">{analytics.overview.rejectedIdeas} reddedilen</span>\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Duyurular</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{analytics.overview.totalAnnouncements}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {analytics.overview.approvedComments} onaylı yorum\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Etkinlikler</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{analytics.overview.totalEvents}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {analytics.overview.activeEvents} aktif, {analytics.overview.totalApplications} başvuru\n                      </p>\n                    </CardContent>\n                  </Card>\n\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">Toplam Yorum</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-2xl font-bold\">{analytics.overview.totalComments}</div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        Duyuru yorumları\n                      </p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                {/* Poll Breakdown */}\n                {analytics.polls.length > 0 && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        <PieChart className=\"h-5 w-5\" />\n                        Oylama Detayları\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-6\">\n                        {analytics.polls.map((poll) => (\n                          <div key={poll.id} className=\"border rounded-lg p-4\" data-testid={`poll-analytics-${poll.id}`}>\n                            <div className=\"flex items-center justify-between mb-3\">\n                              <h4 className=\"font-medium\">{poll.question}</h4>\n                              <div className=\"flex items-center gap-2\">\n                                <Badge variant={poll.isOpen ? 'default' : 'secondary'}>\n                                  {poll.isOpen ? 'Aktif' : 'Kapalı'}\n                                </Badge>\n                                <span className=\"text-sm text-muted-foreground\">\n                                  {poll.totalVotes} oy, %{Math.round(poll.participationRate)} katılım\n                                </span>\n                              </div>\n                            </div>\n                            <div className=\"space-y-2\">\n                              {poll.options.map((option) => {\n                                const percentage = poll.totalVotes > 0 \n                                  ? Math.round((option.votes / poll.totalVotes) * 100) \n                                  : 0;\n                                return (\n                                  <div key={option.id} className=\"space-y-1\">\n                                    <div className=\"flex items-center justify-between text-sm\">\n                                      <span>{option.text}</span>\n                                      <span className=\"text-muted-foreground\">{option.votes} oy (%{percentage})</span>\n                                    </div>\n                                    <Progress value={percentage} className=\"h-2\" />\n                                  </div>\n                                );\n                              })}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Class Distribution */}\n                {Object.keys(analytics.classDistribution).length > 0 && (\n                  <div className=\"grid md:grid-cols-2 gap-6\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          <Users className=\"h-5 w-5\" />\n                          Sınıf Dağılımı\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"space-y-3\">\n                          {Object.entries(analytics.classDistribution)\n                            .sort(([a], [b]) => a.localeCompare(b))\n                            .map(([className, count]) => {\n                              const percentage = analytics.overview.totalUsers > 0 \n                                ? Math.round((count / analytics.overview.totalUsers) * 100) \n                                : 0;\n                              return (\n                                <div key={className} className=\"space-y-1\">\n                                  <div className=\"flex items-center justify-between text-sm\">\n                                    <span className=\"font-medium\">{className}</span>\n                                    <span className=\"text-muted-foreground\">{count} öğrenci (%{percentage})</span>\n                                  </div>\n                                  <Progress value={percentage} className=\"h-2\" />\n                                </div>\n                              );\n                            })}\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          <BarChart3 className=\"h-5 w-5\" />\n                          Sınıf Bazlı Oy Dağılımı\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        {Object.keys(analytics.votesByClass).length > 0 ? (\n                          <div className=\"space-y-3\">\n                            {Object.entries(analytics.votesByClass)\n                              .sort(([, a], [, b]) => b - a)\n                              .map(([className, voteCount]) => {\n                                const maxVotes = Math.max(...Object.values(analytics.votesByClass));\n                                const percentage = maxVotes > 0 ? Math.round((voteCount / maxVotes) * 100) : 0;\n                                return (\n                                  <div key={className} className=\"space-y-1\">\n                                    <div className=\"flex items-center justify-between text-sm\">\n                                      <span className=\"font-medium\">{className}</span>\n                                      <span className=\"text-muted-foreground\">{voteCount} oy</span>\n                                    </div>\n                                    <Progress value={percentage} className=\"h-2\" />\n                                  </div>\n                                );\n                              })}\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-muted-foreground text-center py-8\">\n                            Henüz sınıf bazlı oy verisi yok.\n                          </p>\n                        )}\n                      </CardContent>\n                    </Card>\n                  </div>\n                )}\n              </>\n            ) : (\n              <Card>\n                <CardContent className=\"py-12\">\n                  <p className=\"text-center text-muted-foreground\">\n                    Analiz verileri yüklenirken bir hata oluştu.\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      {/* Event Edit Dialog */}\n      <Dialog open={!!editingEvent} onOpenChange={(open) => !open && setEditingEvent(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Etkinlik Düzenle</DialogTitle>\n          </DialogHeader>\n          {editingEvent && (\n            <div className=\"space-y-4\">\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-event-name\">Etkinlik Adı *</Label>\n                  <Input\n                    id=\"edit-event-name\"\n                    placeholder=\"Etkinlik adını girin\"\n                    value={editEventName}\n                    onChange={(e) => setEditEventName(e.target.value)}\n                    data-testid=\"input-edit-event-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-event-description\">Açıklama</Label>\n                  <Input\n                    id=\"edit-event-description\"\n                    placeholder=\"Etkinlik açıklaması (isteğe bağlı)\"\n                    value={editEventDescription}\n                    onChange={(e) => setEditEventDescription(e.target.value)}\n                    data-testid=\"input-edit-event-description\"\n                  />\n                </div>\n              </div>\n              \n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-event-date\">Etkinlik Tarihi</Label>\n                  <Input\n                    id=\"edit-event-date\"\n                    type=\"datetime-local\"\n                    value={editEventDate}\n                    onChange={(e) => setEditEventDate(e.target.value)}\n                    data-testid=\"input-edit-event-date\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-event-end-date\">Bitiş Tarihi (İsteğe Bağlı)</Label>\n                  <Input\n                    id=\"edit-event-end-date\"\n                    type=\"datetime-local\"\n                    value={editEventEndDate}\n                    onChange={(e) => setEditEventEndDate(e.target.value)}\n                    data-testid=\"input-edit-event-end-date\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  id=\"edit-event-active\"\n                  checked={editEventActive}\n                  onCheckedChange={setEditEventActive}\n                  data-testid=\"switch-edit-event-active\"\n                />\n                <Label htmlFor=\"edit-event-active\">Etkinlik Aktif</Label>\n              </div>\n\n              <div className=\"border rounded-lg p-4 space-y-4\">\n                <h4 className=\"font-medium\">Form Alanları</h4>\n                \n                <div className=\"grid gap-4 md:grid-cols-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Alan Adı</Label>\n                    <Input\n                      placeholder=\"Örn: Telefon Numarası\"\n                      value={editFieldLabel}\n                      onChange={(e) => setEditFieldLabel(e.target.value)}\n                      data-testid=\"input-edit-field-label\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>Alan Tipi</Label>\n                    <Select value={editFieldType} onValueChange={(v: 'text' | 'textarea' | 'select') => setEditFieldType(v)}>\n                      <SelectTrigger data-testid=\"select-edit-field-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"text\">Metin</SelectItem>\n                        <SelectItem value=\"textarea\">Uzun Metin</SelectItem>\n                        <SelectItem value=\"select\">Seçim Listesi</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"flex items-end gap-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Switch\n                        id=\"edit-field-required\"\n                        checked={editFieldRequired}\n                        onCheckedChange={setEditFieldRequired}\n                        data-testid=\"switch-edit-field-required\"\n                      />\n                      <Label htmlFor=\"edit-field-required\">Zorunlu</Label>\n                    </div>\n                  </div>\n                  <div className=\"flex items-end\">\n                    <Button\n                      type=\"button\"\n                      size=\"sm\"\n                      onClick={() => addFormField(true)}\n                      data-testid=\"button-edit-add-field\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-1\" />\n                      Ekle\n                    </Button>\n                  </div>\n                </div>\n\n                {editFieldType === 'select' && (\n                  <div className=\"space-y-2\">\n                    <Label>Seçenekler (virgülle ayırın)</Label>\n                    <Input\n                      placeholder=\"Örn: Seçenek 1, Seçenek 2, Seçenek 3\"\n                      value={editFieldOptions}\n                      onChange={(e) => setEditFieldOptions(e.target.value)}\n                      data-testid=\"input-edit-field-options\"\n                    />\n                  </div>\n                )}\n\n                {editEventFormFields.length > 0 && (\n                  <div className=\"space-y-2\">\n                    <Label>Mevcut Alanlar:</Label>\n                    <div className=\"space-y-2\">\n                      {editEventFormFields.map((field) => (\n                        <div key={field.id} className=\"flex items-center justify-between bg-muted p-2 rounded\" data-testid={`edit-field-preview-${field.id}`}>\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"font-medium\">{field.label}</span>\n                            <Badge variant=\"secondary\">{field.type === 'text' ? 'Metin' : field.type === 'textarea' ? 'Uzun Metin' : 'Seçim'}</Badge>\n                            {field.required && <Badge variant=\"destructive\">Zorunlu</Badge>}\n                            {field.options && field.options.length > 0 && (\n                              <span className=\"text-xs text-muted-foreground\">({field.options.join(', ')})</span>\n                            )}\n                          </div>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => removeFormField(field.id, true)}\n                            data-testid={`button-edit-remove-field-${field.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex justify-end gap-2\">\n                <Button variant=\"outline\" onClick={() => setEditingEvent(null)} data-testid=\"button-cancel-edit-event\">\n                  İptal\n                </Button>\n                <Button\n                  onClick={() => {\n                    if (!editEventName.trim()) {\n                      toast({ variant: \"destructive\", description: \"Etkinlik adı gerekli\" });\n                      return;\n                    }\n                    updateEventMutation.mutate({\n                      id: editingEvent.id,\n                      data: {\n                        name: editEventName.trim(),\n                        description: editEventDescription.trim() || undefined,\n                        is_active: editEventActive,\n                        event_date: editEventDate ? new Date(editEventDate).toISOString() : null,\n                        end_date: editEventEndDate ? new Date(editEventEndDate).toISOString() : null,\n                        form_fields: editEventFormFields,\n                      },\n                    });\n                  }}\n                  disabled={!editEventName.trim() || updateEventMutation.isPending}\n                  data-testid=\"button-save-event\"\n                >\n                  {updateEventMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  ) : (\n                    <Check className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Kaydet\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Event Applications Dialog */}\n      <Dialog open={!!viewingApplicationsEvent} onOpenChange={(open) => !open && setViewingApplicationsEvent(null)}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              Başvurular - {viewingApplicationsEvent?.name}\n            </DialogTitle>\n          </DialogHeader>\n          {loadingApplications ? (\n            <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : eventApplications.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Öğrenci</TableHead>\n                  <TableHead>Sınıf</TableHead>\n                  <TableHead>Yanıtlar</TableHead>\n                  <TableHead>Başvuru Tarihi</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {eventApplications.map((app) => (\n                  <TableRow key={app.id} data-testid={`row-application-${app.id}`}>\n                    <TableCell className=\"font-medium\">\n                      {app.profile?.first_name} {app.profile?.last_name}\n                      {app.profile?.student_no && (\n                        <span className=\"text-muted-foreground ml-1\">({app.profile.student_no})</span>\n                      )}\n                    </TableCell>\n                    <TableCell>{app.profile?.class_name || '-'}</TableCell>\n                    <TableCell>\n                      <div className=\"space-y-1 max-w-md\">\n                        {Object.entries(app.responses || {}).map(([key, value]) => (\n                          <div key={key} className=\"text-sm\">\n                            <span className=\"font-medium\">{key}:</span>{' '}\n                            <span className=\"text-muted-foreground\">{String(value)}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"text-muted-foreground\">\n                      {dayjs(app.created_at).format(\"DD MMM YYYY HH:mm\")}\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          ) : (\n            <p className=\"text-sm text-muted-foreground text-center py-8\">\n              Bu etkinliğe henüz başvuru yapılmamış.\n            </p>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Idea Detail Dialog */}\n      <Dialog open={!!selectedIdea} onOpenChange={(open) => !open && setSelectedIdea(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{selectedIdea?.title}</DialogTitle>\n          </DialogHeader>\n          {selectedIdea && (\n            <div className=\"space-y-4\">\n              {/* Author and Date */}\n              <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                <span>\n                  {selectedIdea.author\n                    ? `${selectedIdea.author.first_name || \"\"} ${selectedIdea.author.last_name || \"\"}`.trim()\n                    : \"Anonim\"}\n                  {selectedIdea.author?.class_name && ` • ${selectedIdea.author.class_name}`}\n                </span>\n                <span>{dayjs.utc(selectedIdea.created_at).local().format('DD.MM.YYYY HH:mm')}</span>\n              </div>\n\n              {/* Content */}\n              <div className=\"prose dark:prose-invert max-w-none\">\n                <p className=\"whitespace-pre-wrap\">{selectedIdea.content}</p>\n              </div>\n\n              {/* Image */}\n              {selectedIdea.image_url && (\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm font-medium\">Görsel:</p>\n                  <img\n                    src={selectedIdea.image_url}\n                    alt=\"Fikir görseli\"\n                    className=\"w-full rounded-lg border\"\n                  />\n                </div>\n              )}\n\n              {/* Video */}\n              {selectedIdea.video_url && (\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm font-medium\">Video:</p>\n                  <video\n                    src={selectedIdea.video_url}\n                    controls\n                    className=\"w-full rounded-lg border\"\n                  />\n                </div>\n              )}\n\n              {/* PDF/Document Attachment */}\n              {selectedIdea.attachment_url && (selectedIdea.attachment_type === 'pdf' || selectedIdea.attachment_type === 'document') && (\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm font-medium\">Ek Dosya:</p>\n                  <a \n                    href={selectedIdea.attachment_url} \n                    download \n                    target=\"_blank\" \n                    rel=\"noopener noreferrer\"\n                    className=\"inline-flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-md hover:bg-primary/20 transition-colors\"\n                    data-testid=\"link-download-attachment-admin-idea\"\n                  >\n                    <FileText className=\"h-4 w-4\" />\n                    {selectedIdea.attachment_type === 'pdf' ? 'PDF Dosyası' : 'Doküman'} İndir\n                    <Download className=\"h-4 w-4\" />\n                  </a>\n                </div>\n              )}\n\n              {/* Status and Actions */}\n              <div className=\"flex items-center justify-between pt-4 border-t\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm\">Durum:</span>\n                  <StatusBadge status={selectedIdea.status} />\n                </div>\n                {selectedIdea.status === 'pending' && (\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"default\"\n                      size=\"sm\"\n                      onClick={() => {\n                        ideaStatusMutation.mutate({ ideaId: selectedIdea.id, status: 'approved' });\n                        setSelectedIdea(null);\n                      }}\n                      data-testid=\"button-approve-in-dialog\"\n                    >\n                      <CheckCircle2 className=\"h-4 w-4 mr-1\" />\n                      Onayla\n                    </Button>\n                    <Button\n                      variant=\"destructive\"\n                      size=\"sm\"\n                      onClick={() => {\n                        ideaStatusMutation.mutate({ ideaId: selectedIdea.id, status: 'rejected' });\n                        setSelectedIdea(null);\n                      }}\n                      data-testid=\"button-reject-in-dialog\"\n                    >\n                      <XCircle className=\"h-4 w-4 mr-1\" />\n                      Reddet\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":103336,"size_tokens":null},"client/src/components/Header.tsx":{"content":"import { Home, Bell, BarChart3, Lightbulb, Users, Shield, LogOut, Image, User, ClipboardList, History, CalendarDays } from \"lucide-react\";\nimport mayaLogo from \"@assets/maya-okullari-logo-simge_1763489344712.webp\";\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport NotificationBell from \"@/components/NotificationBell\";\nimport { ThemeSwitcher } from \"@/components/ThemeSwitcher\";\n\ninterface HeaderProps {\n  isAuthenticated?: boolean;\n  userRole?: \"admin\" | \"teacher\" | \"student\";\n  userName?: string;\n  profilePictureUrl?: string | null;\n  profilePictureStatus?: 'pending' | 'approved' | 'rejected';\n  onLogout?: () => void;\n}\n\nexport default function Header({ \n  isAuthenticated = false, \n  userRole = \"student\",\n  userName = \"Kullanıcı\",\n  profilePictureUrl,\n  profilePictureStatus,\n  onLogout \n}: HeaderProps) {\n  const showProfilePicture = profilePictureUrl && profilePictureStatus === 'approved';\n  const [location] = useLocation();\n\n  const navItems = [\n    { path: \"/\", label: \"Ana Sayfa\", icon: Home },\n    { path: \"/duyurular\", label: \"Duyurular\", icon: Bell },\n    { path: \"/bluten\", label: \"Bülten\", icon: Image },\n    { path: \"/oylamalar\", label: \"Oylamalar\", icon: BarChart3 },\n    { path: \"/fikirler\", label: \"Fikirler\", icon: Lightbulb },\n    { path: \"/basvurular\", label: \"Başvurular\", icon: ClipboardList, requireAuth: true },\n    { path: \"/takvim\", label: \"Takvim\", icon: CalendarDays, requireAuth: true },\n  ];\n\n  if (userRole === \"admin\") {\n    navItems.push({ path: \"/siniflar\", label: \"Sınıflar\", icon: Users });\n    navItems.push({ path: \"/yonetici\", label: \"Yönetici\", icon: Shield });\n  }\n\n  const initials = userName\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n\n  return (\n    <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n      <div className=\"container mx-auto px-4 lg:px-6\">\n        <div className=\"flex h-16 items-center justify-between gap-4\">\n          <Link href=\"/\" className=\"flex items-center gap-2 hover-elevate active-elevate-2 rounded-md px-3 py-2 transition-all\">\n            <img \n              src={mayaLogo} \n              alt=\"Maya Okulları\" \n              className=\"h-8 w-8 object-contain\"\n            />\n            <div className=\"flex flex-col\">\n              <span className=\"text-lg font-bold leading-none\">\n                <span className=\"text-primary\">Maya</span> Meclisi\n              </span>\n              <span className=\"text-xs text-muted-foreground leading-none mt-0.5\">Öğrenci Portalı</span>\n            </div>\n          </Link>\n\n          <nav className=\"hidden md:flex items-center gap-1\">\n            {navItems\n              .filter((item) => !item.requireAuth || isAuthenticated)\n              .map((item) => {\n                const Icon = item.icon;\n                const isActive = location === item.path;\n                return (\n                  <Link key={item.path} href={item.path}>\n                    <Button\n                      variant=\"ghost\"\n                      className={isActive ? \"bg-accent\" : \"\"}\n                      data-testid={`nav-${item.label.toLowerCase()}`}\n                    >\n                      <Icon className=\"h-4 w-4 mr-2\" />\n                      {item.label}\n                    </Button>\n                  </Link>\n                );\n              })}\n          </nav>\n\n          <div className=\"flex items-center gap-2\">\n            <ThemeSwitcher />\n            {isAuthenticated && <NotificationBell />}\n            {isAuthenticated ? (\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full\" data-testid=\"button-profile\">\n                    <Avatar className=\"h-8 w-8\">\n                      {showProfilePicture && <AvatarImage src={profilePictureUrl} alt={userName} />}\n                      <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n                        {initials}\n                      </AvatarFallback>\n                    </Avatar>\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56\">\n                  <div className=\"flex items-center gap-2 p-2\">\n                    <Avatar className=\"h-8 w-8\">\n                      {showProfilePicture && <AvatarImage src={profilePictureUrl} alt={userName} />}\n                      <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n                        {initials}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex flex-col\">\n                      <span className=\"text-sm font-medium\">{userName}</span>\n                      <span className=\"text-xs text-muted-foreground capitalize\">{userRole}</span>\n                    </div>\n                  </div>\n                  <DropdownMenuSeparator />\n                  <Link href=\"/profil\">\n                    <DropdownMenuItem data-testid=\"link-profile\">\n                      <User className=\"h-4 w-4 mr-2\" />\n                      Profil Ayarları\n                    </DropdownMenuItem>\n                  </Link>\n                  <Link href=\"/aktiviteler\">\n                    <DropdownMenuItem data-testid=\"link-activities\">\n                      <History className=\"h-4 w-4 mr-2\" />\n                      Aktivite Geçmişi\n                    </DropdownMenuItem>\n                  </Link>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={onLogout} data-testid=\"button-logout\">\n                    <LogOut className=\"h-4 w-4 mr-2\" />\n                    Çıkış Yap\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            ) : (\n              <Link href=\"/giris\">\n                <Button variant=\"default\" data-testid=\"button-login\">\n                  Giriş Yap\n                </Button>\n              </Link>\n            )}\n          </div>\n        </div>\n\n        <nav className=\"md:hidden flex items-center gap-1 pb-3 overflow-x-auto\">\n          {navItems\n            .filter((item) => !item.requireAuth || isAuthenticated)\n            .map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              return (\n                <Link key={item.path} href={item.path}>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className={isActive ? \"bg-accent\" : \"\"}\n                    data-testid={`nav-mobile-${item.label.toLowerCase()}`}\n                  >\n                    <Icon className=\"h-4 w-4 mr-2\" />\n                    {item.label}\n                  </Button>\n                </Link>\n              );\n            })}\n        </nav>\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":7227,"size_tokens":null},"client/src/components/examples/Admin.tsx":{"content":"import Admin from \"../../pages/Admin\";\n\nexport default function AdminExample() {\n  return <Admin />;\n}\n","path":null,"size_bytes":103,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ProtectedRoute.tsx":{"content":"import { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\nimport { useEffect } from \"react\";\nimport { Loader2 } from \"lucide-react\";\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n  requireAuth?: boolean;\n  requireAdmin?: boolean;\n}\n\nexport default function ProtectedRoute({\n  children,\n  requireAuth = true,\n  requireAdmin = false,\n}: ProtectedRouteProps) {\n  const { user, profile, loading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    if (!loading) {\n      if (requireAuth && !user) {\n        setLocation(\"/giris\");\n      } else if (requireAdmin && profile?.role !== \"admin\") {\n        setLocation(\"/\");\n      }\n    }\n  }, [loading, user, profile, requireAuth, requireAdmin, setLocation]);\n\n  if (loading && requireAuth) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-12 w-12 animate-spin text-primary mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">Yükleniyor...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (requireAuth && !user) {\n    return null;\n  }\n\n  if (requireAdmin && profile?.role !== \"admin\") {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n","path":null,"size_bytes":1269,"size_tokens":null},"client/src/lib/api/announcements.ts":{"content":"import { supabase } from '../supabase';\n\nexport interface Announcement {\n  id: string;\n  title: string;\n  content: string;\n  author_id: string;\n  target_audience: 'all' | 'class_presidents';\n  created_at: string;\n  attachment_url?: string;\n  attachment_type?: string;\n  author?: {\n    first_name: string | null;\n    last_name: string | null;\n  };\n}\n\nexport async function getAnnouncements() {\n  const { data: { session } } = await supabase.auth.getSession();\n  \n  const res = await fetch('/api/announcements', {\n    headers: session ? {\n      'Authorization': `Bearer ${session.access_token}`,\n    } : {},\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Duyurular yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Announcement[]>;\n}\n\nexport async function getAnnouncement(id: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  \n  const res = await fetch(`/api/announcements/${id}`, {\n    headers: session ? {\n      'Authorization': `Bearer ${session.access_token}`,\n    } : {},\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Duyuru yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Announcement>;\n}\n\nexport async function createAnnouncement(title: string, content: string, targetAudience: 'all' | 'class_presidents' = 'all') {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/announcements', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ title, content, target_audience: targetAudience }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Duyuru oluşturulurken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function updateAnnouncement(id: string, title: string, content: string, targetAudience?: 'all' | 'class_presidents') {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const body: any = { title, content };\n  if (targetAudience) {\n    body.target_audience = targetAudience;\n  }\n\n  const res = await fetch(`/api/admin/announcements/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify(body),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Duyuru güncellenirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function deleteAnnouncement(id: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/announcements/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Duyuru silinirken hata oluştu');\n  }\n}\n\nexport async function getAdminAnnouncements() {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/announcements', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Duyurular yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Announcement[]>;\n}\n\n// Announcement Comments\nexport async function getAnnouncementComments(announcementId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/announcements/${announcementId}/comments`, {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to fetch comments');\n  }\n\n  return res.json();\n}\n\nexport async function addAnnouncementComment(announcementId: string, content: string, parentId?: string, isAnonymous?: boolean) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/announcements/${announcementId}/comments`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ content, parent_id: parentId, is_anonymous: isAnonymous || false }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to add comment');\n  }\n\n  return res.json();\n}\n\nexport async function editAnnouncementComment(commentId: string, content: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/announcement-comments/${commentId}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ content }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum düzenlenirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function deleteAnnouncementComment(commentId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/announcement-comments/${commentId}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum silinirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function getAdminAnnouncementComments() {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch('/api/admin/announcement-comments', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to fetch admin comments');\n  }\n\n  return res.json();\n}\n\nexport async function updateAnnouncementCommentStatus(id: string, status: 'approved' | 'rejected') {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/admin/announcement-comments/${id}/status`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ status }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to update comment status');\n  }\n\n  return res.json();\n}\n","path":null,"size_bytes":7565,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"replit.md":{"content":"# Okul Meclisi Portalı\n\n## Overview\n\nA Turkish-language school council portal built with React, Express, and Supabase that enables students to view announcements, participate in polls, share ideas, and browse class directories. The application features role-based access control (admin, teacher, student) with moderation workflows for user-generated content.\n\n**Purpose**: Provide a mobile-responsive platform for school communities to communicate, vote on initiatives, and share moderated ideas/blog posts in Turkish language.\n\n**Key Features**:\n- Announcements management\n- Poll creation and voting\n- Moderated idea/blog submission system\n- Class-based student directory\n- **Events & Applications system** (Katılım & Başvurular) - Dynamic form builder for event registrations\n- **Activity Logging** - User activity tracking with timestamps (votes, likes, comments)\n- Admin moderation panel\n- Authentication with email/password\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework**: React 18 with Vite as the build tool and development server\n\n**Routing**: Wouter for client-side routing with protected routes based on authentication state and user roles\n\n**State Management**: \n- React Query (TanStack Query) for server state management and caching\n- React Context for authentication state (AuthContext)\n- Local component state for UI interactions\n- No global state management library (Redux/Zustand) - relies on server components pattern\n\n**UI Component Library**: shadcn/ui (Radix UI primitives) with Tailwind CSS\n- Consistent design system using Material Design 3 principles\n- Dark-first theme with deep purple-blue aesthetic\n- Turkish typography support (Inter/IBM Plex Sans fonts)\n- Responsive mobile-first layout\n\n**Form Handling**: React Hook Form with Zod validation for type-safe form schemas\n\n**Styling Approach**:\n- Tailwind CSS utility-first framework\n- CSS variables for theming (defined in index.css)\n- Custom design tokens for spacing, colors, shadows\n- Responsive breakpoints (mobile-first)\n\n### Backend Architecture\n\n**Server Framework**: Express.js with TypeScript\n\n**API Design**: RESTful API pattern with `/api` prefix for all routes\n- Routes defined in `server/routes.ts`\n- Currently minimal implementation - storage interface prepared but routes not yet implemented\n- Designed for CRUD operations on announcements, polls, ideas, profiles\n\n**Session Management**: Supabase handles authentication and session management client-side\n\n**Data Access Layer**: \n- Storage interface pattern (`IStorage`) allowing for multiple implementations\n- In-memory storage (`MemStorage`) provided as default/fallback\n- Designed to be replaced with database-backed storage\n\n**Build Process**: \n- Client: Vite builds to `dist/public`\n- Server: esbuild bundles to `dist/index.js`\n- Separate development and production modes\n\n### Authentication & Authorization\n\n**Authentication Provider**: Supabase Auth\n- Email + password authentication\n- Session management with JWT tokens\n- Client-side auth state via AuthContext\n\n**Password Reset Flow**:\n- User requests password reset at `/sifre-sifirla` (forgot password page)\n- Supabase sends email with recovery link to `/auth/reset` route\n- ResetPassword page validates recovery token and shows password update form\n- User sets new password via Supabase `updateUser()` API\n- Environment variable `VITE_APP_URL` controls redirect domain:\n  - Development: `http://localhost:5000`\n  - Production: `https://meclis.onrender.com`\n\n**Supabase Configuration Required**:\n- Add to **Allowed Redirect URLs** in Supabase Dashboard → Authentication → URL Configuration:\n  - `http://localhost:5000/auth/reset` (development)\n  - `https://meclis.onrender.com/auth/reset` (production)\n\n**Authorization Pattern**:\n- Role-based access control (admin, teacher, student)\n- Protected routes component wrapping pages\n- Row Level Security (RLS) intended for Supabase/Postgres\n- Profile-based permissions stored in database\n\n**User Flow**:\n- Unauthenticated users redirected to `/giris` (login)\n- Admin users see additional navigation item and admin panel\n- Students can only view their own profile\n- Admins can view and moderate all content\n\n### Data Storage Solutions\n\n**Database**: PostgreSQL via Supabase\n- Connection through `@supabase/supabase-js` client library\n- Neon serverless PostgreSQL as alternative option (`@neondatabase/serverless`)\n\n**File Storage**: Supabase Storage\n- Bucket: `ideas-media` for idea/announcement media uploads\n- Public access for viewing, authenticated access for uploading\n- File types: Images and videos (max 10MB)\n- Upload endpoint: `/api/upload` using multer with memory storage\n- Files stored with unique names: `{userId}-{timestamp}.{ext}`\n\n**ORM**: Drizzle ORM\n- Schema defined in `shared/schema.ts`\n- Migration files in `./migrations` directory\n- Type-safe database operations\n- Currently minimal schema (users table only) - designed to be extended\n\n**Expected Schema Entities** (based on code structure):\n- Users (authentication)\n- Profiles (user metadata, roles, class info)\n- Action Logs (user activity tracking with timestamps)\n\n### Activity Logging System\n\n**Purpose**: Track all user actions for transparency and admin oversight\n\n**Logged Actions** (stored in `action_logs` table):\n- `VOTE_CAST` / `VOTE_CHANGED` - Poll voting\n- `LIKE_ADDED` / `LIKE_REMOVED` - Idea likes\n- `COMMENT_CREATED` / `ANNOUNCEMENT_COMMENT_CREATED` - Comments on ideas/announcements\n- `PROFILE_UPDATED` - Profile changes\n- `LOGIN` - User logins\n\n**API Endpoints**:\n- `GET /api/activity-log` - Current user's activity history (last 50 actions)\n- `GET /api/admin/activity-logs` - Admin view of all user activities\n- `GET /api/admin/activity-stats` - Activity statistics for dashboard\n\n**Frontend**:\n- `/aktiviteler` - User's activity log page (accessible from profile dropdown)\n- Activity history displayed with action icons, timestamps, and descriptions\n- Announcements\n- Polls & Poll Options & Poll Votes\n- Ideas/Blogs & Comments (with moderation status)\n- Classes (student groupings)\n\n**Moderation Workflow**:\n- Ideas and comments require admin approval before publication\n- Status tracking: pending, approved, rejected\n- Admins can approve/reject from dedicated panel\n\n### External Dependencies\n\n**Third-Party Services**:\n- **Supabase**: Authentication, PostgreSQL database, Row Level Security\n  - Required environment variables: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`\n  - Handles user sessions and JWT tokens\n  - RLS policies enforce data access rules\n  \n**External Libraries**:\n- **Radix UI**: Unstyled accessible component primitives (@radix-ui/*)\n- **TanStack Query**: Server state management and caching\n- **React Hook Form**: Form state and validation\n- **Zod**: Runtime type validation for forms and API\n- **dayjs**: Date formatting and manipulation (Turkish locale)\n- **Wouter**: Lightweight client-side routing\n- **Lucide React**: Icon library\n\n**Development Tools**:\n- **Vite**: Fast development server with HMR\n- **TypeScript**: Type safety across client and server\n- **Tailwind CSS**: Utility-first styling\n- **Drizzle Kit**: Database migrations and schema management\n- **PostCSS + Autoprefixer**: CSS processing\n\n**Deployment Environments**:\n\n1. **Development (Replit)**:\n   - Entry point: `server/index.ts`\n   - Node.js 20+ runtime\n   - Environment variable configuration via Replit Secrets\n   - Single command: `npm run dev`\n   - Always-on server on port 5000\n   - Instagram auto-sync enabled\n\n2. **Production - Render**:\n   - Entry point: `server/index.ts` → `dist/index.js`\n   - Always-on Node.js server\n   - Build: `npm run build`\n   - Start: `npm start`\n   - Persistent connections and background jobs supported\n   - Instagram auto-sync active\n\n3. **Production - Vercel (Alternative)**:\n   - Entry point: `api/index.ts`\n   - Serverless functions architecture\n   - Build: `npm run build` → `dist/public/`\n   - Frontend: CDN static hosting (very fast)\n   - API: Serverless functions under `/api`\n   - Cold start latency (~2-3s first request)\n   - Instagram auto-sync limited (runs on cold starts)\n   - See `VERCEL_DEPLOYMENT_GUIDE.md` for details\n\n**Dual Deployment Strategy**:\n- **Render**: Used for backend with background jobs (Instagram sync)\n- **Vercel**: Can be used for fast global frontend hosting via CDN\n- Both can access same Supabase database\n- Files organized to support both platforms without conflicts:\n  - `server/` for Render (traditional Node.js)\n  - `api/` for Vercel (serverless)\n  - `client/` for both (Vite build)\n\n**API Integrations**:\n- Supabase REST API for authentication operations\n- Supabase PostgreSQL connection for data operations\n- Session-based API authentication (credentials included in fetch)\n- Instagram Graph API for Blüten content synchronization","path":null,"size_bytes":8860,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation, Link } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport mayaLogo from \"@assets/maya-okullari-logo-simge_1763489344712.webp\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const { signIn, user, loading: authLoading } = useAuth();\n  const { toast } = useToast();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (!authLoading && user) {\n      setLocation(\"/\");\n    }\n  }, [user, authLoading, setLocation]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Geçerli bir e-posta adresi giriniz\",\n      });\n      return;\n    }\n    \n    setLoading(true);\n    \n    try {\n      await signIn(email, password);\n      \n      toast({\n        title: \"Başarılı\",\n        description: \"Giriş yapıldı, yönlendiriliyorsunuz...\",\n      });\n      setLocation(\"/\");\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Giriş yapılırken bir hata oluştu\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <img \n              src={mayaLogo} \n              alt=\"Maya Okulları\" \n              className=\"h-12 w-12 object-contain\"\n            />\n          </div>\n          <CardTitle className=\"text-2xl text-center\">Maya Meclisi</CardTitle>\n          <CardDescription className=\"text-center\">\n            Hesabınıza giriş yapın\n          </CardDescription>\n        </CardHeader>\n        <form onSubmit={handleSubmit} noValidate>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">E-posta</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"ornek@mayaokullari.k12.tr\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                data-testid=\"input-email\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Şifre</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                required\n                data-testid=\"input-password\"\n              />\n            </div>\n          </CardContent>\n          <CardFooter className=\"flex flex-col gap-3\">\n            <Button type=\"submit\" className=\"w-full\" disabled={loading} data-testid=\"button-submit-login\">\n              {loading ? \"Giriş yapılıyor...\" : \"Giriş Yap\"}\n            </Button>\n            <Link href=\"/sifre-sifirla\">\n              <Button variant=\"ghost\" className=\"w-full text-xs\" data-testid=\"button-forgot-password\">\n                Şifremi Unuttum\n              </Button>\n            </Link>\n          </CardFooter>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":3846,"size_tokens":null},"client/src/components/admin/UserForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage, FormDescription } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { createUserSchema, type CreateUser } from \"@shared/schema\";\nimport { supabase } from \"@/lib/supabase\";\nimport { UserPlus } from \"lucide-react\";\n\nexport default function UserForm() {\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<CreateUser>({\n    resolver: zodResolver(createUserSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n      first_name: \"\",\n      last_name: \"\",\n      role: \"student\",\n      class_name: \"\",\n      student_no: \"\",\n      is_class_president: false,\n    },\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: CreateUser) => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) throw new Error(\"Not authenticated\");\n\n      const res = await fetch('/api/admin/users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session.access_token}`,\n        },\n        credentials: 'include',\n        body: JSON.stringify(data),\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || 'Failed to create user');\n      }\n\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/profiles\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı oluşturuldu\",\n      });\n      setOpen(false);\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Kullanıcı oluşturulamadı\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-add-user\">\n          <UserPlus className=\"h-4 w-4 mr-2\" />\n          Yeni Kullanıcı Ekle\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Yeni Kullanıcı Oluştur</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"email\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Email</FormLabel>\n                  <FormControl>\n                    <Input {...field} type=\"email\" data-testid=\"input-user-email\" placeholder=\"ornek@maya.com\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"password\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Şifre</FormLabel>\n                  <FormControl>\n                    <Input {...field} type=\"password\" data-testid=\"input-user-password\" placeholder=\"En az 6 karakter\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"first_name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Ad</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-user-first-name\" placeholder=\"Ad\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"last_name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Soyad</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-user-last-name\" placeholder=\"Soyad\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            <FormField\n              control={form.control}\n              name=\"role\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Rol</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger data-testid=\"select-user-role\">\n                        <SelectValue placeholder=\"Rol seçin\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"student\" data-testid=\"option-student\">Öğrenci</SelectItem>\n                      <SelectItem value=\"teacher\" data-testid=\"option-teacher\">Öğretmen</SelectItem>\n                      <SelectItem value=\"admin\" data-testid=\"option-admin\">Admin</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"class_name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Sınıf (Opsiyonel)</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-user-class\" placeholder=\"9-A\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"student_no\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Numara (Opsiyonel)</FormLabel>\n                    <FormControl>\n                      <Input {...field} data-testid=\"input-user-student-no\" placeholder=\"1234\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n            <FormField\n              control={form.control}\n              name=\"is_class_president\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4\">\n                  <FormControl>\n                    <Checkbox\n                      checked={field.value}\n                      onCheckedChange={field.onChange}\n                      data-testid=\"checkbox-user-class-president\"\n                    />\n                  </FormControl>\n                  <div className=\"space-y-1 leading-none\">\n                    <FormLabel className=\"cursor-pointer\">\n                      Sınıf Başkanı\n                    </FormLabel>\n                    <FormDescription>\n                      Bu kullanıcı sınıf başkanı olarak atansın mı?\n                    </FormDescription>\n                  </div>\n                </FormItem>\n              )}\n            />\n            <div className=\"flex gap-2 justify-end\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                İptal\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                {mutation.isPending ? \"Oluşturuluyor...\" : \"Oluştur\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":8535,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/examples/Header.tsx":{"content":"import Header from \"../Header\";\n\nexport default function HeaderExample() {\n  return (\n    <Header \n      isAuthenticated={true}\n      userRole=\"admin\"\n      userName=\"Ahmet Yılmaz\"\n      onLogout={() => console.log(\"Çıkış yapıldı\")}\n    />\n  );\n}\n","path":null,"size_bytes":254,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"server/services/instagram.ts":{"content":"import { createClient } from '@supabase/supabase-js';\n\n// Backend-specific environment variables (NOT VITE_ prefixed)\nconst supabaseUrl = process.env.SUPABASE_URL || process.env.VITE_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  console.warn('⚠️ Supabase credentials not configured. Blüten auto-sync will be disabled.');\n}\n\nconst supabase = supabaseUrl && supabaseServiceKey \n  ? createClient(supabaseUrl, supabaseServiceKey)\n  : null;\n\ninterface InstagramPost {\n  id: string;\n  caption?: string;\n  media_type: 'IMAGE' | 'VIDEO' | 'CAROUSEL_ALBUM';\n  media_url?: string;\n  thumbnail_url?: string;\n  permalink: string;\n  timestamp: string;\n  username?: string;\n}\n\nexport class InstagramService {\n  private accessToken: string | undefined;\n  private businessAccountId: string | undefined;\n  private syncInterval: NodeJS.Timeout | null = null;\n\n  constructor() {\n    this.accessToken = process.env.INSTAGRAM_ACCESS_TOKEN;\n    this.businessAccountId = process.env.INSTAGRAM_BUSINESS_ACCOUNT_ID;\n  }\n\n  /**\n   * Instagram Graph API'den son postları çek\n   */\n  async fetchRecentPosts(limit: number = 10): Promise<InstagramPost[]> {\n    if (!this.accessToken || !this.businessAccountId) {\n      console.log('Instagram credentials not configured. Skipping auto-fetch.');\n      return [];\n    }\n\n    try {\n      const url = `https://graph.facebook.com/v20.0/${this.businessAccountId}/media`;\n      const params = new URLSearchParams({\n        fields: 'id,caption,media_type,media_url,thumbnail_url,permalink,timestamp,username',\n        limit: limit.toString(),\n        access_token: this.accessToken,\n      });\n\n      const response = await fetch(`${url}?${params}`);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(`Instagram API error: ${JSON.stringify(error)}`);\n      }\n\n      const data = await response.json();\n      return data.data || [];\n    } catch (error) {\n      console.error('Error fetching Instagram posts:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Yeni postları Supabase'e kaydet\n   */\n  async syncNewPosts(): Promise<number> {\n    if (!supabase) {\n      console.warn('⚠️ Supabase not configured, skipping sync');\n      return 0;\n    }\n\n    try {\n      // Sync durumunu kontrol et\n      const { data: syncState } = await supabase\n        .from('instagram_sync_state')\n        .select('*')\n        .single();\n\n      if (!syncState?.sync_enabled) {\n        console.log('Instagram auto-sync is disabled');\n        return 0;\n      }\n\n      // Instagram'dan son postları çek\n      const posts = await this.fetchRecentPosts(25);\n      if (posts.length === 0) {\n        console.log('No Instagram posts fetched');\n        return 0;\n      }\n\n      let newPostsCount = 0;\n      const lastSyncedId = syncState.last_synced_post_id;\n\n      for (const post of posts) {\n        // Son senkronize edilen post'a ulaşırsak dur\n        if (post.id === lastSyncedId) break;\n\n        // Veritabanında zaten var mı kontrol et\n        const { data: existing } = await supabase\n          .from('bluten_posts')\n          .select('id')\n          .eq('instagram_post_id', post.id)\n          .single();\n\n        if (existing) continue;\n\n        // Yeni postu ekle\n        const { error } = await supabase\n          .from('bluten_posts')\n          .insert({\n            instagram_post_id: post.id,\n            instagram_url: post.permalink,\n            media_url: post.media_url || post.thumbnail_url,\n            media_type: post.media_type,\n            caption: post.caption,\n            username: post.username,\n            posted_at: new Date(post.timestamp).toISOString(),\n            is_visible: true,\n          });\n\n        if (!error) {\n          newPostsCount++;\n        } else {\n          console.error('Error inserting Instagram post:', error);\n        }\n      }\n\n      // ALWAYS update sync state with latest post ID, even if no new posts inserted\n      // This prevents re-scanning the same batch on every sync\n      if (posts.length > 0) {\n        await supabase\n          .from('instagram_sync_state')\n          .update({\n            last_synced_post_id: posts[0].id,\n            last_sync_timestamp: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n          })\n          .eq('id', syncState.id);\n\n        if (newPostsCount > 0) {\n          console.log(`✅ ${newPostsCount} new Instagram posts synced`);\n        } else {\n          console.log(`✓ Instagram sync completed, no new posts`);\n        }\n      }\n\n      return newPostsCount;\n    } catch (error) {\n      console.error('Error in syncNewPosts:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Manuel olarak Instagram post URL'sinden bilgi çek (oEmbed API)\n   */\n  async fetchPostByUrl(instagramUrl: string) {\n    try {\n      const response = await fetch(\n        `https://graph.facebook.com/v20.0/instagram_oembed?url=${encodeURIComponent(instagramUrl)}&access_token=${this.accessToken}`\n      );\n\n      if (!response.ok) {\n        throw new Error('Invalid Instagram URL or post not accessible');\n      }\n\n      const data = await response.json();\n      return {\n        title: data.title || '',\n        author_name: data.author_name || '',\n        thumbnail_url: data.thumbnail_url,\n        html: data.html,\n      };\n    } catch (error) {\n      console.error('Error fetching Instagram post by URL:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Otomatik senkronizasyonu başlat (15 dakikada bir)\n   */\n  startAutoSync() {\n    if (this.syncInterval) {\n      console.log('Auto-sync already running');\n      return;\n    }\n\n    console.log('🔄 Starting Instagram auto-sync (every 15 minutes)');\n    \n    // İlk senkronizasyonu hemen yap\n    this.syncNewPosts();\n\n    // Her 15 dakikada bir çalıştır\n    this.syncInterval = setInterval(() => {\n      this.syncNewPosts();\n    }, 15 * 60 * 1000); // 15 dakika\n  }\n\n  /**\n   * Otomatik senkronizasyonu durdur\n   */\n  stopAutoSync() {\n    if (this.syncInterval) {\n      clearInterval(this.syncInterval);\n      this.syncInterval = null;\n      console.log('❌ Instagram auto-sync stopped');\n    }\n  }\n\n  /**\n   * Servis durumunu kontrol et\n   */\n  getStatus() {\n    return {\n      configured: !!(this.accessToken && this.businessAccountId),\n      autoSyncRunning: !!this.syncInterval,\n      credentials: {\n        hasToken: !!this.accessToken,\n        hasAccountId: !!this.businessAccountId,\n      }\n    };\n  }\n}\n\n// Singleton instance\nexport const instagramService = new InstagramService();\n","path":null,"size_bytes":6586,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"server/storage.ts":{"content":"import { supabaseAdmin } from './services/supabase';\nimport type { \n  InsertAnnouncement, \n  InsertPoll, \n  InsertBlutenPost, \n  CreateUser,\n  Announcement,\n  Poll,\n  PollOption,\n  BlutenPost,\n  Profile\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // Announcements\n  createAnnouncement(data: InsertAnnouncement): Promise<Announcement>;\n  updateAnnouncement(id: string, data: Partial<InsertAnnouncement>): Promise<Announcement>;\n  deleteAnnouncement(id: string): Promise<void>;\n  \n  // Polls\n  createPollWithOptions(data: InsertPoll): Promise<Poll>;\n  deletePoll(id: string): Promise<void>;\n  togglePollStatus(id: string, isOpen: boolean): Promise<Poll>;\n  \n  // Blüten\n  createManualBlutenPost(data: InsertBlutenPost): Promise<BlutenPost>;\n  toggleBlutenVisibility(id: string, visible: boolean): Promise<void>;\n  \n  // Users (Manual creation & management)\n  createUserWithProfile(data: CreateUser): Promise<Profile>;\n  updateProfile(profileId: string, data: Partial<Profile>): Promise<Profile>;\n  deleteUser(userId: string): Promise<void>;\n  \n  // Moderation\n  updateIdeaStatus(ideaId: string, status: 'approved' | 'rejected', reviewerId: string): Promise<void>;\n  updateCommentStatus(commentId: string, status: 'approved' | 'rejected', reviewerId: string): Promise<void>;\n}\n\nexport class SupabaseStorage implements IStorage {\n  async createAnnouncement(data: InsertAnnouncement): Promise<Announcement> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { data: announcement, error } = await supabaseAdmin\n      .from('announcements')\n      .insert(data)\n      .select()\n      .single();\n    \n    if (error) throw error;\n    return announcement;\n  }\n\n  async updateAnnouncement(id: string, data: Partial<InsertAnnouncement>): Promise<Announcement> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { data: announcement, error } = await supabaseAdmin\n      .from('announcements')\n      .update(data)\n      .eq('id', id)\n      .select()\n      .single();\n    \n    if (error) throw error;\n    return announcement;\n  }\n\n  async deleteAnnouncement(id: string): Promise<void> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { error } = await supabaseAdmin\n      .from('announcements')\n      .delete()\n      .eq('id', id);\n    \n    if (error) throw error;\n  }\n\n  async createPollWithOptions(data: InsertPoll): Promise<Poll> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    // Create poll\n    const { data: poll, error: pollError } = await supabaseAdmin\n      .from('polls')\n      .insert({\n        question: data.question,\n        created_by: data.created_by,\n        is_open: true,\n      })\n      .select()\n      .single();\n    \n    if (pollError) throw pollError;\n    \n    // Create options\n    const options = data.options.map(text => ({\n      poll_id: poll.id,\n      option_text: text,\n      vote_count: 0,\n    }));\n    \n    const { error: optionsError } = await supabaseAdmin\n      .from('poll_options')\n      .insert(options);\n    \n    if (optionsError) throw optionsError;\n    \n    return poll;\n  }\n\n  async deletePoll(id: string): Promise<void> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { error } = await supabaseAdmin\n      .from('polls')\n      .delete()\n      .eq('id', id);\n    \n    if (error) throw error;\n  }\n\n  async togglePollStatus(id: string, isOpen: boolean): Promise<Poll> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { data: poll, error } = await supabaseAdmin\n      .from('polls')\n      .update({ is_open: isOpen })\n      .eq('id', id)\n      .select()\n      .single();\n    \n    if (error) throw error;\n    return poll;\n  }\n\n  async createManualBlutenPost(data: InsertBlutenPost): Promise<BlutenPost> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { data: post, error } = await supabaseAdmin\n      .from('bluten_posts')\n      .insert(data)\n      .select()\n      .single();\n    \n    if (error) throw error;\n    return post;\n  }\n\n  async toggleBlutenVisibility(id: string, visible: boolean): Promise<void> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { error } = await supabaseAdmin\n      .from('bluten_posts')\n      .update({ is_visible: visible })\n      .eq('id', id);\n    \n    if (error) throw error;\n  }\n\n  async createUserWithProfile(data: CreateUser): Promise<Profile> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    // Create auth user\n    const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.createUser({\n      email: data.email,\n      password: data.password,\n      email_confirm: true, // Auto-confirm\n    });\n    \n    if (authError) throw authError;\n    \n    // Wait a moment for trigger to create profile\n    await new Promise(resolve => setTimeout(resolve, 500));\n    \n    // Try to find existing profile (created by trigger)\n    const { data: existingProfile } = await supabaseAdmin\n      .from('profiles')\n      .select('id')\n      .eq('user_id', authUser.user.id)\n      .single();\n    \n    if (existingProfile) {\n      // Update existing profile\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .update({\n          first_name: data.first_name,\n          last_name: data.last_name,\n          role: data.role,\n          class_name: data.class_name,\n          student_no: data.student_no,\n          is_class_president: data.is_class_president,\n        })\n        .eq('id', existingProfile.id)\n        .select()\n        .single();\n      \n      if (profileError) throw profileError;\n      return profile;\n    } else {\n      // Insert new profile if trigger didn't create one\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .insert({\n          user_id: authUser.user.id,\n          first_name: data.first_name,\n          last_name: data.last_name,\n          role: data.role,\n          class_name: data.class_name,\n          student_no: data.student_no,\n          is_class_president: data.is_class_president,\n        })\n        .select()\n        .single();\n      \n      if (profileError) throw profileError;\n      return profile;\n    }\n  }\n\n  async updateProfile(profileId: string, data: Partial<Profile>): Promise<Profile> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    const { data: profile, error } = await supabaseAdmin\n      .from('profiles')\n      .update(data)\n      .eq('id', profileId)\n      .select()\n      .single();\n    \n    if (error) throw error;\n    return profile;\n  }\n\n  async deleteUser(userId: string): Promise<void> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    // Delete from auth (this cascades to profiles due to FK constraint)\n    const { error } = await supabaseAdmin.auth.admin.deleteUser(userId);\n    \n    if (error) throw error;\n  }\n\n  async updateIdeaStatus(ideaId: string, status: 'approved' | 'rejected', reviewerUserId: string): Promise<void> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    // Get profile ID from user ID\n    const { data: profile } = await supabaseAdmin\n      .from('profiles')\n      .select('id')\n      .eq('user_id', reviewerUserId)\n      .single();\n    \n    const { error } = await supabaseAdmin\n      .from('ideas')\n      .update({\n        status,\n        reviewed_by: profile?.id,\n        reviewed_at: new Date().toISOString(),\n      })\n      .eq('id', ideaId);\n    \n    if (error) throw error;\n  }\n\n  async updateCommentStatus(commentId: string, status: 'approved' | 'rejected', reviewerUserId: string): Promise<void> {\n    if (!supabaseAdmin) throw new Error('Supabase not configured');\n    \n    // Get profile ID from user ID\n    const { data: profile } = await supabaseAdmin\n      .from('profiles')\n      .select('id')\n      .eq('user_id', reviewerUserId)\n      .single();\n    \n    const { error } = await supabaseAdmin\n      .from('comments')\n      .update({\n        status,\n        reviewed_by: profile?.id,\n      })\n      .eq('id', commentId);\n    \n    if (error) throw error;\n  }\n}\n\nexport const storage = new SupabaseStorage();\n","path":null,"size_bytes":8286,"size_tokens":null},"client/src/components/examples/Ideas.tsx":{"content":"import Ideas from \"../../pages/Ideas\";\n\nexport default function IdeasExample() {\n  return <Ideas />;\n}\n","path":null,"size_bytes":103,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/AnnouncementCard.tsx":{"content":"import { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Bell, Calendar, User, FileText, Download } from \"lucide-react\";\n\ninterface AnnouncementCardProps {\n  title: string;\n  content: string;\n  authorName: string;\n  createdAt: string;\n  attachmentUrl?: string;\n  attachmentType?: string;\n  onReadMore?: () => void;\n}\n\nexport default function AnnouncementCard({\n  title,\n  content,\n  authorName,\n  createdAt,\n  attachmentUrl,\n  attachmentType,\n  onReadMore,\n}: AnnouncementCardProps) {\n  const truncatedContent = content.length > 200 \n    ? content.substring(0, 200) + \"...\" \n    : content;\n  \n  const getAttachmentLabel = () => {\n    if (attachmentType === 'pdf') return 'PDF Dosyası';\n    if (attachmentType === 'document') return 'Doküman';\n    if (attachmentType === 'image') return 'Görsel';\n    if (attachmentType === 'video') return 'Video';\n    return 'Dosya';\n  };\n\n  return (\n    <Card \n      className=\"card-hover-lift cursor-pointer group\" \n      data-testid=\"card-announcement\"\n      onClick={onReadMore}\n    >\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10 group-hover:bg-primary/20 transition-colors\">\n            <Bell className=\"h-5 w-5 text-primary icon-hover-bounce\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-lg leading-tight mb-1\">{title}</h3>\n            <div className=\"flex flex-wrap items-center gap-3 text-xs text-muted-foreground\">\n              <span className=\"flex items-center gap-1\">\n                <User className=\"h-3 w-3\" />\n                {authorName}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Calendar className=\"h-3 w-3\" />\n                {createdAt}\n              </span>\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"pb-3\">\n        <p className=\"text-sm text-muted-foreground leading-relaxed whitespace-pre-wrap\">{truncatedContent}</p>\n        {attachmentUrl && (attachmentType === 'pdf' || attachmentType === 'document') && (\n          <a \n            href={attachmentUrl} \n            download \n            target=\"_blank\" \n            rel=\"noopener noreferrer\"\n            onClick={(e) => e.stopPropagation()}\n            className=\"inline-flex items-center gap-2 mt-3 text-sm text-primary hover:underline\"\n            data-testid=\"link-download-attachment\"\n          >\n            <FileText className=\"h-4 w-4\" />\n            {getAttachmentLabel()}\n            <Download className=\"h-3 w-3\" />\n          </a>\n        )}\n      </CardContent>\n      {content.length > 200 && (\n        <CardFooter>\n          <Button \n            variant=\"ghost\" \n            size=\"sm\" \n            data-testid=\"button-read-more\"\n          >\n            Detayları Gör\n          </Button>\n        </CardFooter>\n      )}\n    </Card>\n  );\n}\n","path":null,"size_bytes":3058,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/PollCard.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { BarChart3, Users, CheckCircle } from \"lucide-react\";\n\ninterface PollOption {\n  id: string;\n  text: string;\n  votes: number;\n}\n\ninterface PollCardProps {\n  question: string;\n  options: PollOption[];\n  totalVotes: number;\n  hasVoted?: boolean;\n  userVote?: string;\n  isOpen?: boolean;\n  resultsPublished?: boolean;\n  onVote?: (optionId: string) => void;\n}\n\nexport default function PollCard({\n  question,\n  options,\n  totalVotes,\n  hasVoted = false,\n  userVote,\n  isOpen = true,\n  resultsPublished = false,\n  onVote,\n}: PollCardProps) {\n  const [selectedOption, setSelectedOption] = useState<string>(userVote || \"\");\n  const [showChangeDialog, setShowChangeDialog] = useState(false);\n\n  const handleVote = () => {\n    if (selectedOption && onVote) {\n      // If user has already voted, show confirmation dialog\n      if (hasVoted && selectedOption !== userVote) {\n        setShowChangeDialog(true);\n      } else {\n        onVote(selectedOption);\n      }\n    }\n  };\n\n  const confirmVoteChange = () => {\n    if (selectedOption && onVote) {\n      setShowChangeDialog(false);\n      onVote(selectedOption);\n    }\n  };\n\n  return (\n    <Card className=\"card-hover-lift group\" data-testid=\"card-poll\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10 group-hover:bg-primary/20 transition-colors\">\n            <BarChart3 className=\"h-5 w-5 text-primary group-hover:scale-110 transition-transform\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-medium text-lg leading-tight\">{question}</h3>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {!hasVoted && isOpen && !resultsPublished ? (\n          <>\n            <RadioGroup value={selectedOption} onValueChange={setSelectedOption}>\n              {options.map((option) => (\n                <div key={option.id} className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value={option.id} id={option.id} data-testid={`radio-option-${option.id}`} />\n                  <Label htmlFor={option.id} className=\"flex-1 cursor-pointer\">\n                    {option.text}\n                  </Label>\n                </div>\n              ))}\n            </RadioGroup>\n            <Button\n              onClick={handleVote}\n              disabled={!selectedOption}\n              className=\"w-full\"\n              data-testid=\"button-vote\"\n            >\n              Oy Ver\n            </Button>\n          </>\n        ) : hasVoted && !resultsPublished ? (\n          <div className=\"flex flex-col items-center justify-center py-8 space-y-4\">\n            <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30\">\n              <CheckCircle className=\"h-8 w-8 text-green-600 dark:text-green-400\" />\n            </div>\n            <div className=\"text-center space-y-1\">\n              <p className=\"font-medium text-lg\">Oyunuz Kaydedildi!</p>\n              <p className=\"text-sm text-muted-foreground\">\n                Sonuçlar yönetici tarafından yayınlandığında burada görünecek\n              </p>\n            </div>\n            {isOpen && (\n              <>\n                <div className=\"w-full border-t pt-4\">\n                  <p className=\"text-sm text-muted-foreground text-center mb-3\">\n                    Oyunuzu değiştirmek ister misiniz?\n                  </p>\n                  <RadioGroup value={selectedOption} onValueChange={setSelectedOption}>\n                    {options.map((option) => (\n                      <div key={option.id} className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value={option.id} id={`change-${option.id}`} data-testid={`radio-change-${option.id}`} />\n                        <Label htmlFor={`change-${option.id}`} className=\"flex-1 cursor-pointer\">\n                          {option.text}\n                        </Label>\n                      </div>\n                    ))}\n                  </RadioGroup>\n                  <Button\n                    onClick={handleVote}\n                    disabled={!selectedOption || selectedOption === userVote}\n                    variant=\"outline\"\n                    className=\"w-full mt-3\"\n                    data-testid=\"button-change-vote\"\n                  >\n                    Oyumu Değiştir\n                  </Button>\n                </div>\n              </>\n            )}\n            {!isOpen && (\n              <p className=\"text-sm text-yellow-500 mt-4\">\n                Bu oylama kapatılmıştır. Sonuçlar henüz yayınlanmadı.\n              </p>\n            )}\n          </div>\n        ) : resultsPublished ? (\n          <>\n            <div className=\"space-y-3\">\n              {options.map((option) => {\n                const isUserVote = userVote === option.id;\n                return (\n                  <div key={option.id} className=\"space-y-1\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className={isUserVote ? \"font-medium\" : \"\"}>\n                        {option.text}\n                        {isUserVote && \" (Sizin oyunuz)\"}\n                      </span>\n                      <span className=\"text-muted-foreground font-medium\">\n                        {option.votes} oy\n                      </span>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n            <div className=\"flex items-center gap-1 text-xs text-muted-foreground pt-2 border-t\">\n              <Users className=\"h-3 w-3\" />\n              <span>Toplam {totalVotes} kişi oy verdi</span>\n            </div>\n            <p className=\"text-sm text-green-600 dark:text-green-400 font-medium\">\n              ✓ Sonuçlar yayınlandı\n            </p>\n          </>\n        ) : null}\n\n        {isOpen && !resultsPublished && (\n          <AlertDialog open={showChangeDialog} onOpenChange={setShowChangeDialog}>\n            <AlertDialogContent>\n              <AlertDialogHeader>\n                <AlertDialogTitle>Oyunuzu değiştirmek istediğinize emin misiniz?</AlertDialogTitle>\n                <AlertDialogDescription>\n                  Şu an <strong>{options.find(o => o.id === userVote)?.text}</strong> seçeneğine oy vermişsiniz.\n                  Bunu <strong>{options.find(o => o.id === selectedOption)?.text}</strong> olarak değiştirmek üzeresiniz.\n                </AlertDialogDescription>\n              </AlertDialogHeader>\n              <AlertDialogFooter>\n                <AlertDialogCancel>İptal</AlertDialogCancel>\n                <AlertDialogAction onClick={confirmVoteChange}>\n                  Evet, Değiştir\n                </AlertDialogAction>\n              </AlertDialogFooter>\n            </AlertDialogContent>\n          </AlertDialog>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":7474,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Okul Meclisi Portalı (School Council Portal)\n\n## Design Approach\n**System**: Material Design 3 principles adapted for educational dashboard context with dark theme aesthetic shown in the mockup. This utility-focused application prioritizes information clarity, quick scanning, and efficient task completion while maintaining visual appeal for student engagement.\n\n## Core Design Principles\n1. **Information hierarchy**: Clear visual distinction between primary content and supporting elements\n2. **Dark-first design**: Deep purple-blue dark theme as primary interface with high contrast elements\n3. **Approachability**: Soften the administrative nature with rounded corners and gentle shadows\n4. **Turkish typography**: Proper support for Turkish characters (İ, ı, Ş, ş, Ğ, ğ, Ü, ü, Ö, ö, Ç, ç)\n\n## Typography\n**Font Family**: \n- Primary: Inter or IBM Plex Sans via Google Fonts (excellent Turkish character support)\n- Fallback: system-ui, sans-serif\n\n**Scale & Hierarchy**:\n- Page titles: text-3xl font-bold (mobile: text-2xl)\n- Section headers: text-xl font-semibold\n- Card titles: text-lg font-medium\n- Body text: text-base font-normal\n- Supporting text: text-sm\n- Metadata/timestamps: text-xs text-muted-foreground\n\n## Layout System\n**Spacing Primitives**: Use Tailwind units of 2, 4, 6, 8, 12, and 16\n- Component padding: p-4 to p-6 (cards, dialogs)\n- Section spacing: space-y-6 to space-y-8\n- Grid gaps: gap-4 to gap-6\n- Container margins: mx-4 on mobile, mx-auto max-w-7xl px-6 on desktop\n\n**Grid Structure**:\n- Dashboard: 3-column grid on desktop (lg:grid-cols-3), 1-column on mobile\n- Class directory: 2-column layout (sidebar filter + main list) on desktop\n- Admin tabs: Full-width single column with nested grids per section\n- Lists/Tables: Single column stack on mobile, multi-column on tablet+\n\n## Component Library\n\n### Navigation\n- **Top bar**: Fixed header with logo left, main nav center, profile/logout right\n- **Main navigation**: Horizontal tabs on desktop, hamburger menu on mobile\n- Nav items: \"Duyurular\", \"Oylamalar\", \"Fikirler\", \"Sınıflar\", \"Yönetici\" (admin only)\n- Active state: Bottom border accent with subtle background highlight\n\n### Cards\n- Rounded corners: rounded-lg to rounded-xl\n- Shadow: shadow-md with subtle glow effect\n- Padding: p-6\n- Header + content + footer structure\n- Hover state: Slight lift (transform translate-y-[-2px]) with increased shadow\n\n### Announcements\n- Card-based display with announcement icon\n- Title (text-lg font-semibold) + timestamp (text-xs)\n- Content preview: 3-line clamp with \"Devamını Oku\" link\n- Full view: Modal/dialog or dedicated page\n\n### Poll Cards\n- Question prominently displayed (text-lg font-medium)\n- Option list with radio buttons or progress bars (after voting)\n- Vote percentage displayed with animated progress bars\n- \"Oy Ver\" button (primary) or \"Oy Verildi\" (disabled state)\n- Vote count: \"X kişi oy verdi\" below options\n\n### Ideas/Blog System\n- List view: Title, author name, approval status badge, excerpt (2-line clamp), timestamp\n- Status badges: Pending (yellow), Approved (green), Rejected (red) with dot indicators\n- Detail view: Full content with formatted text, author profile link, comment section below\n- Comments: Nested design with avatar, name, timestamp, moderation status indicator\n\n### Moderation Queue (Admin)\n- Table layout with columns: Content preview, Author, Submitted date, Status, Actions\n- Quick action buttons: \"Onayla\" (green), \"Reddet\" (red), \"Görüntüle\" (neutral)\n- Bulk selection checkboxes for batch operations\n\n### Class Directory\n- Left sidebar: Select/dropdown filter for class names (9-A, 9-B, 10-A, etc.)\n- Main area: Table with columns - Ad Soyad (Name), Numara (Student No), Sınıf (Class)\n- Search bar above table: \"Öğrenci ara...\" placeholder\n- Responsive: Sidebar collapses to top filter on mobile, table converts to card stack\n\n### Forms\n- Label above input fields (text-sm font-medium)\n- Input fields: rounded-md border with focus ring\n- Textarea: Minimum 4 rows for content fields\n- Submit buttons: Full width on mobile, auto width on desktop, positioned bottom-right\n- Validation: Inline error messages below fields in red text\n\n### Empty States\n- Centered vertically in container\n- Icon (from lucide-react, size 48-64px)\n- Heading: \"Henüz [content type] yok\"\n- Subtext: Brief explanation\n- Action button if applicable: \"Yeni Ekle\" or \"Oluştur\"\n\n### Modals/Dialogs\n- Max width: max-w-2xl for forms, max-w-4xl for content views\n- Backdrop: Semi-transparent dark overlay\n- Close button: Top-right X icon\n- Action buttons: Bottom-right, primary action emphasized\n\n## Admin Dashboard Tabs\n- Horizontal tab navigation: \"Kullanıcılar\", \"Duyurular\", \"Oylamalar\", \"Moderasyon\", \"Sınıflar\"\n- Each tab: Full-width content area with appropriate layout (table, form, or grid)\n- User management: Table with role dropdown, search/filter bar\n- CSV upload: Drag-drop zone with file format instructions\n\n## Responsive Behavior\n- Mobile (< 768px): Single column, stacked navigation, full-width cards\n- Tablet (768-1024px): 2-column grids where appropriate\n- Desktop (> 1024px): Full multi-column layouts, sidebar navigation visible\n\n## Accessibility\n- Focus indicators: 2px outline offset by 2px\n- Button minimum target size: 44px height\n- Proper heading hierarchy (h1 → h2 → h3)\n- aria-labels for icon-only buttons\n- Form labels associated with inputs\n- Error announcements for screen readers\n\n## Animations\n**Minimal usage**:\n- Page transitions: Simple fade (duration-200)\n- Card hover: Subtle lift (transition-transform duration-200)\n- Progress bars: Smooth width animation (transition-all duration-500)\n- Modal open/close: Scale + fade (duration-300)\n- No scroll-triggered or complex animations\n\n## Images\nNo hero images required. This is a utility dashboard application. Use icons from lucide-react throughout:\n- Dashboard sections: Bell (announcements), BarChart3 (polls), Lightbulb (ideas), Users (classes)\n- Empty states: Relevant contextual icons\n- User avatars: Initials in circular containers or placeholder icons","path":null,"size_bytes":6096,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider, useAuth } from \"@/contexts/AuthContext\";\nimport { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport ProtectedRoute from \"@/components/ProtectedRoute\";\nimport Header from \"@/components/Header\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Announcements from \"@/pages/Announcements\";\nimport Bluten from \"@/pages/Bluten\";\nimport BlutenDetail from \"@/pages/BlutenDetail\";\nimport Polls from \"@/pages/Polls\";\nimport Ideas from \"@/pages/Ideas\";\nimport Classes from \"@/pages/Classes\";\nimport Admin from \"@/pages/Admin\";\nimport Profile from \"@/pages/Profile\";\nimport ActivityLog from \"@/pages/ActivityLog\";\nimport Login from \"@/pages/Login\";\nimport AddEmail from \"@/pages/AddEmail\";\nimport ForgotPassword from \"@/pages/ForgotPassword\";\nimport ResetPassword from \"@/pages/ResetPassword\";\nimport KullanimSartlari from \"@/pages/KullanimSartlari\";\nimport GizlilikPolitikasi from \"@/pages/GizlilikPolitikasi\";\nimport KVKKAydinlatma from \"@/pages/KVKKAydinlatma\";\nimport Basvurular from \"@/pages/Basvurular\";\nimport Takvim from \"@/pages/Takvim\";\nimport NotFound from \"@/pages/not-found\";\nimport CookieBanner from \"@/components/CookieBanner\";\n\nfunction Router() {\n  const { user, profile, signOut, loading } = useAuth();\n  const [, setLocation] = useLocation();\n\n  const handleLogout = async () => {\n    await signOut();\n    setLocation(\"/giris\");\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">Yükleniyor...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const isAuthenticated = !!user;\n  const userRole = profile?.role || \"student\";\n  const userName = profile?.first_name && profile?.last_name \n    ? `${profile.first_name} ${profile.last_name}`\n    : user?.email || \"Kullanıcı\";\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header\n        isAuthenticated={isAuthenticated}\n        userRole={userRole}\n        userName={userName}\n        profilePictureUrl={profile?.profile_picture_url}\n        profilePictureStatus={profile?.profile_picture_status}\n        onLogout={handleLogout}\n      />\n      \n      <Switch>\n        <Route path=\"/giris\" component={Login} />\n        <Route path=\"/email-ekle\" component={AddEmail} />\n        <Route path=\"/sifre-sifirla\" component={ForgotPassword} />\n        <Route path=\"/auth/reset\" component={ResetPassword} />\n        <Route path=\"/\">\n          <ProtectedRoute requireAuth={false}>\n            <Dashboard />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/duyurular\">\n          <ProtectedRoute requireAuth={false}>\n            <Announcements />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/bluten\">\n          <ProtectedRoute requireAuth={false}>\n            <Bluten />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/bluten/:id\">\n          <ProtectedRoute requireAuth={false}>\n            <BlutenDetail />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/oylamalar\">\n          <ProtectedRoute requireAuth={false}>\n            <Polls />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/fikirler\">\n          <ProtectedRoute requireAuth={false}>\n            <Ideas />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/basvurular\">\n          <ProtectedRoute requireAuth={true}>\n            <Basvurular />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/takvim\">\n          <ProtectedRoute requireAuth={true}>\n            <Takvim />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/siniflar\">\n          <ProtectedRoute requireAdmin={true}>\n            <Classes />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/yonetici\">\n          <ProtectedRoute requireAdmin={true}>\n            <Admin />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/profil\">\n          <ProtectedRoute requireAuth={true}>\n            <Profile />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/aktiviteler\">\n          <ProtectedRoute requireAuth={true}>\n            <ActivityLog />\n          </ProtectedRoute>\n        </Route>\n        <Route path=\"/kullanim-sartlari\" component={KullanimSartlari} />\n        <Route path=\"/gizlilik-politikasi\" component={GizlilikPolitikasi} />\n        <Route path=\"/kvkk-aydinlatma-metni\" component={KVKKAydinlatma} />\n        <Route component={NotFound} />\n      </Switch>\n\n      <footer className=\"border-t mt-16 bg-card\">\n        <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-4\">\n            <div className=\"text-center md:text-left\">\n              <p className=\"text-sm font-semibold mb-1\">\n                <span className=\"text-primary\">Maya</span> Okulları Öğrenci Meclisi\n              </p>\n              <p className=\"text-xs text-muted-foreground\">\n                © {new Date().getFullYear()} Tüm hakları saklıdır.\n              </p>\n            </div>\n            <div className=\"flex flex-wrap justify-center gap-4 md:gap-6 text-sm text-muted-foreground\">\n              <a href=\"/kullanim-sartlari\" className=\"hover:text-primary transition-colors\" data-testid=\"link-kullanim-sartlari\">\n                Kullanım Şartları\n              </a>\n              <a href=\"/gizlilik-politikasi\" className=\"hover:text-primary transition-colors\" data-testid=\"link-gizlilik-politikasi\">\n                Gizlilik Politikası\n              </a>\n              <a href=\"/kvkk-aydinlatma-metni\" className=\"hover:text-primary transition-colors\" data-testid=\"link-kvkk\">\n                KVKK Aydınlatma Metni\n              </a>\n            </div>\n          </div>\n        </div>\n      </footer>\n      \n      <CookieBanner />\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <AuthProvider>\n          <TooltipProvider>\n            <Toaster />\n            <Router />\n          </TooltipProvider>\n        </AuthProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":6584,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { instagramService } from \"./services/instagram\";\n\nconst app = express();\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n    \n    // Instagram otomatik senkronizasyonu başlat\n    instagramService.startAutoSync();\n    log(`Instagram service status: ${JSON.stringify(instagramService.getStatus())}`);\n  });\n})();\n","path":null,"size_bytes":2446,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/lib/api/profiles.ts":{"content":"import { supabase } from '../supabase';\n\nexport interface Profile {\n  id: string;\n  user_id: string;\n  first_name: string | null;\n  last_name: string | null;\n  role: 'admin' | 'teacher' | 'student';\n  class_name: string | null;\n  student_no: string | null;\n  gender: string | null;\n  profile_picture_url?: string | null;\n  created_at: string;\n}\n\n// Helper to get auth headers\nasync function getAuthHeaders(): Promise<HeadersInit> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n  return {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${session.access_token}`,\n  };\n}\n\nexport async function getProfiles(className?: string): Promise<Profile[]> {\n  const headers = await getAuthHeaders();\n  const params = new URLSearchParams();\n  if (className && className !== 'Tümü') {\n    params.append('className', className);\n  }\n  \n  const url = `/api/profiles${params.toString() ? `?${params.toString()}` : ''}`;\n  const res = await fetch(url, { headers, credentials: 'include' });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profiller yüklenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function getProfile(): Promise<Profile> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/profiles/me', { headers, credentials: 'include' });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profil yüklenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function updateProfile(updates: Partial<Profile>): Promise<Profile> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/profiles/me', {\n    method: 'PATCH',\n    headers,\n    credentials: 'include',\n    body: JSON.stringify(updates),\n  });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profil güncellenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function getClassNames(): Promise<string[]> {\n  const res = await fetch('/api/classes');\n  if (!res.ok) {\n    throw new Error('Sınıflar yüklenirken hata oluştu');\n  }\n  const classes = await res.json();\n  return classes.map((c: { name: string }) => c.name);\n}\n\nexport interface SchoolClass {\n  id: string;\n  name: string;\n  created_at: string;\n}\n\nexport async function getClasses(): Promise<SchoolClass[]> {\n  const res = await fetch('/api/classes');\n  if (!res.ok) {\n    throw new Error('Sınıflar yüklenirken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function createClass(name: string): Promise<SchoolClass> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/classes', {\n    method: 'POST',\n    headers,\n    body: JSON.stringify({ name }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Sınıf oluşturulurken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function deleteClass(id: string): Promise<void> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/classes/${id}`, {\n    method: 'DELETE',\n    headers,\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Sınıf silinirken hata oluştu');\n  }\n}\n\nexport async function getAdminProfiles(className?: string): Promise<Profile[]> {\n  const headers = await getAuthHeaders();\n  const params = new URLSearchParams();\n  if (className && className !== 'Tümü') {\n    params.append('className', className);\n  }\n  \n  const url = `/api/admin/profiles${params.toString() ? `?${params.toString()}` : ''}`;\n  const res = await fetch(url, { headers, credentials: 'include' });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profiller yüklenirken hata oluştu');\n  }\n\n  return res.json();\n}\n","path":null,"size_bytes":3884,"size_tokens":null},"client/src/pages/Bluten.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, Image as ImageIcon, Loader2, Instagram, ExternalLink } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { getBlutenPosts, type BlutenPost } from \"@/lib/api/bluten\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\n\ndayjs.extend(relativeTime);\ndayjs.locale(\"tr\");\n\nexport default function Bluten() {\n  const { profile } = useAuth();\n  const isAdmin = profile?.role === \"admin\";\n\n  const { data: posts, isLoading } = useQuery({\n    queryKey: [\"/api/bluten\"],\n    queryFn: getBlutenPosts,\n  });\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2 flex items-center gap-2\">\n              <ImageIcon className=\"h-8 w-8 text-primary\" />\n              Bülten\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Maya Meclisi görsel içerikleri ve etkinlikler\n            </p>\n          </div>\n          {isAdmin && (\n            <Button data-testid=\"button-new-bluten\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Yeni İçerik\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      ) : posts && posts.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {posts.map((post) => (\n            <Link key={post.id} href={`/bluten/${post.id}`}>\n              <a className=\"block\">\n                <Card className=\"overflow-hidden hover-elevate group cursor-pointer h-full flex flex-col\">\n                  {post.media_url && (\n                    <div className=\"aspect-square bg-muted relative overflow-hidden\">\n                      <img\n                        src={post.media_url}\n                        alt={post.caption || \"Instagram post\"}\n                        className=\"object-cover w-full h-full\"\n                        data-testid={`img-post-${post.id}`}\n                      />\n                      <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                        <a\n                          href={post.instagram_url}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          onClick={(e) => e.stopPropagation()}\n                          className=\"flex items-center gap-2 bg-white text-black px-4 py-2 rounded-full hover:bg-gray-100 transition-colors\"\n                          data-testid={`button-instagram-${post.id}`}\n                        >\n                          <Instagram className=\"h-4 w-4\" />\n                          <span className=\"text-sm font-medium\">Instagram'da Aç</span>\n                          <ExternalLink className=\"h-3 w-3\" />\n                        </a>\n                      </div>\n                    </div>\n                  )}\n                  {!post.media_url && (\n                    <div className=\"aspect-square bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center\">\n                      <ImageIcon className=\"h-16 w-16 text-primary/30\" />\n                    </div>\n                  )}\n                  {post.caption && (\n                    <CardContent className=\"p-4 flex-1\">\n                      <p className=\"text-sm line-clamp-3\">{post.caption}</p>\n                    </CardContent>\n                  )}\n                  <CardFooter className=\"p-4 pt-0 flex items-center justify-between text-xs text-muted-foreground gap-2 mt-auto\">\n                    <div className=\"flex items-center gap-2\">\n                      <Instagram className=\"h-3 w-3\" />\n                      <span>{post.username || \"Maya Meclisi\"}</span>\n                    </div>\n                    <span data-testid={`text-date-${post.id}`}>{post.posted_at ? dayjs(post.posted_at).fromNow() : dayjs(post.fetched_at).fromNow()}</span>\n                  </CardFooter>\n                </Card>\n              </a>\n            </Link>\n          ))}\n        </div>\n      ) : (\n        <EmptyState\n          icon={ImageIcon}\n          title=\"Henüz içerik yok\"\n          description=\"İlk Bülten içeriği eklendiğinde burada görünecek.\"\n        />\n      )}\n\n      {/* Info card for admins */}\n      {isAdmin && (!posts || posts.length === 0) && (\n        <Card className=\"mt-6 border-dashed\">\n          <CardContent className=\"p-6\">\n            <h3 className=\"font-semibold mb-2\">Bülten Nasıl Kullanılır?</h3>\n            <ul className=\"text-sm text-muted-foreground space-y-2\">\n              <li>• Instagram tarzı görsel içerikler paylaşın</li>\n              <li>• Etkinlik afişleri, duyuru görselleri ekleyin</li>\n              <li>• Öğrenci çalışmalarını sergileyin</li>\n              <li>• Kısa ve özlü açıklamalar kullanın</li>\n            </ul>\n            <p className=\"text-xs text-muted-foreground mt-4\">\n              Not: Supabase'de \"bluten_posts\" tablosu oluşturup içerik eklemeye başlayabilirsiniz.\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5643,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/EmptyState.tsx":{"content":"import { LucideIcon } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface EmptyStateProps {\n  icon: LucideIcon;\n  title: string;\n  description?: string;\n  actionLabel?: string;\n  onAction?: () => void;\n}\n\nexport default function EmptyState({\n  icon: Icon,\n  title,\n  description,\n  actionLabel,\n  onAction,\n}: EmptyStateProps) {\n  return (\n    <div className=\"flex flex-col items-center justify-center py-16 px-4 text-center\">\n      <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-muted mb-4\">\n        <Icon className=\"h-8 w-8 text-muted-foreground\" />\n      </div>\n      <h3 className=\"text-lg font-semibold mb-2\">{title}</h3>\n      {description && (\n        <p className=\"text-sm text-muted-foreground mb-6 max-w-md\">{description}</p>\n      )}\n      {actionLabel && onAction && (\n        <Button onClick={onAction} data-testid=\"button-empty-action\">\n          {actionLabel}\n        </Button>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":977,"size_tokens":null},"client/src/pages/Classes.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Search, Users, Loader2 } from \"lucide-react\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { getProfiles, getClassNames } from \"@/lib/api/profiles\";\n\nexport default function Classes() {\n  const [selectedClass, setSelectedClass] = useState(\"Tümü\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: profiles, isLoading: loadingProfiles } = useQuery({\n    queryKey: [\"/api/profiles\", selectedClass],\n    queryFn: () => getProfiles(selectedClass),\n  });\n\n  const { data: classNamesData, isLoading: loadingClassNames } = useQuery({\n    queryKey: [\"/api/class-names\"],\n    queryFn: getClassNames,\n  });\n\n  const classNames = [\"Tümü\", ...(classNamesData || [])];\n\n  const filteredStudents = profiles?.filter((profile) => {\n    const matchesSearch =\n      profile.first_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      profile.last_name?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      profile.student_no?.includes(searchQuery);\n    return matchesSearch;\n  }) || [];\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Sınıflar</h1>\n        <p className=\"text-muted-foreground\">Öğrenci listelerini sınıflara göre görüntüleyin</p>\n      </div>\n\n      <div className=\"grid lg:grid-cols-4 gap-6\">\n        <div className=\"lg:col-span-1\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-base\">Filtrele</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Sınıf</label>\n                <Select value={selectedClass} onValueChange={setSelectedClass}>\n                  <SelectTrigger data-testid=\"select-class\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {classNames.map((className) => (\n                      <SelectItem key={className} value={className}>\n                        {className}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium mb-2 block\">Ara</label>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"İsim veya numara...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pl-9\"\n                    data-testid=\"input-search-students\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"pt-4 border-t\">\n                <div className=\"text-sm text-muted-foreground\">\n                  <span className=\"font-medium text-foreground\">{filteredStudents.length}</span> öğrenci bulundu\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"lg:col-span-3\">\n          {loadingProfiles ? (\n            <Card>\n              <CardContent className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </CardContent>\n            </Card>\n          ) : filteredStudents.length > 0 ? (\n            <Card>\n              <CardContent className=\"p-0\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Numara</TableHead>\n                      <TableHead>Ad Soyad</TableHead>\n                      <TableHead>Sınıf</TableHead>\n                      <TableHead>Cinsiyet</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredStudents.map((student) => (\n                      <TableRow key={student.id} data-testid={`row-student-${student.id}`}>\n                        <TableCell className=\"font-medium\">{student.student_no || \"-\"}</TableCell>\n                        <TableCell>\n                          {student.first_name} {student.last_name}\n                        </TableCell>\n                        <TableCell>{student.class_name || \"-\"}</TableCell>\n                        <TableCell>{student.gender || \"-\"}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className=\"p-8\">\n                <EmptyState\n                  icon={Users}\n                  title=\"Öğrenci bulunamadı\"\n                  description=\"Seçili filtrelere uygun öğrenci bulunamadı.\"\n                />\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5485,"size_tokens":null},"client/src/lib/api/ideas.ts":{"content":"import { supabase } from '../supabase';\nimport type { Idea } from '@shared/schema';\n\nexport async function getIdeas() {\n  const { data: { session } } = await supabase.auth.getSession();\n\n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n  };\n\n  if (session) {\n    headers['Authorization'] = `Bearer ${session.access_token}`;\n  }\n\n  const res = await fetch('/api/ideas', {\n    headers,\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to fetch ideas');\n  }\n\n  return res.json() as Promise<Idea[]>;\n}\n\nexport async function getIdea(id: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n\n  const headers: Record<string, string> = {\n    'Content-Type': 'application/json',\n  };\n\n  if (session) {\n    headers['Authorization'] = `Bearer ${session.access_token}`;\n  }\n\n  const res = await fetch(`/api/ideas/${id}`, {\n    headers,\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to fetch idea');\n  }\n\n  return res.json();\n}\n\nexport async function createIdea(data: { \n  title: string; \n  content: string; \n  imageUrl?: string; \n  videoUrl?: string;\n  attachmentUrl?: string;\n  attachmentType?: string;\n  is_anonymous?: boolean;\n}) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  // Map frontend field names to backend schema\n  const payload = {\n    title: data.title,\n    content: data.content,\n    image_url: data.imageUrl,\n    video_url: data.videoUrl,\n    attachment_url: data.attachmentUrl,\n    attachment_type: data.attachmentType,\n    is_anonymous: data.is_anonymous || false,\n  };\n\n  const res = await fetch('/api/ideas', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify(payload),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to create idea');\n  }\n\n  return res.json();\n}\n\nexport async function toggleLike(ideaId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/ideas/${ideaId}/like`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to toggle like');\n  }\n\n  return res.json();\n}\n\nexport async function addComment(ideaId: string, content: string, parentId?: string, isAnonymous?: boolean) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/ideas/${ideaId}/comments`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ content, parent_id: parentId, is_anonymous: isAnonymous || false }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to add comment');\n  }\n\n  return res.json();\n}\n\nexport async function editComment(commentId: string, content: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/comments/${commentId}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ content }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum düzenlenirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function deleteComment(commentId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/comments/${commentId}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum silinirken hata oluştu');\n  }\n\n  return res.json();\n}\n\n// Admin functions\nexport async function getAdminIdeas() {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch('/api/admin/ideas', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to fetch admin ideas');\n  }\n\n  return res.json();\n}\n\nexport async function updateIdeaStatus(id: string, status: 'approved' | 'rejected') {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/admin/ideas/${id}/status`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ status }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to update idea status');\n  }\n\n  return res.json();\n}\n\nexport async function getAdminComments() {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch('/api/admin/comments', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to fetch admin comments');\n  }\n\n  return res.json();\n}\n\nexport async function updateCommentStatus(id: string, status: 'approved' | 'rejected') {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/admin/comments/${id}/status`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ status }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to update comment status');\n  }\n\n  return res.json();\n}\n\nexport async function deleteIdea(id: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Not authenticated');\n\n  const res = await fetch(`/api/admin/ideas/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Failed to delete idea');\n  }\n\n  return res.json();\n}\n","path":null,"size_bytes":7301,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport AnnouncementCard from \"@/components/AnnouncementCard\";\nimport PollCard from \"@/components/PollCard\";\nimport IdeaCard from \"@/components/IdeaCard\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { Bell, Plus, Loader2, MessageSquare, Send, FileText, Download, ArrowRight, Reply, X, MoreVertical, Pencil, Trash2, EyeOff } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Link, useLocation } from \"wouter\";\nimport { getAnnouncements, getAnnouncementComments, addAnnouncementComment, editAnnouncementComment, deleteAnnouncementComment, type Announcement } from \"@/lib/api/announcements\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { getPolls, getUserVote, votePoll } from \"@/lib/api/polls\";\nimport { getIdeas } from \"@/lib/api/ideas\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Card } from \"@/components/ui/card\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\nimport utc from \"dayjs/plugin/utc\";\nimport timezone from \"dayjs/plugin/timezone\";\n\ndayjs.extend(relativeTime);\ndayjs.extend(utc);\ndayjs.extend(timezone);\ndayjs.locale(\"tr\");\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n  const { user, profile } = useAuth();\n  const [, setLocation] = useLocation();\n  const [selectedAnnouncement, setSelectedAnnouncement] = useState<Announcement | null>(null);\n  const [newComment, setNewComment] = useState(\"\");\n  const [replyingTo, setReplyingTo] = useState<{ commentId: string; authorName: string } | null>(null);\n  const [editingComment, setEditingComment] = useState<{ id: string; content: string } | null>(null);\n  const [deleteCommentId, setDeleteCommentId] = useState<string | null>(null);\n  const [isCommentAnonymous, setIsCommentAnonymous] = useState(false);\n\n  const { data: announcements, isLoading: loadingAnnouncements } = useQuery({\n    queryKey: [\"/api/announcements\"],\n    queryFn: getAnnouncements,\n  });\n\n  const { data: polls, isLoading: loadingPolls } = useQuery({\n    queryKey: [\"/api/polls\"],\n    queryFn: getPolls,\n  });\n\n  const { data: ideas, isLoading: loadingIdeas } = useQuery({\n    queryKey: [\"/api/ideas\"],\n    queryFn: getIdeas,\n  });\n\n  const { data: comments, isLoading: loadingComments } = useQuery({\n    queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'],\n    queryFn: () => selectedAnnouncement ? getAnnouncementComments(selectedAnnouncement.id) : Promise.resolve([]),\n    enabled: !!selectedAnnouncement,\n  });\n\n  const addCommentMutation = useMutation({\n    mutationFn: ({ content, parentId, isAnonymous }: { content: string; parentId?: string; isAnonymous?: boolean }) => {\n      if (!user) {\n        toast({\n          description: \"Yorum yapmak için lütfen giriş yapın\",\n        });\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return addAnnouncementComment(selectedAnnouncement!.id, content, parentId, isAnonymous);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'] });\n      setNewComment(\"\");\n      setReplyingTo(null);\n      setIsCommentAnonymous(false);\n      toast({\n        title: \"Başarılı\",\n        description: variables.parentId ? \"Yanıtınız moderatör onayına gönderildi\" : \"Yorumunuz moderatör onayına gönderildi\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          variant: \"destructive\",\n          title: \"Hata\",\n          description: error.message || \"Yorum eklenirken bir hata oluştu\",\n        });\n      }\n    },\n  });\n\n  const editCommentMutation = useMutation({\n    mutationFn: ({ commentId, content }: { commentId: string; content: string }) => {\n      return editAnnouncementComment(commentId, content);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'] });\n      setEditingComment(null);\n      toast({\n        title: \"Başarılı\",\n        description: \"Yorumunuz düzenlendi ve tekrar onaya gönderildi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Yorum düzenlenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const deleteCommentMutation = useMutation({\n    mutationFn: (commentId: string) => {\n      return deleteAnnouncementComment(commentId);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'] });\n      setDeleteCommentId(null);\n      toast({\n        title: \"Başarılı\",\n        description: \"Yorum silindi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Yorum silinirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const voteMutation = useMutation({\n    mutationFn: ({ pollId, optionId }: { pollId: string; optionId: string }) => {\n      if (!user) {\n        toast({\n          description: \"Oy vermek için lütfen giriş yapın\",\n        });\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return votePoll(pollId, optionId);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oyunuz kaydedildi\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          variant: \"destructive\",\n          title: \"Hata\",\n          description: error.message || \"Oy verilirken bir hata oluştu\",\n        });\n      }\n    },\n  });\n\n  const activePoll = polls?.[0];\n  const recentAnnouncements = announcements?.slice(0, 2);\n  const recentIdeas = ideas?.slice(0, 5);\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8 text-center md:text-left\">\n        <h1 className=\"text-3xl md:text-4xl font-bold mb-2\">\n          <span className=\"text-primary\">Maya Meclisi</span> Portalı'na Hoş Geldiniz\n        </h1>\n        <p className=\"text-muted-foreground\">Öğrenci meclisi haberler, oylamalar ve fikirleriniz için</p>\n      </div>\n\n      <div className=\"grid lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold flex items-center gap-2\">\n                <Bell className=\"h-5 w-5 text-primary\" />\n                Son Duyurular\n              </h2>\n              <Link href=\"/duyurular\">\n                <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-all-announcements\">\n                  Tümünü Gör\n                </Button>\n              </Link>\n            </div>\n            {loadingAnnouncements ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : recentAnnouncements && recentAnnouncements.length > 0 ? (\n              <div className=\"space-y-4\">\n                {recentAnnouncements.map((announcement) => {\n                  const authorName = announcement.author\n                    ? `${announcement.author.first_name || \"\"} ${announcement.author.last_name || \"\"}`.trim()\n                    : \"Yönetici\";\n                  return (\n                    <AnnouncementCard\n                      key={announcement.id}\n                      title={announcement.title}\n                      content={announcement.content}\n                      authorName={authorName}\n                      createdAt={dayjs.utc(announcement.created_at).local().fromNow()}\n                      attachmentUrl={announcement.attachment_url}\n                      attachmentType={announcement.attachment_type}\n                      onReadMore={() => setSelectedAnnouncement(announcement)}\n                    />\n                  );\n                })}\n              </div>\n            ) : (\n              <EmptyState\n                icon={Bell}\n                title=\"Henüz duyuru yok\"\n                description=\"İlk duyuru eklendiğinde burada görünecek.\"\n              />\n            )}\n          </div>\n\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold\">Son Fikirler</h2>\n              <Link href=\"/fikirler\">\n                <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-all-ideas\">\n                  Tümünü Gör\n                </Button>\n              </Link>\n            </div>\n            {loadingIdeas ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : recentIdeas && recentIdeas.length > 0 ? (\n              <div className=\"space-y-4\">\n                {recentIdeas.map((idea: any) => {\n                  const authorName = idea.author\n                    ? `${idea.author.first_name || \"\"} ${idea.author.last_name || \"\"}`.trim()\n                    : \"Anonim\";\n                  const initials = authorName\n                    .split(\" \")\n                    .map((n) => n[0])\n                    .join(\"\")\n                    .toUpperCase()\n                    .slice(0, 2);\n                  const authorPicture = idea.author?.profile_picture_status === 'approved' ? idea.author?.profile_picture_url : null;\n                  return (\n                    <IdeaCard\n                      key={idea.id}\n                      title={idea.title}\n                      excerpt={idea.content?.substring(0, 150) || ''}\n                      authorName={authorName}\n                      authorInitials={initials}\n                      authorPictureUrl={authorPicture}\n                      createdAt={dayjs.utc(idea.created_at).local().fromNow()}\n                      status={idea.status}\n                      commentCount={idea.comments?.length || 0}\n                      onClick={() => setLocation(\"/fikirler\")}\n                    />\n                  );\n                })}\n              </div>\n            ) : (\n              <EmptyState\n                icon={Bell}\n                title=\"Henüz fikir yok\"\n                description=\"İlk fikir paylaşıldığında burada görünecek.\"\n              />\n            )}\n          </div>\n        </div>\n\n        <div className=\"space-y-6\">\n          {activePoll && (\n            <div>\n              <h2 className=\"text-xl font-semibold mb-4\">Aktif Oylama</h2>\n              <PollDisplay poll={activePoll} onVote={voteMutation.mutate} />\n            </div>\n          )}\n\n          <div className=\"rounded-lg border bg-card p-6\">\n            <h3 className=\"font-semibold mb-3\">Yeni Fikir Ekle</h3>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Okulunuzu geliştirmek için fikirlerinizi paylaşın\n            </p>\n            <Link href=\"/fikirler\">\n              <Button className=\"w-full\" data-testid=\"button-new-idea\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Fikir Paylaş\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      {/* Announcement Detail Dialog */}\n      <Dialog open={!!selectedAnnouncement} onOpenChange={() => setSelectedAnnouncement(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[85vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>{selectedAnnouncement?.title}</DialogTitle>\n            <DialogDescription>\n              {selectedAnnouncement?.author\n                ? `${selectedAnnouncement.author.first_name || \"\"} ${selectedAnnouncement.author.last_name || \"\"}`.trim()\n                : \"Yönetici\"} • {selectedAnnouncement && dayjs.utc(selectedAnnouncement.created_at).local().fromNow()}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex-1 overflow-y-auto pr-2\">\n            <div className=\"py-4\">\n              <p className=\"text-sm leading-relaxed whitespace-pre-wrap\">{selectedAnnouncement?.content}</p>\n              \n              {/* Attachment Download */}\n              {selectedAnnouncement?.attachment_url && \n               (selectedAnnouncement?.attachment_type === 'pdf' || selectedAnnouncement?.attachment_type === 'document') && (\n                <a \n                  href={selectedAnnouncement.attachment_url} \n                  download \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"inline-flex items-center gap-2 mt-4 px-4 py-2 bg-primary/10 text-primary rounded-md hover:bg-primary/20 transition-colors\"\n                  data-testid=\"link-download-attachment-dashboard\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {selectedAnnouncement.attachment_type === 'pdf' ? 'PDF Dosyası' : 'Doküman'} İndir\n                  <Download className=\"h-4 w-4\" />\n                </a>\n              )}\n            </div>\n\n            {/* Comments Section */}\n            <div className=\"border-t pt-6 mt-6\">\n              <h3 className=\"text-sm font-semibold mb-4 flex items-center gap-2\">\n                <MessageSquare className=\"h-4 w-4\" />\n                Yorumlar {comments && comments.length > 0 && `(${comments.length})`}\n              </h3>\n\n              {/* Comment Form */}\n              <div className=\"mb-6 space-y-2\">\n                {replyingTo && (\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded-md\">\n                    <Reply className=\"h-4 w-4\" />\n                    <span><strong>{replyingTo.authorName}</strong> adlı kişiye yanıt veriyorsunuz</span>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-5 w-5 ml-auto\"\n                      onClick={() => setReplyingTo(null)}\n                      data-testid=\"button-cancel-reply\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                )}\n                <div className=\"flex gap-2\">\n                  <Input\n                    placeholder={replyingTo ? `${replyingTo.authorName} adlı kişiye yanıt yaz...` : \"Yorum yaz...\"}\n                    value={newComment}\n                    onChange={(e) => setNewComment(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey && newComment.trim()) {\n                        e.preventDefault();\n                        addCommentMutation.mutate({ content: newComment, parentId: replyingTo?.commentId, isAnonymous: isCommentAnonymous });\n                      }\n                    }}\n                    disabled={addCommentMutation.isPending}\n                    data-testid=\"input-announcement-comment\"\n                  />\n                  <Button\n                    size=\"icon\"\n                    onClick={() => newComment.trim() && addCommentMutation.mutate({ content: newComment, parentId: replyingTo?.commentId, isAnonymous: isCommentAnonymous })}\n                    disabled={!newComment.trim() || addCommentMutation.isPending}\n                    data-testid=\"button-submit-comment\"\n                  >\n                    {addCommentMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Send className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox \n                    id=\"dashboard-comment-anonymous\"\n                    checked={isCommentAnonymous}\n                    onCheckedChange={(checked) => setIsCommentAnonymous(checked === true)}\n                    data-testid=\"checkbox-comment-anonymous-dashboard\"\n                  />\n                  <Label htmlFor=\"dashboard-comment-anonymous\" className=\"flex items-center gap-1 cursor-pointer text-xs text-muted-foreground\">\n                    <EyeOff className=\"h-3 w-3\" />\n                    Anonim yorum\n                  </Label>\n                </div>\n              </div>\n\n              {/* Comments List */}\n              <div className=\"space-y-3\">\n                {loadingComments ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : comments && comments.length > 0 ? (\n                  comments.map((comment: any) => {\n                    const authorName = comment.author\n                      ? `${comment.author.first_name || \"\"} ${comment.author.last_name || \"\"}`.trim()\n                      : \"Anonim\";\n                    const isOwnComment = profile?.id === comment.author_id;\n                    const isAdmin = profile?.role === 'admin';\n                    const canModify = isOwnComment || isAdmin;\n                    return (\n                      <Card key={comment.id} className=\"p-3\" data-testid={`comment-${comment.id}`}>\n                        <div className=\"flex items-start gap-3\">\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between mb-1\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm font-medium\">{authorName}</span>\n                                {comment.author?.class_name && (\n                                  <span className=\"text-xs text-muted-foreground\">• {comment.author.class_name}</span>\n                                )}\n                                <span className=\"text-xs text-muted-foreground\">\n                                  • {dayjs.utc(comment.created_at).local().fromNow()}\n                                </span>\n                              </div>\n                              {canModify && (\n                                <DropdownMenu>\n                                  <DropdownMenuTrigger asChild>\n                                    <Button \n                                      variant=\"ghost\" \n                                      size=\"icon\" \n                                      className=\"h-6 w-6 shrink-0\"\n                                      data-testid={`button-comment-menu-${comment.id}`}\n                                    >\n                                      <MoreVertical className=\"h-4 w-4\" />\n                                    </Button>\n                                  </DropdownMenuTrigger>\n                                  <DropdownMenuContent align=\"end\">\n                                    {isOwnComment && (\n                                      <DropdownMenuItem \n                                        onClick={() => setEditingComment({ id: comment.id, content: comment.content })}\n                                        data-testid={`button-edit-comment-${comment.id}`}\n                                      >\n                                        <Pencil className=\"h-4 w-4 mr-2\" />\n                                        Düzenle\n                                      </DropdownMenuItem>\n                                    )}\n                                    <DropdownMenuItem \n                                      onClick={() => setDeleteCommentId(comment.id)}\n                                      className=\"text-destructive\"\n                                      data-testid={`button-delete-comment-${comment.id}`}\n                                    >\n                                      <Trash2 className=\"h-4 w-4 mr-2\" />\n                                      Sil\n                                    </DropdownMenuItem>\n                                  </DropdownMenuContent>\n                                </DropdownMenu>\n                              )}\n                            </div>\n                            <p className=\"text-sm text-muted-foreground mb-2\">\n                              {comment.parent_id && (() => {\n                                const parentComment = comments?.find((c: any) => c.id === comment.parent_id);\n                                const parentIsAnon = parentComment?.is_anonymous && !parentComment?.author;\n                                const parentAuthorName = parentComment?.author \n                                  ? `${parentComment.author.first_name || \"\"} ${parentComment.author.last_name || \"\"}`.trim() \n                                  : null;\n                                return (\n                                  <span className=\"text-primary font-medium\">\n                                    @{parentIsAnon ? \"anoimkişi\" : (parentAuthorName || \"anoimkişi\")}{\" \"}\n                                  </span>\n                                );\n                              })()}\n                              {comment.content}\n                            </p>\n                            {user && (\n                              <button\n                                onClick={() => setReplyingTo({ \n                                  commentId: comment.id, \n                                  authorName \n                                })}\n                                className=\"text-xs text-primary hover:underline flex items-center gap-1\"\n                                data-testid={`button-reply-${comment.id}`}\n                              >\n                                <Reply className=\"h-3 w-3\" />\n                                Yanıtla\n                              </button>\n                            )}\n                          </div>\n                        </div>\n                      </Card>\n                    );\n                  })\n                ) : (\n                  <p className=\"text-sm text-muted-foreground text-center py-8\">Henüz yorum yok. İlk yorumu siz yapın!</p>\n                )}\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Comment Dialog */}\n      <Dialog open={!!editingComment} onOpenChange={() => setEditingComment(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Yorumu Düzenle</DialogTitle>\n            <DialogDescription>\n              Yorumunuz düzenlendikten sonra tekrar onaya gönderilecektir.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Input\n              value={editingComment?.content || ''}\n              onChange={(e) => setEditingComment(prev => prev ? { ...prev, content: e.target.value } : null)}\n              placeholder=\"Yorum içeriği\"\n              data-testid=\"input-edit-comment\"\n            />\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setEditingComment(null)} data-testid=\"button-cancel-edit\">\n                İptal\n              </Button>\n              <Button\n                onClick={() => {\n                  if (editingComment) {\n                    editCommentMutation.mutate({ commentId: editingComment.id, content: editingComment.content });\n                  }\n                }}\n                disabled={editCommentMutation.isPending}\n                data-testid=\"button-save-edit\"\n              >\n                {editCommentMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Kaydet\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Comment Confirmation */}\n      <AlertDialog open={!!deleteCommentId} onOpenChange={() => setDeleteCommentId(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Yorumu Sil</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu yorumu silmek istediğinize emin misiniz? Bu işlem geri alınamaz.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete\">İptal</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (deleteCommentId) {\n                  deleteCommentMutation.mutate(deleteCommentId);\n                }\n              }}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteCommentMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : \"Sil\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nfunction PollDisplay({ poll, onVote }: { poll: any; onVote: any }) {\n  const { data: userVote } = useQuery({\n    queryKey: [\"/api/polls\", poll.id, \"user-vote\"],\n    queryFn: () => getUserVote(poll.id),\n  });\n\n  const optionsWithVotes = poll.options?.map((opt: any) => ({\n    id: opt.id,\n    text: opt.option_text,\n    votes: opt.vote_count || 0,\n  })) || [];\n\n  const totalVotes = optionsWithVotes.reduce((sum: number, opt: any) => sum + opt.votes, 0);\n\n  return (\n    <PollCard\n      question={poll.question}\n      options={optionsWithVotes}\n      totalVotes={totalVotes}\n      hasVoted={!!userVote}\n      userVote={userVote?.option_id}\n      isOpen={poll.is_open}\n      resultsPublished={poll.results_published}\n      onVote={(optionId) => onVote({ pollId: poll.id, optionId })}\n    />\n  );\n}\n","path":null,"size_bytes":26508,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/examples/Polls.tsx":{"content":"import Polls from \"../../pages/Polls\";\n\nexport default function PollsExample() {\n  return <Polls />;\n}\n","path":null,"size_bytes":103,"size_tokens":null},"client/src/lib/supabase.ts":{"content":"import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = import.meta.env.VITE_SUPABASE_URL || '';\nconst supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY || '';\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n","path":null,"size_bytes":359,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/examples/Announcements.tsx":{"content":"import Announcements from \"../../pages/Announcements\";\n\nexport default function AnnouncementsExample() {\n  return <Announcements />;\n}\n","path":null,"size_bytes":135,"size_tokens":null},"client/src/components/examples/PollCard.tsx":{"content":"import { useState } from \"react\";\nimport PollCard from \"../PollCard\";\n\nexport default function PollCardExample() {\n  const [hasVoted, setHasVoted] = useState(false);\n  const [userVote, setUserVote] = useState<string>();\n  const [options, setOptions] = useState([\n    { id: \"1\", text: \"Evet, katılmak istiyorum\", votes: 45 },\n    { id: \"2\", text: \"Hayır, katılamam\", votes: 12 },\n    { id: \"3\", text: \"Belki, kararsızım\", votes: 23 },\n  ]);\n\n  const handleVote = (optionId: string) => {\n    setOptions(prev => \n      prev.map(opt => \n        opt.id === optionId ? { ...opt, votes: opt.votes + 1 } : opt\n      )\n    );\n    setUserVote(optionId);\n    setHasVoted(true);\n    console.log(\"Oy verildi:\", optionId);\n  };\n\n  return (\n    <div className=\"p-4 max-w-2xl\">\n      <PollCard\n        question=\"Okul pikniğine katılmak ister misiniz?\"\n        options={options}\n        totalVotes={options.reduce((sum, opt) => sum + opt.votes, 0)}\n        hasVoted={hasVoted}\n        userVote={userVote}\n        isOpen={true}\n        onVote={handleVote}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":1072,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/examples/Login.tsx":{"content":"import Login from \"../../pages/Login\";\n\nexport default function LoginExample() {\n  return <Login />;\n}\n","path":null,"size_bytes":103,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/examples/Classes.tsx":{"content":"import Classes from \"../../pages/Classes\";\n\nexport default function ClassesExample() {\n  return <Classes />;\n}\n","path":null,"size_bytes":111,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/StatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { CheckCircle2, Clock, XCircle } from \"lucide-react\";\n\ntype Status = \"pending\" | \"approved\" | \"rejected\";\n\ninterface StatusBadgeProps {\n  status: Status;\n}\n\nexport default function StatusBadge({ status }: StatusBadgeProps) {\n  const config = {\n    pending: {\n      label: \"Beklemede\",\n      icon: Clock,\n      className: \"bg-yellow-500/10 text-yellow-500 border-yellow-500/20\",\n    },\n    approved: {\n      label: \"Onaylandı\",\n      icon: CheckCircle2,\n      className: \"bg-green-500/10 text-green-500 border-green-500/20\",\n    },\n    rejected: {\n      label: \"Reddedildi\",\n      icon: XCircle,\n      className: \"bg-red-500/10 text-red-500 border-red-500/20\",\n    },\n  };\n\n  const { label, icon: Icon, className } = config[status];\n\n  return (\n    <Badge variant=\"outline\" className={className} data-testid={`badge-status-${status}`}>\n      <Icon className=\"h-3 w-3 mr-1\" />\n      {label}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":964,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/lib/i18n/tr/auth.ts":{"content":"export const authTranslations = {\n  // Login errors\n  \"auth.invalid_credentials\": \"E-posta veya şifre hatalı\",\n  \"auth.invalid_email\": \"Geçersiz e-posta adresi\",\n  \"auth.email_not_confirmed\": \"E-posta adresiniz onaylanmamış\",\n  \"auth.user_not_found\": \"Kullanıcı bulunamadı\",\n  \"auth.too_many_requests\": \"Çok fazla deneme. Lütfen daha sonra tekrar deneyin\",\n  \n  // Registration errors\n  \"auth.email_already_exists\": \"Bu e-posta adresi zaten kayıtlı\",\n  \"auth.weak_password\": \"Şifre çok zayıf. En az 6 karakter kullanın\",\n  \"auth.password_too_short\": \"Şifre en az 6 karakter olmalıdır\",\n  \n  // Profile errors\n  \"auth.profile_not_found\": \"Profil bulunamadı. Lütfen destek ekibiyle iletişime geçin\",\n  \"auth.profile_creation_failed\": \"Profil oluşturulamadı. Lütfen destek ekibiyle iletişime geçin\",\n  \n  // Generic errors\n  \"auth.unknown.login\": \"Giriş yapılırken bir hata oluştu\",\n  \"auth.unknown.register\": \"Kayıt sırasında bir hata oluştu\",\n  \"auth.unknown.profile\": \"Profil yüklenirken bir hata oluştu\",\n  \"auth.network_error\": \"Bağlantı hatası. İnternet bağlantınızı kontrol edin\",\n};\n\nexport type AuthTranslationKey = keyof typeof authTranslations;\n","path":null,"size_bytes":1199,"size_tokens":null},"client/src/components/admin/BlutenForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { insertBlutenPostSchema, type InsertBlutenPost } from \"@shared/schema\";\nimport { supabase } from \"@/lib/supabase\";\n\nexport default function BlutenForm() {\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<InsertBlutenPost>({\n    resolver: zodResolver(insertBlutenPostSchema),\n    defaultValues: {\n      instagram_url: \"\",\n      media_url: \"\",\n      caption: \"\",\n      is_visible: true,\n    },\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: InsertBlutenPost) => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) throw new Error(\"Not authenticated\");\n\n      const res = await fetch('/api/admin/bluten', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session.access_token}`,\n        },\n        credentials: 'include',\n        body: JSON.stringify(data),\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || 'Failed to add bluten post');\n      }\n\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bluten\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Bülten içeriği eklendi\",\n      });\n      setOpen(false);\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"İçerik eklenemedi\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-add-bluten\">Manuel İçerik Ekle</Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Manuel Bülten İçeriği Ekle</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"instagram_url\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Instagram URL</FormLabel>\n                  <FormControl>\n                    <Input \n                      {...field} \n                      data-testid=\"input-bluten-url\" \n                      placeholder=\"https://www.instagram.com/p/...\" \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"media_url\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Görsel URL (Opsiyonel)</FormLabel>\n                  <FormControl>\n                    <Input \n                      {...field} \n                      data-testid=\"input-bluten-media\" \n                      placeholder=\"https://...\" \n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"caption\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Açıklama (Opsiyonel)</FormLabel>\n                  <FormControl>\n                    <Textarea \n                      {...field} \n                      data-testid=\"input-bluten-caption\" \n                      placeholder=\"Post açıklaması\" \n                      rows={4}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <div className=\"flex gap-2 justify-end\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                İptal\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                {mutation.isPending ? \"Ekleniyor...\" : \"Ekle\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":4925,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/admin/PollForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { insertPollSchema, type InsertPoll } from \"@shared/schema\";\nimport { supabase } from \"@/lib/supabase\";\nimport { Plus, X } from \"lucide-react\";\n\nexport default function PollForm() {\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<InsertPoll>({\n    resolver: zodResolver(insertPollSchema),\n    defaultValues: {\n      question: \"\",\n      options: [\"\", \"\"],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"options\",\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (data: InsertPoll) => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) throw new Error(\"Not authenticated\");\n\n      const res = await fetch('/api/admin/polls', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session.access_token}`,\n        },\n        credentials: 'include',\n        body: JSON.stringify(data),\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || 'Failed to create poll');\n      }\n\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/polls\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oylama oluşturuldu\",\n      });\n      setOpen(false);\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Oylama oluşturulamadı\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button data-testid=\"button-add-poll\">Yeni Oylama Ekle</Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Yeni Oylama Oluştur</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"question\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Soru</FormLabel>\n                  <FormControl>\n                    <Input {...field} data-testid=\"input-poll-question\" placeholder=\"Oylama sorusu\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"space-y-2\">\n              <FormLabel>Seçenekler</FormLabel>\n              {fields.map((field, index) => (\n                <FormField\n                  key={field.id}\n                  control={form.control}\n                  name={`options.${index}`}\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormControl>\n                        <div className=\"flex gap-2\">\n                          <Input \n                            {...field} \n                            data-testid={`input-poll-option-${index}`} \n                            placeholder={`Seçenek ${index + 1}`} \n                          />\n                          {fields.length > 2 && (\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => remove(index)}\n                              data-testid={`button-remove-option-${index}`}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              ))}\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => append(\"\")}\n                data-testid=\"button-add-option\"\n                className=\"w-full\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Seçenek Ekle\n              </Button>\n            </div>\n\n            <div className=\"flex gap-2 justify-end\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                İptal\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                {mutation.isPending ? \"Oluşturuluyor...\" : \"Oluştur\"}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":5457,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/pages/Polls.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport PollCard from \"@/components/PollCard\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { BarChart3, Plus, Loader2, X } from \"lucide-react\";\nimport { getPolls, getUserVote, votePoll, createPoll, type Poll } from \"@/lib/api/polls\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\n\nconst pollFormSchema = z.object({\n  question: z.string().min(1, \"Soru gereklidir\").max(500, \"Soru çok uzun\"),\n  options: z.array(z.object({\n    text: z.string().min(1, \"Seçenek boş olamaz\").max(200, \"Seçenek çok uzun\")\n  })).min(2, \"En az 2 seçenek gereklidir\").max(5, \"En fazla 5 seçenek eklenebilir\"),\n});\n\ntype PollFormValues = z.infer<typeof pollFormSchema>;\n\nexport default function Polls() {\n  const [isNewPollOpen, setIsNewPollOpen] = useState(false);\n  const { toast } = useToast();\n  const { user, profile } = useAuth();\n  const [, setLocation] = useLocation();\n  const isAdmin = profile?.role === \"admin\";\n\n  const { data: polls, isLoading } = useQuery({\n    queryKey: [\"/api/polls\"],\n    queryFn: getPolls,\n  });\n\n  const form = useForm<PollFormValues>({\n    resolver: zodResolver(pollFormSchema),\n    defaultValues: {\n      question: \"\",\n      options: [{ text: \"\" }, { text: \"\" }],\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"options\",\n  });\n\n  const voteMutation = useMutation({\n    mutationFn: ({ pollId, optionId }: { pollId: string; optionId: string }) => {\n      if (!user) {\n        toast({\n          title: \"Giriş Gerekli\",\n          description: \"Oy vermek için giriş yapmanız gerekiyor\",\n        });\n        setTimeout(() => setLocation(\"/giris\"), 1500);\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return votePoll(pollId, optionId);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\", variables.pollId, \"votes\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\", variables.pollId, \"user-vote\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oyunuz kaydedildi\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          variant: \"destructive\",\n          title: \"Hata\",\n          description: error.message || \"Oy verilirken bir hata oluştu\",\n        });\n      }\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: PollFormValues) => createPoll(data.question, data.options.map(opt => opt.text)),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      setIsNewPollOpen(false);\n      form.reset();\n      toast({\n        title: \"Başarılı\",\n        description: \"Oylama başarıyla oluşturuldu\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Oylama oluşturulurken bir hata oluştu\",\n      });\n    },\n  });\n\n\n  const onSubmit = (data: PollFormValues) => {\n    createMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\">Oylamalar</h1>\n            <p className=\"text-muted-foreground\">Aktif ve tamamlanmış oylamaları görüntüleyin</p>\n          </div>\n          {isAdmin && (\n            <Button onClick={() => setIsNewPollOpen(true)} data-testid=\"button-new-poll\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Yeni Oylama\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      ) : polls && polls.length > 0 ? (\n        <div className=\"grid md:grid-cols-2 gap-6\">\n          {polls.map((poll) => (\n            <PollDisplay\n              key={poll.id}\n              poll={poll}\n              onVote={(optionId) => voteMutation.mutate({ pollId: poll.id, optionId })}\n            />\n          ))}\n        </div>\n      ) : (\n        <EmptyState\n          icon={BarChart3}\n          title=\"Henüz oylama yok\"\n          description=\"İlk oylamayı oluşturun ve öğrencilerin görüşlerini alın.\"\n        />\n      )}\n\n      <Dialog open={isNewPollOpen} onOpenChange={setIsNewPollOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Yeni Oylama</DialogTitle>\n            <DialogDescription>\n              Öğrencilerin oy verebileceği yeni bir oylama oluşturun\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"question\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Soru</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Oylama sorusunu girin\"\n                        {...field}\n                        data-testid=\"input-poll-question\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"space-y-3\">\n                <FormLabel>Seçenekler (En az 2, en fazla 5)</FormLabel>\n                {fields.map((field, index) => (\n                  <FormField\n                    key={field.id}\n                    control={form.control}\n                    name={`options.${index}.text`}\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormControl>\n                          <div className=\"flex gap-2\">\n                            <Input\n                              placeholder={`Seçenek ${index + 1}`}\n                              {...field}\n                              data-testid={`input-poll-option-${index}`}\n                            />\n                            {fields.length > 2 && (\n                              <Button\n                                type=\"button\"\n                                variant=\"outline\"\n                                size=\"icon\"\n                                onClick={() => remove(index)}\n                                data-testid={`button-remove-option-${index}`}\n                              >\n                                <X className=\"h-4 w-4\" />\n                              </Button>\n                            )}\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                ))}\n                {fields.length < 5 && (\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => append({ text: \"\" })}\n                    className=\"w-full\"\n                    data-testid=\"button-add-option\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Seçenek Ekle\n                  </Button>\n                )}\n              </div>\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsNewPollOpen(false)}\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-cancel-poll\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-submit-poll\"\n                >\n                  {createMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Oluştur\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nfunction PollDisplay({ \n  poll, \n  onVote\n}: { \n  poll: Poll; \n  onVote: (optionId: string) => void;\n}) {\n  const { data: userVote } = useQuery({\n    queryKey: [\"/api/polls\", poll.id, \"user-vote\"],\n    queryFn: () => getUserVote(poll.id),\n  });\n\n  const optionsWithVotes = poll.options?.map((opt) => ({\n    id: opt.id,\n    text: opt.option_text,\n    votes: opt.vote_count || 0,\n  })) || [];\n\n  const totalVotes = optionsWithVotes.reduce((sum, opt) => sum + opt.votes, 0);\n\n  return (\n    <PollCard\n      question={poll.question}\n      options={optionsWithVotes}\n      totalVotes={totalVotes}\n      hasVoted={!!userVote}\n      userVote={userVote?.option_id}\n      isOpen={poll.is_open}\n      resultsPublished={poll.results_published}\n      onVote={onVote}\n    />\n  );\n}\n","path":null,"size_bytes":9732,"size_tokens":null},"client/src/components/examples/AnnouncementCard.tsx":{"content":"import AnnouncementCard from \"../AnnouncementCard\";\n\nexport default function AnnouncementCardExample() {\n  return (\n    <div className=\"p-4 max-w-2xl\">\n      <AnnouncementCard\n        title=\"Yaz Tatili Duyurusu\"\n        content=\"Sevgili öğrenciler, yaz tatili 15 Haziran tarihinde başlayacaktır. Tüm öğrencilerin bu tarihten itibaren okulda bulunması zorunlu değildir. İyi tatiller dileriz!\"\n        authorName=\"Müdür Yardımcısı\"\n        createdAt=\"10 Mayıs 2025\"\n        onReadMore={() => console.log(\"Devamını oku\")}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":564,"size_tokens":null},"client/src/components/examples/StatusBadge.tsx":{"content":"import StatusBadge from \"../StatusBadge\";\n\nexport default function StatusBadgeExample() {\n  return (\n    <div className=\"flex flex-wrap gap-3 p-4\">\n      <StatusBadge status=\"pending\" />\n      <StatusBadge status=\"approved\" />\n      <StatusBadge status=\"rejected\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":285,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport { storage } from \"./storage\";\nimport { isAdmin, getUserRole, supabaseAdmin } from \"./services/supabase\";\nimport { \n  insertAnnouncementSchema, \n  insertPollSchema, \n  insertBlutenPostSchema,\n  createUserSchema,\n  updateProfileSchema,\n  insertIdeaSchema,\n  insertCommentSchema,\n  insertAnnouncementCommentSchema,\n  studentRegistrationSchema,\n  insertClassSchema,\n  insertEventSchema,\n  updateEventSchema,\n  insertEventApplicationSchema,\n} from \"@shared/schema\";\n\n// Configure multer for file uploads (in-memory storage)\nconst upload = multer({ \n  storage: multer.memoryStorage(),\n  limits: { \n    fileSize: 25 * 1024 * 1024, // 25MB limit (increased for PDFs)\n  },\n  fileFilter: (_req, file, cb) => {\n    // Allow images, videos, and documents (PDF, DOC, DOCX, etc.)\n    const allowedMimeTypes = [\n      'image/',\n      'video/',\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n      'application/vnd.ms-excel',\n      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n      'application/vnd.ms-powerpoint',\n      'application/vnd.openxmlformats-officedocument.presentationml.presentation',\n      'text/plain',\n    ];\n    \n    const isAllowed = allowedMimeTypes.some(type => file.mimetype.startsWith(type) || file.mimetype === type);\n    \n    if (isAllowed) {\n      cb(null, true);\n    } else {\n      cb(new Error('Sadece resim, video ve doküman dosyaları (PDF, Word, Excel, PowerPoint) yüklenebilir'));\n    }\n  },\n});\n\n// Configure multer for profile picture uploads - STRICT validation\nconst profilePictureUpload = multer({ \n  storage: multer.memoryStorage(),\n  limits: { \n    fileSize: 2 * 1024 * 1024, // 2MB limit for profile pictures\n  },\n  fileFilter: (_req, file, cb) => {\n    // STRICT: Only allow jpg, jpeg, png for profile pictures\n    const allowedMimeTypes = ['image/jpeg', 'image/jpg', 'image/png'];\n    const allowedExtensions = ['.jpg', '.jpeg', '.png'];\n    \n    const fileExtension = file.originalname.toLowerCase().slice(file.originalname.lastIndexOf('.'));\n    const isMimeAllowed = allowedMimeTypes.includes(file.mimetype);\n    const isExtensionAllowed = allowedExtensions.includes(fileExtension);\n    \n    if (isMimeAllowed && isExtensionAllowed) {\n      cb(null, true);\n    } else {\n      cb(new Error('Profil fotoğrafı için sadece JPG, JPEG ve PNG dosyaları yüklenebilir (maksimum 2MB)'));\n    }\n  },\n});\n\n// Middleware to extract user ID from Supabase JWT token\nasync function requireAuth(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader?.startsWith('Bearer ')) {\n    return res.status(401).json({ error: \"Authentication required\" });\n  }\n  \n  const token = authHeader.substring(7); // Remove 'Bearer ' prefix\n  \n  // Verify token with Supabase\n  if (!supabaseAdmin) {\n    return res.status(503).json({ error: \"Authentication service unavailable\" });\n  }\n  \n  const { data: { user }, error } = await supabaseAdmin.auth.getUser(token);\n  \n  if (error || !user) {\n    return res.status(401).json({ error: \"Invalid token\" });\n  }\n  \n  (req as any).userId = user.id;\n  next();\n}\n\n// Middleware to check admin role\nasync function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  const userId = (req as any).userId;\n  \n  if (!userId) {\n    return res.status(401).json({ error: \"Authentication required\" });\n  }\n  \n  const adminCheck = await isAdmin(userId);\n  \n  if (!adminCheck) {\n    return res.status(403).json({ error: \"Admin access required\" });\n  }\n  \n  next();\n}\n\n// Helper: Get profile ID from user ID\nasync function getProfileId(userId: string): Promise<string | null> {\n  const { supabaseAdmin } = await import('./services/supabase');\n  if (!supabaseAdmin) return null;\n  \n  const { data: profile } = await supabaseAdmin\n    .from('profiles')\n    .select('id')\n    .eq('user_id', userId)\n    .single();\n  \n  return profile?.id || null;\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // ============================================\n  // HELPER: LOG USER ACTIVITY\n  // ============================================\n  async function logActivity(\n    userId: string, \n    actionType: string, \n    targetId?: string, \n    targetType?: string, \n    details?: string\n  ) {\n    try {\n      if (!supabaseAdmin) return;\n      \n      await supabaseAdmin.from('action_logs').insert({\n        user_id: userId,\n        action_type: actionType,\n        target_id: targetId,\n        target_type: targetType,\n        details: details,\n      });\n    } catch (error) {\n      console.error('Error logging activity:', error);\n    }\n  }\n\n  // ============================================\n  // ADMIN ROUTES\n  // ============================================\n  \n  // Create announcement\n  app.post('/api/admin/announcements', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const validated = insertAnnouncementSchema.parse(req.body);\n      const userId = (req as any).userId;\n      \n      // Get profile ID from user ID\n      const profileId = await getProfileId(userId);\n      if (!profileId) {\n        return res.status(400).json({ error: \"Profile not found\" });\n      }\n      \n      const announcement = await storage.createAnnouncement({\n        ...validated,\n        author_id: profileId,\n      });\n      \n      res.json(announcement);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update announcement\n  app.patch('/api/admin/announcements/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const validated = insertAnnouncementSchema.partial().parse(req.body);\n      \n      const announcement = await storage.updateAnnouncement(id, validated);\n      \n      res.json(announcement);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete announcement\n  app.delete('/api/admin/announcements/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      \n      await storage.deleteAnnouncement(id);\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get ALL announcements (for admin panel)\n  app.get('/api/admin/announcements', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: announcements, error } = await supabaseAdmin\n        .from('announcements')\n        .select('*, author:profiles!announcements_author_id_fkey(first_name, last_name)')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(announcements);\n    } catch (error: any) {\n      console.error('Error fetching admin announcements:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Public announcement routes (no auth required for viewing)\n  app.get('/api/announcements', async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Check if user is authenticated (optional)\n      const authHeader = req.headers.authorization;\n      let isAdmin = false;\n      let isClassPresident = false;\n\n      if (authHeader?.startsWith('Bearer ')) {\n        const token = authHeader.substring(7);\n        const { data: { user } } = await supabaseAdmin.auth.getUser(token);\n        \n        if (user) {\n          // Get user's profile to check role and class president status\n          const { data: profile } = await supabaseAdmin\n            .from('profiles')\n            .select('role, is_class_president')\n            .eq('user_id', user.id)\n            .single();\n          \n          isAdmin = profile?.role === 'admin';\n          isClassPresident = profile?.is_class_president || false;\n        }\n      }\n\n      // Build query based on user's role and class president status\n      let query = supabaseAdmin\n        .from('announcements')\n        .select('*, author:profiles!announcements_author_id_fkey(first_name, last_name)')\n        .order('created_at', { ascending: false });\n\n      // Filter by target audience\n      if (isAdmin) {\n        // Admins see ALL announcements (no filter)\n        // No additional filtering needed\n      } else if (isClassPresident) {\n        // Class presidents see both 'all' and 'class_presidents' announcements\n        query = query.in('target_audience', ['all', 'class_presidents']);\n      } else {\n        // Regular users only see 'all' announcements\n        query = query.eq('target_audience', 'all');\n      }\n\n      const { data: announcements, error } = await query;\n\n      if (error) throw error;\n\n      res.json(announcements);\n    } catch (error: any) {\n      console.error('Error fetching announcements:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  app.get('/api/announcements/:id', async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: announcement, error } = await supabaseAdmin\n        .from('announcements')\n        .select('*, author:profiles!announcements_author_id_fkey(first_name, last_name)')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      res.json(announcement);\n    } catch (error: any) {\n      console.error('Error fetching announcement:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // ANNOUNCEMENT COMMENTS\n  // ============================================\n\n  // Create announcement comment (with optional reply)\n  app.post('/api/announcements/:id/comments', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { content, parent_id, is_anonymous } = req.body;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID and name from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id, first_name, last_name')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        throw new Error('Profil bulunamadı');\n      }\n\n      const validated = insertAnnouncementCommentSchema.parse({\n        announcement_id: id,\n        author_id: profile.id,\n        content: content,\n        is_anonymous: is_anonymous || false,\n      });\n\n      const { data: comment, error } = await supabaseAdmin\n        .from('announcement_comments')\n        .insert({\n          ...validated,\n          parent_id: parent_id || null,\n          status: 'pending',\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Log announcement comment activity\n      await logActivity(profile.id, 'ANNOUNCEMENT_COMMENT_CREATED', id, 'announcement', 'Duyuruya yorum yapıldı');\n\n      // If this is a reply, create notification for the parent comment author\n      if (parent_id) {\n        const { data: parentComment } = await supabaseAdmin\n          .from('announcement_comments')\n          .select('author_id')\n          .eq('id', parent_id)\n          .single();\n\n        if (parentComment && parentComment.author_id !== profile.id) {\n          const replierName = `${profile.first_name || ''} ${profile.last_name || ''}`.trim() || 'Birisi';\n          const shortContent = content.length > 50 ? content.substring(0, 50) + '...' : content;\n          console.log('Creating reply notification for user:', parentComment.author_id);\n          const { error: notifError } = await supabaseAdmin\n            .from('notifications')\n            .insert({\n              user_id: parentComment.author_id,\n              type: 'reply_received',\n              title: 'Yorumunuza Yanıt Geldi!',\n              message: `${replierName} yorumunuza yanıt verdi: \"${shortContent}\"`,\n              link: '/duyurular',\n            });\n          if (notifError) {\n            console.error('Error creating reply notification:', notifError);\n          } else {\n            console.log('Reply notification created successfully');\n          }\n        }\n      }\n\n      res.json(comment);\n    } catch (error: any) {\n      console.error('Error adding announcement comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get approved announcement comments (public - no auth required)\n  app.get('/api/announcements/:id/comments', async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      \n      // Check if user is admin\n      let isAdmin = false;\n      const authHeader = req.headers.authorization;\n      if (authHeader?.startsWith('Bearer ') && supabaseAdmin) {\n        const token = authHeader.substring(7);\n        try {\n          const { data: { user }, error } = await supabaseAdmin.auth.getUser(token);\n          if (!error && user) {\n            const { data: profile } = await supabaseAdmin\n              .from('profiles')\n              .select('role')\n              .eq('user_id', user.id)\n              .single();\n            isAdmin = profile?.role === 'admin';\n          }\n        } catch (e) {\n          // Continue without admin status\n        }\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: comments, error } = await supabaseAdmin\n        .from('announcement_comments')\n        .select(`\n          *,\n          author:profiles!announcement_comments_author_id_fkey(first_name, last_name, class_name, student_no)\n        `)\n        .eq('announcement_id', id)\n        .eq('status', 'approved')\n        .order('created_at', { ascending: true });\n\n      if (error) throw error;\n\n      // Mask anonymous authors for non-admins, but keep is_anonymous flag\n      const processedComments = (comments || []).map((comment: any) => {\n        if (comment.is_anonymous && !isAdmin) {\n          return { \n            ...comment, \n            author: null,\n            is_anonymous: true \n          };\n        }\n        return {\n          ...comment,\n          is_anonymous: comment.is_anonymous || false\n        };\n      });\n\n      res.json(processedComments);\n    } catch (error: any) {\n      console.error('Error fetching announcement comments:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get pending announcement comments (for admin moderation)\n  app.get('/api/admin/announcement-comments', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: comments, error } = await supabaseAdmin\n        .from('announcement_comments')\n        .select(`\n          *,\n          author:profiles!announcement_comments_author_id_fkey(first_name, last_name, class_name),\n          announcement:announcements(title)\n        `)\n        .eq('status', 'pending')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(comments);\n    } catch (error: any) {\n      console.error('Error fetching admin announcement comments:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update announcement comment status\n  app.patch('/api/admin/announcement-comments/:id/status', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { status } = req.body;\n      const userId = (req as any).userId;\n\n      if (!['approved', 'rejected'].includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get reviewer's profile ID\n      const reviewerProfileId = await getProfileId(userId);\n      if (!reviewerProfileId) {\n        return res.status(400).json({ error: \"Reviewer profile not found\" });\n      }\n\n      // Get comment info for notification\n      const { data: comment } = await supabaseAdmin\n        .from('announcement_comments')\n        .select('author_id, announcement_id, content')\n        .eq('id', id)\n        .single();\n\n      const { error } = await supabaseAdmin\n        .from('announcement_comments')\n        .update({\n          status,\n          reviewed_by: reviewerProfileId,\n        })\n        .eq('id', id);\n\n      if (error) throw error;\n\n      // Create notification for the comment author\n      if (comment?.author_id) {\n        const shortContent = comment.content.length > 50 \n          ? comment.content.substring(0, 50) + '...' \n          : comment.content;\n        console.log('Creating notification for user:', comment.author_id);\n        const { error: notifError } = await supabaseAdmin\n          .from('notifications')\n          .insert({\n            user_id: comment.author_id,\n            type: status === 'approved' ? 'announcement_comment_approved' : 'announcement_comment_rejected',\n            title: status === 'approved' ? 'Yorumunuz Onaylandı!' : 'Yorumunuz Reddedildi',\n            message: status === 'approved' \n              ? `\"${shortContent}\" yorumunuz onaylandı ve yayınlandı.`\n              : `\"${shortContent}\" yorumunuz reddedildi.`,\n            link: status === 'approved' ? '/duyurular' : undefined,\n          });\n        if (notifError) {\n          console.error('Error creating notification:', notifError);\n        } else {\n          console.log('Notification created successfully');\n        }\n      }\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error updating announcement comment status:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Edit own announcement comment (sets status back to pending for re-approval)\n  app.patch('/api/announcement-comments/:id', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { content } = req.body;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      if (!content || content.trim().length === 0) {\n        return res.status(400).json({ error: 'Yorum içeriği boş olamaz' });\n      }\n\n      // Get profile ID from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      // Check if user owns this comment\n      const { data: comment, error: commentError } = await supabaseAdmin\n        .from('announcement_comments')\n        .select('author_id')\n        .eq('id', id)\n        .single();\n\n      if (commentError || !comment) {\n        return res.status(404).json({ error: 'Yorum bulunamadı' });\n      }\n\n      if (comment.author_id !== profile.id) {\n        return res.status(403).json({ error: 'Bu yorumu düzenleme yetkiniz yok' });\n      }\n\n      // Update comment and set status back to pending\n      const { data: updatedComment, error } = await supabaseAdmin\n        .from('announcement_comments')\n        .update({\n          content: content.trim(),\n          status: 'pending',\n          reviewed_by: null,\n        })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(updatedComment);\n    } catch (error: any) {\n      console.error('Error editing announcement comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete own announcement comment\n  app.delete('/api/announcement-comments/:id', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID and role from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id, role')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      // Check if user owns this comment or is admin\n      const { data: comment, error: commentError } = await supabaseAdmin\n        .from('announcement_comments')\n        .select('author_id')\n        .eq('id', id)\n        .single();\n\n      if (commentError || !comment) {\n        return res.status(404).json({ error: 'Yorum bulunamadı' });\n      }\n\n      const isOwner = comment.author_id === profile.id;\n      const isAdmin = profile.role === 'admin';\n\n      if (!isOwner && !isAdmin) {\n        return res.status(403).json({ error: 'Bu yorumu silme yetkiniz yok' });\n      }\n\n      // Delete the comment\n      const { error } = await supabaseAdmin\n        .from('announcement_comments')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error deleting announcement comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // BLÜTEN\n  // ============================================\n\n  // Get single bluten post by ID (public)\n  app.get('/api/bluten/:id', async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: blutenPost, error } = await supabaseAdmin\n        .from('bluten_posts')\n        .select('*')\n        .eq('id', id)\n        .eq('is_visible', true)\n        .single();\n\n      if (error) {\n        if (error.code === 'PGRST116') {\n          return res.status(404).json({ error: 'İçerik bulunamadı' });\n        }\n        throw error;\n      }\n\n      res.json(blutenPost);\n    } catch (error: any) {\n      console.error('Error fetching bluten post:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get visible bluten posts (public)\n  app.get('/api/bluten', async (_req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: blutenPosts, error } = await supabaseAdmin\n        .from('bluten_posts')\n        .select('*')\n        .eq('is_visible', true)\n        .order('posted_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(blutenPosts || []);\n    } catch (error: any) {\n      console.error('Error fetching bluten:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get ALL bluten posts (for admin panel)\n  app.get('/api/admin/bluten', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: blutenPosts, error } = await supabaseAdmin\n        .from('bluten_posts')\n        .select('*')\n        .order('posted_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(blutenPosts);\n    } catch (error: any) {\n      console.error('Error fetching admin bluten:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get ALL profiles (for admin panel) with optional class filter\n  app.get('/api/admin/profiles', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { className } = req.query;\n      \n      let query = supabaseAdmin\n        .from('profiles')\n        .select('*');\n      \n      // Apply server-side class filter if provided\n      if (className && className !== 'Tümü') {\n        query = query.eq('class_name', className);\n      }\n      \n      query = query\n        .order('class_name', { ascending: true })\n        .order('student_no', { ascending: true });\n\n      const { data: profiles, error } = await query;\n\n      if (error) throw error;\n\n      res.json(profiles);\n    } catch (error: any) {\n      console.error('Error fetching admin profiles:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n  \n  // Create poll with options\n  app.post('/api/admin/polls', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const validated = insertPollSchema.parse(req.body);\n      const userId = (req as any).userId;\n      \n      // Get profile ID from user ID\n      const profileId = await getProfileId(userId);\n      if (!profileId) {\n        return res.status(400).json({ error: \"Profile not found\" });\n      }\n      \n      const poll = await storage.createPollWithOptions({\n        ...validated,\n        created_by: profileId,\n      });\n      \n      res.json(poll);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete poll\n  app.delete('/api/admin/polls/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      \n      await storage.deletePoll(id);\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get ALL polls with accurate vote counts (for admin panel)\n  app.get('/api/admin/polls', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get all polls with options\n      const { data: polls, error: pollsError } = await supabaseAdmin\n        .from('polls')\n        .select(`\n          *,\n          options:poll_options(\n            id,\n            poll_id,\n            option_text\n          )\n        `)\n        .order('created_at', { ascending: false });\n\n      if (pollsError) throw pollsError;\n\n      // Calculate vote counts for each option (using service_role - bypasses RLS)\n      const pollsWithVotes = await Promise.all(\n        polls.map(async (poll) => {\n          const optionsWithVotes = await Promise.all(\n            poll.options.map(async (option: any) => {\n              const { count } = await supabaseAdmin!\n                .from('poll_votes')\n                .select('*', { count: 'exact', head: true })\n                .eq('option_id', option.id);\n\n              return {\n                ...option,\n                vote_count: count || 0,\n              };\n            })\n          );\n\n          return {\n            ...poll,\n            options: optionsWithVotes,\n          };\n        })\n      );\n\n      res.json(pollsWithVotes);\n    } catch (error: any) {\n      console.error('Error fetching admin polls:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Toggle poll open/close\n  app.patch('/api/admin/polls/:id/status', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { is_open } = req.body;\n      \n      const poll = await storage.togglePollStatus(id, is_open);\n      \n      res.json(poll);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Publish poll results (closes voting and shows results)\n  app.patch('/api/admin/polls/:id/publish-results', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Close the poll and publish results\n      const { data: poll, error } = await supabaseAdmin\n        .from('polls')\n        .update({ \n          is_open: false,\n          results_published: true\n        })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(poll);\n    } catch (error: any) {\n      console.error('Error publishing poll results:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get detailed poll statistics (who voted, class breakdown)\n  app.get('/api/admin/polls/:id/stats', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      \n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get poll with options\n      const { data: poll, error: pollError } = await supabaseAdmin\n        .from('polls')\n        .select(`\n          *,\n          options:poll_options(id, option_text)\n        `)\n        .eq('id', id)\n        .single();\n\n      if (pollError) throw pollError;\n\n      // Get all votes (no join - we'll fetch profiles separately)\n      const { data: votes, error: votesError } = await supabaseAdmin\n        .from('poll_votes')\n        .select('*')\n        .eq('poll_id', id);\n\n      if (votesError) throw votesError;\n\n      // Handle empty votes case\n      if (votes.length === 0) {\n        return res.json({\n          poll,\n          total_votes: 0,\n          option_stats: poll.options.map((option: any) => ({\n            option_id: option.id,\n            option_text: option.option_text,\n            total_votes: 0,\n            votes: [],\n            class_breakdown: {},\n          })),\n          overall_class_breakdown: {},\n        });\n      }\n\n      // Get profile info for each voter\n      const voterIds = votes.map((v: any) => v.user_id);\n      const { data: profiles, error: profilesError } = await supabaseAdmin\n        .from('profiles')\n        .select('*')\n        .in('user_id', voterIds);\n\n      if (profilesError) throw profilesError;\n\n      // Map profiles to votes\n      const votesWithProfiles = votes.map((vote: any) => {\n        const profile = profiles.find((p: any) => p.user_id === vote.user_id);\n        return {\n          ...vote,\n          profile,\n        };\n      });\n\n      // Calculate stats per option\n      const optionStats = poll.options.map((option: any) => {\n        const optionVotes = votesWithProfiles.filter((v: any) => v.option_id === option.id);\n        \n        // Group by class\n        const classCounts: Record<string, number> = {};\n        optionVotes.forEach((vote: any) => {\n          const className = vote.profile?.class_name || 'Sınıf Yok';\n          classCounts[className] = (classCounts[className] || 0) + 1;\n        });\n\n        return {\n          option_id: option.id,\n          option_text: option.option_text,\n          total_votes: optionVotes.length,\n          votes: optionVotes,\n          class_breakdown: classCounts,\n        };\n      });\n\n      // Overall class breakdown\n      const overallClassBreakdown: Record<string, number> = {};\n      votesWithProfiles.forEach((vote: any) => {\n        const className = vote.profile?.class_name || 'Sınıf Yok';\n        overallClassBreakdown[className] = (overallClassBreakdown[className] || 0) + 1;\n      });\n\n      res.json({\n        poll,\n        total_votes: votesWithProfiles.length,\n        option_stats: optionStats,\n        overall_class_breakdown: overallClassBreakdown,\n      });\n    } catch (error: any) {\n      console.error('Error fetching poll stats:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n  \n  // Create manual blüten post\n  app.post('/api/admin/bluten', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const validated = insertBlutenPostSchema.parse(req.body);\n      const userId = (req as any).userId;\n      \n      // Get profile ID from user ID\n      const profileId = await getProfileId(userId);\n      if (!profileId) {\n        return res.status(400).json({ error: \"Profile not found\" });\n      }\n      \n      const post = await storage.createManualBlutenPost({\n        ...validated,\n        created_by: profileId,\n      });\n      \n      res.json(post);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n  \n  // Toggle blüten visibility\n  app.patch('/api/admin/bluten/:id/visibility', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { visible } = req.body;\n      \n      await storage.toggleBlutenVisibility(id, visible);\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete blüten post (admin only)\n  app.delete('/api/admin/bluten/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { error } = await supabaseAdmin\n        .from('bluten_posts')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update blüten post (admin only)\n  app.patch('/api/admin/bluten/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { caption, is_visible } = req.body;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const updates: any = {};\n      if (caption !== undefined) updates.caption = caption;\n      if (is_visible !== undefined) updates.is_visible = is_visible;\n\n      const { data, error } = await supabaseAdmin\n        .from('bluten_posts')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n  \n  // Get all users (admin only)\n  app.get('/api/admin/users', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: profiles, error } = await supabaseAdmin\n        .from('profiles')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(profiles);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // CLASSES MANAGEMENT\n  // ============================================\n  \n  // Get all classes (public - for registration form)\n  app.get('/api/classes', async (_req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data, error } = await supabaseAdmin\n        .from('classes')\n        .select('*')\n        .order('name');\n\n      if (error) throw error;\n      res.json(data || []);\n    } catch (error: any) {\n      console.error('Error fetching classes:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Create a new class (admin only)\n  app.post('/api/classes', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const validated = insertClassSchema.parse(req.body);\n\n      // Check if class already exists\n      const { data: existing } = await supabaseAdmin\n        .from('classes')\n        .select('id')\n        .eq('name', validated.name)\n        .maybeSingle();\n\n      if (existing) {\n        return res.status(400).json({ error: 'Bu sınıf zaten mevcut' });\n      }\n\n      const { data, error } = await supabaseAdmin\n        .from('classes')\n        .insert({ name: validated.name })\n        .select()\n        .single();\n\n      if (error) throw error;\n      res.status(201).json(data);\n    } catch (error: any) {\n      console.error('Error creating class:', error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ error: 'Geçersiz sınıf adı' });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Delete a class (admin only)\n  app.delete('/api/classes/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n\n      const { error } = await supabaseAdmin\n        .from('classes')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error deleting class:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // LOGIN WITH NAME (instead of email)\n  // ============================================\n  app.post('/api/auth/login-with-name', async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Sunucu yapılandırma hatası' });\n      }\n\n      const { firstName, lastName, password } = req.body;\n\n      if (!firstName || !lastName || !password) {\n        return res.status(400).json({ error: 'Ad, soyad ve şifre gereklidir' });\n      }\n\n      // Find user by first name and last name (case-insensitive)\n      const { data: profiles, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('user_id, first_name, last_name')\n        .ilike('first_name', firstName.trim())\n        .ilike('last_name', lastName.trim());\n\n      if (profileError) {\n        console.error('Profile lookup error:', profileError);\n        return res.status(500).json({ error: 'Kullanıcı aranırken hata oluştu' });\n      }\n\n      if (!profiles || profiles.length === 0) {\n        return res.status(401).json({ error: 'Kullanıcı bulunamadı veya şifre hatalı' });\n      }\n\n      // If multiple profiles with same name exist, try each one\n      let authenticatedUser = null;\n      let matchedProfile = null;\n\n      for (const profile of profiles) {\n        // Get user's email from auth.users\n        const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.getUserById(profile.user_id);\n        \n        if (authError || !authUser?.user?.email) {\n          continue;\n        }\n\n        // Try to sign in with this email\n        const { data: signInData, error: signInError } = await supabaseAdmin.auth.signInWithPassword({\n          email: authUser.user.email,\n          password: password,\n        });\n\n        if (!signInError && signInData.session) {\n          authenticatedUser = signInData;\n          matchedProfile = profile;\n          break;\n        }\n      }\n\n      if (!authenticatedUser || !authenticatedUser.session) {\n        return res.status(401).json({ error: 'Kullanıcı bulunamadı veya şifre hatalı' });\n      }\n\n      // For now, don't require email - can be enabled later with email_added column\n      // const requiresEmail = !matchedProfile?.email_added;\n\n      res.json({\n        accessToken: authenticatedUser.session.access_token,\n        refreshToken: authenticatedUser.session.refresh_token,\n        requiresEmail: false,\n      });\n    } catch (error: any) {\n      console.error('Login with name error:', error);\n      res.status(500).json({ error: 'Giriş yapılırken bir hata oluştu' });\n    }\n  });\n\n  // ============================================\n  // ADD EMAIL TO PROFILE (first login requirement)\n  // ============================================\n  app.post('/api/auth/add-email', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Sunucu yapılandırma hatası' });\n      }\n\n      const userId = (req as any).userId;\n      const { email } = req.body;\n\n      if (!email) {\n        return res.status(400).json({ error: 'E-posta adresi gereklidir' });\n      }\n\n      // Validate email format\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n      if (!emailRegex.test(email)) {\n        return res.status(400).json({ error: 'Geçerli bir e-posta adresi giriniz' });\n      }\n\n      // Update auth user email\n      const { error: updateAuthError } = await supabaseAdmin.auth.admin.updateUserById(userId, {\n        email: email.toLowerCase().trim(),\n      });\n\n      if (updateAuthError) {\n        console.error('Update auth email error:', updateAuthError);\n        if (updateAuthError.message?.includes('already registered')) {\n          return res.status(400).json({ error: 'Bu e-posta adresi başka bir hesapta kullanılıyor' });\n        }\n        return res.status(400).json({ error: 'E-posta güncellenemedi' });\n      }\n\n      // Mark email as added in profile\n      const { error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .update({ email_added: true })\n        .eq('user_id', userId);\n\n      if (profileError) {\n        console.error('Update profile email_added error:', profileError);\n      }\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Add email error:', error);\n      res.status(500).json({ error: 'E-posta eklenirken bir hata oluştu' });\n    }\n  });\n\n  // Create user manually\n  app.post('/api/admin/users', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const validated = createUserSchema.parse(req.body);\n      \n      const profile = await storage.createUserWithProfile(validated);\n      \n      res.json(profile);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update user profile\n  app.patch('/api/admin/users/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const validated = updateProfileSchema.parse(req.body);\n      \n      const profile = await storage.updateProfile(id, validated);\n      \n      res.json(profile);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete user\n  app.delete('/api/admin/users/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      \n      // First get profile to find user_id\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('user_id')\n        .eq('id', id)\n        .single();\n\n      if (profileError || !profile) {\n        throw new Error('Kullanıcı bulunamadı');\n      }\n\n      await storage.deleteUser(profile.user_id);\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n  \n  // ============================================\n  // FILE UPLOAD\n  // ============================================\n  \n  // Upload profile picture - STRICT validation (2MB, only JPG/PNG)\n  app.post('/api/upload/profile-picture', requireAuth, profilePictureUpload.single('file'), async (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'Dosya seçilmedi' });\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n      const file = req.file;\n      \n      // STRICT server-side validation for security (double-check multer filter)\n      const allowedMimeTypes = ['image/jpeg', 'image/jpg', 'image/png'];\n      const allowedExtensions = ['.jpg', '.jpeg', '.png'];\n      \n      // Validate MIME type\n      if (!allowedMimeTypes.includes(file.mimetype)) {\n        return res.status(400).json({ error: 'Sadece JPG, JPEG ve PNG dosyaları yüklenebilir' });\n      }\n      \n      // Validate file extension\n      const fileExt = file.originalname.split('.').pop()?.toLowerCase();\n      if (!fileExt || !allowedExtensions.includes(`.${fileExt}`)) {\n        return res.status(400).json({ error: 'Geçersiz dosya uzantısı. Sadece .jpg, .jpeg, .png dosyaları kabul edilir' });\n      }\n      \n      // Double-check file size (multer should catch this, but verify)\n      if (file.size > 2 * 1024 * 1024) {\n        return res.status(400).json({ error: 'Dosya boyutu 2MB\\'dan küçük olmalıdır' });\n      }\n      const fileName = `${userId}-${Date.now()}.${fileExt}`;\n      const filePath = `profiles/${fileName}`;\n\n      // Upload to Supabase Storage\n      const { data, error } = await supabaseAdmin.storage\n        .from('ideas-media')\n        .upload(filePath, file.buffer, {\n          contentType: file.mimetype,\n          upsert: false,\n        });\n\n      if (error) {\n        console.error('Supabase storage upload error:', error);\n        throw new Error('Dosya yüklenirken hata oluştu');\n      }\n\n      // Get public URL\n      const { data: { publicUrl } } = supabaseAdmin.storage\n        .from('ideas-media')\n        .getPublicUrl(filePath);\n\n      // Update profile with new picture URL and set status to pending\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (profileError || !profile) {\n        throw new Error('Profil bulunamadı');\n      }\n\n      // Update profile picture with pending status\n      const { error: updateError } = await supabaseAdmin\n        .from('profiles')\n        .update({\n          profile_picture_url: publicUrl,\n          profile_picture_status: 'pending',\n        })\n        .eq('id', profile.id);\n\n      if (updateError) throw updateError;\n\n      // Log profile photo upload\n      await supabaseAdmin.from('profile_photo_logs').insert({\n        user_id: userId,\n        image_url: publicUrl,\n        action: 'upload',\n      });\n\n      res.json({ \n        url: publicUrl,\n        status: 'pending',\n      });\n    } catch (error: any) {\n      console.error('Error uploading profile picture:', error);\n      res.status(400).json({ error: error.message || 'Profil fotoğrafı yüklenirken bir hata oluştu' });\n    }\n  });\n\n  // Upload image, video, or document (PDF, Word, etc.)\n  app.post('/api/upload', requireAuth, upload.single('file'), async (req: Request, res: Response) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: 'Dosya seçilmedi' });\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n      const file = req.file;\n      \n      // Generate unique filename\n      const fileExt = file.originalname.split('.').pop();\n      const fileName = `${userId}-${Date.now()}.${fileExt}`;\n      const filePath = `ideas/${fileName}`;\n\n      // Upload to Supabase Storage\n      const { data, error } = await supabaseAdmin.storage\n        .from('ideas-media')\n        .upload(filePath, file.buffer, {\n          contentType: file.mimetype,\n          upsert: false,\n        });\n\n      if (error) {\n        console.error('Supabase storage upload error:', error);\n        throw new Error('Dosya yüklenirken hata oluştu');\n      }\n\n      // Get public URL\n      const { data: { publicUrl } } = supabaseAdmin.storage\n        .from('ideas-media')\n        .getPublicUrl(filePath);\n\n      // Determine file type for response\n      let fileType: 'image' | 'video' | 'pdf' | 'document' = 'document';\n      if (file.mimetype.startsWith('image/')) {\n        fileType = 'image';\n      } else if (file.mimetype.startsWith('video/')) {\n        fileType = 'video';\n      } else if (file.mimetype === 'application/pdf') {\n        fileType = 'pdf';\n      }\n\n      res.json({ \n        url: publicUrl,\n        type: fileType,\n      });\n    } catch (error: any) {\n      console.error('Error uploading file:', error);\n      res.status(400).json({ error: error.message || 'Dosya yüklenirken bir hata oluştu' });\n    }\n  });\n  \n  // ============================================\n  // IDEAS ROUTES (User)\n  // ============================================\n  \n  // Get approved ideas (public - no auth required)\n  app.get('/api/ideas', async (req: Request, res: Response) => {\n    try {\n      // Extract userId from Authorization header\n      let userId: string | null = null;\n      let userRole: string = 'student';\n      const authHeader = req.headers.authorization;\n      \n      if (authHeader?.startsWith('Bearer ')) {\n        const token = authHeader.substring(7);\n        try {\n          if (supabaseAdmin) {\n            const { data: { user }, error } = await supabaseAdmin.auth.getUser(token);\n            if (!error && user) {\n              userId = user.id;\n              // Get user role\n              const { data: profile } = await supabaseAdmin\n                .from('profiles')\n                .select('role')\n                .eq('user_id', user.id)\n                .single();\n              if (profile) {\n                userRole = profile.role;\n              }\n            }\n          }\n        } catch (e) {\n          // Token validation failed, continue without user\n        }\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const supabase = supabaseAdmin; // Store for closure\n      const isAdmin = userRole === 'admin';\n\n      const { data: ideas, error } = await supabase\n        .from('ideas')\n        .select(`\n          *,\n          author:profiles!ideas_author_id_fkey(first_name, last_name, class_name, profile_picture_url, profile_picture_status),\n          comments:comments!comments_idea_id_fkey(id, content, created_at, status, is_anonymous, author_id, parent_id, author:profiles!comments_author_id_fkey(first_name, last_name, profile_picture_url, profile_picture_status))\n        `)\n        .eq('status', 'approved')\n        .eq('comments.status', 'approved')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      // Check which ideas user has liked and mask anonymous authors for non-admins\n      const ideasWithLikes = await Promise.all(\n        (ideas || []).map(async (idea: any) => {\n          // Mask author if anonymous and user is not admin\n          let processedIdea = { ...idea };\n          if (idea.is_anonymous && !isAdmin) {\n            processedIdea.author = null;\n          }\n          \n          // Mask comment authors if anonymous and user is not admin\n          if (processedIdea.comments) {\n            processedIdea.comments = processedIdea.comments.map((comment: any) => {\n              if (comment.is_anonymous && !isAdmin) {\n                return { ...comment, author: null };\n              }\n              return comment;\n            });\n          }\n\n          if (!userId) {\n            return {\n              ...processedIdea,\n              user_has_liked: false,\n            };\n          }\n\n          const { data: userLike } = await supabase\n            .from('idea_likes')\n            .select('*')\n            .eq('idea_id', idea.id)\n            .eq('user_id', userId)\n            .maybeSingle();\n\n          return {\n            ...processedIdea,\n            user_has_liked: !!userLike,\n          };\n        })\n      );\n\n      res.json(ideasWithLikes);\n    } catch (error: any) {\n      console.error('Error fetching ideas:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Create new idea\n  app.post('/api/ideas', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId; // This is the auth user ID\n      \n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get or create profile and get the profile ID\n      let profileId: string | null = null;\n      \n      const { data: existingProfile, error: profileCheckError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (existingProfile) {\n        profileId = existingProfile.id;\n      } else if (!profileCheckError) {\n        // Auto-create profile for this user\n        console.log('Creating profile for user:', userId);\n        const { data: { user }, error: userError } = await supabaseAdmin.auth.getUser(userId);\n        \n        if (userError) {\n          console.error('Error fetching user:', userError);\n          throw new Error('Kullanıcı bilgisi alınamadı');\n        }\n        \n        const { data: newProfile, error: insertProfileError } = await supabaseAdmin\n          .from('profiles')\n          .insert({\n            user_id: userId,\n            email: user?.email || '',\n            first_name: '',\n            last_name: '',\n            role: 'student',\n          })\n          .select('id')\n          .single();\n\n        if (insertProfileError || !newProfile) {\n          console.error('Error creating profile:', insertProfileError);\n          throw new Error('Profil oluşturulamadı. Lütfen yönetici ile iletişime geçin.');\n        }\n        \n        profileId = newProfile.id;\n        console.log('Profile created successfully with ID:', profileId);\n      } else {\n        throw new Error('Profil bilgisi alınamadı');\n      }\n\n      if (!profileId) {\n        throw new Error('Profil ID bulunamadı');\n      }\n\n      // Validate with the correct author_id (profile ID, not user ID)\n      const validated = insertIdeaSchema.parse({\n        ...req.body,\n        author_id: profileId, // Use profile ID, not user ID!\n      });\n\n      // Insert idea with image_url and video_url support\n      const insertData: any = {\n        title: validated.title,\n        content: validated.content,\n        author_id: profileId, // Use profile ID!\n        status: 'pending',\n        is_anonymous: validated.is_anonymous || false,\n      };\n\n      // Add optional media URLs if provided\n      if (validated.image_url) {\n        insertData.image_url = validated.image_url;\n      }\n      if (validated.video_url) {\n        insertData.video_url = validated.video_url;\n      }\n      if (validated.attachment_url) {\n        insertData.attachment_url = validated.attachment_url;\n      }\n      if (validated.attachment_type) {\n        insertData.attachment_type = validated.attachment_type;\n      }\n\n      const { data: idea, error } = await supabaseAdmin\n        .from('ideas')\n        .insert([insertData])\n        .select()\n        .single();\n\n      if (error) {\n        console.error('Insert error:', error);\n        throw new Error('Fikir oluşturulurken bir hata oluştu');\n      }\n\n      res.json(idea);\n    } catch (error: any) {\n      console.error('Error creating idea:', error);\n      \n      // Handle Zod validation errors with user-friendly messages\n      if (error.name === 'ZodError') {\n        const firstError = error.errors[0];\n        const fieldName = firstError.path[0] === 'content' ? 'İçerik' : \n                          firstError.path[0] === 'title' ? 'Başlık' : firstError.path[0];\n        res.status(400).json({ error: `${fieldName}: ${firstError.message}` });\n      } else {\n        res.status(400).json({ error: error.message || 'Fikir oluşturulurken bir hata oluştu' });\n      }\n    }\n  });\n\n  // Get single idea with comments (public - no auth required)\n  app.get('/api/ideas/:id', async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).userId; // Optional - only set if authenticated\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get idea with author info\n      const { data: idea, error: ideaError } = await supabaseAdmin\n        .from('ideas')\n        .select('*, author:profiles!ideas_author_id_fkey(first_name, last_name, class_name)')\n        .eq('id', id)\n        .single();\n\n      if (ideaError) throw ideaError;\n\n      // Get approved comments\n      const { data: comments, error: commentsError } = await supabaseAdmin\n        .from('comments')\n        .select('*, author:profiles!comments_author_id_fkey(first_name, last_name, class_name)')\n        .eq('idea_id', id)\n        .eq('status', 'approved')\n        .order('created_at', { ascending: true });\n\n      if (commentsError) throw commentsError;\n\n      // Check if user liked this idea (only if authenticated)\n      let userHasLiked = false;\n      if (userId) {\n        const { data: userLike } = await supabaseAdmin\n          .from('idea_likes')\n          .select('*')\n          .eq('idea_id', id)\n          .eq('user_id', userId)\n          .maybeSingle();\n        \n        userHasLiked = !!userLike;\n      }\n\n      res.json({\n        ...idea,\n        comments,\n        user_has_liked: userHasLiked,\n      });\n    } catch (error: any) {\n      console.error('Error fetching idea:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Toggle like on idea\n  app.post('/api/ideas/:id/like', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Check if already liked\n      const { data: existingLike } = await supabaseAdmin\n        .from('idea_likes')\n        .select('*')\n        .eq('idea_id', id)\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      // Get profile ID for logging\n      const profileId = await getProfileId(userId);\n\n      if (existingLike) {\n        // Unlike\n        const { error } = await supabaseAdmin\n          .from('idea_likes')\n          .delete()\n          .eq('idea_id', id)\n          .eq('user_id', userId);\n\n        if (error) throw error;\n\n        // Log unlike activity\n        if (profileId) {\n          await logActivity(profileId, 'LIKE_REMOVED', id, 'idea', 'Beğeni kaldırıldı');\n        }\n\n        res.json({ liked: false });\n      } else {\n        // Like - use upsert to handle race conditions\n        const { error } = await supabaseAdmin\n          .from('idea_likes')\n          .upsert({\n            idea_id: id,\n            user_id: userId,\n          }, {\n            onConflict: 'idea_id,user_id'\n          });\n\n        if (error) throw error;\n\n        // Log like activity\n        if (profileId) {\n          await logActivity(profileId, 'LIKE_ADDED', id, 'idea', 'Fikir beğenildi');\n        }\n\n        res.json({ liked: true });\n      }\n    } catch (error: any) {\n      console.error('Error toggling like:', error);\n      // Ignore duplicate key errors - just return success\n      if (error.code === '23505') {\n        return res.json({ liked: true });\n      }\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get approved comments for an idea (public)\n  app.get('/api/ideas/:id/comments', async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: comments, error } = await supabaseAdmin\n        .from('comments')\n        .select(`\n          *,\n          author:profiles!comments_author_id_fkey(first_name, last_name)\n        `)\n        .eq('idea_id', id)\n        .eq('status', 'approved')\n        .order('created_at', { ascending: true });\n\n      if (error) throw error;\n\n      res.json(comments || []);\n    } catch (error: any) {\n      console.error('Error fetching comments:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Add comment to idea (with optional reply)\n  app.post('/api/ideas/:id/comments', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { content, parent_id, is_anonymous } = req.body;\n      const userId = (req as any).userId; // This is the auth user ID\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID and name from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id, first_name, last_name')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        throw new Error('Profil bulunamadı');\n      }\n\n      const validated = insertCommentSchema.parse({\n        idea_id: id,\n        author_id: profile.id, // Use profile ID instead of auth user ID\n        content: content,\n        is_anonymous: is_anonymous || false,\n      });\n\n      const { data: comment, error } = await supabaseAdmin\n        .from('comments')\n        .insert({\n          ...validated,\n          parent_id: parent_id || null,\n          status: 'pending',\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Log comment creation activity\n      await logActivity(profile.id, 'COMMENT_CREATED', id, 'idea', 'Fikre yorum yapıldı');\n\n      // If this is a reply, create notification for the parent comment author\n      if (parent_id) {\n        const { data: parentComment } = await supabaseAdmin\n          .from('comments')\n          .select('author_id')\n          .eq('id', parent_id)\n          .single();\n\n        if (parentComment && parentComment.author_id !== profile.id) {\n          const replierName = `${profile.first_name || ''} ${profile.last_name || ''}`.trim() || 'Birisi';\n          const shortContent = content.length > 50 ? content.substring(0, 50) + '...' : content;\n          await supabaseAdmin\n            .from('notifications')\n            .insert({\n              user_id: parentComment.author_id,\n              type: 'reply_received',\n              title: 'Yorumunuza Yanıt Geldi!',\n              message: `${replierName} yorumunuza yanıt verdi: \"${shortContent}\"`,\n              link: '/fikirler',\n            });\n        }\n      }\n\n      res.json(comment);\n    } catch (error: any) {\n      console.error('Error adding comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Edit own comment (sets status back to pending for re-approval)\n  app.patch('/api/comments/:id', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { content } = req.body;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      if (!content || content.trim().length === 0) {\n        return res.status(400).json({ error: 'Yorum içeriği boş olamaz' });\n      }\n\n      // Get profile ID from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      // Check if user owns this comment\n      const { data: comment, error: commentError } = await supabaseAdmin\n        .from('comments')\n        .select('author_id')\n        .eq('id', id)\n        .single();\n\n      if (commentError || !comment) {\n        return res.status(404).json({ error: 'Yorum bulunamadı' });\n      }\n\n      if (comment.author_id !== profile.id) {\n        return res.status(403).json({ error: 'Bu yorumu düzenleme yetkiniz yok' });\n      }\n\n      // Update comment and set status back to pending\n      const { data: updatedComment, error } = await supabaseAdmin\n        .from('comments')\n        .update({\n          content: content.trim(),\n          status: 'pending',\n          reviewed_by: null,\n        })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(updatedComment);\n    } catch (error: any) {\n      console.error('Error editing comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete comment (own or admin)\n  app.delete('/api/comments/:id', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID and role from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id, role')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      // Check if user owns this comment or is admin\n      const { data: comment, error: commentError } = await supabaseAdmin\n        .from('comments')\n        .select('author_id')\n        .eq('id', id)\n        .single();\n\n      if (commentError || !comment) {\n        return res.status(404).json({ error: 'Yorum bulunamadı' });\n      }\n\n      const isOwner = comment.author_id === profile.id;\n      const isAdmin = profile.role === 'admin';\n\n      if (!isOwner && !isAdmin) {\n        return res.status(403).json({ error: 'Bu yorumu silme yetkiniz yok' });\n      }\n\n      // Delete the comment\n      const { error } = await supabaseAdmin\n        .from('comments')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error deleting comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // NOTIFICATIONS\n  // ============================================\n\n  // Get user's notifications\n  app.get('/api/notifications', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      const { data: notifications, error } = await supabaseAdmin\n        .from('notifications')\n        .select('*')\n        .eq('user_id', profile.id)\n        .order('created_at', { ascending: false })\n        .limit(50);\n\n      if (error) throw error;\n\n      res.json(notifications || []);\n    } catch (error: any) {\n      console.error('Error fetching notifications:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get unread notification count\n  app.get('/api/notifications/unread-count', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      const { count, error } = await supabaseAdmin\n        .from('notifications')\n        .select('*', { count: 'exact', head: true })\n        .eq('user_id', profile.id)\n        .eq('is_read', false);\n\n      if (error) throw error;\n\n      res.json({ count: count || 0 });\n    } catch (error: any) {\n      console.error('Error fetching unread count:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Mark notification as read\n  app.patch('/api/notifications/:id/read', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      const { error } = await supabaseAdmin\n        .from('notifications')\n        .update({ is_read: true })\n        .eq('id', id)\n        .eq('user_id', profile.id);\n\n      if (error) throw error;\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error marking notification as read:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Mark all notifications as read\n  app.patch('/api/notifications/read-all', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get profile ID from auth user ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n\n      if (profileError || !profile) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      const { error } = await supabaseAdmin\n        .from('notifications')\n        .update({ is_read: true })\n        .eq('user_id', profile.id)\n        .eq('is_read', false);\n\n      if (error) throw error;\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error marking all notifications as read:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // IDEAS ADMIN ROUTES\n  // ============================================\n  \n  // Get all ideas for moderation\n  app.get('/api/admin/ideas', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: ideas, error } = await supabaseAdmin\n        .from('ideas')\n        .select('*, author:profiles!ideas_author_id_fkey(first_name, last_name, class_name)')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(ideas);\n    } catch (error: any) {\n      console.error('Error fetching admin ideas:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get pending comments for moderation\n  app.get('/api/admin/comments', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: comments, error } = await supabaseAdmin\n        .from('comments')\n        .select(`\n          *, \n          author:profiles!comments_author_id_fkey(first_name, last_name, class_name),\n          idea:ideas(title)\n        `)\n        .eq('status', 'pending')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(comments);\n    } catch (error: any) {\n      console.error('Error fetching admin comments:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update idea status\n  app.patch('/api/admin/ideas/:id/status', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { status } = req.body;\n      const userId = (req as any).userId;\n      \n      if (!['approved', 'rejected'].includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get reviewer's profile ID (not user ID!)\n      const reviewerProfileId = await getProfileId(userId);\n      if (!reviewerProfileId) {\n        return res.status(400).json({ error: \"Reviewer profile not found\" });\n      }\n\n      // Get idea info for notification\n      const { data: idea } = await supabaseAdmin\n        .from('ideas')\n        .select('author_id, title')\n        .eq('id', id)\n        .single();\n\n      const { error } = await supabaseAdmin\n        .from('ideas')\n        .update({\n          status,\n          reviewed_by: reviewerProfileId,\n          reviewed_at: new Date().toISOString(),\n        })\n        .eq('id', id);\n\n      if (error) throw error;\n\n      // Create notification for the idea author\n      if (idea?.author_id) {\n        await supabaseAdmin\n          .from('notifications')\n          .insert({\n            user_id: idea.author_id,\n            type: status === 'approved' ? 'idea_approved' : 'idea_rejected',\n            title: status === 'approved' ? 'Fikriniz Onaylandı!' : 'Fikriniz Reddedildi',\n            message: status === 'approved' \n              ? `\"${idea.title}\" başlıklı fikriniz onaylandı ve yayınlandı.`\n              : `\"${idea.title}\" başlıklı fikriniz reddedildi.`,\n            link: status === 'approved' ? '/fikirler' : undefined,\n          });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error updating idea status:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n  \n  // Delete idea\n  app.delete('/api/admin/ideas/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Delete associated comments first (cascade)\n      await supabaseAdmin\n        .from('comments')\n        .delete()\n        .eq('idea_id', id);\n\n      // Delete idea\n      const { error } = await supabaseAdmin\n        .from('ideas')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error deleting idea:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update comment status\n  app.patch('/api/admin/comments/:id/status', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { status } = req.body;\n      const userId = (req as any).userId;\n      \n      if (!['approved', 'rejected'].includes(status)) {\n        return res.status(400).json({ error: \"Invalid status\" });\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get reviewer's profile ID (not user ID!)\n      const reviewerProfileId = await getProfileId(userId);\n      if (!reviewerProfileId) {\n        return res.status(400).json({ error: \"Reviewer profile not found\" });\n      }\n\n      // Get comment info for notification\n      const { data: comment } = await supabaseAdmin\n        .from('comments')\n        .select('author_id, idea_id, content')\n        .eq('id', id)\n        .single();\n\n      const { error } = await supabaseAdmin\n        .from('comments')\n        .update({\n          status,\n          reviewed_by: reviewerProfileId,\n        })\n        .eq('id', id);\n\n      if (error) throw error;\n\n      // Create notification for the comment author\n      if (comment?.author_id) {\n        const shortContent = comment.content.length > 50 \n          ? comment.content.substring(0, 50) + '...' \n          : comment.content;\n        await supabaseAdmin\n          .from('notifications')\n          .insert({\n            user_id: comment.author_id,\n            type: status === 'approved' ? 'comment_approved' : 'comment_rejected',\n            title: status === 'approved' ? 'Yorumunuz Onaylandı!' : 'Yorumunuz Reddedildi',\n            message: status === 'approved' \n              ? `\"${shortContent}\" yorumunuz onaylandı ve yayınlandı.`\n              : `\"${shortContent}\" yorumunuz reddedildi.`,\n            link: status === 'approved' ? '/fikirler' : undefined,\n          });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error updating comment status:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // PROFILE PICTURE ROUTES (Admin)\n  // ============================================\n\n  // Upload/update profile picture (user)\n  app.post('/api/profile/picture', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId;\n      const { profile_picture_url } = req.body;\n\n      if (!profile_picture_url) {\n        return res.status(400).json({ error: 'Profil fotoğrafı URL gerekli' });\n      }\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get user's profile ID\n      const { data: profile, error: profileError } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (profileError || !profile) {\n        throw new Error('Profil bulunamadı');\n      }\n\n      // Update profile picture with pending status\n      const { error } = await supabaseAdmin\n        .from('profiles')\n        .update({\n          profile_picture_url,\n          profile_picture_status: 'pending',\n        })\n        .eq('id', profile.id);\n\n      if (error) throw error;\n\n      // Log profile photo upload\n      await supabaseAdmin.from('profile_photo_logs').insert({\n        user_id: userId,\n        image_url: profile_picture_url,\n        action: 'upload',\n      });\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error updating profile picture:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get pending profile pictures (admin only)\n  app.get('/api/admin/profile-pictures', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data: profiles, error } = await supabaseAdmin\n        .from('profiles')\n        .select('*')\n        .eq('profile_picture_status', 'pending')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      res.json(profiles || []);\n    } catch (error: any) {\n      console.error('Error fetching pending profile pictures:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Approve profile picture (admin only)\n  app.post('/api/admin/profile-pictures/:id/approve', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data, error } = await supabaseAdmin\n        .from('profiles')\n        .update({ profile_picture_status: 'approved' })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error approving profile picture:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Reject profile picture (admin only)\n  app.post('/api/admin/profile-pictures/:id/reject', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const adminUserId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get the profile before update to log the old picture URL\n      const { data: oldProfile } = await supabaseAdmin\n        .from('profiles')\n        .select('user_id, profile_picture_url')\n        .eq('id', id)\n        .single();\n\n      const { data, error } = await supabaseAdmin\n        .from('profiles')\n        .update({ \n          profile_picture_status: 'rejected',\n          profile_picture_url: null,\n        })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Log the profile photo rejection\n      if (oldProfile?.profile_picture_url) {\n        await supabaseAdmin.from('profile_photo_logs').insert({\n          user_id: oldProfile.user_id,\n          image_url: oldProfile.profile_picture_url,\n          action: 'delete',\n        });\n\n        await supabaseAdmin.from('action_logs').insert({\n          user_id: adminUserId,\n          action_type: 'PROFILE_PHOTO_RESET',\n          target_id: id,\n          target_type: 'profile',\n          details: `Admin rejected profile picture`,\n        });\n      }\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error rejecting profile picture:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Reset profile picture (admin only) - force remove any user's profile picture\n  app.post('/api/admin/users/:id/reset-picture', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const adminUserId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get the profile before update\n      const { data: oldProfile } = await supabaseAdmin\n        .from('profiles')\n        .select('user_id, profile_picture_url')\n        .eq('id', id)\n        .single();\n\n      const { data, error } = await supabaseAdmin\n        .from('profiles')\n        .update({ \n          profile_picture_url: null,\n          profile_picture_status: 'approved',\n        })\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Log the action\n      if (oldProfile?.profile_picture_url) {\n        await supabaseAdmin.from('profile_photo_logs').insert({\n          user_id: oldProfile.user_id,\n          image_url: oldProfile.profile_picture_url,\n          action: 'reset',\n        });\n      }\n\n      await supabaseAdmin.from('action_logs').insert({\n        user_id: adminUserId,\n        action_type: 'PROFILE_PHOTO_RESET',\n        target_id: id,\n        target_type: 'profile',\n        details: `Admin reset profile picture`,\n      });\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error resetting profile picture:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Suspend user (admin only)\n  app.post('/api/admin/users/:id/suspend', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const adminUserId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get user_id from profile\n      const { data: profile } = await supabaseAdmin\n        .from('profiles')\n        .select('user_id')\n        .eq('id', id)\n        .single();\n\n      if (!profile) {\n        return res.status(404).json({ error: 'Kullanıcı bulunamadı' });\n      }\n\n      // Ban user in Supabase Auth\n      const { error: banError } = await supabaseAdmin.auth.admin.updateUserById(\n        profile.user_id,\n        { ban_duration: '876000h' } // ~100 years\n      );\n\n      if (banError) throw banError;\n\n      // Log the action\n      await supabaseAdmin.from('action_logs').insert({\n        user_id: adminUserId,\n        action_type: 'USER_SUSPENDED',\n        target_id: id,\n        target_type: 'user',\n        details: `Admin suspended user`,\n      });\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error suspending user:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Activate user (admin only) - remove suspension\n  app.post('/api/admin/users/:id/activate', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const adminUserId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get user_id from profile\n      const { data: profile } = await supabaseAdmin\n        .from('profiles')\n        .select('user_id')\n        .eq('id', id)\n        .single();\n\n      if (!profile) {\n        return res.status(404).json({ error: 'Kullanıcı bulunamadı' });\n      }\n\n      // Unban user in Supabase Auth\n      const { error: unbanError } = await supabaseAdmin.auth.admin.updateUserById(\n        profile.user_id,\n        { ban_duration: 'none' }\n      );\n\n      if (unbanError) throw unbanError;\n\n      // Log the action\n      await supabaseAdmin.from('action_logs').insert({\n        user_id: adminUserId,\n        action_type: 'USER_ACTIVATED',\n        target_id: id,\n        target_type: 'user',\n        details: `Admin activated user`,\n      });\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error activating user:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete comment (admin only)\n  app.delete('/api/admin/comments/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const adminUserId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get comment info before deletion\n      const { data: comment } = await supabaseAdmin\n        .from('comments')\n        .select('author_id, idea_id, content')\n        .eq('id', id)\n        .single();\n\n      // Delete the comment\n      const { error } = await supabaseAdmin\n        .from('comments')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n\n      // Log the action\n      await supabaseAdmin.from('action_logs').insert({\n        user_id: adminUserId,\n        action_type: 'COMMENT_DELETED',\n        target_id: id,\n        target_type: 'comment',\n        details: comment ? `Deleted comment on idea ${comment.idea_id}: \"${comment.content?.substring(0, 100)}...\"` : 'Deleted comment',\n      });\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error deleting comment:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Clear likes for an idea (admin only)\n  app.delete('/api/admin/ideas/:id/likes', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const adminUserId = (req as any).userId;\n\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get count before deletion\n      const { count } = await supabaseAdmin\n        .from('idea_likes')\n        .select('*', { count: 'exact', head: true })\n        .eq('idea_id', id);\n\n      // Delete all likes\n      const { error } = await supabaseAdmin\n        .from('idea_likes')\n        .delete()\n        .eq('idea_id', id);\n\n      if (error) throw error;\n\n      // Update the likes count on idea\n      await supabaseAdmin\n        .from('ideas')\n        .update({ likes_count: 0 })\n        .eq('id', id);\n\n      // Log the action\n      await supabaseAdmin.from('action_logs').insert({\n        user_id: adminUserId,\n        action_type: 'LIKE_REMOVED',\n        target_id: id,\n        target_type: 'idea',\n        details: `Admin cleared ${count || 0} likes from idea`,\n      });\n\n      res.json({ success: true, cleared: count || 0 });\n    } catch (error: any) {\n      console.error('Error clearing likes:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // EVENTS (Etkinlikler) MANAGEMENT\n  // ============================================\n\n  // Get all events (admin only)\n  app.get('/api/admin/events', requireAuth, requireAdmin, async (_req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { data, error } = await supabaseAdmin\n        .from('events')\n        .select('*')\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n      res.json(data || []);\n    } catch (error: any) {\n      console.error('Error fetching events:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Create event (admin only)\n  app.post('/api/admin/events', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n      const profileId = await getProfileId(userId);\n      \n      const validated = insertEventSchema.parse(req.body);\n\n      const { data, error } = await supabaseAdmin\n        .from('events')\n        .insert({\n          name: validated.name,\n          description: validated.description || null,\n          is_active: validated.is_active,\n          event_date: validated.event_date || null,\n          end_date: validated.end_date || null,\n          form_fields: validated.form_fields,\n          created_by: profileId,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error creating event:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Update event (admin only)\n  app.patch('/api/admin/events/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n      const validated = updateEventSchema.parse(req.body);\n\n      const updateData: any = {};\n      if (validated.name !== undefined) updateData.name = validated.name;\n      if (validated.description !== undefined) updateData.description = validated.description;\n      if (validated.is_active !== undefined) updateData.is_active = validated.is_active;\n      if (validated.event_date !== undefined) updateData.event_date = validated.event_date;\n      if (validated.end_date !== undefined) updateData.end_date = validated.end_date;\n      if (validated.form_fields !== undefined) updateData.form_fields = validated.form_fields;\n\n      const { data, error } = await supabaseAdmin\n        .from('events')\n        .update(updateData)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) throw error;\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error updating event:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Delete event (admin only)\n  app.delete('/api/admin/events/:id', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n\n      // First delete all applications for this event\n      await supabaseAdmin\n        .from('event_applications')\n        .delete()\n        .eq('event_id', id);\n\n      // Then delete the event\n      const { error } = await supabaseAdmin\n        .from('events')\n        .delete()\n        .eq('id', id);\n\n      if (error) throw error;\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error deleting event:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get applications for an event (admin only)\n  app.get('/api/admin/events/:id/applications', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n\n      const { data, error } = await supabaseAdmin\n        .from('event_applications')\n        .select(`\n          *,\n          profile:profiles!event_applications_profile_id_fkey(first_name, last_name, class_name, student_no, user_id)\n        `)\n        .eq('event_id', id)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      // Get email addresses from auth.users\n      const applicationsWithEmail = await Promise.all(\n        (data || []).map(async (app: any) => {\n          let email = '';\n          if (app.profile?.user_id) {\n            const { data: userData } = await supabaseAdmin!.auth.admin.getUserById(app.profile.user_id);\n            email = userData?.user?.email || '';\n          }\n          return {\n            ...app,\n            profile: {\n              ...app.profile,\n              email,\n            },\n          };\n        })\n      );\n\n      res.json(applicationsWithEmail);\n    } catch (error: any) {\n      console.error('Error fetching event applications:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // EVENTS - PUBLIC (Öğrenci tarafı)\n  // ============================================\n\n  // Get active events (authenticated users)\n  app.get('/api/events', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n      const profileId = await getProfileId(userId);\n\n      // Get active events\n      const { data: events, error } = await supabaseAdmin\n        .from('events')\n        .select('*')\n        .eq('is_active', true)\n        .order('created_at', { ascending: false });\n\n      if (error) throw error;\n\n      // Check which events the user has already applied to\n      if (profileId && events && events.length > 0) {\n        const { data: applications } = await supabaseAdmin\n          .from('event_applications')\n          .select('event_id')\n          .eq('profile_id', profileId);\n\n        const appliedEventIds = new Set((applications || []).map((a: any) => a.event_id));\n        \n        const eventsWithStatus = events.map((event: any) => ({\n          ...event,\n          has_applied: appliedEventIds.has(event.id),\n        }));\n\n        return res.json(eventsWithStatus);\n      }\n\n      res.json(events || []);\n    } catch (error: any) {\n      console.error('Error fetching events:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get single event details\n  app.get('/api/events/:id', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n      const userId = (req as any).userId;\n      const profileId = await getProfileId(userId);\n\n      const { data: event, error } = await supabaseAdmin\n        .from('events')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      // Check if user has already applied\n      let has_applied = false;\n      if (profileId) {\n        const { data: application } = await supabaseAdmin\n          .from('event_applications')\n          .select('id')\n          .eq('event_id', id)\n          .eq('profile_id', profileId)\n          .maybeSingle();\n        \n        has_applied = !!application;\n      }\n\n      res.json({ ...event, has_applied });\n    } catch (error: any) {\n      console.error('Error fetching event:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Submit application to an event\n  app.post('/api/events/:id/apply', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n      const userId = (req as any).userId;\n      const profileId = await getProfileId(userId);\n\n      if (!profileId) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      // Check if event exists and is active\n      const { data: event, error: eventError } = await supabaseAdmin\n        .from('events')\n        .select('*')\n        .eq('id', id)\n        .single();\n\n      if (eventError || !event) {\n        return res.status(404).json({ error: 'Etkinlik bulunamadı' });\n      }\n\n      if (!event.is_active) {\n        return res.status(400).json({ error: 'Bu etkinlik artık başvuruya kapalı' });\n      }\n\n      // Check if user has already applied\n      const { data: existingApp } = await supabaseAdmin\n        .from('event_applications')\n        .select('id')\n        .eq('event_id', id)\n        .eq('profile_id', profileId)\n        .maybeSingle();\n\n      if (existingApp) {\n        return res.status(409).json({ error: 'Bu etkinliğe zaten başvurdunuz' });\n      }\n\n      // Validate responses against form fields\n      const { responses } = req.body;\n      const formFields = event.form_fields as any[];\n      \n      for (const field of formFields) {\n        if (field.required && (!responses || !responses[field.id] || responses[field.id].trim() === '')) {\n          return res.status(400).json({ error: `${field.label} alanı zorunludur` });\n        }\n      }\n\n      // Create application\n      const { data, error } = await supabaseAdmin\n        .from('event_applications')\n        .insert({\n          event_id: id,\n          profile_id: profileId,\n          responses: responses || {},\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error submitting application:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // SECURE PUBLIC API ENDPOINTS (Authenticated Users)\n  // These replace direct Supabase access from frontend\n  // ============================================\n\n  // GET /api/polls - Get all polls (authenticated users only)\n  app.get('/api/polls', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get all polls with options\n      const { data: polls, error: pollsError } = await supabaseAdmin\n        .from('polls')\n        .select(`\n          *,\n          options:poll_options(\n            id,\n            poll_id,\n            option_text\n          )\n        `)\n        .order('created_at', { ascending: false });\n\n      if (pollsError) throw pollsError;\n\n      // Calculate vote counts for each option\n      const pollsWithVotes = await Promise.all(\n        polls.map(async (poll) => {\n          const optionsWithVotes = await Promise.all(\n            poll.options.map(async (option: any) => {\n              const { count } = await supabaseAdmin!\n                .from('poll_votes')\n                .select('*', { count: 'exact', head: true })\n                .eq('option_id', option.id);\n\n              return {\n                ...option,\n                vote_count: count || 0,\n              };\n            })\n          );\n\n          return {\n            ...poll,\n            options: optionsWithVotes,\n          };\n        })\n      );\n\n      res.json(pollsWithVotes);\n    } catch (error: any) {\n      console.error('Error fetching polls:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // GET /api/polls/:id - Get single poll (authenticated users only)\n  app.get('/api/polls/:id', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n\n      const { data: poll, error } = await supabaseAdmin\n        .from('polls')\n        .select(`\n          *,\n          options:poll_options(\n            id,\n            poll_id,\n            option_text\n          )\n        `)\n        .eq('id', id)\n        .single();\n\n      if (error) throw error;\n\n      // Calculate vote counts for each option\n      const optionsWithVotes = await Promise.all(\n        poll.options.map(async (option: any) => {\n          const { count } = await supabaseAdmin!\n            .from('poll_votes')\n            .select('*', { count: 'exact', head: true })\n            .eq('option_id', option.id);\n\n          return {\n            ...option,\n            vote_count: count || 0,\n          };\n        })\n      );\n\n      res.json({\n        ...poll,\n        options: optionsWithVotes,\n      });\n    } catch (error: any) {\n      console.error('Error fetching poll:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // GET /api/polls/:id/my-vote - Get user's vote for a poll\n  app.get('/api/polls/:id/my-vote', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n      const userId = (req as any).userId;\n\n      const { data, error } = await supabaseAdmin\n        .from('poll_votes')\n        .select('*')\n        .eq('poll_id', id)\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error fetching user vote:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // POST /api/polls/:id/vote - Vote on a poll (authenticated users only)\n  app.post('/api/polls/:id/vote', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id: pollId } = req.params;\n      const { option_id: optionId } = req.body;\n      const userId = (req as any).userId;\n\n      if (!optionId) {\n        return res.status(400).json({ error: 'option_id gerekli' });\n      }\n\n      // Check if poll exists and is open\n      const { data: poll, error: pollError } = await supabaseAdmin\n        .from('polls')\n        .select('is_open, results_published')\n        .eq('id', pollId)\n        .single();\n\n      if (pollError) throw pollError;\n\n      if (!poll.is_open) {\n        return res.status(400).json({ error: 'Bu oylama kapatılmıştır' });\n      }\n\n      if (poll.results_published) {\n        return res.status(400).json({ error: 'Sonuçlar yayınlandı, artık oy veremezsiniz' });\n      }\n\n      // Verify option belongs to this poll\n      const { data: option, error: optionError } = await supabaseAdmin\n        .from('poll_options')\n        .select('id')\n        .eq('id', optionId)\n        .eq('poll_id', pollId)\n        .single();\n\n      if (optionError || !option) {\n        return res.status(400).json({ error: 'Geçersiz seçenek' });\n      }\n\n      // Check if user has existing vote\n      const { data: existingVote } = await supabaseAdmin\n        .from('poll_votes')\n        .select('option_id')\n        .eq('poll_id', pollId)\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      const isVoteChange = !!existingVote;\n\n      // Upsert vote (allows changing vote)\n      const { data, error } = await supabaseAdmin\n        .from('poll_votes')\n        .upsert(\n          { poll_id: pollId, option_id: optionId, user_id: userId },\n          { onConflict: 'poll_id,user_id' }\n        )\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      // Log the activity\n      const profileId = await getProfileId(userId);\n      if (profileId) {\n        await logActivity(\n          profileId, \n          isVoteChange ? 'VOTE_CHANGED' : 'VOTE_CAST', \n          pollId, \n          'poll',\n          `Oy kullanıldı`\n        );\n      }\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error voting on poll:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // GET /api/profiles - Get profiles (authenticated, role-based filtering)\n  app.get('/api/profiles', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n      const { className } = req.query;\n\n      // Get user's role\n      const role = await getUserRole(userId);\n\n      let query = supabaseAdmin\n        .from('profiles')\n        .select('id, first_name, last_name, class_name, student_no, role, gender, profile_picture_url');\n\n      // Role-based filtering: students can only see limited info\n      // Teachers and admins can see all profiles\n      if (role === 'student') {\n        // Students can only see their own class\n        const profileId = await getProfileId(userId);\n        if (profileId) {\n          const { data: ownProfile } = await supabaseAdmin\n            .from('profiles')\n            .select('class_name')\n            .eq('id', profileId)\n            .single();\n          \n          if (ownProfile?.class_name) {\n            query = query.eq('class_name', ownProfile.class_name);\n          }\n        }\n      } else if (className && className !== 'Tümü') {\n        // Admins/teachers can filter by class\n        query = query.eq('class_name', className);\n      }\n\n      query = query\n        .order('class_name', { ascending: true })\n        .order('student_no', { ascending: true });\n\n      const { data: profiles, error } = await query;\n\n      if (error) throw error;\n\n      res.json(profiles);\n    } catch (error: any) {\n      console.error('Error fetching profiles:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // GET /api/profiles/me - Get current user's profile\n  app.get('/api/profiles/me', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n\n      const { data, error } = await supabaseAdmin\n        .from('profiles')\n        .select('*')\n        .eq('user_id', userId)\n        .single();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error fetching own profile:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // PATCH /api/profiles/me - Update current user's profile (only own profile)\n  app.patch('/api/profiles/me', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n      \n      // Validate input - only allow certain fields to be updated\n      const allowedFields = ['first_name', 'last_name', 'gender'];\n      const updates: Record<string, any> = {};\n      \n      for (const field of allowedFields) {\n        if (req.body[field] !== undefined) {\n          updates[field] = req.body[field];\n        }\n      }\n\n      if (Object.keys(updates).length === 0) {\n        return res.status(400).json({ error: 'Güncellenecek alan bulunamadı' });\n      }\n\n      const { data, error } = await supabaseAdmin\n        .from('profiles')\n        .update(updates)\n        .eq('user_id', userId)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error updating profile:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // POST /api/profiles/accept-terms - Record terms acceptance timestamp\n  app.post('/api/profiles/accept-terms', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const userId = (req as any).userId;\n\n      const { data, error } = await supabaseAdmin\n        .from('profiles')\n        .update({ accepted_terms_at: new Date().toISOString() })\n        .eq('user_id', userId)\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error accepting terms:', error);\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get user's own application for an event\n  app.get('/api/events/:id/my-application', requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      const { id } = req.params;\n      const userId = (req as any).userId;\n      const profileId = await getProfileId(userId);\n\n      if (!profileId) {\n        return res.status(400).json({ error: 'Profil bulunamadı' });\n      }\n\n      const { data, error } = await supabaseAdmin\n        .from('event_applications')\n        .select('*')\n        .eq('event_id', id)\n        .eq('profile_id', profileId)\n        .maybeSingle();\n\n      if (error) throw error;\n\n      res.json(data);\n    } catch (error: any) {\n      console.error('Error fetching application:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // GET /api/admin/analytics - Get comprehensive analytics data\n  app.get('/api/admin/analytics', requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(500).json({ error: 'Supabase not configured' });\n      }\n\n      // Get poll statistics\n      const { data: polls } = await supabaseAdmin\n        .from('polls')\n        .select('id, question, is_open, results_published, created_at');\n\n      const { data: pollVotes } = await supabaseAdmin\n        .from('poll_votes')\n        .select('id, poll_id, option_id, user_id, created_at');\n\n      const { data: pollOptions } = await supabaseAdmin\n        .from('poll_options')\n        .select('id, poll_id, option_text');\n\n      // Get user statistics\n      const { data: profiles } = await supabaseAdmin\n        .from('profiles')\n        .select('id, role, class_name, created_at');\n\n      // Get idea statistics\n      const { data: ideas } = await supabaseAdmin\n        .from('ideas')\n        .select('id, status, created_at');\n\n      // Get announcement statistics\n      const { data: announcements } = await supabaseAdmin\n        .from('announcements')\n        .select('id, created_at');\n\n      const { data: announcementComments } = await supabaseAdmin\n        .from('announcement_comments')\n        .select('id, status, created_at');\n\n      // Get event statistics\n      const { data: events } = await supabaseAdmin\n        .from('events')\n        .select('id, name, is_active, created_at');\n\n      const { data: eventApplications } = await supabaseAdmin\n        .from('event_applications')\n        .select('id, event_id, created_at');\n\n      // Calculate poll participation metrics\n      const totalPolls = polls?.length || 0;\n      const activePolls = polls?.filter(p => p.is_open)?.length || 0;\n      const closedPolls = polls?.filter(p => !p.is_open)?.length || 0;\n      const totalVotes = pollVotes?.length || 0;\n      \n      // Unique voters\n      const uniqueVoters = new Set(pollVotes?.map(v => v.user_id)).size;\n      \n      // Total possible voters (all users who could vote)\n      const totalUsers = profiles?.length || 0;\n      const studentCount = profiles?.filter(p => p.role === 'student')?.length || 0;\n      const teacherCount = profiles?.filter(p => p.role === 'teacher')?.length || 0;\n      const adminCount = profiles?.filter(p => p.role === 'admin')?.length || 0;\n      \n      // Participation rate\n      const participationRate = totalUsers > 0 ? (uniqueVoters / totalUsers) * 100 : 0;\n\n      // Poll-specific breakdown\n      const pollBreakdown = (polls || []).map(poll => {\n        const options = pollOptions?.filter(o => o.poll_id === poll.id) || [];\n        const votes = pollVotes?.filter(v => v.poll_id === poll.id) || [];\n        const uniquePollVoters = new Set(votes.map(v => v.user_id)).size;\n        \n        const optionBreakdown = options.map(opt => ({\n          id: opt.id,\n          text: opt.option_text,\n          votes: votes.filter(v => v.option_id === opt.id).length,\n        }));\n\n        return {\n          id: poll.id,\n          question: poll.question,\n          isOpen: poll.is_open,\n          resultsPublished: poll.results_published,\n          createdAt: poll.created_at,\n          totalVotes: votes.length,\n          uniqueVoters: uniquePollVoters,\n          participationRate: totalUsers > 0 ? (uniquePollVoters / totalUsers) * 100 : 0,\n          options: optionBreakdown,\n        };\n      });\n\n      // Ideas statistics\n      const totalIdeas = ideas?.length || 0;\n      const approvedIdeas = ideas?.filter(i => i.status === 'approved')?.length || 0;\n      const pendingIdeas = ideas?.filter(i => i.status === 'pending')?.length || 0;\n      const rejectedIdeas = ideas?.filter(i => i.status === 'rejected')?.length || 0;\n\n      // Engagement metrics\n      const totalAnnouncements = announcements?.length || 0;\n      const totalComments = announcementComments?.length || 0;\n      const approvedComments = announcementComments?.filter(c => c.status === 'approved')?.length || 0;\n\n      // Event metrics\n      const totalEvents = events?.length || 0;\n      const activeEvents = events?.filter(e => e.is_active)?.length || 0;\n      const totalApplications = eventApplications?.length || 0;\n\n      // Class distribution\n      const classDistribution: Record<string, number> = {};\n      profiles?.forEach(p => {\n        if (p.class_name) {\n          classDistribution[p.class_name] = (classDistribution[p.class_name] || 0) + 1;\n        }\n      });\n\n      // Votes by class\n      const votesByClass: Record<string, number> = {};\n      for (const vote of pollVotes || []) {\n        const voterProfile = profiles?.find(p => p.id === vote.user_id);\n        if (voterProfile?.class_name) {\n          votesByClass[voterProfile.class_name] = (votesByClass[voterProfile.class_name] || 0) + 1;\n        }\n      }\n\n      res.json({\n        overview: {\n          totalUsers,\n          studentCount,\n          teacherCount,\n          adminCount,\n          totalPolls,\n          activePolls,\n          closedPolls,\n          totalVotes,\n          uniqueVoters,\n          participationRate: Math.round(participationRate * 10) / 10,\n          totalIdeas,\n          approvedIdeas,\n          pendingIdeas,\n          rejectedIdeas,\n          totalAnnouncements,\n          totalComments,\n          approvedComments,\n          totalEvents,\n          activeEvents,\n          totalApplications,\n        },\n        polls: pollBreakdown,\n        classDistribution,\n        votesByClass,\n      });\n    } catch (error: any) {\n      console.error('Error fetching analytics:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ============================================\n  // ACTIVITY LOGS\n  // ============================================\n\n  // Get current user's activity log\n  app.get(\"/api/activity-log\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const offset = parseInt(req.query.offset as string) || 0;\n      \n      if (!supabaseAdmin) {\n        return res.status(503).json({ error: \"Service unavailable\" });\n      }\n      \n      // Get profile ID from user ID\n      const { data: profile } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n      \n      if (!profile) {\n        return res.status(404).json({ error: \"Profile not found\" });\n      }\n      \n      const { data: logs, error } = await supabaseAdmin\n        .from('action_logs')\n        .select('*')\n        .eq('user_id', profile.id)\n        .order('created_at', { ascending: false })\n        .range(offset, offset + limit - 1);\n      \n      if (error) throw error;\n      \n      // Get total count\n      const { count } = await supabaseAdmin\n        .from('action_logs')\n        .select('*', { count: 'exact', head: true })\n        .eq('user_id', profile.id);\n      \n      res.json({\n        logs: logs || [],\n        total: count || 0,\n        limit,\n        offset,\n      });\n    } catch (error: any) {\n      console.error('Error fetching activity log:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Get all activity logs or specific user's logs\n  app.get(\"/api/admin/activity-logs\", requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      const limit = parseInt(req.query.limit as string) || 100;\n      const offset = parseInt(req.query.offset as string) || 0;\n      const profileId = req.query.profileId as string;\n      const actionType = req.query.actionType as string;\n      \n      if (!supabaseAdmin) {\n        return res.status(503).json({ error: \"Service unavailable\" });\n      }\n      \n      let query = supabaseAdmin\n        .from('action_logs')\n        .select('*')\n        .order('created_at', { ascending: false });\n      \n      if (profileId) {\n        query = query.eq('user_id', profileId);\n      }\n      \n      if (actionType) {\n        query = query.eq('action_type', actionType);\n      }\n      \n      const { data: logs, error } = await query.range(offset, offset + limit - 1);\n      \n      if (error) throw error;\n      \n      // Get profiles for the logs\n      const userIds = Array.from(new Set((logs || []).map(log => log.user_id)));\n      \n      const { data: profiles } = await supabaseAdmin\n        .from('profiles')\n        .select('id, first_name, last_name, class_name')\n        .in('id', userIds);\n      \n      const profileMap = new Map(profiles?.map(p => [p.id, p]) || []);\n      \n      const logsWithProfiles = (logs || []).map(log => ({\n        ...log,\n        profile: profileMap.get(log.user_id) || null,\n      }));\n      \n      // Get total count\n      let countQuery = supabaseAdmin\n        .from('action_logs')\n        .select('*', { count: 'exact', head: true });\n      \n      if (profileId) {\n        countQuery = countQuery.eq('user_id', profileId);\n      }\n      \n      if (actionType) {\n        countQuery = countQuery.eq('action_type', actionType);\n      }\n      \n      const { count } = await countQuery;\n      \n      res.json({\n        logs: logsWithProfiles,\n        total: count || 0,\n        limit,\n        offset,\n      });\n    } catch (error: any) {\n      console.error('Error fetching admin activity logs:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Admin: Get activity log statistics\n  app.get(\"/api/admin/activity-stats\", requireAuth, requireAdmin, async (req: Request, res: Response) => {\n    try {\n      if (!supabaseAdmin) {\n        return res.status(503).json({ error: \"Service unavailable\" });\n      }\n      \n      // Get logs from last 30 days\n      const thirtyDaysAgo = new Date();\n      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n      \n      const { data: logs, error } = await supabaseAdmin\n        .from('action_logs')\n        .select('action_type, created_at')\n        .gte('created_at', thirtyDaysAgo.toISOString());\n      \n      if (error) throw error;\n      \n      // Count by action type\n      const actionCounts: Record<string, number> = {};\n      (logs || []).forEach(log => {\n        actionCounts[log.action_type] = (actionCounts[log.action_type] || 0) + 1;\n      });\n      \n      // Count by day (last 7 days)\n      const dailyCounts: Record<string, number> = {};\n      const sevenDaysAgo = new Date();\n      sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n      \n      (logs || []).filter(log => new Date(log.created_at) >= sevenDaysAgo).forEach(log => {\n        const date = new Date(log.created_at).toISOString().split('T')[0];\n        dailyCounts[date] = (dailyCounts[date] || 0) + 1;\n      });\n      \n      res.json({\n        actionCounts,\n        dailyCounts,\n        totalLogs: logs?.length || 0,\n      });\n    } catch (error: any) {\n      console.error('Error fetching activity stats:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Log user login (called from frontend after successful auth)\n  app.post(\"/api/activity-log/login\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = (req as any).userId;\n      \n      if (!supabaseAdmin) {\n        return res.status(503).json({ error: \"Service unavailable\" });\n      }\n      \n      // Get profile ID\n      const { data: profile } = await supabaseAdmin\n        .from('profiles')\n        .select('id')\n        .eq('user_id', userId)\n        .single();\n      \n      if (profile) {\n        await logActivity(profile.id, 'LOGIN', undefined, undefined, 'User logged in');\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      console.error('Error logging login:', error);\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":122303,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE BASE - Default and Maya light theme */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 0 0% 9%;\n  --border: 0 0% 90%;\n  --card: 0 0% 98%;\n  --card-foreground: 0 0% 9%;\n  --card-border: 0 0% 94%;\n  --sidebar: 0 0% 96%;\n  --sidebar-foreground: 0 0% 9%;\n  --sidebar-border: 0 0% 92%;\n  --sidebar-primary: 280 69% 36%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 280 8% 90%;\n  --sidebar-accent-foreground: 0 0% 9%;\n  --sidebar-ring: 280 69% 36%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 9%;\n  --popover-border: 0 0% 90%;\n  --primary: 280 69% 36%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 0 0% 92%;\n  --secondary-foreground: 0 0% 9%;\n  --muted: 263 6% 91%;\n  --muted-foreground: 0 0% 40%;\n  --accent: 263 12% 92%;\n  --accent-foreground: 0 0% 9%;\n  --destructive: 0 72% 45%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 0 0% 75%;\n  --ring: 263 70% 50%;\n  --chart-1: 263 70% 45%;\n  --chart-2: 220 70% 45%;\n  --chart-3: 173 58% 35%;\n  --chart-4: 30 80% 45%;\n  --chart-5: 340 75% 45%;\n  --font-sans: Inter, IBM Plex Sans, system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n/* DARK MODE BASE - Default and Maya dark theme */\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 260 6% 8%;\n  --foreground: 0 0% 95%;\n  --border: 260 5% 18%;\n  --card: 260 6% 10%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 260 5% 13%;\n  --sidebar: 260 6% 12%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 260 5% 16%;\n  --sidebar-primary: 280 69% 36%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 280 15% 18%;\n  --sidebar-accent-foreground: 0 0% 95%;\n  --sidebar-ring: 280 69% 36%;\n  --popover: 260 6% 14%;\n  --popover-foreground: 0 0% 95%;\n  --popover-border: 260 5% 18%;\n  --primary: 280 69% 36%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 260 6% 16%;\n  --secondary-foreground: 0 0% 95%;\n  --muted: 263 8% 16%;\n  --muted-foreground: 0 0% 65%;\n  --accent: 263 10% 15%;\n  --accent-foreground: 0 0% 95%;\n  --destructive: 0 72% 45%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 260 5% 30%;\n  --ring: 263 70% 55%;\n  --chart-1: 263 70% 65%;\n  --chart-2: 220 70% 65%;\n  --chart-3: 173 58% 55%;\n  --chart-4: 30 80% 60%;\n  --chart-5: 340 75% 60%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n\n/* ========================================\n   FRAMER-INSPIRED THEME\n   Modern, glassmorphism, gradients\n   ======================================== */\n\n/* Framer Theme - Light Mode */\n.theme-framer.light {\n  --button-outline: rgba(0,0,0, .08);\n  --badge-outline: rgba(0,0,0, .04);\n  --opaque-button-border-intensity: -6;\n  --elevate-1: rgba(0,0,0, .02);\n  --elevate-2: rgba(0,0,0, .06);\n  --background: 0 0% 98%;\n  --foreground: 220 15% 15%;\n  --border: 220 10% 88%;\n  --card: 0 0% 100%;\n  --card-foreground: 220 15% 15%;\n  --card-border: 220 10% 92%;\n  --sidebar: 220 15% 96%;\n  --sidebar-foreground: 220 15% 15%;\n  --sidebar-border: 220 10% 90%;\n  --sidebar-primary: 220 90% 56%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 20% 92%;\n  --sidebar-accent-foreground: 220 15% 15%;\n  --sidebar-ring: 220 90% 56%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 220 15% 15%;\n  --popover-border: 220 10% 90%;\n  --primary: 220 90% 56%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 220 15% 94%;\n  --secondary-foreground: 220 15% 25%;\n  --muted: 220 10% 92%;\n  --muted-foreground: 220 10% 45%;\n  --accent: 270 80% 60%;\n  --accent-foreground: 0 0% 100%;\n  --destructive: 0 72% 50%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 220 10% 80%;\n  --ring: 220 90% 56%;\n  --chart-1: 220 90% 56%;\n  --chart-2: 270 80% 60%;\n  --chart-3: 160 70% 45%;\n  --chart-4: 40 90% 55%;\n  --chart-5: 340 80% 55%;\n\n  --glass-bg: rgba(255, 255, 255, 0.7);\n  --glass-border: rgba(255, 255, 255, 0.3);\n  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n  --gradient-primary: linear-gradient(135deg, hsl(220 90% 56%) 0%, hsl(270 80% 60%) 100%);\n  --gradient-accent: linear-gradient(135deg, hsl(270 80% 60%) 0%, hsl(340 80% 55%) 100%);\n  --gradient-surface: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);\n}\n\n/* Framer Theme - Dark Mode */\n.theme-framer.dark {\n  --button-outline: rgba(255,255,255, .12);\n  --badge-outline: rgba(255,255,255, .06);\n  --opaque-button-border-intensity: 10;\n  --elevate-1: rgba(255,255,255, .05);\n  --elevate-2: rgba(255,255,255, .10);\n  --background: 225 15% 6%;\n  --foreground: 0 0% 98%;\n  --border: 225 10% 16%;\n  --card: 225 15% 8%;\n  --card-foreground: 0 0% 98%;\n  --card-border: 225 10% 12%;\n  --sidebar: 225 15% 7%;\n  --sidebar-foreground: 0 0% 98%;\n  --sidebar-border: 225 10% 14%;\n  --sidebar-primary: 220 90% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 225 15% 14%;\n  --sidebar-accent-foreground: 0 0% 98%;\n  --sidebar-ring: 220 90% 60%;\n  --popover: 225 15% 10%;\n  --popover-foreground: 0 0% 98%;\n  --popover-border: 225 10% 16%;\n  --primary: 220 90% 60%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 225 15% 14%;\n  --secondary-foreground: 0 0% 95%;\n  --muted: 225 10% 18%;\n  --muted-foreground: 225 10% 60%;\n  --accent: 270 80% 65%;\n  --accent-foreground: 0 0% 100%;\n  --destructive: 0 72% 55%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 225 10% 25%;\n  --ring: 220 90% 60%;\n  --chart-1: 220 90% 65%;\n  --chart-2: 270 80% 70%;\n  --chart-3: 160 70% 55%;\n  --chart-4: 40 90% 60%;\n  --chart-5: 340 80% 60%;\n\n  --glass-bg: rgba(30, 35, 50, 0.7);\n  --glass-border: rgba(255, 255, 255, 0.08);\n  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n  --gradient-primary: linear-gradient(135deg, hsl(220 90% 60%) 0%, hsl(270 80% 65%) 100%);\n  --gradient-accent: linear-gradient(135deg, hsl(270 80% 65%) 0%, hsl(340 80% 60%) 100%);\n  --gradient-surface: linear-gradient(180deg, rgba(30, 35, 50, 0.9) 0%, rgba(20, 25, 40, 0.7) 100%);\n}\n\n/* Glassmorphism utility classes */\n@layer utilities {\n  .glass {\n    background: var(--glass-bg, rgba(255, 255, 255, 0.7));\n    backdrop-filter: blur(12px);\n    -webkit-backdrop-filter: blur(12px);\n    border: 1px solid var(--glass-border, rgba(255, 255, 255, 0.3));\n    box-shadow: var(--glass-shadow, 0 8px 32px rgba(0, 0, 0, 0.1));\n  }\n\n  .glass-subtle {\n    background: var(--glass-bg, rgba(255, 255, 255, 0.5));\n    backdrop-filter: blur(8px);\n    -webkit-backdrop-filter: blur(8px);\n  }\n\n  .gradient-text {\n    background: var(--gradient-primary);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n  }\n\n  .gradient-border {\n    position: relative;\n    background: hsl(var(--card));\n    border-radius: var(--radius);\n  }\n\n  .gradient-border::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    padding: 1px;\n    border-radius: inherit;\n    background: var(--gradient-primary);\n    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    -webkit-mask-composite: xor;\n    mask-composite: exclude;\n    pointer-events: none;\n  }\n\n  .animate-float {\n    animation: float 6s ease-in-out infinite;\n  }\n\n  .animate-glow {\n    animation: glow 2s ease-in-out infinite alternate;\n  }\n\n  .animate-gradient {\n    background-size: 200% 200%;\n    animation: gradient-shift 8s ease infinite;\n  }\n}\n\n@keyframes float {\n  0%, 100% { transform: translateY(0); }\n  50% { transform: translateY(-10px); }\n}\n\n@keyframes glow {\n  from { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }\n  to { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5); }\n}\n\n@keyframes gradient-shift {\n  0% { background-position: 0% 50%; }\n  50% { background-position: 100% 50%; }\n  100% { background-position: 0% 50%; }\n}\n\n/* Framer theme - Enhanced component styling */\n.theme-framer [data-slot=\"card\"],\n.theme-framer .card-glass {\n  background: var(--glass-bg);\n  backdrop-filter: blur(12px);\n  -webkit-backdrop-filter: blur(12px);\n  border: 1px solid var(--glass-border);\n  box-shadow: var(--glass-shadow);\n  transition: all 0.3s ease;\n}\n\n.theme-framer [data-slot=\"card\"]:hover,\n.theme-framer .card-glass:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);\n}\n\n.theme-framer.dark [data-slot=\"card\"]:hover,\n.theme-framer.dark .card-glass:hover {\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);\n}\n\n/* Framer theme - Main Header styling (only sticky top header) */\n.theme-framer header.sticky {\n  background: var(--glass-bg) !important;\n  backdrop-filter: blur(16px);\n  -webkit-backdrop-filter: blur(16px);\n}\n\n/* Framer theme - Button gradient styling */\n.theme-framer [data-slot=\"button\"][data-variant=\"default\"] {\n  background: var(--gradient-primary);\n  border: none;\n  transition: all 0.3s ease;\n}\n\n.theme-framer [data-slot=\"button\"][data-variant=\"default\"]:hover {\n  opacity: 0.9;\n  transform: translateY(-1px);\n}\n\n/* Framer theme - Input styling */\n.theme-framer input,\n.theme-framer textarea,\n.theme-framer select {\n  background: var(--glass-bg);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  border-color: var(--glass-border);\n  transition: all 0.2s ease;\n}\n\n.theme-framer input:focus,\n.theme-framer textarea:focus,\n.theme-framer select:focus {\n  border-color: hsl(var(--primary));\n  box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);\n}\n\n/* Framer theme - Badge styling */\n.theme-framer [data-slot=\"badge\"] {\n  background: var(--glass-bg);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n}\n\n/* Framer theme - Dialog/Modal styling */\n.theme-framer [data-slot=\"dialog-content\"] {\n  background: var(--glass-bg);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  border: 1px solid var(--glass-border);\n}\n\n/* Smooth transitions for theme switching */\n* {\n  transition-property: background-color, border-color, color;\n  transition-duration: 0.2s;\n  transition-timing-function: ease;\n}\n\n/* =========================================\n   INTERACTIVE HOVER ANIMATIONS\n   ========================================= */\n\n/* Icon hover animations */\n.icon-hover-spin {\n  transition: transform 0.3s ease;\n}\n.icon-hover-spin:hover {\n  transform: rotate(180deg);\n}\n\n.icon-hover-bounce {\n  transition: transform 0.2s ease;\n}\n.icon-hover-bounce:hover {\n  animation: bounce 0.5s ease;\n}\n\n.icon-hover-shake {\n  transition: transform 0.2s ease;\n}\n.icon-hover-shake:hover {\n  animation: shake 0.4s ease;\n}\n\n.icon-hover-pulse {\n  transition: transform 0.2s ease;\n}\n.icon-hover-pulse:hover {\n  animation: pulse 0.6s ease;\n}\n\n/* Card interactive effects */\n.card-hover-lift {\n  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;\n}\n.card-hover-lift:hover {\n  transform: translateY(-8px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n}\n.dark .card-hover-lift:hover {\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);\n}\n\n.card-hover-scale {\n  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n.card-hover-scale:hover {\n  transform: scale(1.02);\n}\n\n.card-hover-tilt {\n  transition: transform 0.3s ease;\n  transform-style: preserve-3d;\n  perspective: 1000px;\n}\n.card-hover-tilt:hover {\n  transform: rotateX(-2deg) rotateY(2deg) translateY(-4px);\n}\n\n.card-hover-glow {\n  transition: box-shadow 0.3s ease, transform 0.3s ease;\n}\n.card-hover-glow:hover {\n  box-shadow: 0 0 30px hsl(var(--primary) / 0.3);\n  transform: translateY(-4px);\n}\n\n/* Button interactive effects */\n.btn-hover-scale {\n  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n.btn-hover-scale:hover {\n  transform: scale(1.05);\n}\n.btn-hover-scale:active {\n  transform: scale(0.98);\n}\n\n.btn-hover-glow {\n  transition: box-shadow 0.3s ease, transform 0.2s ease;\n}\n.btn-hover-glow:hover {\n  box-shadow: 0 0 20px hsl(var(--primary) / 0.5);\n  transform: translateY(-2px);\n}\n\n.btn-hover-ripple {\n  position: relative;\n  overflow: hidden;\n}\n.btn-hover-ripple::after {\n  content: \"\";\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 60%);\n  transform: scale(0);\n  opacity: 0;\n  transition: transform 0.5s ease, opacity 0.3s ease;\n}\n.btn-hover-ripple:hover::after {\n  transform: scale(2);\n  opacity: 1;\n}\n\n/* List item hover effects */\n.list-item-hover {\n  transition: transform 0.2s ease, background-color 0.2s ease, padding-left 0.2s ease;\n}\n.list-item-hover:hover {\n  transform: translateX(8px);\n  background-color: hsl(var(--accent) / 0.5);\n}\n\n.list-item-hover-border {\n  position: relative;\n  transition: padding-left 0.2s ease;\n}\n.list-item-hover-border::before {\n  content: \"\";\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translateY(-50%) scaleY(0);\n  width: 3px;\n  height: 60%;\n  background: hsl(var(--primary));\n  border-radius: 2px;\n  transition: transform 0.2s ease;\n}\n.list-item-hover-border:hover {\n  padding-left: 12px;\n}\n.list-item-hover-border:hover::before {\n  transform: translateY(-50%) scaleY(1);\n}\n\n/* Avatar/image hover effects */\n.avatar-hover-pop {\n  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;\n}\n.avatar-hover-pop:hover {\n  transform: scale(1.1);\n  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);\n}\n\n.avatar-hover-ring {\n  transition: box-shadow 0.3s ease;\n}\n.avatar-hover-ring:hover {\n  box-shadow: 0 0 0 4px hsl(var(--primary)), 0 8px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Link hover effects */\n.link-hover-underline {\n  position: relative;\n}\n.link-hover-underline::after {\n  content: \"\";\n  position: absolute;\n  bottom: -2px;\n  left: 0;\n  width: 0;\n  height: 2px;\n  background: hsl(var(--primary));\n  transition: width 0.3s ease;\n}\n.link-hover-underline:hover::after {\n  width: 100%;\n}\n\n.link-hover-slide {\n  transition: color 0.2s ease, transform 0.2s ease;\n}\n.link-hover-slide:hover {\n  transform: translateX(4px);\n  color: hsl(var(--primary));\n}\n\n/* Nav item hover effects */\n.nav-hover-bg {\n  position: relative;\n  transition: color 0.2s ease;\n}\n.nav-hover-bg::before {\n  content: \"\";\n  position: absolute;\n  inset: 0;\n  background: hsl(var(--primary) / 0.1);\n  border-radius: var(--radius);\n  transform: scaleX(0);\n  transition: transform 0.2s ease;\n}\n.nav-hover-bg:hover::before {\n  transform: scaleX(1);\n}\n\n/* Badge/tag hover effects */\n.badge-hover-pop {\n  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\n}\n.badge-hover-pop:hover {\n  transform: scale(1.1);\n}\n\n/* Input focus effects */\n.input-focus-glow:focus {\n  box-shadow: 0 0 0 3px hsl(var(--primary) / 0.2), 0 0 20px hsl(var(--primary) / 0.1);\n}\n\n/* Floating action button */\n.fab-hover {\n  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;\n}\n.fab-hover:hover {\n  transform: scale(1.1) rotate(5deg);\n  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);\n}\n\n/* Interactive table rows */\n.table-row-hover {\n  transition: background-color 0.2s ease, transform 0.2s ease;\n}\n.table-row-hover:hover {\n  background-color: hsl(var(--accent) / 0.3);\n  transform: scale(1.01);\n}\n\n/* Tab hover effect */\n.tab-hover-slide {\n  position: relative;\n}\n.tab-hover-slide::after {\n  content: \"\";\n  position: absolute;\n  bottom: 0;\n  left: 50%;\n  width: 0;\n  height: 2px;\n  background: hsl(var(--primary));\n  transition: width 0.3s ease, left 0.3s ease;\n}\n.tab-hover-slide:hover::after {\n  width: 100%;\n  left: 0;\n}\n\n/* Keyframe animations */\n@keyframes bounce {\n  0%, 100% { transform: translateY(0); }\n  25% { transform: translateY(-6px); }\n  50% { transform: translateY(0); }\n  75% { transform: translateY(-3px); }\n}\n\n@keyframes shake {\n  0%, 100% { transform: translateX(0); }\n  20% { transform: translateX(-4px); }\n  40% { transform: translateX(4px); }\n  60% { transform: translateX(-4px); }\n  80% { transform: translateX(4px); }\n}\n\n@keyframes pulse {\n  0% { transform: scale(1); }\n  50% { transform: scale(1.15); }\n  100% { transform: scale(1); }\n}\n\n@keyframes wiggle {\n  0%, 100% { transform: rotate(0deg); }\n  25% { transform: rotate(-5deg); }\n  75% { transform: rotate(5deg); }\n}\n\n@keyframes pop {\n  0% { transform: scale(1); }\n  50% { transform: scale(1.2); }\n  100% { transform: scale(1); }\n}\n\n/* Framer theme - Enhanced interactive effects */\n.theme-framer .card-hover-lift:hover {\n  box-shadow: 0 20px 50px rgba(99, 102, 241, 0.2);\n}\n\n.theme-framer.dark .card-hover-lift:hover {\n  box-shadow: 0 20px 50px rgba(139, 92, 246, 0.25);\n}\n\n.theme-framer .btn-hover-glow:hover {\n  box-shadow: 0 0 30px hsl(var(--primary) / 0.6), 0 0 60px hsl(var(--primary) / 0.3);\n}\n\n/* Framer specific - Cards have built-in hover lift */\n.theme-framer [data-slot=\"card\"] {\n  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;\n}\n\n.theme-framer [data-slot=\"card\"]:hover {\n  transform: translateY(-6px) scale(1.01);\n}\n\n/* Framer specific - Buttons have enhanced glow */\n.theme-framer [data-slot=\"button\"] {\n  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease, opacity 0.2s ease;\n}\n\n.theme-framer [data-slot=\"button\"]:hover {\n  transform: translateY(-2px) scale(1.02);\n}\n\n.theme-framer [data-slot=\"button\"]:active {\n  transform: translateY(0) scale(0.98);\n}\n\n/* Framer specific - Sidebar items */\n.theme-framer [data-slot=\"sidebar-menu-button\"] {\n  transition: transform 0.2s ease, background-color 0.2s ease;\n}\n\n.theme-framer [data-slot=\"sidebar-menu-button\"]:hover {\n  transform: translateX(4px);\n}\n","path":null,"size_bytes":25538,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/lib/api/bluten.ts":{"content":"import { supabase } from '../supabase';\n\nexport interface BlutenPost {\n  id: string;\n  instagram_post_id?: string;\n  instagram_url: string;\n  media_url?: string;\n  media_type?: string;\n  caption?: string;\n  username?: string;\n  is_visible: boolean;\n  created_by?: string;\n  posted_at?: string;\n  fetched_at: string;\n}\n\nexport async function getBlutenPosts(): Promise<BlutenPost[]> {\n  const res = await fetch('/api/bluten', {\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Bülten içerikleri yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<BlutenPost[]>;\n}\n\nexport async function getAllBlutenPosts(): Promise<BlutenPost[]> {\n  return getAdminBlutenPosts();\n}\n\nexport async function createBlutenPost(postData: {\n  instagram_url: string;\n  caption?: string;\n  media_url?: string;\n}) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/bluten', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify(postData),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Bülten paylaşımı oluşturulamadı');\n  }\n\n  return res.json();\n}\n\nexport async function updateBlutenPost(\n  id: string,\n  updates: { caption?: string; is_visible?: boolean }\n) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/bluten/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify(updates),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Bülten paylaşımı güncellenemedi');\n  }\n\n  return res.json();\n}\n\nexport async function deleteBlutenPost(id: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/bluten/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Bülten paylaşımı silinemedi');\n  }\n}\n\nexport async function toggleBlutenVisibility(id: string, is_visible: boolean) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/bluten/${id}/visibility`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify({ visible: is_visible }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Görünürlük değiştirilemedi');\n  }\n\n  return res.json();\n}\n\nexport async function triggerInstagramSync(): Promise<{ count: number }> {\n  const response = await fetch('/api/instagram/sync', {\n    method: 'POST',\n    credentials: 'include',\n  });\n  \n  if (!response.ok) {\n    throw new Error('Failed to trigger Instagram sync');\n  }\n  \n  return response.json();\n}\n\nexport async function getAdminBlutenPosts(): Promise<BlutenPost[]> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/bluten', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Bülten içerikleri yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<BlutenPost[]>;\n}\n","path":null,"size_bytes":4114,"size_tokens":null},"client/src/pages/Announcements.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport AnnouncementCard from \"@/components/AnnouncementCard\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { Bell, Plus, Search, Loader2, FileText, Download, MoreVertical, Pencil, Trash2, Reply, X, EyeOff } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\nimport { getAnnouncements, createAnnouncement, getAnnouncementComments, addAnnouncementComment, editAnnouncementComment, deleteAnnouncementComment, type Announcement } from \"@/lib/api/announcements\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useLocation } from \"wouter\";\nimport { MessageSquare, Send } from \"lucide-react\";\nimport { Card } from \"@/components/ui/card\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\n\ndayjs.extend(relativeTime);\ndayjs.locale(\"tr\");\n\nconst announcementFormSchema = z.object({\n  title: z.string().min(1, \"Başlık gereklidir\").max(200, \"Başlık çok uzun\"),\n  content: z.string().min(1, \"İçerik gereklidir\").max(5000, \"İçerik çok uzun\"),\n  targetAudience: z.enum(['all', 'class_presidents']).default('all'),\n});\n\ntype AnnouncementFormValues = z.infer<typeof announcementFormSchema>;\n\nexport default function Announcements() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedAnnouncement, setSelectedAnnouncement] = useState<Announcement | null>(null);\n  const [isNewAnnouncementOpen, setIsNewAnnouncementOpen] = useState(false);\n  const [newComment, setNewComment] = useState(\"\");\n  const [isCommentAnonymous, setIsCommentAnonymous] = useState(false);\n  const [editingComment, setEditingComment] = useState<{ id: string; content: string } | null>(null);\n  const [deleteCommentId, setDeleteCommentId] = useState<string | null>(null);\n  const [replyingTo, setReplyingTo] = useState<{ commentId: string; authorName: string } | null>(null);\n  const { toast} = useToast();\n  const { user, profile } = useAuth();\n  const [, setLocation] = useLocation();\n  const isAdmin = profile?.role === \"admin\";\n\n  const { data: comments, isLoading: loadingComments } = useQuery({\n    queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'],\n    queryFn: () => selectedAnnouncement ? getAnnouncementComments(selectedAnnouncement.id) : Promise.resolve([]),\n    enabled: !!selectedAnnouncement,\n  });\n\n  const addCommentMutation = useMutation({\n    mutationFn: ({ content, parentId, isAnonymous }: { content: string; parentId?: string; isAnonymous?: boolean }) => {\n      if (!user) {\n        toast({\n          title: \"Giriş Gerekli\",\n          description: \"Yorum yapmak için giriş yapmanız gerekiyor\",\n        });\n        setTimeout(() => setLocation(\"/giris\"), 1500);\n        throw new Error(\"Giriş yapmanız gerekiyor\");\n      }\n      return addAnnouncementComment(selectedAnnouncement!.id, content, parentId, isAnonymous);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'] });\n      setNewComment(\"\");\n      setIsCommentAnonymous(false);\n      setReplyingTo(null);\n      toast({\n        title: \"Başarılı\",\n        description: variables.parentId ? \"Yanıtınız moderatör onayına gönderildi\" : \"Yorumunuz moderatör onayına gönderildi\",\n      });\n    },\n    onError: (error: any) => {\n      if (error.message !== \"Giriş yapmanız gerekiyor\") {\n        toast({\n          variant: \"destructive\",\n          title: \"Hata\",\n          description: error.message || \"Yorum eklenirken bir hata oluştu\",\n        });\n      }\n    },\n  });\n\n  const editCommentMutation = useMutation({\n    mutationFn: ({ commentId, content }: { commentId: string; content: string }) => {\n      return editAnnouncementComment(commentId, content);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'] });\n      setEditingComment(null);\n      toast({\n        title: \"Yorum düzenlendi!\",\n        description: \"Yorumunuz tekrar yönetici onayına gönderildi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteCommentMutation = useMutation({\n    mutationFn: (commentId: string) => {\n      return deleteAnnouncementComment(commentId);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/announcements', selectedAnnouncement?.id, 'comments'] });\n      setDeleteCommentId(null);\n      toast({\n        title: \"Yorum silindi\",\n        description: \"Yorumunuz başarıyla silindi.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hata\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const { data: announcements, isLoading } = useQuery({\n    queryKey: [\"/api/announcements\"],\n    queryFn: getAnnouncements,\n  });\n\n  const form = useForm<AnnouncementFormValues>({\n    resolver: zodResolver(announcementFormSchema),\n    defaultValues: {\n      title: \"\",\n      content: \"\",\n      targetAudience: 'all',\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: AnnouncementFormValues) => createAnnouncement(data.title, data.content, data.targetAudience),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/announcements\"] });\n      setIsNewAnnouncementOpen(false);\n      form.reset();\n      toast({\n        title: \"Başarılı\",\n        description: \"Duyuru başarıyla oluşturuldu\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Duyuru oluşturulurken bir hata oluştu\",\n      });\n    },\n  });\n\n  const onSubmit = (data: AnnouncementFormValues) => {\n    createMutation.mutate(data);\n  };\n\n  const filteredAnnouncements = announcements?.filter((announcement) =>\n    announcement.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    announcement.content.toLowerCase().includes(searchQuery.toLowerCase())\n  ) || [];\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\">Duyurular</h1>\n            <p className=\"text-muted-foreground\">Tüm okul duyurularını görüntüleyin</p>\n          </div>\n          {isAdmin && (\n            <Button onClick={() => setIsNewAnnouncementOpen(true)} data-testid=\"button-new-announcement\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Yeni Duyuru\n            </Button>\n          )}\n        </div>\n\n        <div className=\"relative max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Duyuru ara...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-announcements\"\n          />\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      ) : filteredAnnouncements.length > 0 ? (\n        <div className=\"grid md:grid-cols-2 gap-4\">\n          {filteredAnnouncements.map((announcement) => {\n            const authorName = announcement.author\n              ? `${announcement.author.first_name || \"\"} ${announcement.author.last_name || \"\"}`.trim()\n              : \"Yönetici\";\n            return (\n              <AnnouncementCard\n                key={announcement.id}\n                title={announcement.title}\n                content={announcement.content}\n                authorName={authorName}\n                createdAt={dayjs.utc(announcement.created_at).local().fromNow()}\n                attachmentUrl={announcement.attachment_url}\n                attachmentType={announcement.attachment_type}\n                onReadMore={() => setSelectedAnnouncement(announcement)}\n              />\n            );\n          })}\n        </div>\n      ) : (\n        <EmptyState\n          icon={Bell}\n          title={searchQuery ? \"Duyuru bulunamadı\" : \"Henüz duyuru yok\"}\n          description={searchQuery ? \"Arama kriterlerinize uygun duyuru bulunamadı.\" : \"İlk duyuruyu oluşturun.\"}\n        />\n      )}\n\n      <Dialog open={!!selectedAnnouncement} onOpenChange={() => setSelectedAnnouncement(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[85vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle>{selectedAnnouncement?.title}</DialogTitle>\n            <DialogDescription>\n              {selectedAnnouncement?.author\n                ? `${selectedAnnouncement.author.first_name || \"\"} ${selectedAnnouncement.author.last_name || \"\"}`.trim()\n                : \"Yönetici\"} • {selectedAnnouncement && dayjs.utc(selectedAnnouncement.created_at).local().fromNow()}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"flex-1 overflow-y-auto pr-2\">\n            <div className=\"py-4\">\n              <p className=\"text-sm leading-relaxed whitespace-pre-wrap\">{selectedAnnouncement?.content}</p>\n              \n              {/* Attachment Download */}\n              {selectedAnnouncement?.attachment_url && \n               (selectedAnnouncement?.attachment_type === 'pdf' || selectedAnnouncement?.attachment_type === 'document') && (\n                <a \n                  href={selectedAnnouncement.attachment_url} \n                  download \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"inline-flex items-center gap-2 mt-4 px-4 py-2 bg-primary/10 text-primary rounded-md hover:bg-primary/20 transition-colors\"\n                  data-testid=\"link-download-attachment-modal\"\n                >\n                  <FileText className=\"h-4 w-4\" />\n                  {selectedAnnouncement.attachment_type === 'pdf' ? 'PDF Dosyası' : 'Doküman'} İndir\n                  <Download className=\"h-4 w-4\" />\n                </a>\n              )}\n            </div>\n\n            {/* Comments Section */}\n            <div className=\"border-t pt-6 mt-6\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <MessageSquare className=\"h-5 w-5\" />\n                <h3 className=\"font-semibold\">Yorumlar ({comments?.length || 0})</h3>\n              </div>\n\n              {/* Comment Form */}\n              <div className=\"mb-6 space-y-2\">\n                {replyingTo && (\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded-md\">\n                    <Reply className=\"h-4 w-4\" />\n                    <span><strong>{replyingTo.authorName}</strong> adlı kişiye yanıt veriyorsunuz</span>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"h-5 w-5 ml-auto\"\n                      onClick={() => setReplyingTo(null)}\n                      data-testid=\"button-cancel-reply\"\n                    >\n                      <X className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                )}\n                <div className=\"flex gap-2\">\n                  <Input\n                    placeholder={replyingTo ? `${replyingTo.authorName} adlı kişiye yanıt yaz...` : \"Yorum yaz...\"}\n                    value={newComment}\n                    onChange={(e) => setNewComment(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey && newComment.trim()) {\n                        e.preventDefault();\n                        addCommentMutation.mutate({ content: newComment, parentId: replyingTo?.commentId, isAnonymous: isCommentAnonymous });\n                      }\n                    }}\n                    disabled={addCommentMutation.isPending}\n                    data-testid=\"input-announcement-comment\"\n                  />\n                  <Button\n                    size=\"icon\"\n                    onClick={() => newComment.trim() && addCommentMutation.mutate({ content: newComment, parentId: replyingTo?.commentId, isAnonymous: isCommentAnonymous })}\n                    disabled={!newComment.trim() || addCommentMutation.isPending}\n                    data-testid=\"button-submit-comment\"\n                  >\n                    {addCommentMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    ) : (\n                      <Send className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox \n                    id=\"comment-anonymous\"\n                    checked={isCommentAnonymous}\n                    onCheckedChange={(checked) => setIsCommentAnonymous(checked === true)}\n                    data-testid=\"checkbox-comment-anonymous\"\n                  />\n                  <Label htmlFor=\"comment-anonymous\" className=\"flex items-center gap-1 cursor-pointer text-xs text-muted-foreground\">\n                    <EyeOff className=\"h-3 w-3\" />\n                    Anonim yorum\n                  </Label>\n                </div>\n              </div>\n\n              {/* Comments List */}\n              {loadingComments ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                </div>\n              ) : comments && comments.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {comments.map((comment: any) => {\n                    const isCommentAnon = comment.is_anonymous && !comment.author;\n                    const authorName = comment.author\n                      ? `${comment.author.first_name || \"\"} ${comment.author.last_name || \"\"}`.trim()\n                      : \"Anonim\";\n                    const showAnonBadge = comment.is_anonymous && comment.author && profile?.role === 'admin';\n                    const isOwnComment = profile?.id === comment.author_id;\n                    const isAdmin = profile?.role === 'admin';\n                    const canModify = isOwnComment || isAdmin;\n                    return (\n                      <Card key={comment.id} className=\"p-4\" data-testid={`comment-${comment.id}`}>\n                        <div className=\"flex items-start justify-between mb-2\">\n                          <div>\n                            <p className=\"font-medium text-sm\">\n                              {isCommentAnon ? (\n                                <span className=\"inline-flex items-center gap-1\">\n                                  <EyeOff className=\"h-4 w-4\" />\n                                  Anonim\n                                </span>\n                              ) : (\n                                <>\n                                  {authorName}\n                                  {showAnonBadge && (\n                                    <span className=\"ml-2 text-xs text-muted-foreground font-normal inline-flex items-center gap-1\">\n                                      <EyeOff className=\"h-3 w-3\" />\n                                      Anonim\n                                    </span>\n                                  )}\n                                </>\n                              )}\n                            </p>\n                            {comment.author && (comment.author.class_name || comment.author.student_no) && (\n                              <p className=\"text-xs text-muted-foreground\">\n                                {comment.author.class_name || \"\"} {comment.author.student_no ? `• ${comment.author.student_no}` : \"\"}\n                              </p>\n                            )}\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <p className=\"text-xs text-muted-foreground\">\n                              {dayjs.utc(comment.created_at).local().fromNow()}\n                            </p>\n                            {canModify && (\n                              <DropdownMenu>\n                                <DropdownMenuTrigger asChild>\n                                  <Button \n                                    variant=\"ghost\" \n                                    size=\"icon\" \n                                    className=\"h-6 w-6 shrink-0\"\n                                    data-testid={`button-comment-menu-${comment.id}`}\n                                  >\n                                    <MoreVertical className=\"h-4 w-4\" />\n                                  </Button>\n                                </DropdownMenuTrigger>\n                                <DropdownMenuContent align=\"end\">\n                                  {isOwnComment && (\n                                    <DropdownMenuItem \n                                      onClick={() => setEditingComment({ id: comment.id, content: comment.content })}\n                                      data-testid={`button-edit-comment-${comment.id}`}\n                                    >\n                                      <Pencil className=\"h-4 w-4 mr-2\" />\n                                      Düzenle\n                                    </DropdownMenuItem>\n                                  )}\n                                  <DropdownMenuItem \n                                    onClick={() => setDeleteCommentId(comment.id)}\n                                    className=\"text-destructive\"\n                                    data-testid={`button-delete-comment-${comment.id}`}\n                                  >\n                                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                                    Sil\n                                  </DropdownMenuItem>\n                                </DropdownMenuContent>\n                              </DropdownMenu>\n                            )}\n                          </div>\n                        </div>\n                        <p className=\"text-sm mb-2\">\n                          {comment.parent_id && (() => {\n                            const parentComment = comments?.find((c: any) => c.id === comment.parent_id);\n                            const parentIsAnon = parentComment?.is_anonymous && !parentComment?.author;\n                            const parentAuthorName = parentComment?.author \n                              ? `${parentComment.author.first_name || \"\"} ${parentComment.author.last_name || \"\"}`.trim() \n                              : null;\n                            return (\n                              <span className=\"text-primary font-medium\">\n                                @{parentIsAnon ? \"anoimkişi\" : (parentAuthorName || \"anoimkişi\")}{\" \"}\n                              </span>\n                            );\n                          })()}\n                          {comment.content}\n                        </p>\n                        {user && (\n                          <button\n                            onClick={() => setReplyingTo({ \n                              commentId: comment.id, \n                              authorName \n                            })}\n                            className=\"text-xs text-primary hover:underline flex items-center gap-1\"\n                            data-testid={`button-reply-${comment.id}`}\n                          >\n                            <Reply className=\"h-3 w-3\" />\n                            Yanıtla\n                          </button>\n                        )}\n                      </Card>\n                    );\n                  })}\n                </div>\n              ) : (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">\n                  Henüz yorum yok. İlk yorumu siz yapın!\n                </p>\n              )}\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isNewAnnouncementOpen} onOpenChange={setIsNewAnnouncementOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Yeni Duyuru</DialogTitle>\n            <DialogDescription>\n              Okul genelinde paylaşılacak yeni bir duyuru oluşturun\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"title\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Başlık</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"Duyuru başlığını girin\"\n                        {...field}\n                        data-testid=\"input-announcement-title\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"content\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>İçerik</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder=\"Duyuru içeriğini girin\"\n                        rows={6}\n                        {...field}\n                        data-testid=\"textarea-announcement-content\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"targetAudience\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Hedef Kitle</FormLabel>\n                    <FormControl>\n                      <RadioGroup\n                        value={field.value}\n                        onValueChange={field.onChange}\n                        data-testid=\"radio-target-audience\"\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"all\" id=\"all\" data-testid=\"radio-audience-all\" />\n                          <Label htmlFor=\"all\" className=\"cursor-pointer\">Herkes</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"class_presidents\" id=\"class_presidents\" data-testid=\"radio-audience-presidents\" />\n                          <Label htmlFor=\"class_presidents\" className=\"cursor-pointer\">Sadece Sınıf Başkanları</Label>\n                        </div>\n                      </RadioGroup>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsNewAnnouncementOpen(false)}\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-cancel-announcement\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-submit-announcement\"\n                >\n                  {createMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Oluştur\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Comment Dialog */}\n      <Dialog open={!!editingComment} onOpenChange={(open) => !open && setEditingComment(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Yorumu Düzenle</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Textarea\n              value={editingComment?.content || ''}\n              onChange={(e) => setEditingComment(editingComment ? { ...editingComment, content: e.target.value } : null)}\n              placeholder=\"Yorumunuz...\"\n              className=\"min-h-[100px]\"\n              data-testid=\"input-edit-announcement-comment\"\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              Düzenlenen yorumlar tekrar yönetici onayına gönderilir.\n            </p>\n            <div className=\"flex justify-end gap-2\">\n              <Button variant=\"outline\" onClick={() => setEditingComment(null)}>\n                İptal\n              </Button>\n              <Button\n                onClick={() => {\n                  if (editingComment && editingComment.content.trim()) {\n                    editCommentMutation.mutate({ \n                      commentId: editingComment.id, \n                      content: editingComment.content \n                    });\n                  }\n                }}\n                disabled={editCommentMutation.isPending}\n                data-testid=\"button-save-edit-announcement-comment\"\n              >\n                {editCommentMutation.isPending ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : null}\n                Kaydet\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Delete Comment Confirmation */}\n      <AlertDialog open={!!deleteCommentId} onOpenChange={(open) => !open && setDeleteCommentId(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Yorumu Sil</AlertDialogTitle>\n            <AlertDialogDescription>\n              Bu yorumu silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>İptal</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (deleteCommentId) {\n                  deleteCommentMutation.mutate(deleteCommentId);\n                }\n              }}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n              data-testid=\"button-confirm-delete-announcement-comment\"\n            >\n              {deleteCommentMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n              ) : null}\n              Sil\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":28141,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"server/services/supabase.ts":{"content":"import { createClient } from '@supabase/supabase-js';\n\n// Use backend-specific env vars (NOT VITE_ prefixed)\nconst supabaseUrl = process.env.SUPABASE_URL || process.env.VITE_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !supabaseServiceKey) {\n  console.warn('⚠️ Supabase environment variables not configured. Admin API will be limited.');\n}\n\nexport const supabaseAdmin = supabaseUrl && supabaseServiceKey\n  ? createClient(supabaseUrl, supabaseServiceKey, {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false\n      }\n    })\n  : null;\n\n// Helper functions for common operations\n\nexport async function getUserRole(userId: string): Promise<string | null> {\n  if (!supabaseAdmin) {\n    console.error('Supabase admin client not configured');\n    return null;\n  }\n\n  const { data, error } = await supabaseAdmin\n    .from('profiles')\n    .select('role')\n    .eq('user_id', userId)\n    .single();\n\n  if (error) {\n    console.error('Error fetching user role:', error);\n    return null;\n  }\n\n  return data?.role || null;\n}\n\nexport async function isAdmin(userId: string): Promise<boolean> {\n  const role = await getUserRole(userId);\n  return role === 'admin';\n}\n","path":null,"size_bytes":1235,"size_tokens":null},"client/src/components/examples/Dashboard.tsx":{"content":"import Dashboard from \"../../pages/Dashboard\";\n\nexport default function DashboardExample() {\n  return <Dashboard />;\n}\n","path":null,"size_bytes":119,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/admin/AnnouncementForm.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { insertAnnouncementSchema, type InsertAnnouncement } from \"@shared/schema\";\nimport { supabase } from \"@/lib/supabase\";\nimport { Pencil, Upload, FileText, X } from \"lucide-react\";\nimport { updateAnnouncement } from \"@/lib/api/announcements\";\nimport FileUpload from \"@/components/FileUpload\";\n\ninterface AnnouncementFormProps {\n  existingAnnouncement?: {\n    id: string;\n    title: string;\n    content: string;\n  };\n}\n\nexport default function AnnouncementForm({ existingAnnouncement }: AnnouncementFormProps) {\n  const [open, setOpen] = useState(false);\n  const [attachmentUrl, setAttachmentUrl] = useState(\"\");\n  const [attachmentType, setAttachmentType] = useState<'image' | 'video' | 'pdf' | 'document' | undefined>();\n  const { toast } = useToast();\n  const isEditMode = !!existingAnnouncement;\n\n  const form = useForm<InsertAnnouncement>({\n    resolver: zodResolver(insertAnnouncementSchema),\n    defaultValues: {\n      title: existingAnnouncement?.title || \"\",\n      content: existingAnnouncement?.content || \"\",\n      target_audience: \"all\",\n    },\n  });\n\n  useEffect(() => {\n    if (existingAnnouncement) {\n      form.reset({\n        title: existingAnnouncement.title,\n        content: existingAnnouncement.content,\n      });\n    }\n  }, [existingAnnouncement, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: InsertAnnouncement) => {\n      const payload = {\n        ...data,\n        attachment_url: attachmentUrl || undefined,\n        attachment_type: attachmentType || undefined,\n      };\n      \n      if (isEditMode && existingAnnouncement) {\n        return updateAnnouncement(existingAnnouncement.id, payload.title, payload.content);\n      } else {\n        const { data: { session } } = await supabase.auth.getSession();\n        if (!session) throw new Error(\"Not authenticated\");\n\n        const res = await fetch('/api/admin/announcements', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${session.access_token}`,\n          },\n          credentials: 'include',\n          body: JSON.stringify(payload),\n        });\n\n        if (!res.ok) {\n          const error = await res.json();\n          throw new Error(error.error || 'Failed to create announcement');\n        }\n\n        return res.json();\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/announcements\"] });\n      toast({\n        title: \"Başarılı\",\n        description: isEditMode ? \"Duyuru güncellendi\" : \"Duyuru oluşturuldu\",\n      });\n      setOpen(false);\n      form.reset();\n      setAttachmentUrl(\"\");\n      setAttachmentType(undefined);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || (isEditMode ? \"Duyuru güncellenemedi\" : \"Duyuru oluşturulamadı\"),\n      });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {isEditMode ? (\n          <Button variant=\"ghost\" size=\"icon\" data-testid={`button-edit-announcement-${existingAnnouncement.id}`}>\n            <Pencil className=\"h-4 w-4\" />\n          </Button>\n        ) : (\n          <Button data-testid=\"button-add-announcement\">Yeni Duyuru Ekle</Button>\n        )}\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>{isEditMode ? \"Duyuru Düzenle\" : \"Yeni Duyuru Oluştur\"}</DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Başlık</FormLabel>\n                  <FormControl>\n                    <Input {...field} data-testid=\"input-announcement-title\" placeholder=\"Duyuru başlığı\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            <FormField\n              control={form.control}\n              name=\"content\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>İçerik</FormLabel>\n                  <FormControl>\n                    <Textarea {...field} data-testid=\"input-announcement-content\" placeholder=\"Duyuru içeriği\" rows={6} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            <FormField\n              control={form.control}\n              name=\"target_audience\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Hedef Kitle</FormLabel>\n                  <Select onValueChange={field.onChange} defaultValue={field.value}>\n                    <FormControl>\n                      <SelectTrigger data-testid=\"select-target-audience\">\n                        <SelectValue placeholder=\"Hedef kitle seçin\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Tüm Öğrenciler</SelectItem>\n                      <SelectItem value=\"class_presidents\">Sınıf Başkanları</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <div className=\"space-y-2\">\n              <FormLabel>Dosya Ekle (Opsiyonel)</FormLabel>\n              <FileUpload\n                onUploadComplete={(url, type) => {\n                  setAttachmentUrl(url);\n                  setAttachmentType(type);\n                  toast({\n                    title: \"Dosya yüklendi\",\n                    description: \"Dosya başarıyla yüklendi\",\n                  });\n                }}\n                accept=\"image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx\"\n              />\n              {attachmentUrl && (\n                <div className=\"flex items-center gap-2 p-2 bg-muted rounded-md\">\n                  <FileText className=\"h-4 w-4\" />\n                  <span className=\"text-sm flex-1 truncate\">{attachmentType === 'pdf' ? 'PDF' : attachmentType === 'document' ? 'Doküman' : 'Medya'} dosyası</span>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => {\n                      setAttachmentUrl(\"\");\n                      setAttachmentType(undefined);\n                    }}\n                    data-testid=\"button-remove-attachment\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n            </div>\n            \n            <div className=\"flex gap-2 justify-end\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} data-testid=\"button-cancel\">\n                İptal\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                {mutation.isPending \n                  ? (isEditMode ? \"Güncelleniyor...\" : \"Oluşturuluyor...\") \n                  : (isEditMode ? \"Güncelle\" : \"Oluştur\")}\n              </Button>\n            </div>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":8270,"size_tokens":null},"client/src/lib/errors/supabase.ts":{"content":"import { AuthError, PostgrestError } from '@supabase/supabase-js';\nimport { authTranslations, AuthTranslationKey } from '@/lib/i18n/tr/auth';\n\nexport class AppError extends Error {\n  constructor(\n    message: string,\n    public code: string,\n    public originalError?: unknown\n  ) {\n    super(message);\n    this.name = 'AppError';\n  }\n}\n\ntype ErrorContext = 'login' | 'register' | 'profile';\n\nexport function translateSupabaseError(\n  error: unknown,\n  context: ErrorContext = 'login'\n): AppError {\n  // Log original error for debugging\n  console.error(`Supabase error in ${context}:`, error);\n\n  let code: AuthTranslationKey;\n  let message: string;\n\n  // Handle AuthError from Supabase Auth\n  if (error && typeof error === 'object' && 'status' in error) {\n    const authError = error as AuthError;\n    const errorMessage = authError.message?.toLowerCase() || '';\n    const status = authError.status;\n\n    // Map by error message patterns\n    if (errorMessage.includes('invalid login credentials') || \n        errorMessage.includes('invalid email or password')) {\n      code = 'auth.invalid_credentials';\n    } else if (errorMessage.includes('email') && errorMessage.includes('invalid')) {\n      code = 'auth.invalid_email';\n    } else if (errorMessage.includes('email not confirmed')) {\n      code = 'auth.email_not_confirmed';\n    } else if (errorMessage.includes('user not found') ||\n               errorMessage.includes('user does not exist')) {\n      code = 'auth.user_not_found';\n    } else if (errorMessage.includes('already registered') ||\n               errorMessage.includes('already exists') ||\n               errorMessage.includes('user already registered')) {\n      code = 'auth.email_already_exists';\n    } else if (errorMessage.includes('password') && \n               (errorMessage.includes('weak') || errorMessage.includes('short'))) {\n      code = 'auth.weak_password';\n    } else if (status === 429) {\n      code = 'auth.too_many_requests';\n    } else {\n      // Generic error based on context\n      code = `auth.unknown.${context}` as AuthTranslationKey;\n    }\n  }\n  // Handle PostgrestError\n  else if (error && typeof error === 'object' && 'code' in error) {\n    const pgError = error as PostgrestError;\n    \n    if (pgError.code === 'PGRST116') {\n      code = 'auth.profile_not_found';\n    } else {\n      code = `auth.unknown.${context}` as AuthTranslationKey;\n    }\n  }\n  // Handle network errors\n  else if (error instanceof TypeError && error.message.includes('fetch')) {\n    code = 'auth.network_error';\n  }\n  // Handle generic errors\n  else {\n    code = `auth.unknown.${context}` as AuthTranslationKey;\n  }\n\n  // Get translated message\n  message = authTranslations[code] || authTranslations['auth.unknown.login'];\n\n  return new AppError(message, code, error);\n}\n","path":null,"size_bytes":2787,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"INSTAGRAM_SETUP.md":{"content":"# Instagram Otomatik Post Çekme - Kurulum Rehberi\n\n## 🔧 Gereksinimler\n\nInstagram'dan otomatik post çekmek için:\n\n1. **Instagram Business veya Creator hesabı** (kişisel hesap çalışmaz)\n2. **Facebook Page'e bağlı Instagram hesabı**\n3. **Meta Developer hesabı ve App**\n4. **Access Token**\n\n## 📝 Adım Adım Setup\n\n### 1. Instagram Business Hesabı\n\n- Instagram > Ayarlar > Hesap Türü > \"Professional Account\"'a geç\n- \"Business\" veya \"Creator\" seç\n\n### 2. Facebook Page Bağlantısı\n\n- Facebook'ta bir Page oluştur (varsa kullan)\n- Instagram > Ayarlar > Account > Linked Accounts > Facebook\n- Page'i Instagram hesabına bağla\n\n### 3. Meta Developer App\n\n1. https://developers.facebook.com/ adresine git\n2. \"My Apps\" > \"Create App\" > \"Business\" seç\n3. App adı ver (örn: \"Maya Meclisi Portal\")\n4. Instagram Graph API'yi ekle\n\n### 4. Access Token Al\n\n```bash\n# Facebook Page ID'ni bul\nhttps://www.facebook.com/YOUR_PAGE > About > Page ID\n\n# Graph API Explorer'dan token al\nhttps://developers.facebook.com/tools/explorer/\n\nPermissions seç:\n- instagram_basic\n- pages_read_engagement  \n- pages_show_list\n\n\"Generate Access Token\" tıkla\n```\n\n### 5. Instagram Business Account ID Bul\n\n```bash\nGET https://graph.facebook.com/v20.0/{PAGE_ID}?fields=instagram_business_account&access_token={TOKEN}\n\nResponse:\n{\n  \"instagram_business_account\": {\n    \"id\": \"123456789\"  # Bu ID'yi kaydet\n  }\n}\n```\n\n### 6. Replit Secrets Ekle\n\n```\nINSTAGRAM_BUSINESS_ACCOUNT_ID=123456789\nINSTAGRAM_ACCESS_TOKEN=your_long_token_here\n```\n\n## 🚀 Otomatik Çekme Sistemi\n\nSistem her 15 dakikada bir yeni postları kontrol edecek ve Supabase'e kaydedecek.\n\n## ⚙️ Manuel Alternatif\n\nAccess token alamıyorsanız:\n- Admin panelden Instagram post URL'sini manuel girin\n- Sistem oEmbed API ile bilgileri çekecek\n- Daha basit ama manuel işlem gerektirir\n\n## 📚 Kaynaklar\n\n- [Instagram Graph API Docs](https://developers.facebook.com/docs/instagram-platform)\n- [Access Token Guide](https://developers.facebook.com/docs/facebook-login/guides/access-tokens/)\n","path":null,"size_bytes":2051,"size_tokens":null},"client/src/pages/DashboardReal.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport AnnouncementCard from \"@/components/AnnouncementCard\";\nimport PollCard from \"@/components/PollCard\";\nimport IdeaCard from \"@/components/IdeaCard\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { Bell, Plus, Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { getAnnouncements } from \"@/lib/api/announcements\";\nimport { getPolls, getUserVote, votePoll } from \"@/lib/api/polls\";\nimport { getIdeas } from \"@/lib/api/ideas\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\n\ndayjs.extend(relativeTime);\ndayjs.locale(\"tr\");\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n\n  const { data: announcements, isLoading: loadingAnnouncements } = useQuery({\n    queryKey: [\"/api/announcements\"],\n    queryFn: getAnnouncements,\n  });\n\n  const { data: polls, isLoading: loadingPolls } = useQuery({\n    queryKey: [\"/api/polls\"],\n    queryFn: getPolls,\n  });\n\n  const { data: ideas, isLoading: loadingIdeas } = useQuery({\n    queryKey: [\"/api/ideas\", \"approved\"],\n    queryFn: () => getIdeas(\"approved\"),\n  });\n\n  const voteMutation = useMutation({\n    mutationFn: ({ pollId, optionId }: { pollId: string; optionId: string }) =>\n      votePoll(pollId, optionId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Oyunuz kaydedildi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Oy verilirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const activePoll = polls?.[0];\n  const recentAnnouncements = announcements?.slice(0, 2);\n  const recentIdeas = ideas?.slice(0, 5);\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Ana Sayfa</h1>\n        <p className=\"text-muted-foreground\">Okul meclisi portalına hoş geldiniz</p>\n      </div>\n\n      <div className=\"grid lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold flex items-center gap-2\">\n                <Bell className=\"h-5 w-5 text-primary\" />\n                Son Duyurular\n              </h2>\n              <Link href=\"/duyurular\">\n                <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-all-announcements\">\n                  Tümünü Gör\n                </Button>\n              </Link>\n            </div>\n            {loadingAnnouncements ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : recentAnnouncements && recentAnnouncements.length > 0 ? (\n              <div className=\"space-y-4\">\n                {recentAnnouncements.map((announcement) => {\n                  const authorName = announcement.author\n                    ? `${announcement.author.first_name || \"\"} ${announcement.author.last_name || \"\"}`.trim()\n                    : \"Yönetici\";\n                  return (\n                    <AnnouncementCard\n                      key={announcement.id}\n                      title={announcement.title}\n                      content={announcement.content}\n                      authorName={authorName}\n                      createdAt={dayjs(announcement.created_at).fromNow()}\n                      onReadMore={() => console.log(\"Duyuru detayı:\", announcement.id)}\n                    />\n                  );\n                })}\n              </div>\n            ) : (\n              <EmptyState\n                icon={Bell}\n                title=\"Henüz duyuru yok\"\n                description=\"İlk duyuru eklendiğinde burada görünecek.\"\n              />\n            )}\n          </div>\n\n          <div>\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold\">Son Fikirler</h2>\n              <Link href=\"/fikirler\">\n                <Button variant=\"ghost\" size=\"sm\" data-testid=\"link-all-ideas\">\n                  Tümünü Gör\n                </Button>\n              </Link>\n            </div>\n            {loadingIdeas ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : recentIdeas && recentIdeas.length > 0 ? (\n              <div className=\"space-y-4\">\n                {recentIdeas.map((idea) => {\n                  const authorName = idea.author\n                    ? `${idea.author.first_name || \"\"} ${idea.author.last_name || \"\"}`.trim()\n                    : \"Anonim\";\n                  const initials = authorName\n                    .split(\" \")\n                    .map((n) => n[0])\n                    .join(\"\")\n                    .toUpperCase()\n                    .slice(0, 2);\n                  return (\n                    <IdeaCard\n                      key={idea.id}\n                      title={idea.title}\n                      excerpt={idea.body.substring(0, 150)}\n                      authorName={authorName}\n                      authorInitials={initials}\n                      createdAt={dayjs(idea.created_at).fromNow()}\n                      status={idea.status}\n                      commentCount={0}\n                      onReadMore={() => console.log(\"Fikir detayı:\", idea.id)}\n                    />\n                  );\n                })}\n              </div>\n            ) : (\n              <EmptyState\n                icon={Bell}\n                title=\"Henüz fikir yok\"\n                description=\"İlk fikir paylaşıldığında burada görünecek.\"\n              />\n            )}\n          </div>\n        </div>\n\n        <div className=\"space-y-6\">\n          {activePoll && (\n            <div>\n              <h2 className=\"text-xl font-semibold mb-4\">Aktif Oylama</h2>\n              <PollDisplay poll={activePoll} onVote={voteMutation.mutate} />\n            </div>\n          )}\n\n          <div className=\"rounded-lg border bg-card p-6\">\n            <h3 className=\"font-semibold mb-3\">Yeni Fikir Ekle</h3>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Okulunuzu geliştirmek için fikirlerinizi paylaşın\n            </p>\n            <Link href=\"/fikirler/yeni\">\n              <Button className=\"w-full\" data-testid=\"button-new-idea\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Fikir Paylaş\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction PollDisplay({ poll, onVote }: { poll: any; onVote: any }) {\n  const { data: userVote } = useQuery({\n    queryKey: [\"/api/polls\", poll.id, \"user-vote\"],\n    queryFn: () => getUserVote(poll.id),\n  });\n\n  const optionsWithVotes = poll.options?.map((opt: any) => ({\n    id: opt.id,\n    text: opt.option_text,\n    votes: opt.vote_count || 0,\n  })) || [];\n\n  const totalVotes = optionsWithVotes.reduce((sum: number, opt: any) => sum + opt.votes, 0);\n\n  return (\n    <PollCard\n      question={poll.question}\n      options={optionsWithVotes}\n      totalVotes={totalVotes}\n      hasVoted={!!userVote}\n      userVote={userVote?.option_id}\n      isOpen={poll.is_open}\n      onVote={(optionId) => onVote({ pollId: poll.id, optionId })}\n    />\n  );\n}\n","path":null,"size_bytes":7711,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/IdeaCard.tsx":{"content":"import { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Lightbulb, Calendar, MessageSquare } from \"lucide-react\";\nimport StatusBadge from \"./StatusBadge\";\n\ntype Status = \"pending\" | \"approved\" | \"rejected\";\n\ninterface IdeaCardProps {\n  title: string;\n  excerpt: string;\n  authorName: string;\n  authorInitials: string;\n  authorPictureUrl?: string | null;\n  createdAt: string;\n  status: Status;\n  commentCount: number;\n  onReadMore?: () => void;\n  onClick?: () => void;\n}\n\nexport default function IdeaCard({\n  title,\n  excerpt,\n  authorName,\n  authorInitials,\n  authorPictureUrl,\n  createdAt,\n  status,\n  commentCount,\n  onReadMore,\n  onClick,\n}: IdeaCardProps) {\n  const handleClick = () => {\n    if (onClick) onClick();\n    else if (onReadMore) onReadMore();\n  };\n\n  return (\n    <Card \n      className=\"card-hover-lift cursor-pointer group\" \n      data-testid=\"card-idea\"\n      onClick={handleClick}\n    >\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between gap-3\">\n          <div className=\"flex items-start gap-3 flex-1 min-w-0\">\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10 group-hover:bg-primary/20 transition-colors\">\n              <Lightbulb className=\"h-5 w-5 text-primary group-hover:animate-pulse transition-transform\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"font-semibold text-lg leading-tight mb-2\">{title}</h3>\n              <div className=\"flex items-center gap-2\">\n                <Avatar className=\"h-6 w-6\">\n                  {authorPictureUrl && <AvatarImage src={authorPictureUrl} alt={authorName} />}\n                  <AvatarFallback className=\"bg-muted text-xs\">\n                    {authorInitials}\n                  </AvatarFallback>\n                </Avatar>\n                <span className=\"text-sm text-muted-foreground\">{authorName}</span>\n              </div>\n            </div>\n          </div>\n          <StatusBadge status={status} />\n        </div>\n      </CardHeader>\n      <CardContent className=\"pb-3\">\n        <p className=\"text-sm text-muted-foreground leading-relaxed line-clamp-2\">\n          {excerpt}\n        </p>\n      </CardContent>\n      <CardFooter className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n          <span className=\"flex items-center gap-1\">\n            <Calendar className=\"h-3 w-3\" />\n            {createdAt}\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <MessageSquare className=\"h-3 w-3\" />\n            {commentCount} yorum\n          </span>\n        </div>\n        <Button \n          variant=\"ghost\" \n          size=\"sm\" \n          onClick={(e) => {\n            e.stopPropagation();\n            if (onReadMore) onReadMore();\n            else if (onClick) onClick();\n          }}\n          data-testid=\"button-read-idea\"\n        >\n          Görüntüle\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}\n","path":null,"size_bytes":3193,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/lib/api/polls.ts":{"content":"import { supabase } from '../supabase';\n\nexport interface PollOption {\n  id: string;\n  poll_id: string;\n  option_text: string;\n  vote_count?: number;\n}\n\nexport interface Poll {\n  id: string;\n  question: string;\n  created_by: string;\n  is_open: boolean;\n  results_published: boolean;\n  created_at: string;\n  options: PollOption[];\n}\n\nexport interface PollVote {\n  id: string;\n  poll_id: string;\n  option_id: string;\n  user_id: string;\n}\n\n// Helper to get auth headers\nasync function getAuthHeaders(): Promise<HeadersInit> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n  return {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${session.access_token}`,\n  };\n}\n\nexport async function getPolls(): Promise<Poll[]> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/polls', { headers, credentials: 'include' });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oylamalar yüklenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function getPoll(id: string): Promise<Poll> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/polls/${id}`, { headers, credentials: 'include' });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oylama yüklenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function getUserVote(pollId: string): Promise<PollVote | null> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/polls/${pollId}/my-vote`, { headers, credentials: 'include' });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oy bilgisi yüklenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function votePoll(pollId: string, optionId: string): Promise<PollVote> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/polls/${pollId}/vote`, {\n    method: 'POST',\n    headers,\n    credentials: 'include',\n    body: JSON.stringify({ option_id: optionId }),\n  });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oy verilirken hata oluştu');\n  }\n  \n  return res.json();\n}\n\nexport async function deletePoll(id: string): Promise<void> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/admin/polls/${id}`, {\n    method: 'DELETE',\n    headers,\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oylama silinirken hata oluştu');\n  }\n}\n\nexport async function togglePollStatus(id: string, isOpen: boolean): Promise<Poll> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/admin/polls/${id}/status`, {\n    method: 'PATCH',\n    headers,\n    credentials: 'include',\n    body: JSON.stringify({ is_open: isOpen }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oylama durumu güncellenirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function getAdminPolls(): Promise<Poll[]> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/admin/polls', { headers, credentials: 'include' });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oylamalar yüklenirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function publishPollResults(id: string): Promise<Poll> {\n  const headers = await getAuthHeaders();\n  const res = await fetch(`/api/admin/polls/${id}/publish-results`, {\n    method: 'PATCH',\n    headers,\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Sonuçlar yayınlanırken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function createPoll(question: string, options: string[]): Promise<Poll> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/admin/polls', {\n    method: 'POST',\n    headers,\n    credentials: 'include',\n    body: JSON.stringify({ question, options }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Oylama oluşturulurken hata oluştu');\n  }\n\n  return res.json();\n}\n","path":null,"size_bytes":4307,"size_tokens":null},"client/src/components/examples/EmptyState.tsx":{"content":"import EmptyState from \"../EmptyState\";\nimport { Bell } from \"lucide-react\";\n\nexport default function EmptyStateExample() {\n  return (\n    <div className=\"p-8 bg-card rounded-lg\">\n      <EmptyState\n        icon={Bell}\n        title=\"Henüz duyuru yok\"\n        description=\"İlk duyuruyu oluşturmak için aşağıdaki butona tıklayın.\"\n        actionLabel=\"Yeni Duyuru\"\n        onAction={() => console.log(\"Yeni duyuru ekle\")}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":456,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/admin/PollStatsDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Loader2, BarChart3 } from \"lucide-react\";\nimport { supabase } from \"@/lib/supabase\";\nimport { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';\n\ninterface PollStatsDialogProps {\n  pollId: string;\n  pollQuestion: string;\n}\n\nconst COLORS = ['#6b1c9e', '#d61b3c', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#14b8a6'];\n\nexport default function PollStatsDialog({ pollId, pollQuestion }: PollStatsDialogProps) {\n  const [open, setOpen] = useState(false);\n\n  const { data: stats, isLoading } = useQuery({\n    queryKey: ['/api/admin/polls', pollId, 'stats'],\n    queryFn: async () => {\n      const { data: { session } } = await supabase.auth.getSession();\n      if (!session) throw new Error('Not authenticated');\n\n      const res = await fetch(`/api/admin/polls/${pollId}/stats`, {\n        headers: {\n          'Authorization': `Bearer ${session.access_token}`,\n        },\n        credentials: 'include',\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || 'Failed to fetch stats');\n      }\n\n      return res.json();\n    },\n    enabled: open,\n  });\n\n  // Prepare pie chart data for overall class breakdown\n  const classChartData = stats?.overall_class_breakdown \n    ? Object.entries(stats.overall_class_breakdown).map(([name, value]) => ({\n        name,\n        value: value as number,\n      }))\n    : [];\n\n  // Prepare data for each option's class breakdown\n  const optionClassData = stats?.option_stats?.map((opt: any) => {\n    return {\n      ...opt,\n      classChartData: Object.entries(opt.class_breakdown).map(([name, value]) => ({\n        name,\n        value: value as number,\n      })),\n    };\n  }) || [];\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" data-testid={`button-stats-${pollId}`}>\n          <BarChart3 className=\"h-4 w-4 mr-2\" />\n          Detaylı İstatistikler\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-5xl max-h-[85vh] flex flex-col\">\n        <DialogHeader>\n          <DialogTitle>{pollQuestion}</DialogTitle>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"flex justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        ) : stats ? (\n          <div className=\"space-y-6 overflow-y-auto pr-2 flex-1\">\n            {/* Overall Stats */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Genel İstatistikler</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Toplam Oy</p>\n                    <p className=\"text-2xl font-bold\">{stats.total_votes}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">Seçenek Sayısı</p>\n                    <p className=\"text-2xl font-bold\">{stats.poll.options.length}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Overall Class Breakdown */}\n            {classChartData.length > 0 && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Sınıf Bazlı Katılım</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid md:grid-cols-2 gap-6 items-center\">\n                    <div className=\"h-[220px]\">\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <PieChart>\n                          <Pie\n                            data={classChartData}\n                            cx=\"50%\"\n                            cy=\"50%\"\n                            labelLine={false}\n                            label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                            outerRadius={75}\n                            fill=\"#8884d8\"\n                            dataKey=\"value\"\n                          >\n                            {classChartData.map((entry, index) => (\n                              <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                            ))}\n                          </Pie>\n                          <Tooltip />\n                        </PieChart>\n                      </ResponsiveContainer>\n                    </div>\n                    <div className=\"space-y-2 max-h-[220px] overflow-y-auto pr-2\">\n                      {classChartData.map((item, index) => (\n                        <div key={index} className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <div \n                              className=\"w-4 h-4 rounded flex-shrink-0\" \n                              style={{ backgroundColor: COLORS[index % COLORS.length] }}\n                            />\n                            <span className=\"text-sm\">{item.name}</span>\n                          </div>\n                          <span className=\"font-semibold\">{item.value} oy</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Per-Option Stats */}\n            {optionClassData.map((opt: any, idx: number) => (\n              <Card key={opt.option_id}>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">{opt.option_text}</CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">{opt.total_votes} oy ({stats.total_votes > 0 ? Math.round((opt.total_votes / stats.total_votes) * 100) : 0}%)</p>\n                </CardHeader>\n                <CardContent>\n                  {opt.classChartData.length > 0 ? (\n                    <div className=\"grid md:grid-cols-2 gap-6 items-start\">\n                      <div className=\"h-[180px]\">\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                          <PieChart>\n                            <Pie\n                              data={opt.classChartData}\n                              cx=\"50%\"\n                              cy=\"50%\"\n                              labelLine={false}\n                              label={({ name, percent }) => `${name}: ${(percent * 100).toFixed(0)}%`}\n                              outerRadius={65}\n                              fill=\"#8884d8\"\n                              dataKey=\"value\"\n                            >\n                              {opt.classChartData.map((entry: any, index: number) => (\n                                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                              ))}\n                            </Pie>\n                            <Tooltip />\n                          </PieChart>\n                        </ResponsiveContainer>\n                      </div>\n                      <div className=\"space-y-2 max-h-[180px] overflow-y-auto pr-2\">\n                        <p className=\"font-semibold mb-2 text-sm\">Sınıf Dağılımı:</p>\n                        {opt.classChartData.map((item: any, index: number) => (\n                          <div key={index} className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-2\">\n                              <div \n                                className=\"w-4 h-4 rounded flex-shrink-0\" \n                                style={{ backgroundColor: COLORS[index % COLORS.length] }}\n                              />\n                              <span className=\"text-sm\">{item.name}</span>\n                            </div>\n                            <span className=\"font-semibold\">{item.value} oy</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\">Bu seçeneğe henüz oy verilmedi</p>\n                  )}\n\n                  {/* Voter List */}\n                  {opt.votes.length > 0 && (\n                    <div className=\"mt-6\">\n                      <p className=\"font-semibold mb-2 text-sm\">Oy Verenler:</p>\n                      <div className=\"space-y-1 max-h-[160px] overflow-y-auto pr-2 border rounded-md p-2 bg-background/50\">\n                        {opt.votes.map((vote: any, vIdx: number) => (\n                          <div key={vIdx} className=\"text-sm flex items-center justify-between py-1.5 px-2 rounded hover-elevate\">\n                            <span>\n                              {vote.profile?.first_name} {vote.profile?.last_name}\n                            </span>\n                            <span className=\"text-muted-foreground text-xs\">\n                              {vote.profile?.class_name || 'Sınıf yok'} \n                              {vote.profile?.student_no ? ` - ${vote.profile.student_no}` : ''}\n                            </span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-center text-muted-foreground py-12\">İstatistik bulunamadı</p>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9910,"size_tokens":null},"client/src/lib/api/upload.ts":{"content":"import { supabase } from '@/lib/supabase';\n\nexport async function uploadFile(file: File): Promise<{ url: string; type: 'image' | 'video' | 'pdf' | 'document' }> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const formData = new FormData();\n  formData.append('file', file);\n\n  const res = await fetch('/api/upload', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: formData,\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Dosya yüklenirken hata oluştu');\n  }\n\n  return res.json();\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/FileUpload.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { Upload, X, Image as ImageIcon, Video, FileText } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { uploadFile } from \"@/lib/api/upload\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface FileUploadProps {\n  onUploadComplete: (url: string, type: 'image' | 'video' | 'pdf' | 'document') => void;\n  type?: 'image' | 'video' | 'all';\n  currentUrl?: string;\n  onRemove?: () => void;\n  accept?: string;\n}\n\nexport default function FileUpload({ onUploadComplete, type = 'all', currentUrl, onRemove, accept }: FileUploadProps) {\n  const [uploading, setUploading] = useState(false);\n  const [dragActive, setDragActive] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast} = useToast();\n\n  const handleFileChange = async (file: File) => {\n    const isImage = file.type.startsWith('image/');\n    const isVideo = file.type.startsWith('video/');\n    const isPdf = file.type === 'application/pdf';\n    const isDocument = file.type.startsWith('application/');\n\n    // Validate file type if specific type is required\n    if (type === 'image' && !isImage) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Lütfen bir resim dosyası seçin\",\n      });\n      return;\n    }\n\n    if (type === 'video' && !isVideo) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Lütfen bir video dosyası seçin\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const result = await uploadFile(file);\n      onUploadComplete(result.url, result.type);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Dosya yüklenirken bir hata oluştu\",\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      handleFileChange(e.dataTransfer.files[0]);\n    }\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files && e.target.files[0]) {\n      handleFileChange(e.target.files[0]);\n    }\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept={accept || (type === 'image' ? 'image/*' : type === 'video' ? 'video/*' : 'image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx')}\n        onChange={handleInputChange}\n        className=\"hidden\"\n        data-testid={`input-file-${type}`}\n      />\n\n      {currentUrl ? (\n        <div className=\"relative\">\n          {type === 'image' ? (\n            <img \n              src={currentUrl} \n              alt=\"Preview\" \n              className=\"w-full h-40 object-cover rounded-md\"\n            />\n          ) : type === 'video' ? (\n            <video \n              src={currentUrl} \n              controls \n              className=\"w-full h-40 rounded-md\"\n            />\n          ) : (\n            <div className=\"flex items-center gap-2 p-3 bg-muted rounded-md\">\n              <FileText className=\"h-5 w-5 text-primary\" />\n              <span className=\"text-sm flex-1\">Dosya yüklendi</span>\n            </div>\n          )}\n          {onRemove && (\n            <Button\n              variant=\"destructive\"\n              size=\"icon\"\n              className=\"absolute top-2 right-2\"\n              onClick={onRemove}\n              data-testid={`button-remove-${type}`}\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      ) : (\n        <div\n          className={`border-2 border-dashed rounded-md p-6 text-center cursor-pointer transition-colors ${\n            dragActive ? 'border-primary bg-primary/5' : 'border-muted-foreground/25'\n          } ${uploading ? 'opacity-50 cursor-not-allowed' : 'hover:border-primary hover:bg-primary/5'}`}\n          onDragEnter={handleDrag}\n          onDragLeave={handleDrag}\n          onDragOver={handleDrag}\n          onDrop={handleDrop}\n          onClick={() => !uploading && fileInputRef.current?.click()}\n          data-testid={`dropzone-${type}`}\n        >\n          {uploading ? (\n            <div className=\"flex flex-col items-center gap-2\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n              <p className=\"text-sm text-muted-foreground\">Yükleniyor...</p>\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center gap-2\">\n              {type === 'image' ? (\n                <ImageIcon className=\"h-8 w-8 text-muted-foreground\" />\n              ) : type === 'video' ? (\n                <Video className=\"h-8 w-8 text-muted-foreground\" />\n              ) : (\n                <Upload className=\"h-8 w-8 text-muted-foreground\" />\n              )}\n              <div className=\"text-sm text-muted-foreground\">\n                <p className=\"font-medium\">\n                  {type === 'image' ? 'Resim' : type === 'video' ? 'Video' : 'Dosya'} sürükleyin veya tıklayın\n                </p>\n                <p className=\"text-xs mt-1\">Maksimum 25MB</p>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5620,"size_tokens":null},"api/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"../server/routes\";\nimport { serveStatic } from \"../server/vite\";\nimport { instagramService } from \"../server/services/instagram\";\n\nconst app = express();\n\n// Increase body size limits for file uploads (Vercel max: 4.5MB)\napp.use(express.json({ limit: '4mb' }));\napp.use(express.urlencoded({ extended: false, limit: '4mb' }));\n\n// Health check endpoint for debugging\napp.get('/api/health', (_req: Request, res: Response) => {\n  const hasSupabaseUrl = !!(process.env.SUPABASE_URL || process.env.VITE_SUPABASE_URL);\n  const hasServiceKey = !!process.env.SUPABASE_SERVICE_ROLE_KEY;\n  \n  res.json({\n    status: 'ok',\n    environment: {\n      hasSupabaseUrl,\n      hasServiceKey,\n      nodeEnv: process.env.NODE_ENV,\n      isVercel: !!process.env.VERCEL,\n    }\n  });\n});\n\n// Register API routes\nregisterRoutes(app);\n\n// Error handling\napp.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n  const status = err.status || err.statusCode || 500;\n  const message = err.message || \"Internal Server Error\";\n  \n  console.error('API Error:', {\n    status,\n    message,\n    stack: err.stack,\n  });\n  \n  res.status(status).json({ \n    error: message,\n    details: process.env.NODE_ENV === 'development' ? err.stack : undefined\n  });\n});\n\n// Serve static files in production\nserveStatic(app);\n\n// Initialize Instagram service for Vercel (serverless)\n// This will run on each cold start, but the service handles initialization gracefully\nif (process.env.VERCEL) {\n  instagramService.startAutoSync();\n}\n\nexport default app;\n","path":null,"size_bytes":1631,"size_tokens":null},"client/src/lib/api/admin.ts":{"content":"import { supabase } from '../supabase';\nimport type { Profile, CreateUser } from '@shared/schema';\n\nexport async function getUsers() {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/users', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Kullanıcılar yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile[]>;\n}\n\nexport async function createUser(data: CreateUser) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/users', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify(data),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Kullanıcı oluşturulurken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile>;\n}\n\nexport async function updateUser(id: string, data: Partial<Profile>) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/users/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n    body: JSON.stringify(data),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Kullanıcı güncellenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile>;\n}\n\nexport async function deleteUser(id: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/users/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Kullanıcı silinirken hata oluştu');\n  }\n}\n\nexport async function getPendingProfilePictures() {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/profile-pictures', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profil fotoğrafları yüklenirken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile[]>;\n}\n\nexport async function approveProfilePicture(profileId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/profile-pictures/${profileId}/approve`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profil fotoğrafı onaylanırken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile>;\n}\n\nexport async function rejectProfilePicture(profileId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/profile-pictures/${profileId}/reject`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profil fotoğrafı reddedilirken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile>;\n}\n\nexport async function resetUserProfilePicture(profileId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/users/${profileId}/reset-picture`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Profil fotoğrafı sıfırlanırken hata oluştu');\n  }\n\n  return res.json() as Promise<Profile>;\n}\n\nexport async function suspendUser(profileId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/users/${profileId}/suspend`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Kullanıcı askıya alınırken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function activateUser(profileId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/users/${profileId}/activate`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Kullanıcı aktifleştirilirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function deleteComment(commentId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/comments/${commentId}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Yorum silinirken hata oluştu');\n  }\n\n  return res.json();\n}\n\nexport async function clearIdeaLikes(ideaId: string) {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/ideas/${ideaId}/likes`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    credentials: 'include',\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Beğeniler temizlenirken hata oluştu');\n  }\n\n  return res.json();\n}\n","path":null,"size_bytes":6903,"size_tokens":null},"client/src/pages/Profile.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useTheme, type DesignTheme, type ColorMode } from \"@/contexts/ThemeContext\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2, User, Mail, Lock, Upload, Image as ImageIcon, Palette, Sun, Moon, Sparkles, GraduationCap } from \"lucide-react\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { supabase } from \"@/lib/supabase\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\n\nexport default function Profile() {\n  const { user, profile } = useAuth();\n  const { toast } = useToast();\n  const { designTheme, colorMode, setDesignTheme, setColorMode } = useTheme();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);\n  const [isUpdatingPassword, setIsUpdatingPassword] = useState(false);\n  const [isUploadingPhoto, setIsUploadingPhoto] = useState(false);\n  \n  const [newEmail, setNewEmail] = useState(\"\");\n  const [currentPassword, setCurrentPassword] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n\n  const handleEmailUpdate = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newEmail) {\n      toast({\n        variant: \"destructive\",\n        description: \"Lütfen yeni e-posta adresinizi girin\",\n      });\n      return;\n    }\n\n    setIsUpdatingEmail(true);\n    try {\n      const { error } = await supabase.auth.updateUser({ email: newEmail });\n      \n      if (error) throw error;\n\n      toast({\n        description: \"E-posta adresi güncelleme talebi gönderildi. Lütfen yeni e-posta adresinizi doğrulayın.\",\n      });\n      setNewEmail(\"\");\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        description: error.message || \"E-posta güncellenirken hata oluştu\",\n      });\n    } finally {\n      setIsUpdatingEmail(false);\n    }\n  };\n\n  const handlePasswordUpdate = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!newPassword || !confirmPassword) {\n      toast({\n        variant: \"destructive\",\n        description: \"Lütfen tüm alanları doldurun\",\n      });\n      return;\n    }\n\n    if (newPassword.length < 8) {\n      toast({\n        variant: \"destructive\",\n        description: \"Şifre en az 8 karakter olmalıdır\",\n      });\n      return;\n    }\n\n    if (newPassword !== confirmPassword) {\n      toast({\n        variant: \"destructive\",\n        description: \"Şifreler eşleşmiyor\",\n      });\n      return;\n    }\n\n    setIsUpdatingPassword(true);\n    try {\n      const { error } = await supabase.auth.updateUser({ password: newPassword });\n      \n      if (error) throw error;\n\n      toast({\n        description: \"Şifreniz başarıyla güncellendi\",\n      });\n      setCurrentPassword(\"\");\n      setNewPassword(\"\");\n      setConfirmPassword(\"\");\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        description: error.message || \"Şifre güncellenirken hata oluştu\",\n      });\n    } finally {\n      setIsUpdatingPassword(false);\n    }\n  };\n\n  const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Only allow specific image types\n    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];\n    if (!allowedTypes.includes(file.type)) {\n      toast({\n        variant: \"destructive\",\n        description: \"Sadece JPG, JPEG ve PNG dosyaları yüklenebilir\",\n      });\n      return;\n    }\n\n    // Check file extension as well\n    const allowedExtensions = ['.jpg', '.jpeg', '.png'];\n    const fileName = file.name.toLowerCase();\n    const hasValidExtension = allowedExtensions.some(ext => fileName.endsWith(ext));\n    if (!hasValidExtension) {\n      toast({\n        variant: \"destructive\",\n        description: \"Sadece .jpg, .jpeg ve .png uzantılı dosyalar yüklenebilir\",\n      });\n      return;\n    }\n\n    // Maximum 2MB\n    if (file.size > 2 * 1024 * 1024) {\n      toast({\n        variant: \"destructive\",\n        description: \"Dosya boyutu 2MB'dan küçük olmalıdır\",\n      });\n      return;\n    }\n\n    setIsUploadingPhoto(true);\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      // Use dedicated profile picture endpoint with strict server-side validation\n      const res = await fetch('/api/upload/profile-picture', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${session?.access_token || ''}`,\n        },\n        body: formData,\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || 'Dosya yüklenirken hata oluştu');\n      }\n\n      toast({\n        description: \"Profil fotoğrafınız yönetici onayına gönderildi\",\n      });\n\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        description: error.message || \"Fotoğraf yüklenirken hata oluştu\",\n      });\n    } finally {\n      setIsUploadingPhoto(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8 max-w-3xl\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Profil Ayarları</h1>\n        <p className=\"text-muted-foreground\">Hesap bilgilerinizi yönetin</p>\n      </div>\n\n      <div className=\"space-y-6\">\n        {/* Profile Picture */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <ImageIcon className=\"h-5 w-5\" />\n              Profil Fotoğrafı\n            </CardTitle>\n            <CardDescription>\n              Profil fotoğrafınızı güncelleyebilirsiniz. Yüklediğiniz fotoğraf yönetici onayından sonra yayınlanacaktır.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"bg-muted/50 rounded-lg p-4 text-sm text-muted-foreground\">\n              <p className=\"font-medium text-foreground mb-2\">Profil Fotoğrafı Kuralları</p>\n              <ul className=\"list-disc list-inside space-y-1\">\n                <li>Fotoğrafınızda yalnızca kendi yüzünüz yer almalıdır</li>\n                <li>Uygunsuz, rahatsız edici veya başka kişilere ait görseller kabul edilmez</li>\n                <li>Fotoğraf net, düzgün ve tanınabilir olmalıdır</li>\n                <li>Sadece JPG, JPEG ve PNG formatları kabul edilir</li>\n                <li>Maksimum dosya boyutu 2MB</li>\n              </ul>\n              <p className=\"mt-3 text-yellow-600 dark:text-yellow-400 font-medium\">\n                Uygunsuz fotoğraflar silinir ve hesabınız askıya alınabilir.\n              </p>\n            </div>\n            <div className=\"flex items-center gap-6\">\n              <Avatar className=\"h-24 w-24 avatar-hover-ring cursor-pointer\">\n                <AvatarImage src={profile?.profile_picture_url || undefined} alt={profile?.first_name || undefined} />\n                <AvatarFallback>{profile?.first_name?.charAt(0)}{profile?.last_name?.charAt(0)}</AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1\">\n                {profile?.profile_picture_status === 'pending' && (\n                  <p className=\"text-sm text-yellow-600 dark:text-yellow-400 mb-3\">\n                    Fotoğrafınız onay beklemektedir\n                  </p>\n                )}\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\".jpg,.jpeg,.png\"\n                  onChange={handlePhotoUpload}\n                  className=\"hidden\"\n                  data-testid=\"input-profile-picture\"\n                />\n                <Button \n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={isUploadingPhoto}\n                  data-testid=\"button-upload-picture\"\n                >\n                  {isUploadingPhoto && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                  <Upload className=\"mr-2 h-4 w-4\" />\n                  Fotoğraf Yükle\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Profile Info */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              Profil Bilgileri\n            </CardTitle>\n            <CardDescription>Genel hesap bilgileriniz</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <Label>Ad Soyad</Label>\n              <div className=\"mt-1 text-sm text-muted-foreground\">\n                {profile?.first_name && profile?.last_name \n                  ? `${profile.first_name} ${profile.last_name}` \n                  : \"Belirtilmemiş\"}\n              </div>\n            </div>\n            <div>\n              <Label>Sınıf</Label>\n              <div className=\"mt-1 text-sm text-muted-foreground\">\n                {profile?.class_name || \"Belirtilmemiş\"}\n              </div>\n            </div>\n            <div>\n              <Label>Öğrenci No</Label>\n              <div className=\"mt-1 text-sm text-muted-foreground\">\n                {profile?.student_no || \"Belirtilmemiş\"}\n              </div>\n            </div>\n            <div>\n              <Label>Rol</Label>\n              <div className=\"mt-1 text-sm text-muted-foreground\">\n                {profile?.role === \"admin\" ? \"Yönetici\" : profile?.role === \"teacher\" ? \"Öğretmen\" : \"Öğrenci\"}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Theme Settings */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Palette className=\"h-5 w-5\" />\n              Tema Ayarları\n            </CardTitle>\n            <CardDescription>Görünüm tercihlerinizi özelleştirin</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div>\n              <Label className=\"text-base font-medium mb-3 block\">Tasarım Teması</Label>\n              <RadioGroup \n                value={designTheme} \n                onValueChange={(value) => setDesignTheme(value as DesignTheme)}\n                className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\"\n              >\n                <div className=\"flex items-center space-x-3 border rounded-lg p-4 cursor-pointer card-hover-scale group\" onClick={() => setDesignTheme('maya')}>\n                  <RadioGroupItem value=\"maya\" id=\"theme-maya\" data-testid=\"radio-theme-maya\" />\n                  <Label htmlFor=\"theme-maya\" className=\"flex items-center gap-3 cursor-pointer flex-1\">\n                    <GraduationCap className=\"h-5 w-5 text-primary group-hover:scale-110 transition-transform\" />\n                    <div>\n                      <div className=\"font-medium\">Maya Klasik</div>\n                      <div className=\"text-xs text-muted-foreground\">Mor ve beyaz okul teması</div>\n                    </div>\n                  </Label>\n                </div>\n                <div className=\"flex items-center space-x-3 border rounded-lg p-4 cursor-pointer card-hover-scale group\" onClick={() => setDesignTheme('framer')}>\n                  <RadioGroupItem value=\"framer\" id=\"theme-framer\" data-testid=\"radio-theme-framer\" />\n                  <Label htmlFor=\"theme-framer\" className=\"flex items-center gap-3 cursor-pointer flex-1\">\n                    <Sparkles className=\"h-5 w-5 text-primary group-hover:rotate-12 group-hover:scale-110 transition-transform\" />\n                    <div>\n                      <div className=\"font-medium\">Modern</div>\n                      <div className=\"text-xs text-muted-foreground\">Cam efektli modern tasarım</div>\n                    </div>\n                  </Label>\n                </div>\n              </RadioGroup>\n            </div>\n\n            <div>\n              <Label className=\"text-base font-medium mb-3 block\">Renk Modu</Label>\n              <RadioGroup \n                value={colorMode} \n                onValueChange={(value) => setColorMode(value as ColorMode)}\n                className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\"\n              >\n                <div className=\"flex items-center space-x-3 border rounded-lg p-4 cursor-pointer card-hover-scale group\" onClick={() => setColorMode('light')}>\n                  <RadioGroupItem value=\"light\" id=\"color-light\" data-testid=\"radio-color-light\" />\n                  <Label htmlFor=\"color-light\" className=\"flex items-center gap-3 cursor-pointer flex-1\">\n                    <Sun className=\"h-5 w-5 text-yellow-500 group-hover:rotate-45 group-hover:scale-110 transition-transform\" />\n                    <div>\n                      <div className=\"font-medium\">Açık Mod</div>\n                      <div className=\"text-xs text-muted-foreground\">Beyaz arka plan</div>\n                    </div>\n                  </Label>\n                </div>\n                <div className=\"flex items-center space-x-3 border rounded-lg p-4 cursor-pointer card-hover-scale group\" onClick={() => setColorMode('dark')}>\n                  <RadioGroupItem value=\"dark\" id=\"color-dark\" data-testid=\"radio-color-dark\" />\n                  <Label htmlFor=\"color-dark\" className=\"flex items-center gap-3 cursor-pointer flex-1\">\n                    <Moon className=\"h-5 w-5 text-blue-400 group-hover:-rotate-12 group-hover:scale-110 transition-transform\" />\n                    <div>\n                      <div className=\"font-medium\">Koyu Mod</div>\n                      <div className=\"text-xs text-muted-foreground\">Koyu arka plan</div>\n                    </div>\n                  </Label>\n                </div>\n              </RadioGroup>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Email Update */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Mail className=\"h-5 w-5\" />\n              E-posta Değiştir\n            </CardTitle>\n            <CardDescription>Mevcut e-posta: {user?.email}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleEmailUpdate} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"new-email\">Yeni E-posta</Label>\n                <Input\n                  id=\"new-email\"\n                  type=\"email\"\n                  value={newEmail}\n                  onChange={(e) => setNewEmail(e.target.value)}\n                  placeholder=\"yeni@mayaokullari.k12.tr\"\n                  disabled={isUpdatingEmail}\n                  data-testid=\"input-new-email\"\n                />\n              </div>\n              <Button \n                type=\"submit\" \n                disabled={isUpdatingEmail}\n                data-testid=\"button-update-email\"\n              >\n                {isUpdatingEmail && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                E-posta Güncelle\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Password Update */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Lock className=\"h-5 w-5\" />\n              Şifre Değiştir\n            </CardTitle>\n            <CardDescription>Hesabınızın güvenliği için güçlü bir şifre seçin</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handlePasswordUpdate} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"new-password\">Yeni Şifre</Label>\n                <Input\n                  id=\"new-password\"\n                  type=\"password\"\n                  value={newPassword}\n                  onChange={(e) => setNewPassword(e.target.value)}\n                  placeholder=\"En az 8 karakter\"\n                  disabled={isUpdatingPassword}\n                  data-testid=\"input-new-password\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"confirm-password\">Yeni Şifre (Tekrar)</Label>\n                <Input\n                  id=\"confirm-password\"\n                  type=\"password\"\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  placeholder=\"Şifrenizi tekrar girin\"\n                  disabled={isUpdatingPassword}\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n              <Button \n                type=\"submit\" \n                disabled={isUpdatingPassword}\n                data-testid=\"button-update-password\"\n              >\n                {isUpdatingPassword && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                Şifre Güncelle\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17493,"size_tokens":null},"client/src/pages/AdminPanel.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n  FormDescription,\n} from \"@/components/ui/form\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { getUsers, createUser, updateUser, deleteUser } from \"@/lib/api/admin\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Users, Plus, Pencil, Trash2, Loader2, Shield, GraduationCap, UserCheck, Image as ImageIcon, Check, X } from \"lucide-react\";\nimport { createUserSchema, type CreateUser, type Profile } from \"@shared/schema\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { getPendingProfilePictures, approveProfilePicture, rejectProfilePicture } from \"@/lib/api/admin\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\n\ndayjs.locale(\"tr\");\n\nexport default function AdminPanel() {\n  const [isNewUserDialogOpen, setIsNewUserDialogOpen] = useState(false);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<Profile | null>(null);\n  const { toast } = useToast();\n\n  const { data: users, isLoading } = useQuery({\n    queryKey: ['/api/admin/users'],\n    queryFn: getUsers,\n  });\n\n  const { data: pendingPictures, isLoading: isPicturesLoading } = useQuery({\n    queryKey: ['/api/admin/profile-pictures'],\n    queryFn: getPendingProfilePictures,\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: (profileId: string) => approveProfilePicture(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/profile-pictures'] });\n      toast({\n        description: \"Profil fotoğrafı onaylandı\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        description: error.message || \"Onay yapılırken hata oluştu\",\n      });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: (profileId: string) => rejectProfilePicture(profileId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/profile-pictures'] });\n      toast({\n        description: \"Profil fotoğrafı reddedildi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        description: error.message || \"Red işlemi yapılırken hata oluştu\",\n      });\n    },\n  });\n\n  const createForm = useForm<CreateUser>({\n    resolver: zodResolver(createUserSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n      first_name: \"\",\n      last_name: \"\",\n      role: \"student\",\n      class_name: \"\",\n      student_no: \"\",\n      is_class_president: false,\n    },\n  });\n\n  const editForm = useForm<Partial<Profile>>({\n    defaultValues: {\n      first_name: \"\",\n      last_name: \"\",\n      role: \"student\",\n      class_name: \"\",\n      student_no: \"\",\n      is_class_president: false,\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: (data: CreateUser) => createUser(data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/users'] });\n      setIsNewUserDialogOpen(false);\n      createForm.reset();\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı başarıyla oluşturuldu\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Kullanıcı oluşturulurken bir hata oluştu\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: Partial<Profile> }) => updateUser(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/users'] });\n      setIsEditDialogOpen(false);\n      setSelectedUser(null);\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı başarıyla güncellendi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Kullanıcı güncellenirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: string) => deleteUser(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/users'] });\n      toast({\n        title: \"Başarılı\",\n        description: \"Kullanıcı başarıyla silindi\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Kullanıcı silinirken bir hata oluştu\",\n      });\n    },\n  });\n\n  const handleEdit = (user: Profile) => {\n    setSelectedUser(user);\n    editForm.reset({\n      first_name: user.first_name || \"\",\n      last_name: user.last_name || \"\",\n      role: user.role,\n      class_name: user.class_name || \"\",\n      student_no: user.student_no || \"\",\n      is_class_president: user.is_class_president,\n    });\n    setIsEditDialogOpen(true);\n  };\n\n  const handleDelete = (user: Profile) => {\n    if (confirm(`${user.first_name} ${user.last_name} kullanıcısını silmek istediğinizden emin misiniz?`)) {\n      deleteMutation.mutate(user.id);\n    }\n  };\n\n  const onCreateSubmit = (data: CreateUser) => {\n    createMutation.mutate(data);\n  };\n\n  const onEditSubmit = (data: Partial<Profile>) => {\n    if (selectedUser) {\n      updateMutation.mutate({ id: selectedUser.id, data });\n    }\n  };\n\n  const getRoleBadge = (role: string) => {\n    switch (role) {\n      case 'admin':\n        return <Badge variant=\"destructive\" className=\"gap-1\"><Shield className=\"h-3 w-3\" />Admin</Badge>;\n      case 'teacher':\n        return <Badge variant=\"default\" className=\"gap-1\"><GraduationCap className=\"h-3 w-3\" />Öğretmen</Badge>;\n      default:\n        return <Badge variant=\"secondary\" className=\"gap-1\"><Users className=\"h-3 w-3\" />Öğrenci</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"text-2xl flex items-center gap-2\">\n                <Users className=\"h-6 w-6\" />\n                Kullanıcı Yönetimi\n              </CardTitle>\n              <CardDescription>\n                Kullanıcıları yönetin, sınıf başkanları atayın\n              </CardDescription>\n            </div>\n            <Button onClick={() => setIsNewUserDialogOpen(true)} data-testid=\"button-new-user\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Yeni Kullanıcı\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : users && users.length > 0 ? (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Ad Soyad</TableHead>\n                  <TableHead>Rol</TableHead>\n                  <TableHead>Sınıf</TableHead>\n                  <TableHead>Öğrenci No</TableHead>\n                  <TableHead>Sınıf Başkanı</TableHead>\n                  <TableHead>Kayıt Tarihi</TableHead>\n                  <TableHead className=\"text-right\">İşlemler</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {users.map((user) => (\n                  <TableRow key={user.id} data-testid={`user-row-${user.id}`}>\n                    <TableCell className=\"font-medium\">\n                      {user.first_name} {user.last_name}\n                    </TableCell>\n                    <TableCell>{getRoleBadge(user.role)}</TableCell>\n                    <TableCell>{user.class_name || \"-\"}</TableCell>\n                    <TableCell>{user.student_no || \"-\"}</TableCell>\n                    <TableCell>\n                      {user.is_class_president ? (\n                        <Badge variant=\"default\" className=\"gap-1\">\n                          <UserCheck className=\"h-3 w-3\" />\n                          Başkan\n                        </Badge>\n                      ) : (\n                        <span className=\"text-muted-foreground\">-</span>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-sm text-muted-foreground\">\n                      {dayjs(user.created_at).format('DD.MM.YYYY')}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex justify-end gap-2\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleEdit(user)}\n                          data-testid={`button-edit-${user.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleDelete(user)}\n                          data-testid={`button-delete-${user.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          ) : (\n            <div className=\"text-center py-12\">\n              <Users className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-lg font-medium mb-2\">Henüz kullanıcı yok</p>\n              <p className=\"text-sm text-muted-foreground\">İlk kullanıcıyı oluşturun</p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Create User Dialog */}\n      <Dialog open={isNewUserDialogOpen} onOpenChange={setIsNewUserDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Yeni Kullanıcı Oluştur</DialogTitle>\n            <DialogDescription>\n              Sisteme yeni bir kullanıcı ekleyin\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...createForm}>\n            <form onSubmit={createForm.handleSubmit(onCreateSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={createForm.control}\n                  name=\"first_name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Ad</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Ad\" {...field} data-testid=\"input-first-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={createForm.control}\n                  name=\"last_name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Soyad</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Soyad\" {...field} data-testid=\"input-last-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={createForm.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>E-posta</FormLabel>\n                    <FormControl>\n                      <Input type=\"email\" placeholder=\"ornek@mayaokullari.k12.tr\" {...field} data-testid=\"input-email\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={createForm.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Şifre</FormLabel>\n                    <FormControl>\n                      <Input type=\"password\" placeholder=\"Minimum 6 karakter\" {...field} data-testid=\"input-password\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={createForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Rol</FormLabel>\n                      <Select value={field.value} onValueChange={field.onChange}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-role\">\n                            <SelectValue placeholder=\"Rol seçin\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"student\">Öğrenci</SelectItem>\n                          <SelectItem value=\"teacher\">Öğretmen</SelectItem>\n                          <SelectItem value=\"admin\">Admin</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={createForm.control}\n                  name=\"class_name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Sınıf</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"9-A\" {...field} data-testid=\"input-class\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={createForm.control}\n                name=\"student_no\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Öğrenci Numarası</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"12345\" {...field} data-testid=\"input-student-no\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={createForm.control}\n                name=\"is_class_president\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4\">\n                    <FormControl>\n                      <Checkbox\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                        data-testid=\"checkbox-class-president\"\n                      />\n                    </FormControl>\n                    <div className=\"space-y-1 leading-none\">\n                      <FormLabel className=\"cursor-pointer\">\n                        Sınıf Başkanı\n                      </FormLabel>\n                      <FormDescription>\n                        Bu kullanıcı sınıf başkanı olarak atansın mı?\n                      </FormDescription>\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsNewUserDialogOpen(false)}\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-cancel\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending}\n                  data-testid=\"button-submit\"\n                >\n                  {createMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Oluştur\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit User Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Kullanıcı Düzenle</DialogTitle>\n            <DialogDescription>\n              Kullanıcı bilgilerini güncelleyin\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...editForm}>\n            <form onSubmit={editForm.handleSubmit(onEditSubmit)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"first_name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Ad</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Ad\" {...field} data-testid=\"input-edit-first-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editForm.control}\n                  name=\"last_name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Soyad</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Soyad\" {...field} data-testid=\"input-edit-last-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Rol</FormLabel>\n                      <Select value={field.value} onValueChange={field.onChange}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-edit-role\">\n                            <SelectValue placeholder=\"Rol seçin\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"student\">Öğrenci</SelectItem>\n                          <SelectItem value=\"teacher\">Öğretmen</SelectItem>\n                          <SelectItem value=\"admin\">Admin</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={editForm.control}\n                  name=\"class_name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Sınıf</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"9-A\" {...field} data-testid=\"input-edit-class\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={editForm.control}\n                name=\"student_no\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Öğrenci Numarası</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"12345\" {...field} data-testid=\"input-edit-student-no\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={editForm.control}\n                name=\"is_class_president\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4\">\n                    <FormControl>\n                      <Checkbox\n                        checked={field.value}\n                        onCheckedChange={field.onChange}\n                        data-testid=\"checkbox-edit-class-president\"\n                      />\n                    </FormControl>\n                    <div className=\"space-y-1 leading-none\">\n                      <FormLabel className=\"cursor-pointer\">\n                        Sınıf Başkanı\n                      </FormLabel>\n                      <FormDescription>\n                        Bu kullanıcı sınıf başkanı olarak atansın mı?\n                      </FormDescription>\n                    </div>\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setIsEditDialogOpen(false)}\n                  disabled={updateMutation.isPending}\n                  data-testid=\"button-edit-cancel\"\n                >\n                  İptal\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={updateMutation.isPending}\n                  data-testid=\"button-edit-submit\"\n                >\n                  {updateMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\n                  Güncelle\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":22871,"size_tokens":null},"VERCEL_ENV_SETUP.md":{"content":"# 🔧 Vercel Environment Variables Kurulumu\n\n## ❗ Hata: \"Unexpected token 'A'...\"\n\nBu hata Vercel'de environment variables eksik olduğu için API'lerin çalışmadığını gösterir.\n\n---\n\n## ✅ Çözüm: Environment Variables Ekleyin\n\n### 1️⃣ Vercel Dashboard'a Gidin\nhttps://vercel.com/dashboard → Projenizi seçin → **Settings** → **Environment Variables**\n\n### 2️⃣ Şu Değişkenleri Ekleyin\n\n#### Frontend (Public - `VITE_` prefix)\n```bash\nVITE_SUPABASE_URL=https://zpohslofrljuepuuwpjf.supabase.co\nVITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n```\n\n#### Backend (Server-side - NO prefix)\n```bash\nSUPABASE_URL=https://zpohslofrljuepuuwpjf.supabase.co\nSUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\nSESSION_SECRET=your-random-secret-min-32-chars\n```\n\n#### Instagram (Opsiyonel)\n```bash\nINSTAGRAM_ACCESS_TOKEN=your-instagram-token\nINSTAGRAM_ACCOUNT_ID=your-instagram-account-id\n```\n\n---\n\n## 🔍 Environment Variable Değerleri Nereden Bulunur?\n\n### Supabase Keys\n1. https://supabase.com/dashboard → Projenizi seçin\n2. **Settings** → **API**\n3. Şu değerleri kopyalayın:\n   - **Project URL** → `SUPABASE_URL` ve `VITE_SUPABASE_URL`\n   - **anon/public key** → `VITE_SUPABASE_ANON_KEY`\n   - **service_role key** → `SUPABASE_SERVICE_ROLE_KEY` (🔒 GİZLİ!)\n\n### Session Secret\nRastgele bir string oluşturun (en az 32 karakter):\n```bash\n# Node.js ile oluşturun:\nnode -e \"console.log(require('crypto').randomBytes(32).toString('hex'))\"\n```\n\n---\n\n## 📝 Vercel'de Nasıl Eklerim?\n\n### Yöntem 1: Dashboard (Önerilen)\n1. Vercel Dashboard → Projeniz → Settings → Environment Variables\n2. **Add New** butonuna tıklayın\n3. Her bir variable için:\n   - **Key**: Değişken adı (örn: `VITE_SUPABASE_URL`)\n   - **Value**: Değer (örn: `https://zpohslofrljuepuuwpjf...`)\n   - **Environments**: ✅ Production, ✅ Preview, ✅ Development (hepsini seçin)\n4. **Save** butonuna tıklayın\n5. Tüm değişkenler için tekrarlayın\n\n### Yöntem 2: CLI\n```bash\n# Her variable için:\nvercel env add VITE_SUPABASE_URL\n\n# Sorulacak sorular:\n# - What's the value? → Değeri girin\n# - Environments? → Production, Preview, Development (hepsini seçin)\n```\n\n---\n\n## 🔄 Environment Variables Eklendikten Sonra\n\n### 1. Redeploy Yapın\nEnvironment variables ekledikten sonra **yeniden deploy** etmelisiniz:\n\n```bash\n# CLI ile:\nvercel --prod --force\n\n# Ya da Vercel Dashboard'dan:\n# Deployments → Latest → ... → Redeploy\n```\n\n### 2. Kontrol Edin\nDeploy tamamlandıktan sonra:\n- https://your-app.vercel.app → Ana sayfa açılmalı\n- Duyurular bölümü çalışmalı\n- Fikirler bölümü çalışmalı\n- Oylamalar çalışmalı\n\n---\n\n## 🚨 Önemli Notlar\n\n### Security\n- ⚠️ `SUPABASE_SERVICE_ROLE_KEY` **asla frontend'de kullanılmamalı**\n- ⚠️ `VITE_` prefix'li değişkenler **public'tir** (herkes görebilir)\n- ⚠️ Service role key'i **kimseyle paylaşmayın**\n\n### Debugging\nEğer hala çalışmıyorsa:\n\n1. **Vercel Logs Kontrol**:\n   ```bash\n   vercel logs --follow\n   ```\n\n2. **Browser Console Kontrol**:\n   - F12 → Console → Hataları kontrol edin\n   - Network → API isteklerini kontrol edin\n\n3. **Environment Variables Kontrol**:\n   - Vercel Dashboard → Settings → Environment Variables\n   - Tüm değerlerin doğru girildiğinden emin olun\n\n---\n\n## ✅ Checklist\n\nVercel'de çalışması için:\n\n- [ ] `VITE_SUPABASE_URL` eklendi\n- [ ] `VITE_SUPABASE_ANON_KEY` eklendi\n- [ ] `SUPABASE_URL` eklendi (backend için)\n- [ ] `SUPABASE_SERVICE_ROLE_KEY` eklendi (backend için)\n- [ ] `SESSION_SECRET` eklendi\n- [ ] Tüm environment'lar seçildi (Production, Preview, Development)\n- [ ] Redeploy yapıldı\n- [ ] Site test edildi\n\n---\n\n## 🎯 Hızlı Referans\n\n| Variable | Nereden? | Kullanım |\n|----------|----------|----------|\n| `VITE_SUPABASE_URL` | Supabase → Settings → API → Project URL | Frontend auth |\n| `VITE_SUPABASE_ANON_KEY` | Supabase → Settings → API → anon public | Frontend auth |\n| `SUPABASE_URL` | Aynı (Project URL) | Backend API |\n| `SUPABASE_SERVICE_ROLE_KEY` | Supabase → Settings → API → service_role | Backend admin |\n| `SESSION_SECRET` | `node -e \"console.log(...)\"` | Express session |\n\n---\n\n**🔗 Faydalı Linkler:**\n- Vercel Env Vars: https://vercel.com/docs/environment-variables\n- Supabase Dashboard: https://supabase.com/dashboard\n- Vercel Logs: https://vercel.com/docs/observability/runtime-logs\n","path":null,"size_bytes":4451,"size_tokens":null},"VERCEL_DEPLOYMENT_GUIDE.md":{"content":"# 🚀 Vercel Deployment Rehberi - Maya Meclisi\n\nBu proje **hem Render hem de Vercel'de** deploy edilebilir şekilde yapılandırılmıştır.\n\n## 📁 Klasör Yapısı\n\n```\nmaya-meclisi/\n├── api/                      # Vercel serverless fonksiyonları\n│   └── index.ts             # Express app (Vercel için entry point)\n│\n├── server/                   # Render/development için Express backend\n│   ├── index.ts             # Ana server (Render için)\n│   ├── routes.ts            # API route'ları\n│   ├── vite.ts              # Vite middleware\n│   └── services/            # Backend servisleri\n│\n├── client/                   # Vite React frontend\n│   ├── src/\n│   ├── public/\n│   └── index.html\n│\n├── shared/                   # Ortak tipler ve şemalar\n│   └── schema.ts\n│\n├── dist/                     # Build output (production)\n│   ├── public/              # Frontend static files\n│   └── index.js             # Backend bundle (Render için)\n│\n├── vercel.json              # Vercel yapılandırması\n├── .vercelignore            # Vercel'e upload edilmeyecek dosyalar\n└── package.json\n```\n\n---\n\n## 🌐 İki Platform Karşılaştırması\n\n### Render Deployment\n- **Kullanılan Entry**: `server/index.ts`\n- **Server Type**: Geleneksel Node.js server (Always-on)\n- **Port**: 5000\n- **Build**: `npm run build` → `dist/index.js`\n- **Start**: `npm start` → `node dist/index.js`\n- **Instagram Auto-Sync**: ✅ Aktif (sunucu sürekli çalışır)\n\n### Vercel Deployment\n- **Kullanılan Entry**: `api/index.ts`\n- **Server Type**: Serverless Functions\n- **Build**: `npm run build` → `dist/public/`\n- **API Routes**: Otomatik olarak `/api` altında sunulur\n- **Instagram Auto-Sync**: ⚠️ Sınırlı (cold start'larda çalışır)\n- **Limits**: \n  - Free tier: 10s execution time\n  - Pro tier: 60s execution time\n\n---\n\n## 🔧 Vercel'e Deploy Etme\n\n### 1️⃣ Vercel CLI ile Deploy\n\n```bash\n# Vercel CLI'yi yükle (global)\nnpm i -g vercel\n\n# Proje dizininde deploy et\nvercel\n\n# İlk deployment için sorulan sorular:\n# - Set up and deploy \"~/maya-meclisi\"? Yes\n# - Which scope? (Kendi hesabınızı seçin)\n# - Link to existing project? No\n# - Project name? maya-meclisi (veya istediğiniz isim)\n# - In which directory is your code located? ./\n# - Want to override settings? No\n\n# Production deploy\nvercel --prod\n```\n\n### 2️⃣ Vercel Dashboard ile Deploy (Önerilen)\n\n1. **GitHub/GitLab/Bitbucket'a Push Edin**\n   ```bash\n   git add .\n   git commit -m \"Vercel deployment ready\"\n   git push origin main\n   ```\n\n2. **Vercel Dashboard'a Gidin**\n   - https://vercel.com/dashboard\n   - \"Add New\" → \"Project\"\n   - Repository'nizi import edin\n\n3. **Build Ayarları (Otomatik Algılanır)**\n   - **Framework Preset**: Other\n   - **Build Command**: `vite build` (sadece frontend)\n   - **Output Directory**: `dist/public`\n   - **Install Command**: `npm install`\n   \n   **ÖNEMLİ NOTLAR**:\n   - Backend (`api/index.ts`) Vercel tarafından otomatik build edilir\n   - `server/` ve `shared/` klasörleri **ZORUNLU** (api/index.ts bunları import ediyor)\n   - `.vercelignore` dosyasında `server/` veya `shared/` OLMAMALI!\n\n4. **Environment Variables Ekleyin**\n   ```\n   VITE_SUPABASE_URL=your-supabase-url\n   VITE_SUPABASE_ANON_KEY=your-anon-key\n   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key\n   SESSION_SECRET=your-session-secret\n   \n   # Instagram (opsiyonel)\n   INSTAGRAM_ACCESS_TOKEN=your-token\n   INSTAGRAM_ACCOUNT_ID=your-account-id\n   ```\n\n5. **Deploy!**\n   - \"Deploy\" butonuna tıklayın\n   - Her `main` branch'e push'ta otomatik deploy olur\n\n---\n\n## ⚙️ Vercel Yapılandırma Detayları\n\n### `vercel.json` Açıklaması\n\n```json\n{\n  \"version\": 2,\n  \"buildCommand\": \"npm run build\",              // Frontend + backend build\n  \"outputDirectory\": \"dist/public\",             // Static files dizini\n  \"framework\": null,                            // Custom setup\n  \n  \"functions\": {\n    \"api/index.ts\": {\n      \"memory\": 1024,                           // 1GB RAM\n      \"maxDuration\": 60                         // Max 60s (Pro plan gerekir)\n    }\n  },\n  \n  \"rewrites\": [\n    {\n      \"source\": \"/api/:path*\",                  // Tüm /api/* istekleri\n      \"destination\": \"/api\"                     // api/index.ts'e yönlendir\n    },\n    {\n      \"source\": \"/:path*\",                      // Diğer tüm istekler\n      \"destination\": \"/api\"                     // SPA routing için api'ye\n    }\n  ]\n}\n```\n\n### `.vercelignore` Açıklaması\n\n- Development dosyaları ignore edilir\n- `server/` klasörü ignore edilir (Vercel `api/` kullanır)\n- SQL migration dosyaları ignore edilir\n- Sadece production için gerekli dosyalar upload edilir\n\n---\n\n## 🎯 Build Process\n\n### Local Test (Vercel Dev)\n\n```bash\n# Vercel dev server başlat (Vercel ortamını simüle eder)\nvercel dev\n\n# Otomatik olarak:\n# - Frontend: http://localhost:3000\n# - API: http://localhost:3000/api/*\n```\n\n### Production Build\n\n```bash\n# Manuel build (Vercel'in yaptığı işlem)\nnpm run build\n\n# Sonuç:\n# ├── dist/\n# │   ├── public/              # Frontend (Vercel static hosting)\n# │   │   ├── index.html\n# │   │   ├── assets/\n# │   │   └── ...\n# │   └── index.js             # Backend (Render için, Vercel kullanmaz)\n```\n\n---\n\n## 🔐 Environment Variables\n\n### Frontend (.env veya Vercel Dashboard)\n```bash\nVITE_SUPABASE_URL=https://your-project.supabase.co\nVITE_SUPABASE_ANON_KEY=your-anon-key\n```\n\n### Backend (Vercel Dashboard - Server-side)\n```bash\nSUPABASE_SERVICE_ROLE_KEY=your-service-role-key\nSESSION_SECRET=your-random-secret\nINSTAGRAM_ACCESS_TOKEN=optional\nINSTAGRAM_ACCOUNT_ID=optional\n```\n\n**Not**: `VITE_` prefix'li değişkenler frontend'e inject edilir, diğerleri sadece backend'de kullanılabilir.\n\n---\n\n## 🚨 Önemli Notlar\n\n### 1. Serverless Limitations\n- **Cold Start**: İlk istek yavaş olabilir (~2-3s)\n- **Execution Time**: Max 10s (Free) / 60s (Pro)\n- **Stateless**: Her request farklı instance'da çalışabilir\n- **WebSocket**: Desteklenmez (Instagram webhooks için Render tercih edilebilir)\n\n### 2. Database Connections\n- Supabase connection pooling kullanır, sorun olmaz\n- Her serverless function kendi connection'ını açar\n\n### 3. Instagram Auto-Sync\n- Vercel'de sınırlıdır (serverless nature)\n- Sürekli background job gerekiyorsa Render kullanın\n- Vercel'de cron job eklenebilir (Vercel Cron Jobs feature)\n\n### 4. File Uploads\n- Multer memory storage kullanılır\n- Vercel dosyaları `/tmp` dizinine yazar\n- Kalıcı storage için Supabase Storage kullanın\n\n---\n\n## 📊 Platform Karşılaştırması\n\n| Özellik | Render | Vercel |\n|---------|--------|--------|\n| **Server Type** | Always-on Node.js | Serverless Functions |\n| **Cold Start** | Yok | Var (~2-3s) |\n| **Execution Time** | Sınırsız | 10s (Free) / 60s (Pro) |\n| **Background Jobs** | ✅ Full support | ⚠️ Limited (Cron Jobs) |\n| **Static Files** | Express serve | CDN (çok hızlı) |\n| **WebSocket** | ✅ Desteklenir | ❌ Desteklenmez |\n| **Free Tier** | 750 saat/ay | Unlimited requests* |\n| **Cost** | $7/mo (Hobby) | $20/mo (Pro) |\n| **Build Time** | ~2-3 dakika | ~1-2 dakika |\n| **Deploy Time** | ~30 saniye | ~10 saniye |\n\n\\* Fair use policy uygulanır\n\n---\n\n## ✅ Best Practices\n\n### Render İçin İyi\n- 📱 Instagram auto-sync (24/7 çalışmalı)\n- 🔄 Background job'lar\n- 🌐 WebSocket bağlantıları\n- 💾 Sürekli database connections\n\n### Vercel İçin İyi\n- ⚡ Statik frontend hosting (CDN)\n- 🚀 API endpoints (kısa execution time)\n- 🌍 Global dağıtım (edge network)\n- 📈 Auto-scaling (traffic spike'larda)\n\n### Hibrit Yaklaşım (Önerilen)\n```\nFrontend → Vercel (Hızlı CDN)\nAPI → Vercel (Serverless)\nBackground Jobs → Render (Always-on)\nInstagram Sync → Render (Cron jobs)\nDatabase → Supabase (Her ikisinden erişilebilir)\n```\n\n---\n\n## 🆘 Troubleshooting\n\n### Vercel Build Hatası\n```bash\n# Local'de build test et\nnpm run build\n\n# Logs kontrol et\nvercel logs\n```\n\n### API Routes Çalışmıyor\n- `vercel.json` rewrites kontrolü\n- Environment variables kontrolü\n- Function logs: `vercel logs --follow`\n\n### Cold Start Çok Yavaş\n- Pro plan'e geçin (regions seçimi)\n- Keep-alive istekleri gönderin (cronjob ile)\n\n### Database Connection Error\n- Supabase project ayarlarını kontrol edin\n- Connection pooling aktif olmalı\n- Service role key doğru mu?\n\n---\n\n## 📝 Deployment Checklist\n\n- [ ] GitHub'a push edildi\n- [ ] Vercel project oluşturuldu\n- [ ] Environment variables eklendi\n- [ ] Build başarılı\n- [ ] `/` anasayfa çalışıyor\n- [ ] `/api/announcements` API çalışıyor\n- [ ] Login/logout çalışıyor\n- [ ] Database bağlantısı OK\n- [ ] Custom domain eklendi (opsiyonel)\n\n---\n\n## 🔗 Faydalı Linkler\n\n- **Vercel Dashboard**: https://vercel.com/dashboard\n- **Vercel Docs**: https://vercel.com/docs\n- **Vercel CLI Docs**: https://vercel.com/docs/cli\n- **Supabase Dashboard**: https://supabase.com/dashboard\n\n---\n\n**🎉 Başarılar!** Her iki platformda da sorunsuz çalışacak şekilde yapılandırıldı.\n","path":null,"size_bytes":9191,"size_tokens":null},"client/src/pages/ResetPassword.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { supabase } from \"@/lib/supabase\";\nimport mayaLogo from \"@assets/maya-okullari-logo-simge_1763489344712.webp\";\nimport { CheckCircle2 } from \"lucide-react\";\n\nexport default function ResetPassword() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [validToken, setValidToken] = useState(false);\n  const [checkingToken, setCheckingToken] = useState(true);\n  const [resetSuccess, setResetSuccess] = useState(false);\n\n  // Check if user has valid session (Supabase sets it after verification)\n  useEffect(() => {\n    const checkSession = async () => {\n      try {\n        const { data: { session }, error } = await supabase.auth.getSession();\n        \n        if (error) throw error;\n        \n        if (session?.user) {\n          setValidToken(true);\n        } else {\n          toast({\n            variant: \"destructive\",\n            title: \"Hata\",\n            description: \"Geçersiz veya süresi dolmuş bağlantı\",\n          });\n          setTimeout(() => setLocation(\"/giris\"), 2000);\n        }\n      } catch (error) {\n        console.error(\"Session check error:\", error);\n        toast({\n          variant: \"destructive\",\n          title: \"Hata\",\n          description: \"Bir hata oluştu\",\n        });\n        setTimeout(() => setLocation(\"/giris\"), 2000);\n      } finally {\n        setCheckingToken(false);\n      }\n    };\n    \n    checkSession();\n  }, [toast, setLocation]);\n\n  const handlePasswordReset = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    // Validate new password\n    if (newPassword.length < 8) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Şifre en az 8 karakter olmalıdır\",\n      });\n      return;\n    }\n\n    if (newPassword !== confirmPassword) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Şifreler eşleşmiyor\",\n      });\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const { error } = await supabase.auth.updateUser({\n        password: newPassword\n      });\n\n      if (error) throw error;\n\n      setResetSuccess(true);\n      \n      toast({\n        title: \"Başarılı\",\n        description: \"Şifreniz güncellendi\",\n      });\n\n      // Redirect to login after 3 seconds\n      setTimeout(() => {\n        setLocation(\"/giris\");\n      }, 3000);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Şifre güncellenirken bir hata oluştu\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (checkingToken) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n              <p className=\"text-muted-foreground\">Bağlantı doğrulanıyor...</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!validToken) {\n    return null; // Will redirect to login\n  }\n\n  if (resetSuccess) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"space-y-1\">\n            <div className=\"flex items-center justify-center mb-4\">\n              <img \n                src={mayaLogo} \n                alt=\"Maya Okulları\" \n                className=\"h-12 w-12 object-contain\"\n              />\n            </div>\n            <CardTitle className=\"text-2xl font-bold text-center\">\n              Şifre Güncellendi\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              Yeni şifrenizle giriş yapabilirsiniz\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-col items-center gap-4 py-8\">\n              <CheckCircle2 className=\"h-16 w-16 text-green-500\" />\n              <p className=\"text-center text-muted-foreground\">\n                Giriş sayfasına yönlendiriliyorsunuz...\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <img \n              src={mayaLogo} \n              alt=\"Maya Okulları\" \n              className=\"h-12 w-12 object-contain\"\n            />\n          </div>\n          <CardTitle className=\"text-2xl font-bold text-center\">\n            Yeni Şifre Belirle\n          </CardTitle>\n          <CardDescription className=\"text-center\">\n            Hesabınız için yeni bir şifre oluşturun\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handlePasswordReset} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"newPassword\">Yeni Şifre</Label>\n              <Input\n                id=\"newPassword\"\n                type=\"password\"\n                placeholder=\"En az 8 karakter\"\n                value={newPassword}\n                onChange={(e) => setNewPassword(e.target.value)}\n                required\n                disabled={loading}\n                data-testid=\"input-new-password\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPassword\">Yeni Şifre (Tekrar)</Label>\n              <Input\n                id=\"confirmPassword\"\n                type=\"password\"\n                placeholder=\"Şifrenizi tekrar girin\"\n                value={confirmPassword}\n                onChange={(e) => setConfirmPassword(e.target.value)}\n                required\n                disabled={loading}\n                data-testid=\"input-confirm-password\"\n              />\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full\"\n              disabled={loading}\n              data-testid=\"button-reset-password\"\n            >\n              {loading ? \"Güncelleniyor...\" : \"Şifremi Güncelle\"}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":6995,"size_tokens":null},"SUPABASE_STORAGE_SETUP.md":{"content":"# 📦 Supabase Storage Kurulumu\n\nFile upload özelliği için Supabase Storage bucket'ı oluşturmanız gerekiyor.\n\n---\n\n## 🚀 Adım Adım Kurulum\n\n### 1️⃣ Supabase Dashboard'a Gidin\n\n1. https://supabase.com/dashboard adresine gidin\n2. Projenizi seçin: **zpohslofrljuepuuwpjf**\n3. Sol menüden **Storage** tıklayın\n\n---\n\n### 2️⃣ Bucket Oluşturun\n\n1. **\"Create a new bucket\"** veya **\"New bucket\"** butonuna tıklayın\n\n2. Şu bilgileri girin:\n   ```\n   Name: ideas-media\n   Public bucket: ✅ AÇIK (Public)\n   File size limit: 10 MB\n   Allowed MIME types: Boş bırakın (tüm dosyalar)\n   ```\n\n3. **\"Create bucket\"** butonuna tıklayın\n\n**Önemli:** Public bucket seçmelisiniz ki herkes resimleri görebilsin!\n\n---\n\n### 3️⃣ Storage Policies Ekleyin\n\nBucket oluşturduktan sonra **policies** (güvenlik kuralları) eklemeniz gerekiyor.\n\n#### Yöntem 1: Dashboard'dan (Kolay)\n\n1. Storage → **ideas-media** bucket'ına tıklayın\n2. Üstteki **Policies** sekmesine tıklayın\n3. **\"New Policy\"** butonuna tıklayın\n\n#### 4 Adet Policy Oluşturun:\n\n**Policy 1: Public View (Herkes Görebilir)**\n```\nPolicy name: Public can view files\nAllowed operation: SELECT\nTarget roles: public\nUSING expression: bucket_id = 'ideas-media'\n```\n\n**Policy 2: Authenticated Upload (Giriş Yapanlar Yükleyebilir)**\n```\nPolicy name: Authenticated users can upload\nAllowed operation: INSERT\nTarget roles: authenticated\nWITH CHECK expression: bucket_id = 'ideas-media'\n```\n\n**Policy 3: Owner Delete (Kendi Dosyalarını Silebilir)**\n```\nPolicy name: Users can delete own files\nAllowed operation: DELETE\nTarget roles: authenticated\nUSING expression: bucket_id = 'ideas-media' AND auth.uid()::text = (storage.foldername(name))[1]\n```\n\n**Policy 4: Owner Update (Kendi Dosyalarını Güncelleyebilir)**\n```\nPolicy name: Users can update own files\nAllowed operation: UPDATE\nTarget roles: authenticated\nUSING expression: bucket_id = 'ideas-media' AND auth.uid()::text = (storage.foldername(name))[1]\n```\n\n---\n\n#### Yöntem 2: SQL ile (Hızlı)\n\n**SQL Editor** → **New query** açın ve şunu çalıştırın:\n\n```sql\n-- Policy 1: Herkes görebilir\nCREATE POLICY \"Public can view files\"\nON storage.objects FOR SELECT\nTO public\nUSING (bucket_id = 'ideas-media');\n\n-- Policy 2: Giriş yapanlar yükleyebilir\nCREATE POLICY \"Authenticated users can upload\"\nON storage.objects FOR INSERT\nTO authenticated\nWITH CHECK (bucket_id = 'ideas-media');\n\n-- Policy 3: Kendi dosyalarını silebilir\nCREATE POLICY \"Users can delete own files\"\nON storage.objects FOR DELETE\nTO authenticated\nUSING (\n  bucket_id = 'ideas-media' \n  AND auth.uid()::text = (storage.foldername(name))[1]\n);\n\n-- Policy 4: Kendi dosyalarını güncelleyebilir\nCREATE POLICY \"Users can update own files\"\nON storage.objects FOR UPDATE\nTO authenticated\nUSING (\n  bucket_id = 'ideas-media' \n  AND auth.uid()::text = (storage.foldername(name))[1]\n);\n```\n\n**\"Run\"** butonuna tıklayın.\n\n---\n\n## ✅ Kontrol Edin\n\nKurulum tamamlandıktan sonra kontrol edin:\n\n### Dashboard'da Kontrol:\n\n1. **Storage** → **ideas-media** → **Policies** sekmesi\n2. 4 adet policy görmelisiniz:\n   - ✅ Public can view files (SELECT)\n   - ✅ Authenticated users can upload (INSERT)\n   - ✅ Users can delete own files (DELETE)\n   - ✅ Users can update own files (UPDATE)\n\n---\n\n## 🧪 Test Edin\n\n### 1. Yeni Fikir Ekleyin\n\n1. Maya Meclisi → **Fikirler** sayfası\n2. \"Yeni Fikir Paylaş\" butonuna tıklayın\n3. Resim veya video yükleyin\n4. Fikir içeriğini yazın\n5. \"Paylaş\" butonuna tıklayın\n\n**Beklenen sonuç:**\n- ✅ Dosya yüklenmeli\n- ✅ \"Fikir gönderildi!\" mesajı görünmeli\n- ❌ \"Unexpected token 'A'\" hatası almamalısınız\n\n### 2. Yeni Duyuru Ekleyin (Admin)\n\n1. Admin paneli → **Duyurular** → \"Yeni Duyuru\"\n2. Resim yükleyin (opsiyonel)\n3. Başlık ve içerik yazın\n4. \"Oluştur\" butonuna tıklayın\n\n**Beklenen sonuç:**\n- ✅ Duyuru oluşturulmalı\n- ✅ Resim varsa gösterilmeli\n\n---\n\n## 🐛 Sorun Giderme\n\n### Hata: \"Bucket not found\"\n- ✅ Bucket adını kontrol edin: tam olarak `ideas-media` olmalı\n- ✅ Bucket'ın Public olduğundan emin olun\n\n### Hata: \"new row violates row-level security policy\"\n- ✅ Policies eklediğinizden emin olun\n- ✅ SQL Editor'dan policy'leri kontrol edin:\n  ```sql\n  SELECT * FROM pg_policies WHERE tablename = 'objects';\n  ```\n\n### Hata: \"Dosya yüklenirken hata oluştu\"\n- ✅ Dosya boyutunu kontrol edin (max 10MB)\n- ✅ Supabase environment variables'ları kontrol edin (SUPABASE_SERVICE_ROLE_KEY)\n- ✅ Browser console'da hata loglarını kontrol edin (F12)\n\n### Hata: \"403 Forbidden\"\n- ✅ INSERT policy'si olduğundan emin olun\n- ✅ Kullanıcı giriş yapmış olmalı\n\n---\n\n## 📊 Storage Kullanım İstatistikleri\n\nBucket'ı oluşturduktan sonra kullanım istatistiklerini görebilirsiniz:\n\n**Storage** → **ideas-media** → **Usage**\n- Toplam dosya sayısı\n- Toplam boyut\n- Son yüklenen dosyalar\n\n---\n\n## 🔐 Güvenlik Notları\n\n1. **Public bucket**: Herkes URL ile dosyalara erişebilir\n2. **Dosya adları**: UUID ile şifrelenir (güvenlik için)\n3. **Yetkilendirme**: Sadece giriş yapanlar yükleyebilir\n4. **Silme**: Sadece kendi dosyalarını silebilir\n\n---\n\n## 🎯 Özet Checklist\n\nKurulum için:\n\n- [ ] Supabase Dashboard → Storage açıldı\n- [ ] `ideas-media` bucket'ı oluşturuldu\n- [ ] Bucket **Public** olarak işaretlendi\n- [ ] 4 adet policy eklendi (SELECT, INSERT, DELETE, UPDATE)\n- [ ] Policies kontrol edildi\n- [ ] Yeni fikir ile test edildi\n- [ ] Dosya yükleme çalışıyor ✅\n\n---\n\n**Faydalı Linkler:**\n- Supabase Storage Docs: https://supabase.com/docs/guides/storage\n- Storage Policies Guide: https://supabase.com/docs/guides/storage/security/access-control\n- Maya Meclisi Local: http://localhost:5000\n","path":null,"size_bytes":5759,"size_tokens":null},"client/src/pages/ForgotPassword.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link, useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { supabase } from \"@/lib/supabase\";\nimport mayaLogo from \"@assets/maya-okullari-logo-simge_1763489344712.webp\";\nimport { ChevronLeft } from \"lucide-react\";\n\nexport default function ForgotPassword() {\n  const [, setLocation] = useLocation();\n  const { user, loading: authLoading } = useAuth();\n  const [step, setStep] = useState<\"email\" | \"password\">(\"email\");\n  const [email, setEmail] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const { toast } = useToast();\n\n  // Redirect to home if already logged in\n  useEffect(() => {\n    if (!authLoading && user) {\n      setLocation(\"/\");\n    }\n  }, [user, authLoading, setLocation]);\n\n  const handleEmailSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Geçerli bir e-posta adresi giriniz\",\n      });\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Use hardcoded production URL for email redirect\n      const redirectUrl = import.meta.env.PROD \n        ? 'https://meclis.onrender.com/auth/reset'\n        : 'http://localhost:5000/auth/reset';\n      \n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\n        redirectTo: redirectUrl,\n      });\n      \n      console.log('Password reset email sent with redirectTo:', redirectUrl);\n\n      if (error) throw error;\n\n      toast({\n        title: \"Başarılı\",\n        description: `E-postanızı kontrol edin. Şifre sıfırlama linki ${email} adresine gönderildi.`,\n      });\n      \n      // Clear email for next attempt\n      setEmail(\"\");\n      \n      // Redirect to login after 3 seconds\n      setTimeout(() => {\n        window.location.href = \"/giris\";\n      }, 3000);\n    } catch (error: any) {\n      console.error(\"Error:\", error);\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"Bir hata oluştu\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <img \n              src={mayaLogo} \n              alt=\"Maya Okulları\" \n              className=\"h-12 w-12 object-contain\"\n            />\n          </div>\n          <CardTitle className=\"text-2xl text-center\">Şifre Sıfırlama</CardTitle>\n          <CardDescription className=\"text-center\">\n            Hesabınızın e-posta adresini giriniz\n          </CardDescription>\n        </CardHeader>\n\n        <form onSubmit={handleEmailSubmit} noValidate>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">E-posta</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"soyad-isim@mayaokullari.k12.tr\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                data-testid=\"input-forgot-password-email\"\n              />\n            </div>\n            <div className=\"bg-blue-50 dark:bg-blue-950 p-3 rounded text-sm\">\n              <p className=\"text-blue-700 dark:text-blue-300\">\n                <strong>ℹ️ Bilgi:</strong> Şifre sıfırlama linki e-postanıza gönderilecektir. \n                E-postanızı kontrol ederek linke tıklayın ve yeni şifre belirleyin.\n              </p>\n            </div>\n          </CardContent>\n          <CardFooter className=\"flex flex-col gap-3\">\n            <Button type=\"submit\" className=\"w-full\" disabled={loading} data-testid=\"button-send-reset-link\">\n              {loading ? \"Gönderiliyor...\" : \"Şifre Sıfırlama E-postası Gönder\"}\n            </Button>\n            <Link href=\"/giris\">\n              <Button variant=\"ghost\" className=\"w-full gap-2\" data-testid=\"button-back-to-login\">\n                <ChevronLeft className=\"h-4 w-4\" />\n                Giriş Sayfasına Dön\n              </Button>\n            </Link>\n          </CardFooter>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4846,"size_tokens":null},"client/src/pages/BlutenDetail.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useParams, useLocation, Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { ArrowLeft, Loader2, Instagram, ExternalLink, Play } from \"lucide-react\";\nimport { type BlutenPost } from \"@/lib/api/bluten\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\n\ndayjs.extend(relativeTime);\ndayjs.locale(\"tr\");\n\nexport default function BlutenDetail() {\n  const { id } = useParams();\n  const [, setLocation] = useLocation();\n\n  const { data: post, isLoading, error } = useQuery({\n    queryKey: [\"/api/bluten\", id],\n    queryFn: async () => {\n      const res = await fetch(`/api/bluten/${id}`, {\n        credentials: 'include',\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || 'İçerik yüklenirken hata oluştu');\n      }\n\n      return res.json() as Promise<BlutenPost>;\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !post) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => setLocation(\"/bluten\")}\n          className=\"mb-6\"\n          data-testid=\"button-back-to-bluten\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Bültene Dön\n        </Button>\n        <Card>\n          <CardContent className=\"p-6 text-center\">\n            <p className=\"text-muted-foreground\">İçerik bulunamadı</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <Button\n        variant=\"ghost\"\n        onClick={() => setLocation(\"/bluten\")}\n        className=\"mb-6\"\n        data-testid=\"button-back-to-bluten\"\n      >\n        <ArrowLeft className=\"h-4 w-4 mr-2\" />\n        Bültene Dön\n      </Button>\n\n      <div className=\"max-w-2xl mx-auto\">\n        <Card className=\"overflow-hidden\">\n          {/* Media */}\n          {post.media_url && (\n            <div className=\"w-full bg-muted\">\n              {post.media_type === \"VIDEO\" ? (\n                <div className=\"relative bg-black aspect-video flex items-center justify-center\">\n                  <video\n                    src={post.media_url}\n                    controls\n                    className=\"w-full h-full\"\n                    data-testid=\"video-post-media\"\n                  />\n                </div>\n              ) : (\n                <img\n                  src={post.media_url}\n                  alt={post.caption || \"Instagram post\"}\n                  className=\"w-full h-auto\"\n                  data-testid=\"img-post-media\"\n                />\n              )}\n            </div>\n          )}\n\n          {!post.media_url && (\n            <div className=\"w-full bg-gradient-to-br from-primary/10 to-primary/5 aspect-video flex items-center justify-center\">\n              <div className=\"text-center\">\n                <Instagram className=\"h-16 w-16 text-primary/30 mx-auto mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">Görsel bulunamadı</p>\n              </div>\n            </div>\n          )}\n\n          {/* Content */}\n          <CardContent className=\"p-8\">\n            {/* Caption */}\n            {post.caption && (\n              <div className=\"mb-6\">\n                <p className=\"text-lg whitespace-pre-wrap\" data-testid=\"text-post-caption\">\n                  {post.caption}\n                </p>\n              </div>\n            )}\n\n            {/* Metadata */}\n            <div className=\"flex items-center justify-between pt-6 border-t text-sm text-muted-foreground mb-6\">\n              <div className=\"flex items-center gap-2\">\n                <Instagram className=\"h-4 w-4\" />\n                <span>{post.username || \"Maya Meclisi\"}</span>\n              </div>\n              <span data-testid=\"text-post-date\">\n                {post.posted_at\n                  ? dayjs(post.posted_at).format(\"DD MMMM YYYY HH:mm\")\n                  : dayjs(post.fetched_at).format(\"DD MMMM YYYY HH:mm\")}\n              </span>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-3\">\n              <Button\n                asChild\n                variant=\"default\"\n                className=\"flex-1\"\n                data-testid=\"button-open-instagram\"\n              >\n                <a\n                  href={post.instagram_url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"flex items-center justify-center gap-2\"\n                >\n                  <Instagram className=\"h-4 w-4\" />\n                  Instagram'da Aç\n                  <ExternalLink className=\"h-3 w-3\" />\n                </a>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5145,"size_tokens":null},"client/src/pages/GizlilikPolitikasi.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Shield, AlertTriangle, Building } from \"lucide-react\";\n\nexport default function GizlilikPolitikasi() {\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      <Card>\n        <CardHeader className=\"border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <Shield className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-2xl\">Gizlilik Politikası</CardTitle>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Son güncelleme: {new Date().toLocaleDateString('tr-TR')}\n              </p>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          <ScrollArea className=\"h-[60vh] pr-4\">\n            <div className=\"space-y-6\">\n              <section className=\"space-y-4\">\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Bu sayfa, Maya Okulları Öğrenci Meclisi web sitesinde işlenen kişisel verilerin gizliliğini ve veri güvenliği esaslarını açıklamak amacıyla oluşturulmuştur.\n                </p>\n\n                <div className=\"p-4 bg-yellow-500/10 rounded-lg border border-yellow-500/20\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className=\"h-5 w-5 text-yellow-500 shrink-0 mt-0.5\" />\n                    <div className=\"space-y-2\">\n                      <p className=\"font-medium\">İçerik Güncelleme Bildirimi</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Bu sayfanın detaylı içeriği okul yönetimi ve hukuki danışmanlık doğrultusunda güncellenecektir. Şu anda temel bilgiler sunulmaktadır.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4 mt-6\">\n                  <h2 className=\"text-lg font-semibold\">Toplanan Veriler</h2>\n                  <ul className=\"list-disc pl-5 space-y-2 text-muted-foreground\">\n                    <li>Kullanıcı kimlik bilgileri (ad, soyad, e-posta)</li>\n                    <li>Okul ve sınıf bilgileri</li>\n                    <li>Profil fotoğrafları</li>\n                    <li>Site kullanım verileri ve log kayıtları</li>\n                    <li>Paylaşılan içerikler (fikirler, yorumlar, beğeniler)</li>\n                  </ul>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">Verilerin Kullanım Amacı</h2>\n                  <ul className=\"list-disc pl-5 space-y-2 text-muted-foreground\">\n                    <li>Site hizmetlerinin sunulması</li>\n                    <li>Kullanıcı deneyiminin iyileştirilmesi</li>\n                    <li>Güvenlik ve moderasyon işlemleri</li>\n                    <li>Yasal yükümlülüklerin yerine getirilmesi</li>\n                  </ul>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">Veri Güvenliği</h2>\n                  <p className=\"text-muted-foreground\">\n                    Kişisel verileriniz, teknik ve idari önlemlerle korunmaktadır. Verilerinize yetkisiz erişimi önlemek için endüstri standardı güvenlik protokolleri uygulanmaktadır.\n                  </p>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">Veri Paylaşımı</h2>\n                  <p className=\"text-muted-foreground\">\n                    Kişisel verileriniz, yasal zorunluluklar dışında üçüncü taraflarla paylaşılmamaktadır. Okul yönetimi ve yetkili kurumlar dışında hiçbir kuruluşa veri aktarımı yapılmamaktadır.\n                  </p>\n                </div>\n              </section>\n\n              <section className=\"pt-4 border-t\">\n                <h2 className=\"text-lg font-semibold mb-3\">İletişim</h2>\n                <div className=\"p-4 bg-muted/50 rounded-lg\">\n                  <div className=\"flex items-center gap-2\">\n                    <Building className=\"h-4 w-4 text-muted-foreground\" />\n                    <span>Maya Okulları Öğrenci Meclisi</span>\n                  </div>\n                </div>\n              </section>\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4623,"size_tokens":null},"client/src/pages/KVKKAydinlatma.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Scale, AlertTriangle, Building } from \"lucide-react\";\n\nexport default function KVKKAydinlatma() {\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      <Card>\n        <CardHeader className=\"border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <Scale className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-2xl\">KVKK Aydınlatma Metni</CardTitle>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                6698 Sayılı Kişisel Verilerin Korunması Kanunu\n              </p>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          <ScrollArea className=\"h-[60vh] pr-4\">\n            <div className=\"space-y-6\">\n              <section className=\"space-y-4\">\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Bu metin, 6698 sayılı Kişisel Verilerin Korunması Kanunu (\"KVKK\") kapsamında kişisel verilerin işlenmesine ilişkin kullanıcıları bilgilendirmek amacıyla hazırlanmıştır.\n                </p>\n\n                <div className=\"p-4 bg-yellow-500/10 rounded-lg border border-yellow-500/20\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className=\"h-5 w-5 text-yellow-500 shrink-0 mt-0.5\" />\n                    <div className=\"space-y-2\">\n                      <p className=\"font-medium\">İçerik Güncelleme Bildirimi</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        Detaylı aydınlatma metni içeriği okul yönetimi tarafından hukuki danışmanlık doğrultusunda eklenecektir. Şu anda özet bilgiler sunulmaktadır.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4 mt-6\">\n                  <h2 className=\"text-lg font-semibold\">Veri Sorumlusu</h2>\n                  <p className=\"text-muted-foreground\">\n                    Maya Okulları, kişisel verilerinizin işlenmesi bakımından \"Veri Sorumlusu\" sıfatını taşımaktadır.\n                  </p>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">İşlenen Kişisel Veriler</h2>\n                  <ul className=\"list-disc pl-5 space-y-2 text-muted-foreground\">\n                    <li><strong>Kimlik Verileri:</strong> Ad, soyad, öğrenci numarası</li>\n                    <li><strong>İletişim Verileri:</strong> E-posta adresi</li>\n                    <li><strong>Görsel Veriler:</strong> Profil fotoğrafı</li>\n                    <li><strong>Eğitim Verileri:</strong> Sınıf bilgisi, okul bilgisi</li>\n                    <li><strong>İşlem Güvenliği:</strong> Log kayıtları, IP adresi</li>\n                  </ul>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">Veri İşleme Amaçları</h2>\n                  <ul className=\"list-disc pl-5 space-y-2 text-muted-foreground\">\n                    <li>Öğrenci meclisi platformunun işletilmesi</li>\n                    <li>Kullanıcı kimlik doğrulaması</li>\n                    <li>İçerik moderasyonu ve denetimi</li>\n                    <li>Güvenlik önlemlerinin alınması</li>\n                    <li>Yasal yükümlülüklerin yerine getirilmesi</li>\n                  </ul>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">Hukuki Sebepler</h2>\n                  <p className=\"text-muted-foreground\">\n                    Kişisel verileriniz, KVKK'nın 5. ve 6. maddelerinde belirtilen:\n                  </p>\n                  <ul className=\"list-disc pl-5 space-y-2 text-muted-foreground\">\n                    <li>Açık rızanızın bulunması</li>\n                    <li>Kanunlarda açıkça öngörülmesi</li>\n                    <li>Meşru menfaat için zorunlu olması</li>\n                  </ul>\n                  <p className=\"text-muted-foreground mt-2\">\n                    hukuki sebeplerine dayanılarak işlenmektedir.\n                  </p>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">KVKK Kapsamındaki Haklarınız</h2>\n                  <p className=\"text-muted-foreground\">\n                    KVKK'nın 11. maddesi kapsamında aşağıdaki haklara sahipsiniz:\n                  </p>\n                  <ul className=\"list-disc pl-5 space-y-2 text-muted-foreground\">\n                    <li>Kişisel verilerinizin işlenip işlenmediğini öğrenme</li>\n                    <li>İşlenmişse buna ilişkin bilgi talep etme</li>\n                    <li>İşlenme amacını ve bunların amacına uygun kullanılıp kullanılmadığını öğrenme</li>\n                    <li>Yurt içinde veya yurt dışında aktarıldığı üçüncü kişileri bilme</li>\n                    <li>Eksik veya yanlış işlenmiş olması halinde düzeltilmesini isteme</li>\n                    <li>Silinmesini veya yok edilmesini isteme</li>\n                    <li>İşlenen verilerin münhasıran otomatik sistemler vasıtasıyla analiz edilmesi suretiyle aleyhinize bir sonucun ortaya çıkmasına itiraz etme</li>\n                    <li>Kanuna aykırı olarak işlenmesi sebebiyle zarara uğramanız halinde zararın giderilmesini talep etme</li>\n                  </ul>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-lg font-semibold\">Özel Nitelikli Kişisel Veriler</h2>\n                  <p className=\"text-muted-foreground\">\n                    Reşit olmayan öğrencilere ait kişisel veriler özel koruma altındadır. Bu verilerin işlenmesinde ek güvenlik önlemleri alınmakta ve veli/vasi bilgilendirmesi yapılmaktadır.\n                  </p>\n                </div>\n              </section>\n\n              <section className=\"pt-4 border-t\">\n                <h2 className=\"text-lg font-semibold mb-3\">Başvuru ve İletişim</h2>\n                <p className=\"text-muted-foreground mb-3\">\n                  KVKK kapsamındaki haklarınızı kullanmak için aşağıdaki iletişim bilgilerinden bize ulaşabilirsiniz:\n                </p>\n                <div className=\"p-4 bg-muted/50 rounded-lg space-y-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Building className=\"h-4 w-4 text-muted-foreground\" />\n                    <span>Maya Okulları Öğrenci Meclisi</span>\n                  </div>\n                </div>\n              </section>\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":7037,"size_tokens":null},"client/src/pages/KullanimSartlari.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { FileText, AlertTriangle, Shield, Users, Camera, MessageCircle, Heart, Scale, BookOpen, Clock, Ban, Database, Gavel, Mail, Building } from \"lucide-react\";\n\nexport default function KullanimSartlari() {\n  return (\n    <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n      <Card>\n        <CardHeader className=\"border-b\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <FileText className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-2xl\">Kullanım Şartları</CardTitle>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Son güncelleme: {new Date().toLocaleDateString('tr-TR')}\n              </p>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          <ScrollArea className=\"h-[70vh] pr-4\">\n            <div className=\"space-y-8\">\n              {/* Giriş */}\n              <section>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Bu Kullanım Şartları, Maya Okulları Öğrenci Meclisi web sitesini (\"Site\") kullanan tüm kullanıcılar için geçerlidir. Siteye erişim sağlayarak veya siteyi kullanarak bu şartları kabul etmiş sayılırsınız. Lütfen bu şartları dikkatlice okuyunuz.\n                </p>\n              </section>\n\n              {/* Madde 1 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5 text-primary\" />\n                  <h2 className=\"text-lg font-semibold\">1. Kullanıcı Tanımları</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p><strong>Öğrenci:</strong> Maya Okulları'na kayıtlı, siteye erişim yetkisi verilen öğrencidir.</p>\n                  <p><strong>Öğretmen:</strong> Maya Okulları'nda görev yapan ve siteye erişim yetkisi verilen öğretmendir.</p>\n                  <p><strong>Yönetici (Admin):</strong> Sitenin içerik ve kullanıcı yönetiminden sorumlu yetkili personeldir.</p>\n                  <p><strong>Veli/Vasisi:</strong> Reşit olmayan öğrencilerin yasal temsilcisidir.</p>\n                </div>\n              </section>\n\n              {/* Madde 2 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <AlertTriangle className=\"h-5 w-5 text-yellow-500\" />\n                  <h2 className=\"text-lg font-semibold\">2. Reşit Olmayan Kullanıcılar</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Bu site, çoğunlukla 18 yaşından küçük öğrenciler tarafından kullanılmaktadır. Bu nedenle:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Site içeriği eğitim amaçlıdır ve okul kurallarına tabidir.</li>\n                    <li>Kullanıcılar, velilerinin/vasilerinin bilgisi dahilinde siteyi kullanmalıdır.</li>\n                    <li>18 yaş altı kullanıcıların kişisel verileri özel koruma altındadır.</li>\n                    <li>Uygunsuz içerik paylaşımı derhal silinir ve disiplin sürecine tabidir.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 3 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5 text-green-500\" />\n                  <h2 className=\"text-lg font-semibold\">3. Hesap Güvenliği</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Her kullanıcı:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Hesap bilgilerini gizli tutmakla yükümlüdür.</li>\n                    <li>Şifresini kimseyle paylaşmamalıdır.</li>\n                    <li>Hesabında gerçekleşen tüm aktivitelerden sorumludur.</li>\n                    <li>Şüpheli bir durumda derhal yöneticiye bildirimde bulunmalıdır.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 4 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Camera className=\"h-5 w-5 text-blue-500\" />\n                  <h2 className=\"text-lg font-semibold\">4. Profil Fotoğrafı Kuralları</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Profil fotoğrafları aşağıdaki kurallara uygun olmalıdır:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Sadece kullanıcının kendi fotoğrafı kullanılabilir.</li>\n                    <li>Fotoğraf okul ortamına uygun olmalıdır.</li>\n                    <li>Uygunsuz, müstehcen veya rahatsız edici görseller yasaktır.</li>\n                    <li>Başkalarının fotoğraflarını kullanmak yasaktır.</li>\n                    <li>Telif hakkı ihlali içeren görseller yasaktır.</li>\n                    <li>Şiddet, nefret veya ayrımcılık içeren görseller yasaktır.</li>\n                  </ul>\n                  <div className=\"mt-3 p-3 bg-yellow-500/10 rounded-lg border border-yellow-500/20\">\n                    <p className=\"text-sm flex items-start gap-2\">\n                      <AlertTriangle className=\"h-4 w-4 text-yellow-500 shrink-0 mt-0.5\" />\n                      <span>Uygunsuz profil fotoğrafları yönetici tarafından silinir ve hesap askıya alınabilir. Her profil fotoğrafı değişikliği kayıt altına alınır.</span>\n                    </p>\n                  </div>\n                </div>\n              </section>\n\n              {/* Madde 5 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <MessageCircle className=\"h-5 w-5 text-purple-500\" />\n                  <h2 className=\"text-lg font-semibold\">5. Yorum Kuralları</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Sitede yapılan yorumlar:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Saygılı ve yapıcı olmalıdır.</li>\n                    <li>Hakaret, küfür, aşağılama içermemelidir.</li>\n                    <li>Kişisel saldırı ve zorbalık yasaktır.</li>\n                    <li>Spam, reklam ve tanıtım içermemelidir.</li>\n                    <li>Kişisel bilgi paylaşımı (telefon, adres vb.) yasaktır.</li>\n                    <li>Yönetici onayından sonra yayınlanır.</li>\n                  </ul>\n                  <p className=\"mt-2\">Tüm yorumlar kayıt altına alınır ve silinen yorumlar da log sisteminde saklanır.</p>\n                </div>\n              </section>\n\n              {/* Madde 6 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Heart className=\"h-5 w-5 text-red-500\" />\n                  <h2 className=\"text-lg font-semibold\">6. Beğeni (Like) Sistemi</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Beğeni sistemi kullanımı:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Her kullanıcı bir içeriği yalnızca bir kez beğenebilir.</li>\n                    <li>Beğeniler kayıt altına alınır.</li>\n                    <li>Manipülasyon veya kötüye kullanım tespit edilirse hesap askıya alınabilir.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 7 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <BookOpen className=\"h-5 w-5 text-indigo-500\" />\n                  <h2 className=\"text-lg font-semibold\">7. İçerik Paylaşım Kuralları</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Kullanıcılar içerik paylaşırken:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Okul kurallarına ve yasalara uygun davranmalıdır.</li>\n                    <li>Telif hakkı ihlali yapmamalıdır.</li>\n                    <li>Yanlış veya yanıltıcı bilgi paylaşmamalıdır.</li>\n                    <li>Kişisel verileri izinsiz paylaşmamalıdır.</li>\n                    <li>Siyasi, dini veya ideolojik propaganda yapmamalıdır.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 8 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Scale className=\"h-5 w-5 text-orange-500\" />\n                  <h2 className=\"text-lg font-semibold\">8. İçerik Denetimi ve Moderasyon</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Site yönetimi:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Tüm içerikleri denetleme hakkına sahiptir.</li>\n                    <li>Uygunsuz içerikleri önceden bildirim yapmadan silebilir.</li>\n                    <li>Fikirler ve yorumlar yayınlanmadan önce onay sürecinden geçer.</li>\n                    <li>Reddedilen içerikler hakkında kullanıcı bilgilendirilir.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 9 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Database className=\"h-5 w-5 text-cyan-500\" />\n                  <h2 className=\"text-lg font-semibold\">9. Kayıt ve Log Sistemi</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Sistem güvenliği ve hukuki sorumluluk için aşağıdaki veriler kayıt altına alınır:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Kullanıcı giriş ve çıkış işlemleri</li>\n                    <li>Profil fotoğrafı değişiklikleri</li>\n                    <li>Yorum oluşturma ve silme işlemleri</li>\n                    <li>Beğeni işlemleri</li>\n                    <li>İçerik paylaşım ve düzenleme işlemleri</li>\n                    <li>Yönetici tarafından yapılan moderasyon işlemleri</li>\n                  </ul>\n                  <p className=\"mt-2\">Bu kayıtlar yasal süreçlerde delil olarak kullanılabilir.</p>\n                </div>\n              </section>\n\n              {/* Madde 10 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Ban className=\"h-5 w-5 text-red-600\" />\n                  <h2 className=\"text-lg font-semibold\">10. Yasaklı Davranışlar</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Aşağıdaki davranışlar kesinlikle yasaktır:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Siber zorbalık ve taciz</li>\n                    <li>Nefret söylemi ve ayrımcılık</li>\n                    <li>Müstehcen veya uygunsuz içerik paylaşımı</li>\n                    <li>Başkalarının kimliğini taklit etme</li>\n                    <li>Sisteme yetkisiz erişim girişimi</li>\n                    <li>Kötü amaçlı yazılım paylaşımı</li>\n                    <li>Spam ve istenmeyen mesaj gönderimi</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 11 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Gavel className=\"h-5 w-5 text-amber-600\" />\n                  <h2 className=\"text-lg font-semibold\">11. Disiplin Süreci</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Kural ihlallerinde uygulanacak yaptırımlar:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li><strong>Uyarı:</strong> İlk ihlallerde yazılı uyarı verilir.</li>\n                    <li><strong>Geçici Askıya Alma:</strong> Tekrarlayan ihlallerde hesap geçici olarak askıya alınır.</li>\n                    <li><strong>Kalıcı Kapatma:</strong> Ciddi ihlallerde hesap kalıcı olarak kapatılır.</li>\n                    <li><strong>Okul Disiplin Kurulu:</strong> Gerekli durumlarda konu okul yönetimine bildirilir.</li>\n                  </ul>\n                  <p className=\"mt-2\">Tüm disiplin işlemleri kayıt altına alınır ve veliye/vasiye bildirilir.</p>\n                </div>\n              </section>\n\n              {/* Madde 12 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5 text-teal-500\" />\n                  <h2 className=\"text-lg font-semibold\">12. Gizlilik ve Veri Koruma</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Kullanıcı verileri:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>6698 sayılı KVKK kapsamında korunur.</li>\n                    <li>Sadece eğitim amaçlı kullanılır.</li>\n                    <li>Üçüncü taraflarla izinsiz paylaşılmaz.</li>\n                    <li>Güvenli ortamlarda saklanır.</li>\n                  </ul>\n                  <p className=\"mt-2\">Detaylı bilgi için Gizlilik Politikası ve KVKK Aydınlatma Metni'ni inceleyiniz.</p>\n                </div>\n              </section>\n\n              {/* Madde 13 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5 text-slate-500\" />\n                  <h2 className=\"text-lg font-semibold\">13. Şartlarda Değişiklik</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Maya Okulları:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Bu kullanım şartlarını önceden bildirim yaparak değiştirme hakkını saklı tutar.</li>\n                    <li>Değişiklikler sitede yayınlandığı tarihte yürürlüğe girer.</li>\n                    <li>Kullanıcılar, değişikliklerden sonra siteyi kullanmaya devam etmeleri halinde yeni şartları kabul etmiş sayılır.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 14 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Scale className=\"h-5 w-5 text-violet-500\" />\n                  <h2 className=\"text-lg font-semibold\">14. Sorumluluk Reddi</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Maya Okulları:</p>\n                  <ul className=\"list-disc pl-5 space-y-1\">\n                    <li>Kullanıcılar tarafından paylaşılan içeriklerden sorumlu değildir.</li>\n                    <li>Sitenin kesintisiz veya hatasız çalışacağını garanti etmez.</li>\n                    <li>Teknik arızalardan kaynaklanan veri kayıplarından sorumlu tutulamaz.</li>\n                    <li>Kullanıcıların birbirleriyle olan anlaşmazlıklarından sorumlu değildir.</li>\n                  </ul>\n                </div>\n              </section>\n\n              {/* Madde 15 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Gavel className=\"h-5 w-5 text-rose-600\" />\n                  <h2 className=\"text-lg font-semibold\">15. Uygulanacak Hukuk</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Bu kullanım şartları Türkiye Cumhuriyeti kanunlarına tabidir. Uyuşmazlıklarda İstanbul Mahkemeleri ve İcra Daireleri yetkilidir.</p>\n                </div>\n              </section>\n\n              {/* Madde 16 */}\n              <section className=\"space-y-3\">\n                <div className=\"flex items-center gap-2\">\n                  <Mail className=\"h-5 w-5 text-sky-500\" />\n                  <h2 className=\"text-lg font-semibold\">16. İletişim</h2>\n                </div>\n                <div className=\"pl-7 space-y-2 text-muted-foreground\">\n                  <p>Kullanım şartları hakkında sorularınız için:</p>\n                  <div className=\"mt-3 p-4 bg-muted/50 rounded-lg\">\n                    <div className=\"flex items-center gap-2\">\n                      <Building className=\"h-4 w-4 text-muted-foreground\" />\n                      <span>Maya Okulları Öğrenci Meclisi</span>\n                    </div>\n                  </div>\n                </div>\n              </section>\n\n              {/* Sonuç */}\n              <section className=\"pt-4 border-t\">\n                <div className=\"p-4 bg-primary/5 rounded-lg\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    Bu siteyi kullanarak yukarıdaki tüm kullanım şartlarını okuduğunuzu, anladığınızı ve kabul ettiğinizi beyan etmiş olursunuz. Şartları kabul etmiyorsanız, siteyi kullanmayınız.\n                  </p>\n                </div>\n              </section>\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":18071,"size_tokens":null},"client/src/components/CookieBanner.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Cookie } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function CookieBanner() {\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    const cookiesAccepted = localStorage.getItem(\"cookiesAccepted\");\n    if (!cookiesAccepted) {\n      setIsVisible(true);\n    }\n  }, []);\n\n  const handleAccept = () => {\n    localStorage.setItem(\"cookiesAccepted\", \"true\");\n    setIsVisible(false);\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 z-50 p-4 bg-card border-t shadow-lg\" data-testid=\"cookie-banner\">\n      <div className=\"container mx-auto max-w-4xl\">\n        <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n          <div className=\"flex items-start gap-3\">\n            <Cookie className=\"h-5 w-5 text-primary shrink-0 mt-0.5\" />\n            <div className=\"text-sm\">\n              <p className=\"text-foreground\">\n                Bu site, deneyiminizi iyileştirmek için çerezler kullanmaktadır.\n              </p>\n              <p className=\"text-muted-foreground mt-1\">\n                Sitemizi kullanmaya devam ederek{\" \"}\n                <Link href=\"/gizlilik-politikasi\" className=\"text-primary hover:underline\">\n                  Gizlilik Politikamızı\n                </Link>{\" \"}\n                kabul etmiş olursunuz.\n              </p>\n            </div>\n          </div>\n          <Button \n            onClick={handleAccept} \n            className=\"shrink-0\"\n            data-testid=\"button-accept-cookies\"\n          >\n            Tümünü Kabul Et\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1758,"size_tokens":null},"client/src/components/NotificationBell.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Bell, CheckCheck, Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from \"@/components/ui/dropdown-menu\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\n\ndayjs.extend(relativeTime);\ndayjs.locale(\"tr\");\n\ninterface Notification {\n  id: string;\n  user_id: string;\n  type: string;\n  title: string;\n  message: string;\n  link?: string;\n  is_read: boolean;\n  created_at: string;\n}\n\nexport default function NotificationBell() {\n  const [open, setOpen] = useState(false);\n  const { user, session } = useAuth();\n  const [, setLocation] = useLocation();\n\n  const getAuthHeaders = (): Record<string, string> => {\n    if (session?.access_token) {\n      return {\n        'Authorization': `Bearer ${session.access_token}`,\n        'Content-Type': 'application/json',\n      };\n    }\n    return { 'Content-Type': 'application/json' };\n  };\n\n  const { data: notifications = [], isLoading } = useQuery<Notification[]>({\n    queryKey: ['/api/notifications'],\n    queryFn: async () => {\n      const res = await fetch('/api/notifications', { \n        credentials: 'include',\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error('Failed to fetch notifications');\n      return res.json();\n    },\n    enabled: !!user && !!session,\n    refetchInterval: 30000,\n  });\n\n  const { data: unreadData } = useQuery<{ count: number }>({\n    queryKey: ['/api/notifications/unread-count'],\n    queryFn: async () => {\n      const res = await fetch('/api/notifications/unread-count', { \n        credentials: 'include',\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error('Failed to fetch unread count');\n      return res.json();\n    },\n    enabled: !!user && !!session,\n    refetchInterval: 30000,\n  });\n\n  const unreadCount = unreadData?.count || 0;\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await fetch(`/api/notifications/${id}/read`, {\n        method: 'PATCH',\n        credentials: 'include',\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error('Failed to mark as read');\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications/unread-count'] });\n    },\n  });\n\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () => {\n      const res = await fetch('/api/notifications/read-all', {\n        method: 'PATCH',\n        credentials: 'include',\n        headers: getAuthHeaders(),\n      });\n      if (!res.ok) throw new Error('Failed to mark all as read');\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/notifications/unread-count'] });\n    },\n  });\n\n  const handleNotificationClick = (notification: Notification) => {\n    if (!notification.is_read) {\n      markAsReadMutation.mutate(notification.id);\n    }\n    if (notification.link) {\n      setLocation(notification.link);\n    }\n    setOpen(false);\n  };\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case 'idea_approved':\n      case 'comment_approved':\n      case 'announcement_comment_approved':\n        return '✅';\n      case 'idea_rejected':\n      case 'comment_rejected':\n      case 'announcement_comment_rejected':\n        return '❌';\n      case 'reply_received':\n        return '💬';\n      default:\n        return '🔔';\n    }\n  };\n\n  if (!user) return null;\n\n  return (\n    <DropdownMenu open={open} onOpenChange={setOpen}>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"icon\" \n          className=\"relative\"\n          data-testid=\"button-notifications\"\n        >\n          <Bell className=\"h-5 w-5\" />\n          {unreadCount > 0 && (\n            <Badge \n              variant=\"destructive\" \n              className=\"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs\"\n            >\n              {unreadCount > 9 ? '9+' : unreadCount}\n            </Badge>\n          )}\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-80\">\n        <div className=\"flex items-center justify-between px-3 py-2 border-b\">\n          <span className=\"font-semibold text-sm\">Bildirimler</span>\n          {unreadCount > 0 && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-auto py-1 px-2 text-xs text-primary\"\n              onClick={() => markAllAsReadMutation.mutate()}\n              disabled={markAllAsReadMutation.isPending}\n              data-testid=\"button-mark-all-read\"\n            >\n              <CheckCheck className=\"h-3 w-3 mr-1\" />\n              Tümünü Okundu İşaretle\n            </Button>\n          )}\n        </div>\n        <ScrollArea className=\"h-[300px]\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : notifications.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-8 text-muted-foreground\">\n              <Bell className=\"h-8 w-8 mb-2 opacity-50\" />\n              <p className=\"text-sm\">Henüz bildirim yok</p>\n            </div>\n          ) : (\n            <div>\n              {notifications.map((notification) => (\n                <DropdownMenuItem\n                  key={notification.id}\n                  className={`flex flex-col items-start gap-1 p-3 cursor-pointer ${\n                    !notification.is_read ? 'bg-primary/5' : ''\n                  }`}\n                  onClick={() => handleNotificationClick(notification)}\n                  data-testid={`notification-${notification.id}`}\n                >\n                  <div className=\"flex items-start gap-2 w-full\">\n                    <span className=\"text-lg shrink-0\">{getNotificationIcon(notification.type)}</span>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className={`text-sm font-medium ${!notification.is_read ? 'text-foreground' : 'text-muted-foreground'}`}>\n                        {notification.title}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground line-clamp-2\">\n                        {notification.message}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {dayjs(notification.created_at).fromNow()}\n                      </p>\n                    </div>\n                    {!notification.is_read && (\n                      <div className=\"w-2 h-2 rounded-full bg-primary shrink-0 mt-1\" />\n                    )}\n                  </div>\n                </DropdownMenuItem>\n              ))}\n            </div>\n          )}\n        </ScrollArea>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":7587,"size_tokens":null},"client/src/lib/api/events.ts":{"content":"import { supabase } from '../supabase';\nimport type { Event, InsertEvent, UpdateEvent, EventApplication, FormField } from '@shared/schema';\n\nexport async function getAdminEvents(): Promise<Event[]> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/events', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Etkinlikler yüklenirken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function createEvent(data: {\n  name: string;\n  description?: string;\n  is_active?: boolean;\n  event_date?: string;\n  end_date?: string;\n  form_fields?: FormField[];\n}): Promise<Event> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/admin/events', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    body: JSON.stringify(data),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Etkinlik oluşturulurken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function updateEvent(id: string, data: {\n  name?: string;\n  description?: string;\n  is_active?: boolean;\n  event_date?: string | null;\n  end_date?: string | null;\n  form_fields?: FormField[];\n}): Promise<Event> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/events/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    body: JSON.stringify(data),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Etkinlik güncellenirken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function deleteEvent(id: string): Promise<void> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/events/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Etkinlik silinirken hata oluştu');\n  }\n}\n\nexport interface EventApplicationWithProfile extends EventApplication {\n  profile?: {\n    first_name: string | null;\n    last_name: string | null;\n    class_name: string | null;\n    student_no: string | null;\n    user_id: string;\n  };\n}\n\nexport async function getEventApplications(eventId: string): Promise<EventApplicationWithProfile[]> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/admin/events/${eventId}/applications`, {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Başvurular yüklenirken hata oluştu');\n  }\n  return res.json();\n}\n\n// ============================================\n// STUDENT-FACING API FUNCTIONS\n// ============================================\n\nexport interface EventWithStatus extends Event {\n  has_applied?: boolean;\n}\n\nexport async function getEvents(): Promise<EventWithStatus[]> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch('/api/events', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Etkinlikler yüklenirken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function getEventDetails(id: string): Promise<EventWithStatus> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/events/${id}`, {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Etkinlik detayları yüklenirken hata oluştu');\n  }\n  return res.json();\n}\n\nexport async function applyToEvent(id: string, responses: Record<string, string>): Promise<EventApplication> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n\n  const res = await fetch(`/api/events/${id}/apply`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n    body: JSON.stringify({ responses }),\n  });\n\n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Başvuru gönderilirken hata oluştu');\n  }\n  return res.json();\n}\n","path":null,"size_bytes":5201,"size_tokens":null},"client/src/pages/Basvurular.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { getEvents, getEventDetails, applyToEvent, type EventWithStatus } from \"@/lib/api/events\";\nimport type { FormField } from \"@shared/schema\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Form,\n  FormControl,\n  FormField as FormFieldComponent,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { Calendar, Check, ClipboardList, FileText, Loader2 } from \"lucide-react\";\nimport { supabase } from \"@/lib/supabase\";\n\nexport default function Basvurular() {\n  const { user, profile } = useAuth();\n  const { toast } = useToast();\n  const [selectedEvent, setSelectedEvent] = useState<EventWithStatus | null>(null);\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [userEmail, setUserEmail] = useState<string>(\"\");\n\n  const { data: events, isLoading } = useQuery({\n    queryKey: [\"/api/events\"],\n    queryFn: getEvents,\n    enabled: !!user,\n  });\n\n  const openApplicationDialog = async (event: EventWithStatus) => {\n    setSelectedEvent(event);\n    const { data: { user: authUser } } = await supabase.auth.getUser();\n    setUserEmail(authUser?.email || \"\");\n    setDialogOpen(true);\n  };\n\n  const closeDialog = () => {\n    setDialogOpen(false);\n    setSelectedEvent(null);\n  };\n\n  if (isLoading) {\n    return (\n      <main className=\"container mx-auto px-4 lg:px-6 py-8\">\n        <div className=\"mb-8\">\n          <Skeleton className=\"h-9 w-48 mb-2\" />\n          <Skeleton className=\"h-5 w-72\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i}>\n              <CardHeader>\n                <Skeleton className=\"h-6 w-3/4\" />\n                <Skeleton className=\"h-4 w-full mt-2\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-4 w-1/2\" />\n              </CardContent>\n              <CardFooter>\n                <Skeleton className=\"h-9 w-24\" />\n              </CardFooter>\n            </Card>\n          ))}\n        </div>\n      </main>\n    );\n  }\n\n  const activeEvents = events || [];\n\n  return (\n    <main className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"heading-basvurular\">\n          Başvurular\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Aktif etkinlikleri görüntüleyin ve başvurun\n        </p>\n      </div>\n\n      {activeEvents.length === 0 ? (\n        <EmptyState\n          icon={Calendar}\n          title=\"Aktif etkinlik bulunamadı\"\n          description=\"Şu anda başvuruya açık etkinlik bulunmuyor. Daha sonra tekrar kontrol edin.\"\n        />\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {activeEvents.map((event) => (\n            <EventCard\n              key={event.id}\n              event={event}\n              onApply={() => openApplicationDialog(event)}\n            />\n          ))}\n        </div>\n      )}\n\n      {selectedEvent && (\n        <ApplicationDialog\n          event={selectedEvent}\n          open={dialogOpen}\n          onOpenChange={setDialogOpen}\n          onClose={closeDialog}\n          profile={profile}\n          userEmail={userEmail}\n        />\n      )}\n    </main>\n  );\n}\n\ninterface EventCardProps {\n  event: EventWithStatus;\n  onApply: () => void;\n}\n\nfunction EventCard({ event, onApply }: EventCardProps) {\n  const formFields = (event.form_fields || []) as FormField[];\n  \n  return (\n    <Card className=\"flex flex-col\" data-testid={`card-event-${event.id}`}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between gap-2\">\n          <CardTitle className=\"text-lg\" data-testid={`text-event-name-${event.id}`}>\n            {event.name}\n          </CardTitle>\n          {event.has_applied && (\n            <Badge variant=\"default\" className=\"bg-green-600 hover:bg-green-700 shrink-0\" data-testid={`badge-applied-${event.id}`}>\n              <Check className=\"h-3 w-3 mr-1\" />\n              Başvurdunuz\n            </Badge>\n          )}\n        </div>\n        {event.description && (\n          <CardDescription className=\"line-clamp-3\" data-testid={`text-event-description-${event.id}`}>\n            {event.description}\n          </CardDescription>\n        )}\n      </CardHeader>\n      <CardContent className=\"flex-1\">\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <FileText className=\"h-4 w-4\" />\n          <span data-testid={`text-field-count-${event.id}`}>\n            {formFields.length} form alanı\n          </span>\n        </div>\n      </CardContent>\n      <CardFooter>\n        <Button\n          onClick={onApply}\n          disabled={event.has_applied}\n          className=\"w-full\"\n          data-testid={`button-apply-${event.id}`}\n        >\n          {event.has_applied ? (\n            <>\n              <Check className=\"h-4 w-4 mr-2\" />\n              Başvuru Yapıldı\n            </>\n          ) : (\n            <>\n              <ClipboardList className=\"h-4 w-4 mr-2\" />\n              Başvur\n            </>\n          )}\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}\n\ninterface ApplicationDialogProps {\n  event: EventWithStatus;\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onClose: () => void;\n  profile: {\n    first_name: string | null;\n    last_name: string | null;\n    class_name: string | null;\n  } | null;\n  userEmail: string;\n}\n\nfunction ApplicationDialog({ event, open, onOpenChange, onClose, profile, userEmail }: ApplicationDialogProps) {\n  const { toast } = useToast();\n  const formFields = (event.form_fields || []) as FormField[];\n\n  const dynamicSchema = z.object(\n    formFields.reduce((acc, field) => {\n      if (field.required) {\n        acc[field.id] = z.string().min(1, `${field.label} alanı zorunludur`);\n      } else {\n        acc[field.id] = z.string().optional();\n      }\n      return acc;\n    }, {} as Record<string, z.ZodTypeAny>)\n  );\n\n  const form = useForm<Record<string, string>>({\n    resolver: zodResolver(dynamicSchema),\n    defaultValues: formFields.reduce((acc, field) => {\n      acc[field.id] = \"\";\n      return acc;\n    }, {} as Record<string, string>),\n  });\n\n  const applyMutation = useMutation({\n    mutationFn: (responses: Record<string, string>) => applyToEvent(event.id, responses),\n    onSuccess: () => {\n      toast({ description: \"Başvurunuz başarıyla gönderildi!\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/events\"] });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        description: error.message || \"Başvuru gönderilirken hata oluştu\",\n      });\n    },\n  });\n\n  const onSubmit = (data: Record<string, string>) => {\n    applyMutation.mutate(data);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle data-testid=\"dialog-title-event\">\n            {event.name}\n          </DialogTitle>\n          {event.description && (\n            <DialogDescription data-testid=\"dialog-description-event\">\n              {event.description}\n            </DialogDescription>\n          )}\n        </DialogHeader>\n\n        <div className=\"space-y-6 pt-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted rounded-lg\">\n            <div>\n              <Label className=\"text-xs text-muted-foreground\">Ad</Label>\n              <Input\n                value={profile?.first_name || \"\"}\n                readOnly\n                className=\"bg-background\"\n                data-testid=\"input-user-firstname\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-xs text-muted-foreground\">Soyad</Label>\n              <Input\n                value={profile?.last_name || \"\"}\n                readOnly\n                className=\"bg-background\"\n                data-testid=\"input-user-lastname\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-xs text-muted-foreground\">E-posta</Label>\n              <Input\n                value={userEmail}\n                readOnly\n                className=\"bg-background\"\n                data-testid=\"input-user-email\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-xs text-muted-foreground\">Sınıf</Label>\n              <Input\n                value={profile?.class_name || \"\"}\n                readOnly\n                className=\"bg-background\"\n                data-testid=\"input-user-class\"\n              />\n            </div>\n          </div>\n\n          {formFields.length > 0 && (\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                {formFields.map((field) => (\n                  <FormFieldComponent\n                    key={field.id}\n                    control={form.control}\n                    name={field.id}\n                    render={({ field: formFieldProps }) => (\n                      <FormItem>\n                        <FormLabel data-testid={`label-field-${field.id}`}>\n                          {field.label}\n                          {field.required && <span className=\"text-destructive ml-1\">*</span>}\n                        </FormLabel>\n                        <FormControl>\n                          {field.type === \"textarea\" ? (\n                            <Textarea\n                              {...formFieldProps}\n                              placeholder={`${field.label} giriniz...`}\n                              data-testid={`input-field-${field.id}`}\n                            />\n                          ) : field.type === \"select\" ? (\n                            <Select\n                              value={formFieldProps.value}\n                              onValueChange={formFieldProps.onChange}\n                            >\n                              <SelectTrigger data-testid={`select-field-${field.id}`}>\n                                <SelectValue placeholder=\"Seçiniz...\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {(field.options || []).map((option) => (\n                                  <SelectItem key={option} value={option}>\n                                    {option}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          ) : (\n                            <Input\n                              {...formFieldProps}\n                              placeholder={`${field.label} giriniz...`}\n                              data-testid={`input-field-${field.id}`}\n                            />\n                          )}\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                ))}\n\n                <div className=\"flex justify-end gap-3 pt-4\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={onClose}\n                    data-testid=\"button-cancel-apply\"\n                  >\n                    İptal\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={applyMutation.isPending}\n                    data-testid=\"button-submit-apply\"\n                  >\n                    {applyMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        Gönderiliyor...\n                      </>\n                    ) : (\n                      \"Başvuruyu Gönder\"\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          )}\n\n          {formFields.length === 0 && (\n            <div className=\"flex justify-end gap-3 pt-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={onClose}\n                data-testid=\"button-cancel-apply\"\n              >\n                İptal\n              </Button>\n              <Button\n                onClick={() => applyMutation.mutate({})}\n                disabled={applyMutation.isPending}\n                data-testid=\"button-submit-apply\"\n              >\n                {applyMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Gönderiliyor...\n                  </>\n                ) : (\n                  \"Başvuruyu Gönder\"\n                )}\n              </Button>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":13953,"size_tokens":null},"client/src/pages/AddEmail.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Mail, Loader2 } from \"lucide-react\";\nimport mayaLogo from \"@assets/maya-okullari-logo-simge_1763489344712.webp\";\n\nexport default function AddEmail() {\n  const [, setLocation] = useLocation();\n  const { session } = useAuth();\n  const { toast } = useToast();\n  const [email, setEmail] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: \"Geçerli bir e-posta adresi giriniz\",\n      });\n      return;\n    }\n    \n    setLoading(true);\n    \n    try {\n      const response = await fetch('/api/auth/add-email', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${session?.access_token}`,\n        },\n        body: JSON.stringify({ email: email.trim() }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'E-posta eklenirken bir hata oluştu');\n      }\n      \n      toast({\n        title: \"Başarılı\",\n        description: \"E-posta adresiniz eklendi. Anasayfaya yönlendiriliyorsunuz...\",\n      });\n      \n      setLocation(\"/\");\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Hata\",\n        description: error.message || \"E-posta eklenirken bir hata oluştu\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <img \n              src={mayaLogo} \n              alt=\"Maya Okulları\" \n              className=\"h-12 w-12 object-contain\"\n            />\n          </div>\n          <CardTitle className=\"text-2xl text-center\">E-posta Ekle</CardTitle>\n          <CardDescription className=\"text-center\">\n            Hesabınıza bir e-posta adresi eklemeniz gerekmektedir. Bu adres şifre sıfırlama ve bildirimler için kullanılacaktır.\n          </CardDescription>\n        </CardHeader>\n        <form onSubmit={handleSubmit} noValidate>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">E-posta Adresi</Label>\n              <div className=\"relative\">\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"ornek@email.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  className=\"pl-10\"\n                  required\n                  data-testid=\"input-add-email\"\n                />\n              </div>\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={loading} data-testid=\"button-submit-email\">\n              {loading ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Ekleniyor...\n                </>\n              ) : (\n                \"E-posta Ekle\"\n              )}\n            </Button>\n          </CardContent>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":3912,"size_tokens":null},"client/src/lib/api/analytics.ts":{"content":"import { supabase } from '../supabase';\n\nexport interface PollAnalytics {\n  id: string;\n  question: string;\n  isOpen: boolean;\n  resultsPublished: boolean;\n  createdAt: string;\n  totalVotes: number;\n  uniqueVoters: number;\n  participationRate: number;\n  options: {\n    id: string;\n    text: string;\n    votes: number;\n  }[];\n}\n\nexport interface AnalyticsOverview {\n  totalUsers: number;\n  studentCount: number;\n  teacherCount: number;\n  adminCount: number;\n  totalPolls: number;\n  activePolls: number;\n  closedPolls: number;\n  totalVotes: number;\n  uniqueVoters: number;\n  participationRate: number;\n  totalIdeas: number;\n  approvedIdeas: number;\n  pendingIdeas: number;\n  rejectedIdeas: number;\n  totalAnnouncements: number;\n  totalComments: number;\n  approvedComments: number;\n  totalEvents: number;\n  activeEvents: number;\n  totalApplications: number;\n}\n\nexport interface AnalyticsData {\n  overview: AnalyticsOverview;\n  polls: PollAnalytics[];\n  classDistribution: Record<string, number>;\n  votesByClass: Record<string, number>;\n}\n\nasync function getAuthHeaders(): Promise<HeadersInit> {\n  const { data: { session } } = await supabase.auth.getSession();\n  if (!session) throw new Error('Giriş yapmanız gerekiyor');\n  return {\n    'Content-Type': 'application/json',\n    'Authorization': `Bearer ${session.access_token}`,\n  };\n}\n\nexport async function getAnalytics(): Promise<AnalyticsData> {\n  const headers = await getAuthHeaders();\n  const res = await fetch('/api/admin/analytics', { headers, credentials: 'include' });\n  \n  if (!res.ok) {\n    const error = await res.json();\n    throw new Error(error.error || 'Analiz verileri yüklenirken hata oluştu');\n  }\n  \n  return res.json();\n}\n","path":null,"size_bytes":1695,"size_tokens":null},"client/src/contexts/ThemeContext.tsx":{"content":"import { createContext, useContext, useEffect, useState } from 'react';\n\nexport type DesignTheme = 'maya' | 'framer';\nexport type ColorMode = 'light' | 'dark';\n\ninterface ThemeContextType {\n  designTheme: DesignTheme;\n  colorMode: ColorMode;\n  setDesignTheme: (theme: DesignTheme) => void;\n  setColorMode: (mode: ColorMode) => void;\n  toggleColorMode: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nconst THEME_STORAGE_KEY = 'maya-design-theme';\nconst COLOR_MODE_STORAGE_KEY = 'maya-color-mode';\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [designTheme, setDesignThemeState] = useState<DesignTheme>(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem(THEME_STORAGE_KEY);\n      if (saved === 'maya' || saved === 'framer') return saved;\n    }\n    return 'maya';\n  });\n\n  const [colorMode, setColorModeState] = useState<ColorMode>(() => {\n    if (typeof window !== 'undefined') {\n      const saved = localStorage.getItem(COLOR_MODE_STORAGE_KEY);\n      if (saved === 'light' || saved === 'dark') return saved;\n      if (window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';\n    }\n    return 'dark';\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    \n    root.classList.remove('theme-maya', 'theme-framer', 'light', 'dark');\n    root.classList.add(`theme-${designTheme}`);\n    root.classList.add(colorMode);\n    \n    localStorage.setItem(THEME_STORAGE_KEY, designTheme);\n    localStorage.setItem(COLOR_MODE_STORAGE_KEY, colorMode);\n  }, [designTheme, colorMode]);\n\n  const setDesignTheme = (theme: DesignTheme) => {\n    setDesignThemeState(theme);\n  };\n\n  const setColorMode = (mode: ColorMode) => {\n    setColorModeState(mode);\n  };\n\n  const toggleColorMode = () => {\n    setColorModeState(prev => prev === 'light' ? 'dark' : 'light');\n  };\n\n  return (\n    <ThemeContext.Provider value={{ \n      designTheme, \n      colorMode, \n      setDesignTheme, \n      setColorMode, \n      toggleColorMode \n    }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":2320,"size_tokens":null},"client/src/lib/api/activity.ts":{"content":"import { supabase } from '../supabase';\nimport type { ActionLog } from '@shared/schema';\n\ninterface ActivityLogResponse {\n  logs: ActionLog[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\nexport async function fetchActivityLog(): Promise<ActionLog[]> {\n  const { data: { session } } = await supabase.auth.getSession();\n  \n  if (!session?.access_token) {\n    throw new Error('Authentication required');\n  }\n\n  const response = await fetch('/api/activity-log', {\n    headers: {\n      'Authorization': `Bearer ${session.access_token}`,\n    },\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    throw new Error(error.error || 'Failed to fetch activity log');\n  }\n\n  const data: ActivityLogResponse = await response.json();\n  return data.logs;\n}\n","path":null,"size_bytes":774,"size_tokens":null},"client/src/pages/ActivityLog.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Vote, \n  Heart, \n  MessageSquare, \n  ThumbsDown, \n  FileEdit, \n  UserCheck,\n  Clock,\n  History,\n  LogIn,\n  LogOut,\n  Trash2,\n  Lightbulb,\n  Image,\n  Camera,\n  Key,\n  Mail,\n  ClipboardList,\n  Star\n} from \"lucide-react\";\nimport dayjs from \"dayjs\";\nimport relativeTime from \"dayjs/plugin/relativeTime\";\nimport utc from \"dayjs/plugin/utc\";\nimport timezone from \"dayjs/plugin/timezone\";\nimport \"dayjs/locale/tr\";\nimport type { ActionLog as ActionLogType, ActionType } from \"@shared/schema\";\nimport { fetchActivityLog } from \"@/lib/api/activity\";\n\ndayjs.extend(relativeTime);\ndayjs.extend(utc);\ndayjs.extend(timezone);\ndayjs.locale(\"tr\");\n\nconst actionConfig: Record<ActionType, { icon: React.ElementType; label: string; color: string }> = {\n  'LOGIN': { icon: LogIn, label: 'Giriş yaptı', color: 'bg-indigo-500' },\n  'LOGOUT': { icon: LogOut, label: 'Çıkış yaptı', color: 'bg-gray-500' },\n  'VOTE_CAST': { icon: Vote, label: 'Oy kullandı', color: 'bg-blue-500' },\n  'VOTE_CHANGED': { icon: FileEdit, label: 'Oy değiştirdi', color: 'bg-blue-400' },\n  'COMMENT_CREATED': { icon: MessageSquare, label: 'Yorum yaptı', color: 'bg-green-500' },\n  'COMMENT_EDITED': { icon: FileEdit, label: 'Yorum düzenledi', color: 'bg-green-400' },\n  'COMMENT_DELETED': { icon: Trash2, label: 'Yorum sildi', color: 'bg-red-400' },\n  'ANNOUNCEMENT_COMMENT_CREATED': { icon: MessageSquare, label: 'Duyuruya yorum yaptı', color: 'bg-purple-500' },\n  'ANNOUNCEMENT_COMMENT_EDITED': { icon: FileEdit, label: 'Duyuru yorumunu düzenledi', color: 'bg-purple-400' },\n  'ANNOUNCEMENT_COMMENT_DELETED': { icon: Trash2, label: 'Duyuru yorumunu sildi', color: 'bg-red-400' },\n  'LIKE_ADDED': { icon: Heart, label: 'Beğendi', color: 'bg-pink-500' },\n  'LIKE_REMOVED': { icon: ThumbsDown, label: 'Beğeni kaldırdı', color: 'bg-gray-400' },\n  'IDEA_CREATED': { icon: Lightbulb, label: 'Fikir paylaştı', color: 'bg-yellow-500' },\n  'IDEA_DELETED': { icon: Trash2, label: 'Fikir sildi', color: 'bg-red-400' },\n  'PROFILE_UPDATED': { icon: UserCheck, label: 'Profil güncelledi', color: 'bg-orange-500' },\n  'PROFILE_PHOTO_UPLOADED': { icon: Camera, label: 'Profil fotoğrafı yükledi', color: 'bg-teal-500' },\n  'PROFILE_PHOTO_RESET': { icon: Image, label: 'Profil fotoğrafı sıfırladı', color: 'bg-gray-400' },\n  'PASSWORD_CHANGED': { icon: Key, label: 'Şifre değiştirdi', color: 'bg-amber-500' },\n  'EMAIL_CHANGED': { icon: Mail, label: 'E-posta değiştirdi', color: 'bg-cyan-500' },\n  'EVENT_APPLICATION_SUBMITTED': { icon: ClipboardList, label: 'Etkinliğe başvurdu', color: 'bg-emerald-500' },\n  'USER_SUSPENDED': { icon: UserCheck, label: 'Kullanıcı askıya alındı', color: 'bg-red-500' },\n  'USER_ACTIVATED': { icon: UserCheck, label: 'Kullanıcı aktifleştirildi', color: 'bg-green-600' },\n  'TERMS_ACCEPTED': { icon: ClipboardList, label: 'Şartları kabul etti', color: 'bg-blue-600' },\n};\n\nfunction ActivityItem({ activity }: { activity: ActionLogType }) {\n  const config = actionConfig[activity.action_type] || { \n    icon: Clock, \n    label: activity.action_type, \n    color: 'bg-gray-500' \n  };\n  const Icon = config.icon;\n\n  return (\n    <div \n      className=\"flex items-start gap-4 p-4 border-b last:border-b-0 hover:bg-muted/30 transition-colors\"\n      data-testid={`activity-item-${activity.id}`}\n    >\n      <div className={`p-2 rounded-full ${config.color} text-white shrink-0`}>\n        <Icon className=\"h-4 w-4\" />\n      </div>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <span className=\"font-medium text-foreground\">{config.label}</span>\n          {activity.target_type && (\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {activity.target_type === 'poll' && 'Oylama'}\n              {activity.target_type === 'idea' && 'Fikir'}\n              {activity.target_type === 'announcement' && 'Duyuru'}\n              {!['poll', 'idea', 'announcement'].includes(activity.target_type) && activity.target_type}\n            </Badge>\n          )}\n        </div>\n        {activity.details && (\n          <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n            {activity.details}\n          </p>\n        )}\n        <div className=\"flex items-center gap-1 mt-2 text-xs text-muted-foreground\">\n          <Clock className=\"h-3 w-3\" />\n          <span>{dayjs.utc(activity.created_at).local().fromNow()}</span>\n          <span className=\"mx-1\">-</span>\n          <span>{dayjs.utc(activity.created_at).local().format('D MMMM YYYY, HH:mm')}</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function ActivityLog() {\n  const { user } = useAuth();\n\n  const { data: activities, isLoading, error } = useQuery<ActionLogType[]>({\n    queryKey: ['/api/activity-log'],\n    queryFn: fetchActivityLog,\n    enabled: !!user,\n  });\n\n  if (!user) {\n    return (\n      <main className=\"container mx-auto py-6 px-4\">\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <p className=\"text-muted-foreground\">\n              Aktivite geçmişini görmek için giriş yapmalısınız.\n            </p>\n          </CardContent>\n        </Card>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"container mx-auto py-6 px-4 max-w-3xl\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-full bg-primary/10\">\n              <History className=\"h-5 w-5 text-primary\" />\n            </div>\n            <div>\n              <CardTitle>Aktivite Geçmişi</CardTitle>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Son 50 aktiviteniz\n              </p>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          {isLoading ? (\n            <div className=\"p-4 space-y-4\">\n              {[1, 2, 3, 4, 5].map((i) => (\n                <div key={i} className=\"flex items-start gap-4\">\n                  <Skeleton className=\"h-10 w-10 rounded-full\" />\n                  <div className=\"flex-1 space-y-2\">\n                    <Skeleton className=\"h-4 w-32\" />\n                    <Skeleton className=\"h-3 w-48\" />\n                    <Skeleton className=\"h-3 w-24\" />\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : error ? (\n            <div className=\"p-8 text-center text-muted-foreground\">\n              Aktiviteler yüklenirken bir hata oluştu.\n            </div>\n          ) : activities && activities.length > 0 ? (\n            <div className=\"divide-y\">\n              {activities.map((activity) => (\n                <ActivityItem key={activity.id} activity={activity} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"p-8 text-center\">\n              <History className=\"h-12 w-12 mx-auto text-muted-foreground/30 mb-3\" />\n              <p className=\"text-muted-foreground\">\n                Henüz bir aktiviteniz bulunmuyor.\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Oylama yapın, fikir beğenin veya yorum yazın!\n              </p>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </main>\n  );\n}\n","path":null,"size_bytes":7545,"size_tokens":null},"client/src/components/ThemeSwitcher.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Palette, Sun, Moon, Sparkles, GraduationCap } from \"lucide-react\";\nimport { useTheme, type DesignTheme } from \"@/contexts/ThemeContext\";\n\nexport function ThemeSwitcher() {\n  const { designTheme, colorMode, setDesignTheme, toggleColorMode } = useTheme();\n\n  const themes: { id: DesignTheme; name: string; icon: typeof Sparkles; description: string }[] = [\n    { \n      id: 'maya', \n      name: 'Maya Klasik', \n      icon: GraduationCap, \n      description: 'Mor ve beyaz okul teması' \n    },\n    { \n      id: 'framer', \n      name: 'Modern', \n      icon: Sparkles, \n      description: 'Cam efektli modern tasarım' \n    },\n  ];\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-theme-switcher\">\n          <Palette className=\"h-5 w-5\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-56\">\n        <DropdownMenuLabel>Tema Seçimi</DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        \n        {themes.map((theme) => (\n          <DropdownMenuItem\n            key={theme.id}\n            onClick={() => setDesignTheme(theme.id)}\n            className=\"flex items-center gap-3 cursor-pointer\"\n            data-testid={`menu-item-theme-${theme.id}`}\n          >\n            <theme.icon className={`h-4 w-4 ${designTheme === theme.id ? 'text-primary' : ''}`} />\n            <div className=\"flex-1\">\n              <div className={`text-sm font-medium ${designTheme === theme.id ? 'text-primary' : ''}`}>\n                {theme.name}\n              </div>\n              <div className=\"text-xs text-muted-foreground\">{theme.description}</div>\n            </div>\n            {designTheme === theme.id && (\n              <div className=\"h-2 w-2 rounded-full bg-primary\" />\n            )}\n          </DropdownMenuItem>\n        ))}\n        \n        <DropdownMenuSeparator />\n        <DropdownMenuLabel>Renk Modu</DropdownMenuLabel>\n        \n        <DropdownMenuItem \n          onClick={toggleColorMode} \n          className=\"flex items-center gap-3 cursor-pointer\"\n          data-testid=\"menu-item-toggle-color-mode\"\n        >\n          {colorMode === 'dark' ? (\n            <>\n              <Sun className=\"h-4 w-4\" />\n              <span>Açık Mod</span>\n            </>\n          ) : (\n            <>\n              <Moon className=\"h-4 w-4\" />\n              <span>Koyu Mod</span>\n            </>\n          )}\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":2760,"size_tokens":null},"client/src/pages/Takvim.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { getEvents, type EventWithStatus } from \"@/lib/api/events\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport EmptyState from \"@/components/EmptyState\";\nimport { \n  ChevronLeft, \n  ChevronRight, \n  Calendar as CalendarIcon,\n  Clock,\n  MapPin,\n  Check\n} from \"lucide-react\";\nimport dayjs from \"dayjs\";\nimport \"dayjs/locale/tr\";\n\ndayjs.locale(\"tr\");\n\nconst DAYS_OF_WEEK = [\"Pzt\", \"Sal\", \"Çar\", \"Per\", \"Cum\", \"Cmt\", \"Paz\"];\nconst MONTHS = [\n  \"Ocak\", \"Şubat\", \"Mart\", \"Nisan\", \"Mayıs\", \"Haziran\",\n  \"Temmuz\", \"Ağustos\", \"Eylül\", \"Ekim\", \"Kasım\", \"Aralık\"\n];\n\nexport default function Takvim() {\n  const { user } = useAuth();\n  const [currentDate, setCurrentDate] = useState(dayjs());\n  const [selectedDate, setSelectedDate] = useState<dayjs.Dayjs | null>(null);\n\n  const { data: events, isLoading } = useQuery({\n    queryKey: [\"/api/events\"],\n    queryFn: getEvents,\n    enabled: !!user,\n  });\n\n  const eventsWithDates = useMemo(() => {\n    if (!events) return [];\n    return events.filter(event => event.event_date);\n  }, [events]);\n\n  const eventsByDate = useMemo(() => {\n    const map = new Map<string, EventWithStatus[]>();\n    eventsWithDates.forEach(event => {\n      if (event.event_date) {\n        const dateKey = dayjs(event.event_date).format(\"YYYY-MM-DD\");\n        if (!map.has(dateKey)) {\n          map.set(dateKey, []);\n        }\n        map.get(dateKey)!.push(event);\n      }\n    });\n    return map;\n  }, [eventsWithDates]);\n\n  const calendarDays = useMemo(() => {\n    const startOfMonth = currentDate.startOf(\"month\");\n    const endOfMonth = currentDate.endOf(\"month\");\n    const startDay = startOfMonth.day();\n    const adjustedStartDay = startDay === 0 ? 6 : startDay - 1;\n    \n    const days: (dayjs.Dayjs | null)[] = [];\n    \n    for (let i = 0; i < adjustedStartDay; i++) {\n      days.push(null);\n    }\n    \n    let day = startOfMonth;\n    while (day.isBefore(endOfMonth) || day.isSame(endOfMonth, \"day\")) {\n      days.push(day);\n      day = day.add(1, \"day\");\n    }\n    \n    while (days.length % 7 !== 0) {\n      days.push(null);\n    }\n    \n    return days;\n  }, [currentDate]);\n\n  const selectedDateEvents = useMemo(() => {\n    if (!selectedDate) return [];\n    const dateKey = selectedDate.format(\"YYYY-MM-DD\");\n    return eventsByDate.get(dateKey) || [];\n  }, [selectedDate, eventsByDate]);\n\n  const goToPreviousMonth = () => {\n    setCurrentDate(currentDate.subtract(1, \"month\"));\n  };\n\n  const goToNextMonth = () => {\n    setCurrentDate(currentDate.add(1, \"month\"));\n  };\n\n  const goToToday = () => {\n    setCurrentDate(dayjs());\n    setSelectedDate(dayjs());\n  };\n\n  if (isLoading) {\n    return (\n      <main className=\"container mx-auto px-4 lg:px-6 py-8\">\n        <div className=\"mb-8\">\n          <Skeleton className=\"h-9 w-48 mb-2\" />\n          <Skeleton className=\"h-5 w-72\" />\n        </div>\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <div className=\"lg:col-span-2\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-80 w-full\" />\n              </CardContent>\n            </Card>\n          </div>\n          <div>\n            <Card>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-40 w-full\" />\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"container mx-auto px-4 lg:px-6 py-8\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"heading-takvim\">\n          Etkinlik Takvimi\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Okul etkinliklerini takvim görünümünde inceleyin\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2\">\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex items-center justify-between gap-4\">\n                <CardTitle className=\"text-xl\">\n                  {MONTHS[currentDate.month()]} {currentDate.year()}\n                </CardTitle>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={goToToday}\n                    data-testid=\"button-today\"\n                  >\n                    Bugün\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={goToPreviousMonth}\n                    data-testid=\"button-prev-month\"\n                  >\n                    <ChevronLeft className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={goToNextMonth}\n                    data-testid=\"button-next-month\"\n                  >\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-7 gap-1 mb-2\">\n                {DAYS_OF_WEEK.map((day) => (\n                  <div\n                    key={day}\n                    className=\"text-center text-sm font-medium text-muted-foreground py-2\"\n                  >\n                    {day}\n                  </div>\n                ))}\n              </div>\n              \n              <div className=\"grid grid-cols-7 gap-1\">\n                {calendarDays.map((day, index) => {\n                  if (!day) {\n                    return <div key={`empty-${index}`} className=\"aspect-square\" />;\n                  }\n                  \n                  const dateKey = day.format(\"YYYY-MM-DD\");\n                  const dayEvents = eventsByDate.get(dateKey) || [];\n                  const isToday = day.isSame(dayjs(), \"day\");\n                  const isSelected = selectedDate && day.isSame(selectedDate, \"day\");\n                  const hasEvents = dayEvents.length > 0;\n                  \n                  return (\n                    <button\n                      key={dateKey}\n                      onClick={() => setSelectedDate(day)}\n                      className={`\n                        aspect-square p-1 rounded-lg flex flex-col items-center justify-start\n                        transition-all hover-elevate\n                        ${isToday ? \"ring-2 ring-primary ring-offset-2 ring-offset-background\" : \"\"}\n                        ${isSelected ? \"bg-primary text-primary-foreground\" : \"\"}\n                        ${!isSelected && hasEvents ? \"bg-accent\" : \"\"}\n                      `}\n                      data-testid={`calendar-day-${dateKey}`}\n                    >\n                      <span className={`text-sm font-medium ${isSelected ? \"\" : isToday ? \"text-primary\" : \"\"}`}>\n                        {day.date()}\n                      </span>\n                      {hasEvents && (\n                        <div className=\"flex gap-0.5 mt-1 flex-wrap justify-center\">\n                          {dayEvents.slice(0, 3).map((_, i) => (\n                            <div\n                              key={i}\n                              className={`w-1.5 h-1.5 rounded-full ${isSelected ? \"bg-primary-foreground\" : \"bg-primary\"}`}\n                            />\n                          ))}\n                        </div>\n                      )}\n                    </button>\n                  );\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div>\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <CalendarIcon className=\"h-5 w-5\" />\n                {selectedDate \n                  ? selectedDate.format(\"D MMMM YYYY\") \n                  : \"Tarih Seçin\"\n                }\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {!selectedDate ? (\n                <p className=\"text-muted-foreground text-sm\">\n                  Etkinlikleri görmek için takvimden bir gün seçin.\n                </p>\n              ) : selectedDateEvents.length === 0 ? (\n                <p className=\"text-muted-foreground text-sm\">\n                  Bu tarihte etkinlik bulunmuyor.\n                </p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {selectedDateEvents.map((event) => (\n                    <EventCard key={event.id} event={event} />\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"mt-4\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Yaklaşan Etkinlikler</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {eventsWithDates.length === 0 ? (\n                <p className=\"text-muted-foreground text-sm\">\n                  Yaklaşan etkinlik bulunmuyor.\n                </p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {eventsWithDates\n                    .filter(e => e.event_date && dayjs(e.event_date).isAfter(dayjs().subtract(1, \"day\")))\n                    .sort((a, b) => dayjs(a.event_date).diff(dayjs(b.event_date)))\n                    .slice(0, 5)\n                    .map((event) => (\n                      <EventCard key={event.id} event={event} showDate />\n                    ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </main>\n  );\n}\n\ninterface EventCardProps {\n  event: EventWithStatus;\n  showDate?: boolean;\n}\n\nfunction EventCard({ event, showDate = false }: EventCardProps) {\n  return (\n    <div \n      className=\"p-3 rounded-lg bg-muted hover-elevate transition-all\"\n      data-testid={`event-card-${event.id}`}\n    >\n      <div className=\"flex items-start justify-between gap-2\">\n        <h4 className=\"font-medium text-sm\" data-testid={`text-event-name-${event.id}`}>\n          {event.name}\n        </h4>\n        {event.has_applied && (\n          <Badge variant=\"default\" className=\"bg-green-600 shrink-0 text-xs\">\n            <Check className=\"h-3 w-3 mr-1\" />\n            Başvurdunuz\n          </Badge>\n        )}\n      </div>\n      \n      {event.description && (\n        <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n          {event.description}\n        </p>\n      )}\n      \n      {showDate && event.event_date && (\n        <div className=\"flex items-center gap-1 mt-2 text-xs text-muted-foreground\">\n          <Clock className=\"h-3 w-3\" />\n          <span>{dayjs(event.event_date).format(\"D MMMM YYYY, HH:mm\")}</span>\n        </div>\n      )}\n      \n      {!showDate && event.event_date && (\n        <div className=\"flex items-center gap-1 mt-2 text-xs text-muted-foreground\">\n          <Clock className=\"h-3 w-3\" />\n          <span>{dayjs(event.event_date).format(\"HH:mm\")}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11392,"size_tokens":null}},"version":2}